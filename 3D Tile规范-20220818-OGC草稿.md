# 3D Tile 规范

![开放地理空间联盟](https://image.baidu.com/search/down?url=https://tvax3.sinaimg.cn/large/9d0983efgy1hduazo23g9j208c02tgmj.jpg)

帕特里克科齐编辑肖恩·里利编辑

提交日期：2022-08-18

批准日期：待定

发布日期：待定

此 OGC® 文档的外部标识符：待定

此 OGC® 文档的内部标识符：22-025r2

此 OGC® 文档的 URL：[这里](https://portal.ogc.org/files/102132)

版本： 1.1.0

附加格式： [PDF](https://portal.ogc.org/files/Specification.pdf)

OGC 社区标准

工作项目草案

# 草稿通知

本文件不是 OGC 标准。分发本文档以供审阅和评论。本文档如有更改，恕不另行通知，并且不得称为 OGC 标准。

邀请本文件的收件人连同他们的评论一起提交他们知道的任何相关专利权的通知，并提供支持文件。

| 文件号码：   | 22-025r2     |
| :----------- | :----------- |
| 文件类型：   | OGC 社区标准 |
| 文档子类型： |              |
| 文档阶段：   | 工作项目草案 |
| 文档语言：   | 英语         |

# 版权声明

版权所有 © 2022 Open Geospatial Consortium\
要获得其他使用权，请访问  <http://www.ogc.org/legal/>

# 笔记

请注意本文档的某些元素可能是专利权的主题。开放地理空间联盟不负责识别任何或所有此类专利权。

本文件的收件人被要求连同他们的评论一起提交他们可能知道的任何相关专利权利要求或其他知识产权的通知，这些权利可能会被本文件中规定的标准的任何实施所侵犯，并提供支持文档。

# 许可协议

Open Geospatial Consortium("许可方")特此免费授予任何获得本知识产权和任何相关文件副本的人，并在遵守下列条款的前提下，在不使用知识产权的情况下处理知识产权限制(下文规定的除外)，包括但不限于实施、使用、复制、修改、合并、发布、分发和/或再许可知识产权副本的权利，以及允许向其提供知识产权的人这样做，前提是知识产权的所有版权声明都完整保留，并且知识产权提供给的每个人都同意本协议的条款。

如果您修改知识产权，则除上述版权声明外，修改后的知识产权的所有副本还必须包括知识产权包含未经许可人批准或采用的修改的通知。

本许可仅为版权许可，不转让任何可能在世界任何地方生效的专利项下的任何权利。知识产权按"原样"提供，不附有任何明示或暗示的保证，包括但不限于对适销性、特定用途的适用性和不侵犯第三方权利的保证。本通知中包含的版权持有人或持有人不保证知识产权中包含的功能将满足您的要求，或者知识产权的运行不会中断或没有错误。对知识产权的任何使用均应完全由用户自行承担风险。

本许可在终止前有效。您可以随时通过销毁知识产权连同任何形式的所有副本来终止它。如果您未能遵守本协议的任何条款或条件，许可也将终止。除以下句子中另有规定外，本许可的此类终止不得要求终止任何第三方最终用户对知识产权的再许可，该再许可在此类终止通知发出之日有效。此外，如果知识产权或知识产权的运作侵犯第三方的任何专利、版权、商标或其他权利，或许可方认为可能侵犯第三方的任何专利、版权、商标或其他权利，您同意许可方单独审慎，可以终止本许可而不对您、您的被许可人或任何其他方承担任何补偿或责任。您同意以任何形式终止销毁或导致销毁知识产权以及任何形式的所有副本，无论是由您还是由任何第三方持有。

除本通知中包含的内容外，许可人或全部或部分知识产权的任何其他版权持有人的名称不得用于广告或以其他方式促进该知识产权的销售、使用或其他交易，除非事先事先许可人或此类版权持有人的书面授权。许可方现在是并将始终是可以授权您或任何第三方使用证明标志、商标或其他特殊名称以表明符合任何许可方标准或规范的唯一实体。本协议受马萨诸塞州联邦法律管辖。特此明确排除《联合国国际货物销售合同公约》对本协议的适用。如果本协议的任何条款被视为不可执行、无效或无效，则应修改此类条款以使其有效和可执行，并且经如此修改后的整个协议应保持完全有效。许可方的任何决定、作为或不作为均不得解释为放弃其可用的任何权利或补救措施。

不得违反美国出口法律法规下载或以其他方式出口或再出口任何知识产权或基础信息或技术。此外，您有责任遵守您所在司法管辖区内可能影响您进口、出口或使用知识产权的权利的任何当地法律，并且您声明您已遵守适用法律要求的任何法规或注册程序，以使此许可证可执行。

# I、摘要

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/af6bb654-b023-4564-a4a0-f2865850ef6e)

本文档描述了 3D Tiles 的规范，这是一种用于流式传输大量异构 3D 地理空间数据集的开放标准。

# II、关键字 v1

以下是搜索引擎和文档目录使用的关键字。

地形、地理空间、gis、点云、空间数据、矢量数据、摄影测量、gltf、3d 模型、3d tiles、元数据、隐式 Tile

# III、前言

3D Tiles 将图形研究、电影行业和游戏行业的技术引入 3D 地理空间，定义了空间数据结构和一组专为 3D 设计并针对流式传输和渲染进行了优化的图块格式。

# IV、安全考虑

本文档未考虑任何安全因素。

# V、报送单位

以下组织向开放地理空间联盟 (OGC) 提交了本文档：

- CesiumGS 公司

# VI、提交者

| name         | 联系          | OGC 会员 |
| :----------- | :------------ | :------- |
| 帕特里克科齐 | CesiumGS 公司 | 是的     |
| 肖恩·里利    | CesiumGS 公司 | 是的     |

# VII、未来的工作

3D Tiles 社区预计需要对该社区标准进行修订，以规定适合新用例的内容。这些用例可能来自(或两者)外部用户和开发人员社区，或者来自 OGC 审查和评论。此外，未来的修订将由任何提交的记录社区用例和要求的变更请求驱动。

# 1、适用范围

3D Tiles 专为流式传输和渲染大量 3D 地理空间内容而设计，例如摄影测量、3D 建筑、BIM/CAD、实例化 Feature 和点云。它定义了一个分层数据结构和一组提供可渲染内容的图块格式。3D Tiles 没有为内容的可视化定义明确的规则；客户端可以可视化 3D Tiles 数据，但它认为合适。

# 2、一致性

本文档的附件 A 描述了实现 3D Tiles 所需的对象和属性。一致性与这些元素相关，并通过关联的 3D Tiles [JSON Schema](https://portal.ogc.org/files/102132#json-schema)部分表达。

所有图表、示例、注释和背景信息均提供信息。

# 3、规范性引用文件

在文中引用下列文件时，其部分或全部内容构成本文件的要求。对于注明日期的参考文献，仅引用的版本适用。对于未注明日期的引用，适用引用文件的最新版本(包括任何修订)。

EPSG：4978，2020 年。[https://epsg.org/crs_4978/WGS-84.html](https://epsg.org/crs_4978/WGS-84.html)

EPSG：4979，2020 年。[https://epsg.org/crs_4979/WGS-84.html](https://epsg.org/crs_4979/WGS-84.html)

L. Masinter：IETF RFC 2397，_"数据"URL 方案_。(1998)。<https://www.rfc-editor.org/info/rfc2397>。

F. Yergeau：IETF RFC 3629，_UTF-8，ISO 10646 的一种转换格式_。(2003)。<https://www.rfc-editor.org/info/rfc3629>。

T. Berners-Lee、R. Fielding、L. Masinter：IETF RFC 3986，_统一资源标识符 (URI)：通用语法_。(2005)。<https://www.rfc-editor.org/info/rfc3986>。

T. Bray(编辑)：IETF RFC 8259，_JavaScript 对象表示法 (JSON) 数据交换格式_。(2017)。<https://www.rfc-editor.org/info/rfc8259>。

Khronos 集团：glTF 2.0，2021 年[。https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html)

Roger Lot：OGC 18-010r7，_地理信息 - 坐标参考系统的众所周知的文本表示_。开放地理空间联盟 (2019)。<https://docs.ogc.org/is/18-010r7/18-010r7.html>。

W3C css-color-3，_CSS 颜色模块级别 3_。<https://www.w3.org/TR/css-color-3/>。

# 4、术语和定义

[本文档使用 OGC 政策指令 49](https://portal.ogc.org/public_ogc/directives/directives.php)中定义的术语，该指令基于 ISO/IEC 指令，第 2 部分，国际标准的结构和起草规则。特别是，"应"(不是"必须")一词是动词形式，用于表示必须严格遵守以符合本文件的要求，OGC 文件不使用 ISO/IEC 指令第 2 部分中的等效短语.

本文档还使用 OGC 模块化规范标准 ( [OGC 08-131r3](https://portal.opengeospatial.org/files/?artifact_id=34762) ) 中定义的术语，也称为"ModSpec"。ModSpec 中提供了标准、规范、要求和一致性测试等术语的定义。

就本文件而言，适用以下附加术语和定义。

## 4.1. **可用性**

指定隐式瓦片集的单个子树中存在哪些瓦片/内容/子树的数据

## 4.2. **比特流**

存储为位序列而不是字节的布尔数组。

## 4.3. **边界体积**

完全包含一组几何对象的并集的封闭体积。参见[维基百科：边界体积](https://en.wikipedia.org/wiki/Bounding_volume)

## 4.4. **子树**

从隐式瓦片集的子树的最底部行中的可用瓦片可到达的子树

## 4.5. **实体**

在 3D Tiles 元数据的上下文中，实体是元数据类的实例，填充有符合元数据类定义的属性值

## 4.6. **Feature**

在 3D Tile 中，Tile 的单个组件，例如批处理 3D 模型中的 3D 模型或点云中包含位置、外观和元数据属性的点。

## 4.7. **几何误差**

瓦片的源几何图形的简化表示的差异(以米为单位)用于计算如果瓦片的内容被渲染而其子元素未被渲染时引入的屏幕空间错误。

## 4.8. **glTF**

用于 3D 资产的 API 中立运行时资产交付格式。

## 4.9. **分层详细程度 (HLOD)**

根据对象重要性或瓦片到观察点或相机位置的距离等指标降低 3D 表示的复杂性。通常，更高级别的细节提供更高的视觉保真度。参见[维基百科：详细程度](https://en.wikipedia.org/wiki/Level_of_detail)

## 4.10. **隐式 Tile**

使用递归细分的 tileset 的描述。

## 4.11. **隐根瓦片**

包含 implicitTiling 属性的图块，因此表示隐式图块集的根。

## 4.12. **元数据**

在 3D Tiles 的上下文中，该术语指的是 3D 内容与实体和属性的任何关联，这样实体就代表了整体结构中有意义的单元。

## 4.13. **元数据类**

包含 3D Tiles 元数据的实体的结构描述，由多个元数据属性组成

## 4.14. **元数据属性**

元数据类的一个元素，它为元数据实体的相应元素定义名称和类型。

## 4.15. **八叉树**

一种 3D 细分方案，将每个包围体沿 x、y 和 z 轴的中点划分为 8 个较小的包围体。

## 4.16. **四叉树**

一种 2D 细分方案，它沿 x 轴和 y 轴的中点将每个包围体分成 4 个较小的包围体。

## 4.17. **图式**

一组定义元数据结构和类型的元数据类和枚举

## 4.18. **屏幕空间错误 (SSE)**

如果渲染了图块的内容而未呈现其子项，则图块对其源几何体的简化表示的差异(以像素为单位)。

## 4.19. **空间连贯性**

子图块所有内容的并集完全在父图块的边界体积内

## 4.20. **风格**

一组要评估的表达式，用于修改图块集中每个要素的显示方式

## 4.21. **子树**

包含可用性信息的隐式瓦片集树的固定大小部分。

## 4.22. **子树文件**

一个二进制文件，存储有关隐式 tileset 的特定子树的信息

## 4.23. **细分方案**

将父图块划分为占据相同区域的较小子图块的递归模式。这是通过使用隐式图块集统一划分父图块的边界体积来完成的。

## 4.24. **模板 URI**

包含瓦片坐标的 URI 模式，用于直接寻址隐式瓦片集中的瓦片。

## 4.25. **瓦**

在 3D Tiles 中，tileset 的一个子集包含对可呈现内容和元数据的引用，例如内容的边界体积，客户端使用它来确定是否呈现内容。

## 4.26. **Tile 内容**

包含渲染图块所需信息的二进制 blob，该图块是特定图块格式(批处理 3D 模型、实例化 3D 模型、点云、复合或 glTF)的实例。

## 4.27. **Tile 格式**

图块内容数据的结构或布局(批处理 3D 模型、实例化 3D 模型、点云、复合或 glTF)。

## 4.28. **瓦片集**

在 3D Tiles 中，3D Tiles tile 实例的集合被组织成空间数据结构和附加元数据，这样这些 tiles 的聚合代表了不同细节级别的一些 3D 内容。

# 5、约定

本文档中未指定约定。

# 6、3D TILES 格式规范

## 6.1.  介绍

在 3D Tiles 中，一个*tileset*是一组以空间数据结构组织的*图块，树*。一个 tileset 由至少一个 tileset JSON 文件描述，其中包含 tileset 元数据和一棵 tile 对象树，每个对象都可以引用可渲染的内容。

[glTF 2.0](https://github.com/KhronosGroup/glTF)是 3D Tile 的主要 Tile 格式。glTF 是一种开放规范，旨在高效传输和加载 3D 内容。glTF 资产包括单个图块的几何和纹理信息，并且可以扩展为包括元数据、模型实例化和压缩。glTF 可用于各种 3D 内容，包括：

- 异构 3D 模型。例如带纹理的地形和表面、3D 建筑外部和内部、大型模型
- 3D 模型实例。例如树木、风车、螺栓
- 海量点云

有关详细信息，请参阅[glTF Tile 格式。](https://portal.ogc.org/files/102132#tileformats-gltf-gltf)

Tiles 还可以引用下面列出的旧版 3D Tiles 1.0 格式。这些格式在 3D Tiles 1.1 中已弃用，可能会在 3D Tiles 的未来版本中删除。

表 1 — 传统图块格式和常见用途

| 传统格式                                                                                                       | 用途                           |
| :------------------------------------------------------------------------------------------------------------- | :----------------------------- |
| [批量 3D 模型 ( b3dm )](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)       | 异构 3D 模型                   |
| [实例化 3D 模型 ( i3dm )](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-instanced-3d-model) | 3D 模型实例                    |
| [点云 ( pnts )](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)                        | 海量积分                       |
| [复合 ( cmpt )](https://portal.ogc.org/files/102132#tileformats-composite-composite)                           | 将不同格式的图块连接成一个图块 |

磁贴的*内容*是磁贴格式的单个实例。一个 tile 可能有多个内容。

内容引用一组*Feature*，例如表示建筑物或树木的 3D 模型，或点云中的点。每个 Feature 都具有位置和外观属性以及其他特定于应用程序的属性。客户端可以选择在运行时选择 Feature 并检索它们的属性以进行可视化或分析。

切片以树的形式组织，该树结合了层次细节级别 (HLOD) 的概念，以优化空间数据的呈现。每个图块都有一个*包围体*，一个定义完全包围其内容的空间范围的对象。树具有[空间连贯性](https://portal.ogc.org/files/102132#core-bounding-volume-spatial-coherence)；子图块的内容完全在父图块的包围体内。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/9a23c398-ca9b-43dd-8ca4-6afabd00854d)

图 1 — 瓦片树

瓦片集可以使用类似于栅格和矢量瓦片方案(如 Web 地图瓦片服务 (WMTS) 或 XYZ 方案)的 2D 空间瓦片方案，这些瓦片在多个细节级别(或缩放级别)提供预定义瓦片。然而，由于 tileset 的内容通常是不均匀的，或者可能不容易仅在二维中组织，树可以是任何具有空间一致性[的空间数据结构](https://portal.ogc.org/files/102132#core-spatial-data-structures)，包括 kd 树、四叉树、八叉树和网格。[隐式 Tile](https://portal.ogc.org/files/102132#core-implicit-tiling)定义了四叉树和八叉树的简明表示。

特定于应用程序的*元数据*可以在 tileset 中以多个粒度提供。元数据可能与高级实体(如瓦片集、瓦片、内容或 Feature)相关联，或者与单个顶点和纹素相关联。元数据符合[3D 元数据规范 描述](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)的定义明确的类型系统，可以使用特定于应用程序或领域的语义进行扩展。

可选择将[3D Tiles Style](https://portal.ogc.org/files/102132#styling-styling)或*style*应用于 tileset。样式定义了要评估的表达式，这些表达式修改了每个 Feature 的显示方式。

## 6.2.  文件扩展名和媒体类型

3D Tiles 使用以下文件扩展名和媒体类型。

- Tileset 文件应使用.json 扩展名和[application/json](https://www.iana.org/assignments/media-types/application/json)媒体类型。
- 磁贴内容文件应使用特定于其[磁贴格式规范](https://portal.ogc.org/files/102132#core-tile-format-specifications)的文件扩展名和媒体类型。
- 元数据架构文件应使用.json 扩展名和[application/json](https://www.iana.org/assignments/media-types/application/json)媒体类型。
- Tileset 样式文件应使用.json 扩展名和[application/json](https://www.iana.org/assignments/media-types/application/json)媒体类型。
- JSON 子树文件应使用.json 扩展名和[application/json](https://www.iana.org/assignments/media-types/application/json)媒体类型。
- 二进制子树文件应使用.subtree 扩展名和[application/octet-stream](https://www.iana.org/assignments/media-types/application/octet-stream)媒体类型。
- 表示二进制缓冲区的文件应使用.bin 扩展名和[application/octet-stream](https://www.iana.org/assignments/media-types/application/octet-stream)媒体类型。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其标头中的魔术字段来识别内容的格式。

## 6.3. JSON 编码

3D Tiles 对 JSON 格式和编码有以下限制。

1. JSON 应使用不带 BOM 的 UTF-8 编码。
2. 本规范中定义的所有字符串(属性名称、枚举)仅使用 ASCII 字符集，并且应以纯文本形式编写，不进行 JSON 转义。
3. *在 JSON 中显示为属性值的*非 ASCII 字符可能会被转义。
4. JSON 对象中的名称(键)应该是唯一的，即不允许重复的键。
5. 某些属性在架构中定义为整数。此类值可以存储为小数部分为零的小数，或使用指数表示法存储，如[RFC 8259 第 6 节](https://www.rfc-editor.org/rfc/rfc8259.html#section-6)中所定义。

## 6.4. URIs

3D Tiles 使用 URI 来引用图块内容。这些 URI 可能指向[相对外部引用 (RFC3986)](https://tools.ietf.org/html/rfc3986#section-4.2)或者是在 JSON 中嵌入资源的数据 URI。嵌入式资源使用["数据"URL 方案 (RFC2397)](https://tools.ietf.org/html/rfc2397)。

当 URI 是相对的时，它的基础总是相对于引用的 tileset JSON 文件。

客户端实现需要支持相关的外部引用和嵌入式资源。可选地，客户端实现可以支持其他方案(例如 http\://)。所有 URI 都应有效且可解析。

## 6.5.  单位

所有直线距离的单位都是米。

所有角度都以弧度为单位。

## 6.6.  坐标参考系统 (CRS)

3D Tiles 使用右手笛卡尔坐标系；也就是说，*x*和*y*的叉积产生*z*。3D Tiles 将*z*轴定义为局部笛卡尔坐标系。tileset 的全球坐标系通常位于[WGS 84](https://epsg.org/ellipsoid_7030/WGS-84.html)地球中心、地球固定 (ECEF) 参考系 ( [EPSG 4978](https://epsg.org/crs_4978/WGS-84.html) ) 中，但它不一定是，例如，发电厂可以在其当地完全定义用于没有地理空间上下文的建模工具的坐标系。

tileset 的 CRS 可以明确定义为[tileset metadata](https://portal.ogc.org/files/102132#core-metadata)的一部分。[tileset 的元数据可以包含具有 TILESET_CRS_GEOCENTRIC 语义的](https://portal.ogc.org/files/102132#metadata-semantics-tileset-semantics)属性，它是表示 EPSG 大地测量参数数据集标识符的字符串。

可以应用额外的[瓦片变换](https://portal.ogc.org/files/102132#core-tile-transforms)以将瓦片的局部坐标系变换到父瓦片的坐标系。

区域包围体使用地理坐标系(纬度、经度、高度)指定边界，特别是[EPSG](https://portal.ogc.org/files/102132#core-region)[4979](https://epsg.org/crs_4979/WGS-84.html)。假定参考椭圆体与 tileset 的参考椭圆体相同。

## 6.7.  概念

### 6.7.1. Tile

图块包含用于确定是否呈现图块的元数据、对可呈现内容的引用以及任何子图块的数组。

#### 6.7.1.1.Tile 内容

瓦片可以与可呈现的内容相关联。一个图块可以有一个[tile.content](http://tile.content/)对象，也可以有多个内容对象，存储在一个[tile.contents](http://tile.contents/)数组中。后者允许灵活的 tileset 结构：例如，单个 tile 可能包含相同几何数据的多个表示。

每个内容对象的 content.uri 引用[Tile 格式规范](https://portal.ogc.org/files/102132#core-tile-format-specifications)中定义的一种 tile 格式的 tile 内容，或另一个 tileset JSON 以创建 tilesets 的 tileset(请参阅[External tilesets](https://portal.ogc.org/files/102132#core-external-tilesets))。

content.group 属性将内容分配给一个组。可以将不同块的内容或单个块的内容分配给组以便对内容进行分类。[此外，每个组都可以与元数据](https://portal.ogc.org/files/102132#core-metadata)相关联。

每个内容都可以与边界体积相关联。虽然 tile.boundingVolume 是一个包含图块*所有内容的边界体积，但每个单独的*content.boundingVolume 是一个紧密配合的边界体积，仅包含各自的内容。有关图块和内容边界体积的作用的更多详细信息，请参见[边界体积](https://portal.ogc.org/files/102132#core-bounding-volumes)部分。

#### 6.7.1.2.几何误差

_瓦片被构造成包含层次细节级别_(HLOD) 的树，因此在运行时，客户端实现将需要确定瓦片是否足够详细以进行渲染，以及瓦片的内容是否应由更高分辨率的子瓦片连续细化。实现将考虑最大允许*屏幕空间误差*(SSE)，该误差以像素为单位。

Tile 的几何误差定义了该 Tile 的选择指标。它的值是一个非负数，用于指定图块对其源几何体的简化表示的误差(以米为单位)。通常，根瓦片的几何误差最大，每个后续级别的子瓦片的几何误差都小于其父瓦片，叶瓦片的几何误差为或接近于 0。

在客户端实现中，几何误差与其他屏幕空间指标(例如，从图块到相机的距离、屏幕尺寸和分辨率)一起使用，以计算在呈现该图块而其子项未呈现时引入的 SSE。如果引入的 SSE 超过允许的最大值，则细化图块并考虑渲染其子项。

几何误差是根据点密度、网格或纹理抽取等指标或该图块集特定的其他因素制定的。通常，较高的几何误差意味着将更积极地细化图块，并且将更快地加载和渲染子图块。

#### 6.7.1.3.求精

精炼决定了较低的分辨率父层在选择较高的分辨率儿童渲染时呈现的过程。允许的细化类型是替换 ( "REPLACE" ) 和添加 ( "ADD" )。如果图块具有替换细化，则子图块会代替父图块进行渲染，即不再渲染父图块。如果图块具有附加细化，则除了父图块之外还会渲染子图块。

一个 tileset 可以只使用替换优化，只使用加法优化，或者加法和替换优化的任意组合。

瓦片集的根瓦片需要细化类型；它对于所有其他图块都是可选的。省略时，图块会继承其父项的细化类型。

##### 6.7.1.3.1.替代品

如果一个图块使用替换细化，那么在细化时它会渲染它的孩子来代替它自己。

表 2——一个瓦片和一个使用替换细化的细化瓦片

| 父 Tile                                                                                               | 精制                                                                                                  |
| :---------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------- |
| ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/f7fba57a-7ebe-4d96-9223-fc5780235441) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/d80320c7-a4cc-4894-8e2c-91a61ddeef69) |

##### 6.7.1.3.2.添加剂

如果一个图块使用加法细化，那么在细化时它会同时渲染它自己和它的孩子。

表 3 — 一个图块和一个使用加法细化的图块

| 父 Tile                                                                                               | 精制                                                                                                  |
| :---------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------- |
| ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/35fb6bd8-c7b1-4388-b72f-873fbc48aa61) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/78a74070-04f6-4efd-b301-a085634a7ff8) |

#### 6.7.1.4.边界体积

边界体积定义了包含图块或图块内容的空间范围。为了支持各种数据集的紧密拟合体积，例如规则划分的地形、未与纬度或经度线对齐的城市或任意点云，包围体类型包括定向包围盒、包围球和地理区域由最小和最大纬度、经度和高度定义。

表 4 — 瓦片的不同边界体积类型

| 边界框                                                                                                | 包围球                                                                                                | 边界区域                                                                                              |
| :---------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------- |
| ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/92464f72-635a-4226-b1e5-97806bd64592) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/9e72ead2-e009-4e6a-9f2c-3b45d5e335f4) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/ed302a08-163b-4b66-8c19-653d3d5f62b0) |

##### 6.7.1.4.1.Region

boundingVolume.region 属性是一个包含六个数字的数组，用于定义具有纬度、经度和高度坐标的边界地理区域，顺序为\[west, south, east, north, minimum height, maximum height]。[纬度和经度在 EPSG 4979](https://epsg.org/crs_4979/WGS-84.html)中定义的 WGS 84 基准中，以弧度为单位。[高度以高于(或低于) WGS 84 椭球体的](https://epsg.org/ellipsoid_7030/WGS-84.html)米为单位。

注意纬度和经度值以*弧度*  给出，与 EPSG 4979 定义不同，它们以*度*为单位给出。使用弧度的选择是由于通常以弧度进行的内部计算——例如，将制图坐标转换为笛卡尔坐标时。

![边界区域](https://github.com/CHENJIAMIAN/Blog/assets/20126997/8eaba887-ea79-462c-a46d-a2fbec63bdef)

图 2 — 边界区域

```js
"boundingVolume" ：{ "区域" ：[ - 1.3197004795898053 ，0.6988582109 ，- 1.3196595204101946 ，0.6988897891 ，0 ，20 ] }
 
   
   
   
   
   
   
 

```

##### 6.7.1.4.2.盒子

boundingVolume.box 属性是一个包含 12 个数字的数组，用于在右手 3 轴 (x, y, z) 笛卡尔坐标系中定义定向边界框，其中 z 轴向*上*。前三个元素定义框中心的 x、y 和 z 值。接下来的三个元素(索引为 3、4 和 5)定义了*x*轴方向和半长。接下来的三个元素(索引 6、7 和 8)定义了*y*轴方向和半长。最后三个元素(索引 9、10 和 11)定义了*z*轴方向和半长。

注意   3D Tiles 中用于定向边界框的表示是通用且紧凑的：除了中心位置外，数组还包含 3×3 矩阵的元素。该矩阵的列是变换后单位向量的图像，因此唯一且紧凑地定义了边界框的缩放和方向。

![边界框](https://github.com/CHENJIAMIAN/Blog/assets/20126997/6a4c62af-74e9-44d7-bbca-f644660fbaf5)

图 3 — 边界框

```js
"boundingVolume" ：{ "框" ：[ 0，0，10，100，0，0，0，100，0，0，0，10 ] } _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
 
         
       
      
         
 

```

##### 6.7.1.4.3.Sphere

boundingVolume.sphere 属性是一个包含四个数字的数组，用于定义边界球体。前三个元素定义右手 3 轴 (x, y, z) 笛卡尔坐标系中球体中心的 x、y 和 z 值，其中 z 轴向*上*。最后一个元素(索引为 3)定义了以米为单位的半径。

![包围球](https://github.com/CHENJIAMIAN/Blog/assets/20126997/33fc8a0c-29cc-4e9d-8c30-1eb1279bfd2a)

图 4 — 包围球

```js
"boundingVolume" ：{ "球体" ：[ 0，0，10，141.4214 ] } _ _
 
   
   
   
   
 

```

##### 6.7.1.4.4.内容边界体积

可以通过 tile.boundingVolume 属性为每个图块指定边界体积。此外，可以为每个[图块内容](https://portal.ogc.org/files/102132#core-tile-content)单独指定边界体积。content.boundingVolume 可能是更紧密的边界体积。这可以实现紧密的视锥体剔除，排除渲染任何不在潜在视野范围内的内容。未定义时，瓦片的边界体积仍用于剔除(请参阅[网格](https://portal.ogc.org/files/102132#core-grids))。

下面的屏幕截图显示了金丝雀码头根瓦片的边界体积。以红色显示的 tile.boundingVolume 包围了 tileset 的整个区域；content.boundingVolume 以蓝色显示，仅包含根图块中的四个 Feature(模型)。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/ad097623-e653-4eb8-8e09-945e4e15bdb0)

图 5 — 瓦片集根瓦片的边界体积。[从 Cyber​​City3D](http://www.cybercity3d.com/)构建数据。[来自必应地图的](https://www.microsoft.com/maps/)图像数据

##### 6.7.1.4.5.扩展

通过扩展支持其他包围体类型。

- [3DTILES_bounding_volume_S2](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2)

#### 6.7.1.5.查看器请求量

tile 的 viewerRequestVolume 可用于组合异构数据集，并可与[外部 tilesets](https://portal.ogc.org/files/102132#core-external-tilesets)组合。

以下示例在建筑物内有一个点云。点云图块的 boundingVolume 是一个半径为 1.25 的球体。对于 viewerRequestVolume，它还有一个半径为 15 的更大球体。由于 geometricError 为零，因此当查看器位于由 viewerRequestVolume 定义的大球体内部时，点云图块的内容始终呈现(并最初请求) 。

```js
{ "children" : [{ "transform" : [ 4.843178171884396 , 1.2424271388626869 , 0 , 0 , - 0.7993325488216595 , 3.1159251367235608 , 3.8278032889280675 , 0 , 0.9511533376784163 , - 3.7077466670407433 , 3.2168186118075526 , 0 , 1215001.7612985559 , - 4736269.697480114 , 4081650.708604793 , 1 ], "boundingVolume "：{
 
   
                           
       
     
          
   
   
      "盒子" ：[ 0，0，6.701，3.738，0，0，0，3.72，0，0，0，13.402 ] } ，"geometricError" ：32 ，"内容" ：{ "uri" ："building.glb _ _ _ _ _ _ _ _ _ _ _ _ " } }, { "变换" : [ 0.968635634376879 , 0.24848542777253732 , 0 , 0 , -
                
            
            
                
     
   
   
   
     
   
 
   
                            
      0.15986650990768783 , 0.6231850279035362 , 0.7655606573007809 , 0 , 0.19023066741520941 , - 0.74154933329385225 , 0.6433637 229384295 , 0 , 1215002.0371330238 , - 4736270.772726648 , 4081651.6414821907 , 1 ] , " viewerRequestVolume " : { " sphere " : [ 0 , 0 , 0 , 15 ] } , " bounding体积" ：{ "球体" ：   
        
          
   
   
     
   
   
       [ 0 , 0 , 0 , 1.25 ] }, "geometricError" : 0 , "content" : { "uri" : "points.glb" } }] }
   
   
   
     
   
 

```

有关请求量的更多信息，请参阅[样本 tileset](https://github.com/CesiumGS/3d-tiles-samples/tree/main/1.0/TilesetWithRequestVolume)。

#### 6.7.1.6.转换

##### 6.7.1.6.1.Tile 变换

为了支持本地坐标系——例如，城市瓦片集中的建筑瓦片集可以在其自己的坐标系中定义，而建筑物内部的点云瓦片集也可以在其自己的坐标系中定义——每个瓦片都有一个可选的转换属性。

transform 属性是一个 4×4 仿射变换矩阵，以列优先顺序存储，从图块的局部坐标系转换到父图块的坐标系——或者在根图块的情况下是图块集的坐标系。

注意 以   列优先顺序存储变换矩阵遵循图形编程 API(如 OpenGL)中常见的约定，这意味着变换数组中的元素直接对应于这些系统中的 4×4 矩阵的条目。

变换属性适用于

- [图块内容](http://tile.content/)

  - 每个 Feature 的位置。
  - 每个 Feature 的法线应该由左上角的 3×3 矩阵的逆转置变换来解释使用[比例时正确的矢量变换](http://www.realtimerendering.com/resources/RTNews/html/rtnews1a.html#art4)。
  - content.boundingVolume，除非定义了 content.boundingVolume.region，它在 EPSG:4979 坐标中明确表示。

- tile.boundingVolume，除非定义了 tile.boundingVolume.region，它在 EPSG:4979 坐标中明确表示。
- tile.viewerRequestVolume，除非定义了 tile.viewerRequestVolume.region，它在 EPSG:4979 坐标中明确表示。

transform 属性通过矩阵中的最大缩放因子缩放 geometricError 。

当未定义 transform 时，它默认为单位矩阵：

```js
[
  1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0,
];
```

从每个 tile 的局部坐标系到 tileset 的全局坐标系的转换是通过对 tileset 的自上而下的遍历以及通过将子变换与其父变换后乘以像计算机图形中的传统场景图或节点层次结构来计算的。

##### 6.7.1.6.2.glTF 变换

glTF 定义了自己的节点层次结构并使用*y*向上坐标系。任何特定于图块格式的转换和 tile.transform 属性都会在解析这些转换后应用。

###### 6.7.1.6.2.1.glTF 节点层次结构

首先，根据[glTF 规范](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#transformations)应用 glTF 节点层次结构转换。

###### 6.7.1.6.2.2.  *y* - 到*z* - 向上

接下来，为了与 3D Tiles 的*z -up 坐标系保持一致，glTF 应在运行时从 y* -up 转换为*z* -up。这是通过将模型绕*x*轴旋转 π/2 弧度来完成的。等效地，应用以下矩阵变换(此处显示为行优先)：

```js
[
  1.0, 0.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
  1.0,
];
```

更广泛地说，转换的顺序是：

1. [glTF 节点层次结构转换](https://portal.ogc.org/files/102132#core-gltf-node-hierarchy)
2. [glTF](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[y](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 到](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[z](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 变换](https://portal.ogc.org/files/102132#core-y-up-to-z-up)
3. [Tile 变换](https://portal.ogc.org/files/102132#core-tile-transforms)

注意   当处理本质上为*z*向上的源数据时，例如 WGS 84 坐标中的数据或本地*z*向上坐标系中的数据，常见的工作流程是：

- 网格数据(包括位置和法线)不会被修改——它们保持*z*向上。
- 根节点矩阵指定列主要*z*到*y*向上变换。这会将源数据转换为 glTF 所需的*y 向上坐标系。*
- 在运行时，glTF 使用上面的矩阵从*y*向上转换回\*z 向上。\*实际上，转换抵消了。

示例 glTF 根节点：

```js
"节点" ：[ { "矩阵" ：[ 1，0，0，0，0，0 ，- 1，0，0，1，0，0，0，0，0，1 ] ，"网格" ：0 _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ ，"名称" ："根节点" } ]
 
  
  
  
 

```

##### 6.7.1.6.3.例子

对于图块集的计算变换(上面代码中的 transformToRoot )的示例，请考虑：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/529924c2-916d-4c64-9aeb-db914418d1aa)
![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/529924c2-916d-4c64-9aeb-db914418d1aa)

图 6 — 包含 glTF 内容的图块示例图块集的结构

每个图块的计算变换是：

- 至：\[T0]
- T1：\[T0]\[T1]
- T2：\[T0]\[T2]
- T3：\[T0]\[T1]\[T3]
- T4：\[T0]\[T1]\[T4]

考虑到[glTF](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[y -](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[向上到](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[z](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-向上变换](https://portal.ogc.org/files/102132#core-y-up-to-z-up)和[glTF 变换的](https://portal.ogc.org/files/102132#core-gltf-transforms)完整计算变换是

- 至：\[T0]
- T1：\[T0]\[T1]
- T2 : \[T0]\[T2]\[glTF y-up to z-up]\[glTF transform]
- T3 : \[T0]\[T1]\[T3]\[glTF y-up to z-up]\[glTF transform]
- T4 : \[T0]\[T1]\[T4]\[glTF y-up to z-up]\[glTF transform]

##### 6.7.1.6.4.实施例

_本节内容丰富_

下面的 JavaScript 代码展示了如何使用 Cesium 的[Matrix4](https://github.com/CesiumGS/cesium/blob/main/Source/Core/Matrix4.js)和[Matrix3](https://github.com/CesiumGS/cesium/blob/main/Source/Core/Matrix3.js)类型来计算它。

```js
函数computeTransforms (tileset){ const root = tileset 。根; const transformToRoot = defined ( root.transform ) ? _ _ 矩阵4 。fromArray ( root.transform ) : Matrix4 。_ _ 身份；  computeTransform (根, transformToRoot ); }函数计算转换(Tile，
 
 




transformToRoot ) { // 将 4x4 transformToRoot 应用于此图块的位置和边界体积let normalTransform = Matrix4 . getRotation ( transformToRoot , new Matrix4 ());   正常变换= Matrix3 。inverseTranspose ( normalTransform , normalTransform ); // 将 3x3 normalTransform 应用于此图块的法线const children = tile . 儿童；如果(定义(孩子
 

 

 

 
   )) { const长度=孩子们。长度；for ( let i = 0 ; i < length ; ++ i ) { const child = children [ i ]; 让childToRoot = defined ( child.transform ) ？_ _ 矩阵4 。fromArray ( child.transform ) : Matrix4 。_ _
   
   
     
          克隆(Matrix4 。身份)；
      childToRoot = Matrix4 。multiplyTransformation ( transformToRoot , childToRoot , childToRoot );       computeTransform (孩子, childToRoot ); } } }

   
 

```

#### 6.7.1.7.Tile JSON

图块 JSON 对象包含以下属性。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/225289ee-8e22-40d1-8890-3d8a96d8df33)

图 7 — 图块 JSON 对象的元素

以下示例显示了一个非叶子图块。

```js
{ "boundingVolume": { "region": [ - 1.2419052957251926 , 0.7395016240301894 , - 1.2415404171917719 , 0.7396563300150859 , 0 , 20.4 ] }, "geometricError" ：43.88464075650763 ，"精炼" ："添加"，"内容"：{ "boundingVolume"：{ "地区"：[ -
 
   
     
     
     
     
     
     
   
 
 
 
 
   
     
        1.2418882438584018 , 0.7395016240301894 , - 1.2415422846940714 , 0.7396461198389616 , 0 , 19.4 ] }, "uri": "2 / 0 / 0.glb" } , "孩子们": [...] }
       
       
       
       
       
     
   
   
 
 

```

boundingVolume 定义包围图块的体积，并用于确定在运行时渲染哪些图块。上面的示例使用了区域体积，但也可以使用其他[边界体积](https://portal.ogc.org/files/102132#core-bounding-volumes)，例如 box 或 sphere 。

geometricError 属性是一个非负数，它定义了错误，以米为单位，如果渲染此图块而其子项未呈现则引入。在运行时，几何误差用于计算*屏幕空间误差*(SSE)，该误差以像素为单位。SSE 确定图块对于当前视图是否足够详细，或者是否应考虑其子项，请参阅[几何错误](https://portal.ogc.org/files/102132#core-geometric-error)。

可选的 viewerRequestVolume 属性(上面未显示)定义了一个体积，使用与 boundingVolume 相同的模式，在请求图块内容之前以及根据 geometricError 优化图块之前，查看器应位于该体积内。请参阅[查看器请求量](https://portal.ogc.org/files/102132#core-viewer-request-volume)部分。

refine 属性是一个字符串，对于替换优化是"REPLACE"，对于加法优化是"ADD" ，请参阅[Refinement](https://portal.ogc.org/files/102132#core-refinement)。瓦片集的根瓦片需要它；它对于所有其他图块都是可选的。一个 tileset 可以使用添加和替换细化的任意组合。当省略 refine 属性时，它是从父图块继承的。

content 属性是描述[磁贴内容](https://portal.ogc.org/files/102132#core-tile-content)的对象。content.uri 不需要文件扩展名。内容的[tile 格式可以通过其标头中的](https://portal.ogc.org/files/102132#core-tile-format-specifications)魔术字段来标识，或者如果内容是 JSON，则作为外部 tileset。

content.boundingVolume 属性定义了一个可选的[边界体积](https://portal.ogc.org/files/102132#core-bounding-volumes)，类似于顶级 tile.boundingVolume 属性。但与顶级 boundingVolume 属性不同的是，content.boundingVolume 是一个紧密配合的边界体积，仅包含图块的内容。

也可以为一个图块定义多个内容：contents 属性(上面未显示)是一个包含一个或多个内容的数组。内容和内容是互斥的。当 tile 具有单一内容时，它应该使用内容来向后兼容仅支持 3D Tiles 1.0 的引擎。多个内容允许对图块内容进行不同的表示——例如，一个作为三角形网格，一个作为点云：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/dfb5a9fc-f0c3-4fc4-bdca-5ed6aefdae44)

图 8 — 定义多个内容的磁贴示例

也可以使用 content.group 属性将内容分组：

```js
{ "root": { "refine": "ADD", "geometricError": 0.0 , "boundingVolume": { "region": [- 1.707 , 0.543 , - 1.706 , 0.544 , 203.895 , 253.113 ] }, "contents": [ { "uri"："建筑物。glb"，"组
 
   
   
   
     
   
   
     
       
       ": 0 }, { "uri": "树。glb"，"组"：1 }，{ "uri"："汽车。glb", "组": 2 } ] } }
     
     
       
       
     
     
       
       
     
   
 

```

这些组可以与组元数据相关联： content.group 属性的值是在 tileset 的顶级数组中定义的组数组的索引。该数组的每个元素都是元数据实体，如[元数据](https://portal.ogc.org/files/102132#core-metadata)部分中所定义。这允许应用程序根据内容所属的组执行样式或过滤：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/4c1321de-1def-4a8c-bfe6-241ecb2a2184)

图 9 — 基于内容组的呈现选项图示

可选的 transform 属性(上面未显示)定义了一个 4×4 仿射变换矩阵，该矩阵变换 tile 的 content、boundingVolume 和 viewerRequestVolume ，如[Tile 变换](https://portal.ogc.org/files/102132#core-tile-transforms)部分所述。

可选的 implicitTiling 属性(上面未显示)定义了磁贴的细分方式以及内容资源的位置。请参阅[隐式 Tile](https://portal.ogc.org/files/102132#core-implicit-tiling)。

children 属性是一组定义子图块的对象。每个子图块的内容都完全包含在其父图块的 boundingVolume 中，并且通常小于其父图块的 geometricError 的 geometricError。对于叶瓦片，此数组的长度为零，并且可能未定义子级。请参阅下面的[Tileset JSON](https://portal.ogc.org/files/102132#core-tileset-json)部分。

[完整的 JSON 模式可以在 tile.schema.json](https://portal.ogc.org/files/102132#reference-schema-tile)中找到  。

### 6.7.2.  瓦片集 JSON

3D Tiles 使用一个主要的 tileset JSON 文件作为入口点来定义一个 tileset。入口和外部 tileset JSON 文件都不需要遵循特定的命名约定。

这是用于金丝雀码头的 tileset JSON 的子集：

```js
{ "资产" ：{ "版本" ："1.1" ，"tilesetVersion" ："e575c6f1-a45b-420a-b172-6449fa6e0a59" ，}，"属性" ：{ "高度" ：{ "最小" ：1 ，"最大"：241.6 } }，"geometricError" ：494.50961650991815 ，"根" ：{ "boundingVolume" ：{ "区域" ：[ - 0。0005682966577418737 , 0.8987233516605286 ,
 
   
   
 
 
   
     
     
   
 
 
 
   
     
       
       
        0.00011646582098558159 , 0.8990603398325034 , 0 , 241.6 ] }, "geometricError" : 268.37878244706053 , "refine" : "ADD" , "content" : { "uri" : "0/0/0.glb " , "boundingVolume" : { "区域"：[ - 0.0004001690908972599，0.8988700116775743，0.00010096729722787196，0.8989625664878067，0，241 。_ _ _ _ _ _ _ _ _6 ] } },
       
       
       
     
   
   
   
   
     
     
       
         
         
         
         
         
         
       
     
   
    "孩子们" ：[...] } }
 

```

tileset JSON 有四个顶级属性：asset、properties、geometricError 和 root。

asset 是一个对象，包含关于整个 tileset 的元数据。asset.version 属性是一个字符串，它定义了 3D Tiles 版本，它指定了 tileset 的 JSON 模式和基本的 tile 格式集。tilesetVersion 属性是一个可选字符串，它定义了特定于应用程序的 tileset 版本，例如，用于更新现有 tileset 的时间。

注意   tilesetVersion 可以在请求内容时用作查询参数，以避免使用缓存中的过时内容。

properties 是一个对象，包含 tileset 中每个 Feature 属性的对象。这个 tileset JSON 片段是针对 3D 建筑的，所以每个 tile 都有建筑模型，每个建筑模型都有一个 Height 属性(参见[批处理表](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table))。properties 中每个对象的名称与每个 Feature 属性的名称相匹配，它的值定义了它的最小和最大数值，这对于例如为样式创建颜色渐变很有用。

geometricError 是一个非负数，它定义了错误，以米为单位，确定是否渲染了 tileset。在运行时，几何误差用于计算*屏幕空间误差*(SSE)，该误差以像素为单位。如果 SSE 未超过所需的最小值，则不应渲染图块集，并且不应考虑渲染其图块，请参阅[几何错误](https://portal.ogc.org/files/102132#core-geometric-error)。

root 是一个对象，它使用[上一节](https://portal.ogc.org/files/102132#core-tiles)中描述的图块 JSON 定义根图块。root.geometricError 与 tileset 的顶级 geometricError 不同。tileset 的 geometricError 在运行时用于确定 tileset 的根 tile 渲染的 SSE；root.geometricError 在运行时用于确定渲染根图块子项的 SSE。

#### 6.7.2.1.外部瓦片集

要创建树中树，tile 的 content.uri 可以指向外部 tileset(另一个 tileset JSON 文件的 uri)。例如，这可以将每个城市存储在一个 tileset 中，然后拥有一个全局 tilesets 的 tilesets。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/016fbfc0-e1c1-40d9-acf6-3ad5b4a7f3d2)

图 10 — 引用其他图块集的图块集

当瓦片指向外部瓦片集时，瓦片：

- 不能有任何孩子；[tile.children](http://tile.children/)应省略
- 不能用于创建循环，例如，通过指向包含该图块的同一个图块集文件或通过指向另一个图块集文件然后指向包含该图块的初始文件。
- 将由 tile 的 transform 和 root tile 的 transform 进行转换。例如，在以下引用外部图块集的图块集中，T3 的计算变换为\[T0]\[T1]\[T2]\[T3]。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/73e4e53c-2106-405d-b099-e5ac30d7d8a2)

图 11 — 一个 tileset 引用另一个 tileset 的转换链

如果外部 tileset 定义了 asset.tilesetVersion，这将覆盖父 tileset 的值。如果外部瓦片集未定义 asset.tilesetVersion，则该值继承自父瓦片集(如果已定义)。

#### 6.7.2.2.边界体积空间相干性

如上所述，树具有空间连贯性；每个图块都有一个完全包围其内容的边界体积，子图块的内容完全在父图块的边界体积内。这并不意味着孩子的边界体积完全在其父边界体积内。例如：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/f4f2a883-c721-4338-9461-3110e00bc10c)

图 12 — 地形图块的边界球体。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/5eea7da4-5b8b-472f-811e-7fd9b2ad8685)

图 13 — 四个子图块的边界球体。子级的内容完全在父级的包围体内，但子级的包围体不在，因为它们没有紧密贴合。

#### 6.7.2.3.空间数据结构

3D Tiles 结合了分层细节层次 (HLOD) 的概念，以优化空间数据的渲染。一个 tileset 由一棵树组成，由根定义，递归地，它的子瓦片可以由不同类型的空间数据结构组织。

运行时引擎是通用的，将渲染由 tileset 定义的任何树。可以使用切片格式和细化方法的任意组合，从而能够灵活地支持异构数据集，请参阅[细化](https://portal.ogc.org/files/102132#core-refinement)。

瓦片集可以使用类似于栅格和矢量瓦片方案(如 Web 地图瓦片服务 (WMTS) 或 XYZ 方案)的 2D 空间瓦片方案，这些瓦片在多个细节级别(或缩放级别)提供预定义瓦片。然而，由于 tileset 的内容通常是不均匀的，或者可能不容易仅在二维中组织，因此其他空间数据结构可能更优化。

下面简要描述了 3D Tiles 如何表示各种空间数据结构。

##### 6.7.2.3.1.四叉树

当每个瓦片有四个均匀细分的孩子(例如，使用中心纬度和经度)时，将创建一个四叉树，类似于典型的 2D 地理空间瓦片方案。可以省略空的子图块。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/9a580287-858e-4df1-801d-74ad3d3e949a)

图 14 — 经典四叉树细分

3D Tiles 启用四叉树变体，例如不均匀细分和紧边界体积(与边界相反，例如，父图块的全部 25%，这对于稀疏数据集来说是一种浪费)。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/30faf661-559d-4196-ac11-339ec814cfe2)

图 15 — 每个孩子周围都有紧密边界体积的四叉树

例如，这是 Canary Wharf 的根磁贴及其子磁贴。请注意左下角，边界体积不包括左侧没有建筑物出现的水域：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/513a871d-38ad-4eb9-8f61-7d454f4c9b83)

[图 16 — 从 Cyber​​City3D](http://www.cybercity3d.com/)构建数据。[来自必应地图的](https://www.microsoft.com/maps/)图像数据

3D Tiles 还支持其他四叉树变体，例如[松散四叉树](http://www.tulrich.com/geekstuff/partitioning.html)，其中子图块重叠但空间连贯性仍然保留，即父图块完全包围其所有子图块。此方法可用于避免跨图块拆分要素(例如 3D 模型)。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/9b4972d4-c8c4-4e0a-b07d-e06819407936)

图 17 — 具有不均匀和重叠块的四叉树

下面，绿色建筑物在左孩子中，紫色建筑物在右孩子中。请注意，Tile 重叠，因此中间的两座绿色和一座紫色建筑没有分开。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/c8bf290e-1d20-420a-acdd-2eb0548b207c)

[图 18 — 从 Cyber​​City3D](http://www.cybercity3d.com/)构建数据。[来自必应地图的](https://www.microsoft.com/maps/)图像数据

##### 6.7.2.3.2.Kd 树

当每个图块有两个子图块时，会创建一个 kd 树，两个子图块由平行于*x*、*y*或*z*轴(或纬度、经度、高度)的*分割平面*隔开。分裂轴通常随着树的级别增加而循环旋转，并且可以使用中值分裂、表面积启发式或其他方法来选择分裂平面。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/29a5b95e-1cb1-49dc-b37f-5f7a86b61321)

图 19 — kd 树示例。注意非均匀细分

请注意，kd 树不像典型的 2D 地理空间切片方案那样具有均匀的细分，因此可以为稀疏和非均匀分布的数据集创建更平衡的树。

3D Tiles 支持 kd 树的变体，例如[多路 kd 树](http://www.crs4.it/vic/cgi-bin/bib-page.cgi?id=%27Goswami:2013:EMF%27)，其中在树的每个叶子处，沿轴有多个拆分。不是每个瓦片有两个孩子，而是有 n 个孩子。

##### 6.7.2.3.3.八叉树

八叉树通过使用三个正交的分裂平面将一个图块细分为八个孩子来扩展四叉树。与四叉树一样，3D Tiles 允许对八叉树进行变体，例如非均匀细分、紧边界体积和重叠子项。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/500af7db-79cd-4cb4-8ea8-8770ede121e0)

图 20——传统的八叉树细分

![]

图 21 — 使用加法细化对点云进行非均匀八叉树细分。哥伦比亚大学机器人实验室 Peter Allen 教授绘制的[法国查佩斯圣玛丽教堂](http://robotics.cs.columbia.edu/~atroccol/ijcv/chappes.html)的点云。由 Alejandro Troccoli 和 Matei Ciocarlie 扫描。

##### 6.7.2.3.4.网格

3D Tiles 通过支持任意数量的子图块来实现统一、非统一和重叠的网格。例如，这是剑桥非均匀重叠网格的自上而下视图：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/eea0871e-f957-4505-afd4-1dac2e6a38e9)

图 22 — 从[Cyber​​City3D](http://www.cybercity3d.com/)构建数据。[来自必应地图的](https://www.microsoft.com/maps/)图像数据

3D Tile 利用空 Tile：那些具有边界体积但没有内容的 Tile。由于不需要定义图块的内容属性，因此可以使用空的非叶图块来加速具有分层剔除的非均匀网格。这实质上创建了一个没有层次细节层次 (HLOD) 的四叉树或八叉树。

#### 6.7.2.4.隐式 Tile

包围体层次结构可以*明确*定义  ——如前所示——这可以实现多种空间数据结构。*可以隐式*定义某些常见的数据结构，例如四叉树和八叉树，而无需为每个图块提供边界体积。这种常规模式允许根据瓦片坐标随机访问瓦片，从而实现加速空间查询、新遍历算法和瓦片内容的高效更新，以及其他用例。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/dbb744f8-b4d7-4702-9e47-22bd9f5f6f9b)

图 23 — 带有图块坐标的四叉树

为了支持稀疏数据集，可用性数据决定了存在哪些切片。为了支持海量数据集，可用性被划分为固定大小的子树。子树可以存储可用图块和内容的元数据。

可以将 implicitTiling 对象添加到 tileset JSON 中的任何 tile。该对象定义了磁贴的细分方式以及内容资源的定位方式。它可以添加到多个图块以创建更复杂的细分方案。

以下示例显示了在根图块上定义的四叉树，其中模板 URI 指向内容和子树文件。

```js
{ "root" ：{ "boundingVolume" ：{ "region" ：[- 1.318 , 0.697 , - 1.319 , 0.698 , 0 , 20 ] }, "refine" : "REPLACE" , "geometricError" : 5000 , "content" : { "uri" ："content/{level}/{x}/{y}.glb" }，"implicitTiling" ：{ "subdivisionScheme" ："QUADTREE"，"可用级别" ：
 
   
     
   
   
   
   
     
   
   
     
       21 ，"subtreeLevels" ：7 ，"subtrees" ：{ "uri" ："subtrees/{level}/{x}/{y}.json" } } } }
     
     
       
     
   
 

```

有关隐式 Tile 对象结构和子树文件格式的更多详细信息，请参阅[隐式 Tile。](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)

### 6.7.3.  元数据

特定于应用程序的*元数据*可以在 tileset 中以多个粒度提供。元数据可能与高级实体(如瓦片集、瓦片、内容或 Feature)相关联，或者与单个顶点和纹素相关联。元数据符合[3D 元数据规范 描述](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)的定义明确的类型系统，可以使用特定于应用程序或领域的语义进行扩展。

元数据为格式启用了额外的用例和功能：

- \*\*检查：\*\*在用户界面 (UI) 中显示 tileset 的应用程序可能允许用户单击或悬停在特定的图块或图块内容上，从而在 UI 中显示有关所选实体的信息元数据。
- \*\*集合：\*\*图块内容组可用于定义集合(类似于地图层)，这样每个集合都可以显示、隐藏或视觉样式化，效果在许多图块中同步。
- \*\*结构化数据：\*\*元数据支持嵌入式和外部引用模式，这样 tileset 作者可以为公共领域(例如 AEC 或科学数据集)或完全定制的、特定于应用程序的数据(例如特定视频游戏)定义新的数据模型。
- \*\*优化：\*\*每内容元数据可能包含具有性能相关语义的属性，使引擎能够显着优化遍历和流式算法。

元数据可以与不同粒度级别的 tileset 元素相关联：

- **Tileset——**  作为一个整体的 tileset 可能与全局元数据相关联。常见示例可能包括收集年份、作者详细信息或 tileset 内容的其他一般上下文。
- **瓦片** ——瓦片可以单独与更具体的元数据相关联。这可能是上次更新图块时的时间戳或图块的最大高度，或优化遍历算法的空间提示。
- **组** ——磁贴内容可以组织成组。每个组定义表示一个元数据实体，可以通过将此列表中的索引指定为内容的组属性来分配给图块内容。这对于将内容集合作为图层进行处理非常有用，例如管理可见性或视觉样式。
- **内容** ——磁贴内容可以单独与更具体的元数据相关联，例如属性字符串列表。
- **具有要素元数据的要素**glTF 2.0 资产可以作为图块内容包含在内。EXT_structural_metadata 扩展允许将元数据[与](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)顶点或纹素相关联。

下图显示了这些实体之间的关系，以及可能与这些实体相关联的元数据示例：

![元数据粒度](https://github.com/CHENJIAMIAN/Blog/assets/20126997/0dbff1fd-0697-4dab-b163-b5d63292d586)

图 24 — 应用元数据的不同粒度级别的图示

尽管它们是独立定义的，但 3D Tiles 和 glTF EXT_structural_metadata 扩展中的元数据结构都符合[3D 元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)并建立在[3D 元数据规范的参考实现](https://portal.ogc.org/files/102132#metadata-referenceimplementation-3d-metadata-reference-implementation)之上。此处使用的概念和术语参考 3D 元数据规范，应将其视为定义和要求的规范参考。本文档在适当的地方提供了术语的内联定义。

#### 6.7.3.1.元数据架构

元数据模式定义元数据的结构。它包含元数据类的定义，元数据类是元数据实例的模板，并定义每个元数据实例具有的属性集。[根据元数据模式参考实现，元数据](https://portal.ogc.org/files/102132#metadata-referenceimplementation-schema-schema-implementation)模式以 JSON 表示形式存储在 tileset 中。此参考实现包括元数据模式的 JSON 模式定义。

模式可以嵌入到具有 schema 属性的 tilesets 中，或者由 schemaUri 属性在外部引用。多个 tilesets 和 glTF 内容可以引用相同的模式以避免重复。[在外部 tileset](https://portal.ogc.org/files/102132#core-external-tilesets)模式中定义的任何类也应在顶级 tileset 模式中定义。

注 1 具有建筑类的   模式具有三个属性，"高度"、"所有者"和"建筑类型"。"buildingType"属性引用 buildingType 枚举作为其数据类型，也在模式中定义。后面的示例显示实体如何声明它们的类并为其属性提供值。

```js
{ "架构" ：{ "类" ：{ "建筑" ：{ "属性" ：{ "高度" ：{ "类型" ："SCALAR" ，"componentType" ："FLOAT32" }，"所有者" ：{ "类型" : "STRING" , "array" : true , "description" : "所有者名称。}，"建筑类型" ：{ "
 
   
     
       
         
           
           
         
         
           
           
           
         
         
           
             "建筑类型" } } } }，"枚举" ：{ "建筑类型" ：{ "值" ：[ { "值" ：0 ，"名称" ："住宅" }，{ "值" ：1 ，"名称" ："商业" }, { "价值" : 2 , "名称" : "其他" } ] } } } }
         
       
     
   
   
     
       
         
         
         
       
     
   
 

```

注 2  由 URI 引用的外部模式。

```js
{ "schemaUri" ："https://example.com/metadata/buildings/1.0/schema.json" }
 

```

#### 6.7.3.2.分配元数据

虽然模式中的类定义了属性的数据类型和含义，但在将元数据分配(即类被"实例化")作为 3D Tiles 层次结构中的特定元数据实体之前，属性不会采用特定值。

出现在 tileset 中的元数据实体的通用结构在  [metadataEntity.schema.json](https://portal.ogc.org/files/102132#reference-schema-metadataentity)中定义。每个元数据实体都包含它作为实例的类的名称，以及与该类的属性相对应的属性值字典。分配的每个属性值应由具有相同属性 ID 的类属性定义，其值与类属性的数据类型相匹配。一个实体可以只为其类的属性的一个子集提供值，但标记为 required: true 的类属性不应被省略。

注：前面介绍的建筑类别   的元数据实体。通过将此类实体存储为它们各自的元数据属性，可以将此类实体分配给图块集、图块或图块内容。

      "元数据" ：{ "类" ："建筑" ，"属性" ：{ "高度" ：16.8 ，"所有者" ：[ "无名氏" ，"无名氏" ]，"建筑类型" ："住宅" } }

大多数属性值在实体中编码为 JSON。一个值得注意的例外是分配给隐式图块和内容的元数据，以更紧凑的二进制形式存储。请参阅[隐式 Tile](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)。

#### 6.7.3.3.元数据统计

统计信息提供了关于属性值分布的聚合信息，汇总了 tileset 中元数据类的所有实例。例如，统计信息可能包括数字属性的最小值/最大值，或特定枚举值的出现次数。

这些汇总统计允许应用程序分析或显示元数据，例如使用[声明式样式语言](https://portal.ogc.org/files/102132#styling-styling)，而无需首先处理完整的数据集来识别颜色渐变和直方图的边界。统计数据是按类提供的，因此应用程序可以提供基于整个图块集的样式或上下文，而只需要下载和处理其图块的一个子集。

![元数据粒度](https://github.com/CHENJIAMIAN/Blog/assets/20126997/a4d3282c-b11d-4002-882f-4aecac4c1889)

图 25 — 说明如何使用元数据统计来呈现分析

统计数据存储在 tileset 的顶级统计对象中。这个统计对象的结构在  [statistics.schema.json](https://portal.ogc.org/files/102132#reference-schema-statistics)中定义。为每个元数据类定义统计信息，包括以下元素：

- count 是 tileset 中出现的类的实体数
- properties 包含有关在 tileset 中出现的类的属性的汇总统计信息

属性可能包括以下内置统计信息：

表 5——元数据统计

| 名称     | 描述               | 类型                                                             |
| :------- | :----------------- | :--------------------------------------------------------------- |
| 分钟     | 最小属性值         | 标量、向量、矩阵                                                 |
| 最大限度 | 最大属性值         | …                                                                |
| 意思是   | 属性值的算术平均值 | …                                                                |
| 中位数   | 财产价值的中位数   | …                                                                |
| 标准差   | 属性值的标准差     | …                                                                |
| 方差     | 属性值的方差       | …                                                                |
| 和       | 属性值的总和       | …                                                                |
| 事件     | 值出现的频率       | 对象，其中键是属性值(对于枚举，枚举名称)，值是该属性值的出现次数 |

Tileset 作者可以定义他们自己的附加统计信息，例如下面示例中的\_mode 。特定于应用程序的统计信息应使用下划线前缀 ( \_\* ) 和 lowerCamelCase 以保持一致性并避免与未来的内置统计信息发生冲突。

注：   "建筑"类别的定义，具有三个属性。摘要统计信息为数字"高度"属性提供了最小值、最大值和(特定于应用程序的)"\_mode"。枚举"buildingType"属性由不同枚举值出现的次数进行总结。

```js
{ "架构" ：{ "类" ：{ "建筑" ：{ "属性" ：{ "高度" ：{ "类型" ："SCALAR" ，"componentType" ："FLOAT32" }，"所有者" ：{ "类型" : "STRING" , "array" : true }, "buildingType" : { "type" : "ENUM" , "enumType"："建筑类型" } } } }，"枚举"
 
   
     
       
         
           
           
         
         
           
           
         
         
           
           
         
       
     
   
    ：{ "buildingType" ：{ "valueType" ："UINT16" ，"values" ：[ { "name" ："Residential" ，"value" ：0 }，{ "name" ："Commercial" ，"value" ：1 }, { "name" : "Hospital" , "value" : 2 }, { "name" : "Other" , "value": 3 } ] } } },
     
       
       
         
         
         
         
       
     
   
 
  "统计" ：{ "类" ：{ "建筑" ：{ "计数" ：100000 ，"属性" ：{ "高度" ：{ "最小" ：3.9 ，"最大" ：341.7 ，"_mode" ：5.0 }，"建筑类型" ：{ "出现" ：{ "住宅" ：50000 ，"商业" ：40950 ，"医院" ：50 } } }
   
     
       
       
         
           
           
           
         
         
           
             
             
             
           
         
       
      } } } }
   
 

```

### 6.7.4.  指定扩展和特定于应用程序的附加功能

3D Tiles 定义扩展以允许基本规范具有新功能的可扩展性。

#### 6.7.4.1.扩展

扩展允许使用新功能扩展基本规范。可选的扩展字典属性可以添加到任何 3D Tiles JSON 对象，其中包含扩展名和扩展特定对象。以下示例显示了一个瓦片对象，该对象具有一个假设的供应商扩展名，该扩展名指定了一个单独的碰撞体积。

```js
{
  "transform": [
     4.843178171884396,   1.2424271388626869, 0,                  0,
    -0.7993325488216595,  3.1159251367235608, 3.8278032889280675, 0,
     0.9511533376784163, -3.7077466670407433, 3.2168186118075526, 0,
     1215001.7612985559, -4736269.697480114,  4081650.708604793,  1
  ],
  "boundingVolume": {
    "box": [ 0 , 0 , 6.701 , 3.738 , 0 , 0 , 0 , 3.72 , 0 , 0 , 0 , 13.402 ] }, "geometricError": 32 , "content": { "uri": "建筑. glb" }, "extensions": { "VENDOR_collision_volume": { "box
              
          
          
              
   
 
 
 
   
 
 
   
     " : [ 0 , 0 , 6.8 , 3.8 , 0 , 0 , 0 , 3.8 , 0 , 0 , 0 , 13.5 ] } } }
                
              
              
                
     
   
 

```

tileset 或任何后代外部 tilesets 中使用的所有扩展都应列在顶级 extensionsUsed 数组属性中的条目 tileset JSON 中，例如，

```js
{ "extensionsUsed": [ "VENDOR_collision_volume" ] }
 
   
 

```

加载和渲染 tileset 或任何后代外部 tilesets 所需的所有扩展也应列在顶级 extensionsRequired 数组属性中的条目 tileset JSON 中，这样 extensionsRequired 是 extensionsUsed 的子集。extensionsRequired 中的所有值也应存在于 extensionsUsed 中。

#### 6.7.4.2.附加功能

extras 属性允许将特定于应用程序的元数据添加到任何 3D Tiles JSON 对象。以下示例显示了一个具有附加应用程序特定名称属性的图块对象。

```js
{ "transform" : [ 4.843178171884396 , 1.2424271388626869 , 0 , 0 , - 0.7993325488216595 , 3.1159251367235608 , 3.8278032889280675 , 0 , 0.9511533376784163 , - 3.7077466670407433 , 3.2168186118075526 , 0 , 1215001.7612985559 , - 4736269.697480114 , 4081650.708604793 , 1 ], "boundingVolume" : { "box" : [ 0
 
                          
     
    
         
 
 
   
      , 0 , 6.701 , 3.738 , 0 , 0 , 0 , 3.72 , 0 , 0 , 0 , 13.402 ] }, "geometricError" : 32 , "content" : { "uri" : "building.glb" }, "extras" : { "名称" : "帝国大厦" } }        
          
          
              
   
 
 
 
   
 
 
   
 

```

[完整的 JSON 模式可以在 tileset.schema.json](https://portal.ogc.org/files/102132#reference-schema-tileset)中找到  。

## 6.8.  磁贴格式规范

每个 tile 的 content.uri 属性是一个文件的 uri，该文件包含用于呈现 tile 的 3D 内容的信息。内容是下面列出的格式之一的实例。

[glTF 2.0](https://github.com/KhronosGroup/glTF)是 3D Tile 的主要 Tile 格式。glTF 是一种开放规范，旨在高效传输和加载 3D 内容。glTF 资产包括单个图块的几何和纹理信息，并且可以扩展为包括元数据、模型实例化和压缩。glTF 可用于各种 3D 内容，包括：

- 异构 3D 模型。例如带纹理的地形和表面、3D 建筑外部和内部、大型模型
- 3D 模型实例。例如树木、风车、螺栓
- 海量点云

有关详细信息，请参阅[glTF Tile 格式。](https://portal.ogc.org/files/102132#tileformats-gltf-gltf)

Tiles 还可以引用下面列出的旧版 3D Tiles 1.0 格式。这些格式在 3D Tiles 1.1 中已弃用，可能会在 3D Tiles 的未来版本中删除。

表 6 — 传统图块格式和常见用途

| 传统格式                                                                                                       | 用途                           |
| :------------------------------------------------------------------------------------------------------------- | :----------------------------- |
| [批量 3D 模型 ( b3dm )](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)       | 异构 3D 模型                   |
| [实例化 3D 模型 ( i3dm )](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-instanced-3d-model) | 3D 模型实例                    |
| [点云 ( pnts )](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)                        | 海量积分                       |
| [复合 ( cmpt )](https://portal.ogc.org/files/102132#tileformats-composite-composite)                           | 将不同格式的图块连接成一个图块 |

## 6.9.  声明式样式规范

3D Tiles 包括使用 JSON 定义的简明声明式样式和用一小部分 JavaScript 编写的表达式，以增强样式。

样式使用基于 Feature 属性的表达式定义 Feature 的显示方式，例如显示和颜色(RGB 和半透明)。

以下示例将高度高于 90 的要素着色为红色，将其他要素着色为白色。

```js
{ "color" : "(${Height} > 90) ? color('red') : color('white')" }
 

```

有关完整的详细信息，请参阅[声明式样式](https://portal.ogc.org/files/102132#styling-styling)规范。

# 7、Tile 格式

[3D Tiles tileset 中的 tile 内容](https://portal.ogc.org/files/102132#core-tile-content)表示 tile 的可渲染内容。它与磁贴 JSON 的 content.uri 一起引用。

3D Tiles 1.1 中的主要图块格式是[glTF Tile Format](https://portal.ogc.org/files/102132#tileformats-gltf-gltf)。它建立在[glTF 2.0](https://github.com/KhronosGroup/glTF)之上，允许在 3D Tiles 中对许多不同的用例和不同形式的可渲染内容进行建模。

## 7.1.  传统磁贴格式

以下图块格式已成为 3D Tiles 1.0 的一部分，并已被[glTF Tile Format](https://portal.ogc.org/files/102132#tileformats-gltf-gltf)取代。

表 7 — 传统图块格式和常见用途

| 传统格式                                                                                                       | 用途                           |
| :------------------------------------------------------------------------------------------------------------- | :----------------------------- |
| [批量 3D 模型 ( b3dm )](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)       | 异构 3D 模型                   |
| [实例化 3D 模型 ( i3dm )](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-instanced-3d-model) | 3D 模型实例                    |
| [点云 ( pnts )](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)                        | 海量积分                       |
| [复合 ( cmpt )](https://portal.ogc.org/files/102132#tileformats-composite-composite)                           | 将不同格式的图块连接成一个图块 |

有关如何基于 glTF 磁贴格式对这些用例进行建模的更多信息，请参阅[迁移指南。](https://portal.ogc.org/files/102132#tileformats-gltf-migration-from-legacy-tile-formats)

## 7.2. glTF

### 7.2.1.  概述

[glTF 2.0](https://github.com/KhronosGroup/glTF)是 3D Tile 的主要 Tile 格式。glTF 是一种开放规范，旨在高效传输和加载 3D 内容。glTF 资产包括单个图块的几何和纹理信息，并且可以扩展为包括元数据、模型实例化和压缩。glTF 可用于各种 3D 内容，包括：

- 异构 3D 模型。例如带纹理的地形和表面、3D 建筑外部和内部、大型模型
- 海量点云
- 3D 模型实例。例如树木、风车、螺栓

### 7.2.2.  用例

#### 7.2.2.1.3D 模型

glTF 为各种网格和材料配置提供了灵活性，非常适合摄影测量和程式化 3D 模型。

表 8——基于 glTF 的不同类型模型

| 摄影测量                                                                                                                                         | 3D 建筑                                                                                                                                   |
| :----------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------- |
| ![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/074277a4-ed13-4189-b2f4-0ff992a92dc4) _O3DE 中来自 Aerometrex 的旧金山摄影测量模型_ | ![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/914d709c-76be-49dd-9533-2aa3dbfb9573) _CesiumJS 中来自 swisstopo 的 3D 建筑_ |

#### 7.2.2.2.点云

glTF 支持具有 0 ( POINTS ) 基元模式的点云。点可以具有在 primitive.attributes 字段中指定的位置、颜色、法线和自定义属性。

![点云](https://github.com/CHENJIAMIAN/Blog/assets/20126997/e12d3b1f-307f-4689-9efe-3d604c0296f9)

图 26——来自蒙特利尔市的 400 亿点云，带有 ASPRS 分类代码 ( [CC-BY 4.0](https://donnees.montreal.ca/license-en) )

使用[EXT_mesh_features](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features/README.md)时，可以为扩展点分配 Feature ID，并且这些 Feature 可以具有关联的元数据。

![点云Feature](https://github.com/CHENJIAMIAN/Blog/assets/20126997/cce80d18-5865-4b89-bdab-586a87b8359b)

图 27 — 具有两个属性表的点云，一个存储点组的元数据，另一个存储单个点的元数据

#### 7.2.2.3.实例化

[glTF 可以利用带有 EXT_mesh_gpu_instancing](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Vendor/EXT_mesh_gpu_instancing/README.md)扩展的 GPU 实例化。实例可以被赋予独特的平移、旋转、缩放和其他每个实例的属性。

![实例化](https://github.com/CHENJIAMIAN/Blog/assets/20126997/cb64d48d-32d6-4b5d-a5ae-d0c021da8765)

图 28——来自 OpenTreeMap 的费城实例树模型

使用[EXT_instance_features](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features/README.md)扩展实例时，可以为其分配功能 ID，并且这些功能可以具有关联的元数据。

![模型实例Feature](https://github.com/CHENJIAMIAN/Blog/assets/20126997/bf400361-af79-4d66-b2e5-f5258d7aec96)

图 29 — 实例化树模型，其中树被分配给具有每个实例 Feature ID 属性的组。一个 Feature 表存储每个组的元数据，另一个存储每个树的元数据

### 7.2.3. Feature 识别

[EXT_mesh_features](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features/README.md)提供了一种将标识符分配给 glTF 2.0 资产中的几何图形和几何图形子组件的方法。Feature ID 可以取消分配给顶点或纹素。[EXT_instance_features](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features/README.md)允许将功能 ID 分配给各个实例。

![逐纹素Feature](https://github.com/CHENJIAMIAN/Blog/assets/20126997/01d5e162-d7d2-404a-9c68-2f8845507fac)

图 30 — 来自 Aerometrex 的旧金山渡轮大楼的街道平面摄影测量。左图：显示 Feature 分类的每个纹素颜色，例如屋顶、天窗、窗户、窗框和空调装置。右：分类用于确定渲染材料属性，例如，使窗户半透明

### 7.2.4.  元数据

[EXT_structural_metadata](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata/README.md)[以每个顶点、每个纹素和每个 Feature 的粒度存储元数据，并使用 3D 元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)中定义的类型系统。此元数据可用于可视化和分析。

![元数据](https://github.com/CHENJIAMIAN/Blog/assets/20126997/04c442af-f227-4ffd-b84d-241a2a81a13a)

图 31——与 glTF 模型相关的元数据示例

### 7.2.5.  压缩

glTF 有几个用于几何和纹理压缩的扩展。这些扩展可以帮助减少文件大小和 GPU 内存使用。

#### 7.2.5.1.几何压缩

- [KHR_mesh_quantization](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_mesh_quantization/README.md)
- [EXT_meshopt_compression](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_meshopt_compression/README.md)
- [KHR_draco_mesh_compression](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_draco_mesh_compression/README.md)

#### 7.2.5.2.纹理压缩

- [KHR_texture_basisu](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_texture_basisu/README.md)

### 7.2.6.  文件扩展名和媒体类型

请参阅[glTF 文件扩展名和媒体类型](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#file-extensions-and-media-types)。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其他方式识别内容的格式，例如二进制 glTF 标头中的魔术字段或 JSON glTF 中资产字段的存在。

## 7.3.  批处理表

警告

批处理表在 3D Tiles 1.1 中已弃用。请参阅[glTF 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-migration-from-legacy-tile-formats)。

### 7.3.1.  概述

批处理*表*是 tile 二进制主体的一个组成部分，包含 tile 中每个功能的应用程序特定属性。在运行时查询这些属性以获取声明式样式和任何特定于应用程序的用例，例如填充 UI 或发出 REST API 请求。一些示例批处理表属性是建筑物高度、地理坐标和数据库主键。

批处理表由以下磁贴格式使用：

- [批处理 3D 模型](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)(b3dm)
- [实例化 3D 模型](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-instanced-3d-model)(i3dm)
- [点云](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)(pnts)

### 7.3.2.  布局

批处理表由两部分组成：一个 JSON 标头和一个可选的小端二进制正文。JSON 描述了属性，其值可以直接在 JSON 中定义为数组，也可以引用二进制主体中的部分。将长数值数组存储在二进制体中效率更高。下图显示了批处理表布局：

![批处理表布局](https://github.com/CHENJIAMIAN/Blog/assets/20126997/31d90961-32aa-4439-ab6f-dcf08b2dff2f)

图 32 — 批处理表的数据布局

当图块格式包含批处理表时，批处理表紧跟在图块的 Feature 表之后。标头还将包含 batchTableJSONByteLength 和 batchTableBinaryByteLength uint32 字段，可用于提取批处理表的各个部分。

#### 7.3.2.1.填充

JSON 标头应在包含的 tile 二进制文件中的 8 字节边界处结束。JSON 标头应填充尾随空格字符 ( 0x20 ) 以满足此要求。

二进制主体应在包含的 tile 二进制文件中的 8 字节边界上开始和结束。二进制主体应填充任何值的附加字节以满足此要求。

二进制属性应从一个字节偏移量开始，该字节偏移量是属性的 componentType 字节大小的倍数。例如，组件类型为 FLOAT 的属性每个元素有 4 个字节，因此应从 4 的倍数的偏移量开始。前面的二进制属性应使用任何值的附加字节来填充以满足此要求。

#### 7.3.2.2.JSON 标头

批处理表值可以通过两种不同的方式在 JSON 标头中表示：

1. 一组值，例如，"name"：\['name1', 'name2', 'name3']或"height"：\[10.0, 20.0, 15.0]。
   - 数组元素可以是任何有效的 JSON 数据类型，包括对象和数组。元素可能为 null。
   - 每个数组的长度等于 batchLength，这是在每个瓦片格式中指定的。这是图块中的要素数。例如，batchLength 可能是 b3dm tile 中的模型数、i3dm tile 中的实例数或 pnts tile 中的点数(或对象数)。
2. 对二进制主体中数据的引用，由具有 byteOffset、componentType 和类型属性的对象表示，例如，"height"：{"byteOffset"：24，"componentType"："FLOAT"，"type"："SCALAR" }。
   - byteOffset 指定相对于二进制主体开头的从零开始的偏移量。byteOffset 的值应该是属性的 componentType 字节大小的倍数，例如，组件类型为 FLOAT 的属性的 byteOffset 值应该是 4 的倍数。
   - componentType 是属性中组件的数据类型。允许的值为"BYTE"、"UNSIGNED_BYTE"、"SHORT"、"UNSIGNED_SHORT"、"INT"、"UNSIGNED_INT"、"FLOAT"和"DOUBLE"。
   - type 指定属性是标量还是向量。允许的值为"SCALAR"、"VEC2"、"VEC3"和"VEC4"。

批处理表 JSON 是包含 JSON 的 UTF-8 字符串。

注意   在 JavaScript 中，批处理表 JSON 可以使用 TextDecoder JavaScript API 从 ArrayBuffer 中提取，并使用 JSON.parse 转换为 JavaScript 对象。

batchId 用于访问每个数组中的元素并提取相应的属性。例如，以下批处理表具有两个 Feature 的批处理属性：

```js
{ "id" ：["唯一id"，"另一个唯一id"]，"displayName" ：["建筑物名称"，"另一个建筑物名称"]，"yearBuilt" ：[ 1999，2015 ] ，"address" ：[ {"街道" ："主街"，"房屋编号" ："1"}，{"
   
   
   
             street" ："Main Street"，"houseNumber" ："2"}] }

```

batchId = 0 的 properties 的属性是

```js
id [ 0 ] = '唯一id '; displayName [ 0 ] = '建筑物名称'; 建造年份[ 0 ] = 1999 ; 地址[ 0 ] = {街道：'主街'，houseNumber ：' 1 '}；



```

batchId = 1 的属性是

```js
id [ 1 ] = '另一个唯一的id '; displayName [ 1 ] = '另一个建筑物名称'; 建造年份[ 1 ] = 2015 年；地址[ 1 ] = {街道：'主街'，房屋编号：' 2 '}；



```

#### 7.3.2.3.二元体

当 JSON 标头包含对二进制部分的引用时，提供的 byteOffset 用于对数据进行索引，如下图所示：

![批处理表二进制索引](https://github.com/CHENJIAMIAN/Blog/assets/20126997/200a14d2-461d-440f-be07-9d1e07ec671e)

图 33 — 显示如何根据 JSON 标头中的信息访问二进制主体的示例

可以使用 Feature 数量 batchLength 检索值；所需的批次 ID，batchId；以及 JSON 标头中定义的 componentType 和类型。

下表可用于计算属性的字节大小。

表 9——组件类型的大小

| 组件类型         | 字节大小 |
| :--------------- | :------- |
| "字节"           | 1 个     |
| "UNSIGNED_BYTE"  | 1 个     |
| "短的"           | 2 个     |
| "UNSIGNED_SHORT" | 2 个     |
| "情报"           | 4 个     |
| "UNSIGNED_INT"   | 4 个     |
| "漂浮"           | 4 个     |
| "双倍的"         | 8 个     |

表 10——元素的组件数

| 类型   | 组件数量 |
| :----- | :------- |
| "标量" | 1 个     |
| "VEC2" | 2 个     |
| "VEC3" | 3 个     |
| "VEC4" | 4 个     |

### 7.3.3.  扩展

以下扩展可应用于批处理表。

- [3DTILES_batch_table_hierarchy](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_batch_table_hierarchy/README.md)

### 7.3.4.  实施例

_本节内容丰富_

以下示例分别访问"高度"和"地理"值，给定以下批处理表 JSON，batchLength 为 10：

```js
{ "高度" ：{ "byteOffset" ：0 ，"componentType" ："FLOAT"，"type" ："SCALAR" }，"geographic" ：{ "byteOffset" ：40 ，"componentType" ："DOUBLE"，"type"" ："VEC3" } }
   
       
       
       
   
   
       
       
       
   

```

要获取"高度"值：

```js
变种高度= batchTableJSON 。身高；
var byteOffset =高度。字节偏移量；
变种组件类型=高度。组件类型；
变量类型=高度。类型；

var heightArrayByteLength = batchLength * sizeInBytes ( componentType ) * numberOfComponents (类型); // 10 * 4 * 1变量高度数组=
 new Float32Array ( batchTableBinary . buffer , byteOffset , heightArrayByteLength ); var heightOfFeature = heightArray [ batchId ];

```

要获取"地理"值：

    变种地理= batchTableJSON 。地理；
    var byteOffset =地理。字节偏移量；
    变种componentType =地理。组件类型；
    变种类型=地理。类型；
    var componentSizeInBytes = sizeInBytes ( componentType )
    var numberOfComponents = numberOfComponents (类型);

    变种地理数组字节长度= batchLength * componentSizeInBytes * numberOfComponents // 10 * 8 * 3
    var geographicArray = new Float64Array ( batchTableBinary . buffer , byteOffset , geographicArrayByteLength ); var geographicOfFeature =位置数组。子数组( batchId * numberOfComponents , batchId * numberOfComponents + numberOfComponents );
     // 使用子数组创建数组视图，而不是新数组。

读取批处理表的代码可以在 3D Tiles 的 CesiumJS 实现中的[Cesium3DTileBatchTable.js](https://github.com/CesiumGS/cesium/blob/main/Source/Scene/Cesium3DTileBatchTable.js)中找到。

## 7.4. Feature 表

警告

Feature 表在 3D Tiles 1.1 中被弃用。请参阅[glTF 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-migration-from-legacy-tile-formats)。

### 7.4.1.  概述

要素*表*是图块二进制主体的一个组成部分，描述了在图块中呈现每个要素所需的位置和外观属性。另一方面，批处理表包含不一定用于渲染的每个功能特定于应用程序的属性[。](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table)

Feature 表用于瓦片格式，例如[批处理 3D 模型](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)(b3dm)，其中每个模型是一个 Feature，[点云](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)(pnts)，其中每个点是一个 Feature。

每个 Feature 的属性是使用每个图块格式规范中定义的特定于图块格式的语义来定义的。例如，对于*Instanced 3D Model*，SCALE_NON_UNIFORM 定义应用于每个 3D 模型实例的非均匀比例。

### 7.4.2.  布局

Feature 表由两部分组成：JSON 标头和可选的小端二进制正文。JSON 属性名称是特定于图块格式的语义，它们的值可以直接在 JSON 中定义，也可以引用二进制主体中的部分。将长数值数组存储在二进制体中效率更高。下图显示了 Feature 表布局：

![功能表布局](https://github.com/CHENJIAMIAN/Blog/assets/20126997/3f136293-6133-4361-a6db-50c330b3bb9b)

图 34 — Feature 表的数据布局

当图块格式包含 Feature 表时，Feature 表紧跟在图块的标题之后。标头还将包含 featureTableJSONByteLength 和 featureTableBinaryByteLength uint32 字段，可用于提取 Feature 表的各个部分。

#### 7.4.2.1.填充

JSON 标头应在包含的 tile 二进制文件中的 8 字节边界处结束。JSON 标头应填充尾随空格字符 ( 0x20 ) 以满足此要求。

二进制主体应在包含的 tile 二进制文件中的 8 字节边界上开始和结束。二进制主体应填充任何值的附加字节以满足此要求。

二进制属性应从一个字节偏移量开始，该字节偏移量是属性隐式组件类型的字节大小的倍数。例如，具有隐式组件类型 FLOAT 的属性每个元素有 4 个字节，因此应从 4 的倍数的偏移量开始。前面的二进制属性应使用任何值的附加字节来填充以满足此要求。

#### 7.4.2.2.JSON 标头

要素表值可以通过两种不同的方式在 JSON 标头中表示：

1. 单个值或对象，例如"INSTANCES_LENGTH" : 4。

   - 这用于全局语义，如"INSTANCES_LENGTH"，它定义了实例化 3D 模型图块中模型实例的数量。

2. 对二进制主体中数据的引用，由具有 byteOffset 属性的对象表示，例如"SCALE"：{"byteOffset"：24}。

   - byteOffset 指定相对于二进制主体开头的从零开始的偏移量。byteOffset 的值应是属性隐式组件类型的字节大小的倍数，例如，"POSITION"属性具有组件类型 FLOAT (4 字节)，因此 byteOffset 的值应是 4 的倍数。
   - 语义定义了允许的数据类型，例如，当 Instanced 3D Model 中的"POSITION"指的是二进制体时，组件类型为 FLOAT，组件数量为 3。
   - 一些语义允许覆盖隐式组件类型。这些情况在每个图块格式中指定，例如，"BATCH_ID"：{"byteOffset"：24，"componentType"："UNSIGNED_BYTE"}。JSON 标头中唯一有效的属性是由 tile 格式定义的语义以及可选的额外和扩展属性。特定于应用程序的数据应存储在批处理表中。

#### 7.4.2.3.二元体

当 JSON 标头包含对二进制文件的引用时，提供的 byteOffset 用于索引数据。下图显示了对 Feature 表二进制主体的索引：

![Feature表二进制索引](https://github.com/CHENJIAMIAN/Blog/assets/20126997/0794abb5-6449-4e6c-b083-25f9181ef27b)

图 35 — 显示如何根据 JSON 标头中的信息访问二进制主体的示例

可以使用 Feature 数量 featuresLength 检索值；所需的功能 ID，featureId；以及 Feature 语义的数据类型(组件类型和组件数量)。

### 7.4.3.  实施例

_本节内容丰富_

以下示例使用 POSITION 语义访问 position 属性，该语义具有 float32\[3]数据类型：

    var byteOffset = featureTableJSON 。位置。字节偏移量；

    var positionArray = new Float32Array ( featureTableBinary.buffer , byteOffset , featuresLength * 3 ) ; _ // 每个 POSITION Feature都包含三个组件。变种位置= positionArray 。子数组( featureId * 3 , featureId * 3 + 3 );
         // 使用子数组创建数组视图，而不是新数组。

读取 Feature 表的代码可以在 3D Tiles 的 CesiumJS 实现中的[Cesium3DTileFeatureTable.js](https://github.com/CesiumGS/cesium/blob/main/Source/Scene/Cesium3DTileFeatureTable.js)中找到。

## 7.5.  批量 3D 模型

警告

批处理 3D 模型在 3D Tiles 1.1 中已弃用。请参阅[b3dm 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-batched-3d-model-b3dm)。

### 7.5.1.  概述

*批处理 3D 模型*允许对异构 3D 模型(例如城市中的不同建筑物)进行离线批处理，以便高效地流式传输到 Web 客户端以进行渲染和交互。效率来自于在单个请求中传输多个模型并以最少数量的必要 WebGL 绘制调用渲染它们。使用核心 3D Tiles 规范语言，每个模型都是一个*Feature*。

每个模型的属性，例如 ID，使各个模型能够在运行时被识别和更新，例如，显示/隐藏、突出显示颜色等。属性可以用于例如查询 Web 服务以访问元数据，例如传递建筑物的 ID 以获取其地址。或者可能会动态引用属性以更改模型的外观，例如，根据属性值更改突出显示颜色。

批处理 3D 模型图块是小端字节序的二进制 blob。

### 7.5.2.  布局

磁贴由两部分组成：标题紧接着是正文。下图显示了批处理 3D 模型布局(破折号表示可选字段)：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/6d5074f7-277e-4cfb-9a56-8c28a09fa919)

图 36 — 批处理 3D 模型的数据布局

#### 7.5.2.1.填充

块的 byteLength 应与 8 字节边界对齐。包含的[Feature Table](https://portal.ogc.org/files/102132#tileformats-featuretable-padding)和[Batch Table](https://portal.ogc.org/files/102132#tileformats-batchtable-padding)应符合其各自的填充要求。

二进制[glTF](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-binary-gltf)应在 8 字节边界上开始和结束，以便满足 glTF 的字节对齐保证。这可以通过填充 Feature 表或批处理表(如果存在)来完成。

### 7.5.3.  标头

28 字节的标头包含以下字段：

表 11 — 批量 3D 模型的标题字段

| 字段名称                     | 数据类型           | 描述                                                                                       |
| :--------------------------- | :----------------- | :----------------------------------------------------------------------------------------- |
| 魔法                         | 4 字节 ANSI 字符串 | "b3dm"。这可用于将内容标识为批处理 3D 模型图块。                                           |
| 版本                         | uint32             | 批处理 3D 模型格式的版本。目前是 1。                                                       |
| 字节长度                     | uint32             | 整个图块的长度，包括标头，以字节为单位。                                                   |
| featureTableJSONByteLength   | uint32             | Feature 表 JSON 部分的长度(以字节为单位)。                                                 |
| featureTableBinaryByteLength | uint32             | Feature 表二进制部分的长度(以字节为单位)。                                                 |
| batchTableJSONByteLength     | uint32             | 批处理表 JSON 部分的长度(以字节为单位)。零表示没有批处理表。                               |
| batchTableBinaryByteLength   | uint32             | 批处理表二进制部分的长度(以字节为单位)。如果 batchTableJSONByteLength 为零，则这也将为零。 |

主体部分紧跟在标题部分之后，由三个字段组成：Feature Table、Batch Table 和 Binary glTF。

### 7.5.4. Feature 表

包含 b3dm 语义的值。

[功能表规范](https://portal.ogc.org/files/102132#tileformats-featuretable-feature-table)中提供了更多信息。

[完整的 JSON 模式可以在 b3dm.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-b3dm-featuretable)中找到  。

#### 7.5.4.1.语义学

##### 7.5.4.1.1.Feature 语义

当前没有每个 Feature 的语义。

##### 7.5.4.1.2.全局语义

这些语义定义了所有 Feature 的全局属性。

表 12 - 批量 3D 模型的全局语义

| 语义的       | 数据类型    | 描述                                                                                                                                                      | 必需的 |
| :----------- | :---------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| BATCH_LENGTH | uint32      | 批次中可区分模型(也称为 Feature)的数量。如果二进制 glTF 没有 batchId 属性，则此字段*应*为 0。                                                             | 是的。 |
| RTC\_中心    | float32\[3] | 当相对于中心定义位置时，定义中心位置的 3 分量数字数组(请参阅[坐标系](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-coordinate-system))。 | 不。   |

### 7.5.5.批处理表

批处理*表*包含每个模型特定于应用程序的属性，可由 batchId 索引，可用于[声明式样式](https://portal.ogc.org/files/102132#styling-styling)和特定于应用程序的用例，例如填充 UI 或发出 REST API 请求。在二进制 glTF 部分中，每个顶点都有一个整数范围\[0, number of models in the batch - 1] 中的数字 batchId 属性。batchId 表示顶点所属的模型。这允许模型一起批处理并且仍然可以识别。

有关详细信息，请参阅[批处理表参考。](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table)

### 7.5.6.  二进制 glTF

批处理 3D 模型嵌入了包含模型几何和纹理信息的[glTF 2.0 。](https://github.com/KhronosGroup/glTF/tree/main/specification/2.0)

二进制[glTF](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#binary-gltf-layout)紧跟在 Feature 表和批处理表之后。它可能嵌入其所有几何、纹理和动画，或者它可能引用外部来源以获取部分或全部这些数据。

如上所述，每个顶点都有一个 batchId 属性，指示它所属的模型。例如，具有三个模型的批次的顶点可能如下所示：

    batchId ：[ 0，0，0 ，… ，1，1，1 ，… ，2，2，2 ，… ]位置：[ xyz ，xyz ，xyz ，… ，xyz ，xyz ，xyz ，… ，xyz ，xyz ，_ _ _ _ _ _ _ xyz , …]正常: [ xyz , xyz , xyz ,                              

        …, xyz , xyz , xyz , …, xyz , xyz , xyz , …]

顶点不需要按 batchId 排序，所以下面的也可以：

    batchId ：[ 0，1，2 ，... ，2，1，0 ，... ，1，2，0 ，... ]位置：[ xyz ，xyz ，xyz ，... ，xyz ，xyz ，xyz ，... ，xyz ，xyz ，_ _ _ _ _ _ _ xyz , …]正常: [ xyz , xyz , xyz ,                              

        …, xyz , xyz , xyz , …, xyz , xyz , xyz , …]

请注意，一个顶点不能属于多个模型；在这种情况下，需要复制顶点，以便可以分配 batchId 。

batchId 参数通过提供\_BATCHID 属性语义以及 batchId[访问器的索引在 glTF](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#accessors)[网格原语](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#meshes)中指定。例如，

```js
"原语"：[ { "属性"：{ "_BATCHID"：0 } } ]
   
       
           
       
   

```

```js
{ "accessors"：[ { "bufferView"：1 ，"byteOffset"：0 ，"componentType"：5126 ，"count"：4860 ，"max"：[ 2 ]，"min"：[ 0 ]，"type" : "标量" } ] }
   
       
           
           
           
           
           
           
           
       
   

```

accessor.type 的值应为"SCALAR"。所有其他属性应符合 glTF 模式，但没有额外要求。

当存在批处理表或 BATCH_LENGTH 属性大于 0 时，需要\_BATCHID 属性；否则，它不是。

#### 7.5.6.1.坐标系

默认情况下，嵌入式 glTF 使用右手坐标系，其中*y*轴向上。为了与 3D Tiles 的\*z -up 坐标系保持一致，glTF 应在运行时进行转换。\*有关详细信息，请参阅[glTF 转换。](https://portal.ogc.org/files/102132#core-gltf-transforms)

可以相对于中心定义顶点位置以进行高精度渲染，请参阅[Precisions, Precisions](http://help.agi.com/AGIComponents/html/BlogPrecisionsPrecisions.htm)。如果已定义，RTC_CENTER 指定在应用坐标系变换和 glTF 节点层次结构变换后所有顶点位置相对的中心位置。具体来说，当 RTC_CENTER 定义在 Batched 3D Model 的 Feature 表中时，[tile transform](https://portal.ogc.org/files/102132#core-tile-transforms)的计算如下：

1. [glTF 节点层次结构转换](https://portal.ogc.org/files/102132#core-gltf-node-hierarchy)
2. [glTF](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[y](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 到](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[z](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 变换](https://portal.ogc.org/files/102132#core-y-up-to-z-up)
3. RTC_CENTER 的变换，用于平移模型顶点
4. [Tile 变换](https://portal.ogc.org/files/102132#core-tile-transforms)

### 7.5.7.  文件扩展名和媒体类型

批处理的 3D 模型图块使用.b3dm 扩展名和 application/octet-stream 媒体类型。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其标头中的魔术字段来识别内容的格式。

### 7.5.8.  实施例

_本节内容丰富_

读取标题的代码可以在 3D Tiles 的 CesiumJS 实现中的[Batched3DModelTileContent.js](https://github.com/CesiumGS/cesium/blob/main/Source/Scene/Batched3DModel3DTileContent.js)中找到 。

## 7.6.  实例化 3D 模型

警告

实例化 3D 模型在 3D Tiles 1.1 中已弃用。请参阅[i3dm 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-instanced-3d-model-i3dm)。

### 7.6.1.  概述

*Instanced 3D Model*是一种用于高效流式传输和渲染大量模型(称为*instances*，略有变化)的图块格式。在最简单的情况下，例如，相同的树模型可能位于或*实例化*在多个地方。每个实例都引用相同的模型并具有每个实例的属性，例如位置。使用核心 3D Tiles 规范语言，每个实例都是一个*Feature*。

除树木外，实例化 3D 模型还可用于消防栓、下水道盖、灯和交通信号灯等外部 Feature，以及螺栓、阀门和电源插座等内部 CAD Feature。

实例化 3D 模型图块是小端字节序的二进制 blob。

注 1  复合图块可用于通过组合两个实例化 3D 模型图块来创建具有不同类型实例化模型的图块，例如树木和交通灯[。](https://portal.ogc.org/files/102132#tileformats-composite-composite)

注 2  实例化 3D 模型可以很好地映射到[ANGLE_instanced_arrays](https://www.khronos.org/registry/webgl/extensions/ANGLE_instanced_arrays/)扩展，以便使用 WebGL 进行高效渲染。

### 7.6.2.  布局

一个 tile 由一个标题部分组成，紧接着是一个二进制主体。下图显示了实例化 3D 模型布局(破折号表示可选字段)：

![页眉布局](https://github.com/CHENJIAMIAN/Blog/assets/20126997/cdd30e01-2dc7-41a7-9484-841718e92091)

图 37 — 实例化 3D 模型的数据布局

#### 7.6.2.1.填充

块的 byteLength 应与 8 字节边界对齐。包含的[Feature Table](https://portal.ogc.org/files/102132#tileformats-featuretable-padding)和[Batch Table](https://portal.ogc.org/files/102132#tileformats-batchtable-padding)应符合其各自的填充要求。

二进制[glTF](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-gltf)(如果存在)应在 8 字节边界上开始和结束，以便满足 glTF 的字节对齐保证。这可以通过填充 Feature 表或批处理表(如果存在)来完成。

否则，如果 glTF 字段是 UTF-8 字符串，则应使用尾随空格字符 ( 0x20 ) 填充以满足图块的对齐要求，在运行时应在请求 glTF 资产之前将其删除。

### 7.6.3.  标头

32 字节的标头包含以下字段：

表 13 — 实例化 3D 模型的标题字段

| 字段名称                     | 数据类型           | 描述                                                                                                                                                                          |
| :--------------------------- | :----------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 魔法                         | 4 字节 ANSI 字符串 | "i3dm"。这可用于将内容标识为实例化 3D 模型图块。                                                                                                                              |
| 版本                         | uint32             | 实例化 3D 模型格式的版本。目前是 1。                                                                                                                                          |
| 字节长度                     | uint32             | 整个图块的长度，包括标头，以字节为单位。                                                                                                                                      |
| featureTableJSONByteLength   | uint32             | Feature 表 JSON 部分的长度(以字节为单位)。                                                                                                                                    |
| featureTableBinaryByteLength | uint32             | Feature 表二进制部分的长度(以字节为单位)。                                                                                                                                    |
| batchTableJSONByteLength     | uint32             | 批处理表 JSON 部分的长度(以字节为单位)。零表示没有批处理表。                                                                                                                  |
| batchTableBinaryByteLength   | uint32             | 批处理表二进制部分的长度(以字节为单位)。如果 batchTableJSONByteLength 为零，则这也将为零。                                                                                    |
| gltf 格式                    | uint32             | 指示主体的 glTF 字段的格式。 0 表示它是一个 URI，1 表示它是嵌入的二进制 glTF。请参阅下面的[glTF](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-gltf)部分。 |

主体部分紧跟在标题部分之后，由三个字段组成：Feature Table、Batch Table 和 glTF。

### 7.6.4. Feature 表

Feature 表包含用于创建实例模型的 i3dm 语义的值。[功能表规范](https://portal.ogc.org/files/102132#tileformats-featuretable-feature-table)中提供了更多信息。

[完整的 JSON 模式可以在 i3dm.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-i3dm-featuretable)中找到  。

#### 7.6.4.1.语义学

##### 7.6.4.1.1.实例语义

这些语义映射到用于创建实例的 Feature 值数组。这些数组的长度对于所有语义都应该是相同的，并且等于实例的数量。每个实例语义的值应是对 Feature 表二进制体的引用；它们不能嵌入到要素表 JSON 标头中。

如果一个语义依赖于另一个语义，则应定义该语义。如果为实例定义了 SCALE 和 SCALE_NON_UNIFORM ，则将应用这两种缩放操作。如果为实例定义了 POSITION 和 POSITION_QUANTIZED ，则将使用精度更高的 POSITION 。如果为实例定义了 NORMAL_UP、NORMAL_RIGHT、NORMAL_UP_OCT32P 和 NORMAL_RIGHT_OCT32P ，则将使用精度更高的 NORMAL_UP 和 NORMAL_RIGHT 。

表 14——实例化 3D 模型实例的语义

| 语义的              | 数据类型                     | 描述                                                                       | 必需的                                 |
| :------------------ | :--------------------------- | :------------------------------------------------------------------------- | :------------------------------------- |
| 位置                | float32\[3]                  | 包含实例位置的 x、y 和 z 笛卡尔坐标的 3 分量数字数组。                     | 是的，除非定义了 POSITION_QUANTIZED 。 |
| POSITION_QUANTIZED  | uint16\[3]                   | 包含 x、y 和 z 的 3 分量数字数组，在实例位置的量化笛卡尔坐标中。           | 是的，除非定义了 POSITION 。           |
| NORMAL_UP           | float32\[3]                  | 定义实例方向的向上方向的单位向量。                                         | 否，除非定义了 NORMAL_RIGHT 。         |
| 正常\_右            | float32\[3]                  | 定义实例方向的正确方向的单位向量。应与 up 正交。                           | 否，除非定义了 NORMAL_UP 。            |
| NORMAL_UP_OCT32P    | uint16\[2]                   | 具有 32 位精度的八进制编码单位向量，定义实例方向的向上方向。               | 否，除非定义了 NORMAL_RIGHT_OCT32P 。  |
| NORMAL_RIGHT_OCT32P | uint16\[2]                   | 具有 32 位精度的八进制编码单位向量，定义实例方向的正确方向。应与 up 正交。 | 否，除非定义了 NORMAL_UP_OCT32P 。     |
| 规模                | 浮点 32                      | 定义要应用于实例所有轴的比例的数字。                                       | 不。                                   |
| SCALE_NON_UNIFORM   | float32\[3]                  | 定义应用于实例的 x、y 和 z 轴的比例的 3 分量数字数组。                     | 不。                                   |
| 批号                | uint8、uint16(默认)或 uint32 | 可用于从批处理表中检索元数据的实例的 batchId 。                            | 不。                                   |

##### 7.6.4.1.2.全局语义

这些语义定义了所有实例的全局属性。

表 15——实例化 3D 模型的全局语义

| 语义的                  | 数据类型    | 描述                                                                                    | 必需的                               |
| :---------------------- | :---------- | :-------------------------------------------------------------------------------------- | :----------------------------------- |
| INSTANCES_LENGTH        | uint32      | 要生成的实例数。实例语义的每个数组值的长度应等于此值。                                  | 是的。                               |
| RTC\_中心               | float32\[3] | 当实例位置相对于中心定义时，定义中心位置的 3 分量数字数组。                             | 不。                                 |
| QUANTIZED_VOLUME_OFFSET | float32\[3] | 定义量化体积偏移量的 3 分量数字数组。                                                   | 不，除非定义了 POSITION_QUANTIZED 。 |
| QUANTIZED_VOLUME_SCALE  | float32\[3] | 定义量化体积尺度的 3 分量数字数组。                                                     | 不，除非定义了 POSITION_QUANTIZED 。 |
| EAST_NORTH_UP           | 布尔值      | 当未定义真实和每个实例的方向时，每个实例将默认为 WGS84 椭球上的东/北/上参考框架的方向。 | 不。                                 |

[使用这些语义的示例可以在示例部分](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-examples)找到。

#### 7.6.4.2.实例定位

实例的方向由上右向量创建的正交基定义。方向将由[tile transform](https://portal.ogc.org/files/102132#core-tile-transforms)进行转换。

标准基础中的 x 向量映射到变换基础中的右向量，y 向量映射到上向量。z 向量将映射到前向向量，但它被省略了，因为它始终是 right 和 up 的叉积。

![箱标准基础](https://github.com/CHENJIAMIAN/Blog/assets/20126997/0bc8f732-c3f9-4ce2-91c8-7509a0e6e42e)

图 38——标准基础中的一个盒子

![盒子旋转基础](https://github.com/CHENJIAMIAN/Blog/assets/20126997/609c7bd2-a4c7-45cc-ab92-32f1e0dc3cc8)

图 39 — 转换为旋转基础的框

##### 7.6.4.2.1.Oct 编码法向量

如果未为实例定义 NORMAL_UP 和 NORMAL_RIGHT ，则其方向可能存储为 NORMAL_UP_OCT32P 和 NORMAL_RIGHT_OCT32P 中的八进制编码法线。这些使用\*[A Survey of Efficient Representations of Independent Unit Vectors](http://jcgt.org/published/0003/02/01/)\*中描述的八进制编码定义向上和向右。Oct 编码值存储在无符号、非标准化范围 ( \[0, 65535] ) 中，然后在运行时映射到带符号的标准化范围 ( \[-1.0, 1.0] )。

注意可以在 CesiumJS 的[AttributeCompression](https://github.com/CesiumGS/cesium/blob/main/Source/Core/AttributeCompression.js)模块   中找到对这些单位向量进行编码和解码的实现  。

##### 7.6.4.2.2.默认方向

如果 NORMAL_UP 和 NORMAL_RIGHT 或 NORMAL_UP_OCT32P 和 NORMAL_RIGHT_OCT32P 不存在，则实例将没有自定义方向。如果 EAST_NORTH_UP 为 true，则假定该实例位于 WGS84 椭球体上，并且其方向将默认为其制图位置的东/北/上参考系。这适用于实例化模型，例如方向始终从其在椭球体表面上的位置朝上的树木。

#### 7.6.4.3.实例位置

POSITION 定义应用任何 Tile 变换之前实例的位置。

##### 7.6.4.3.1.RTC\_中心

可以相对于中心定义位置以进行高精度渲染，请参阅[Precisions, Precisions](http://help.agi.com/AGIComponents/html/BlogPrecisionsPrecisions.htm)。如果已定义，RTC_CENTER 指定中心位置并且所有实例位置都被视为相对于此值。有关此属性对变换的影响，请参阅[坐标系。](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-coordinate-system)

##### 7.6.4.3.2.量化职位

如果没有为实例定义 POSITION，则其位置可能存储在 POSITION_QUANTIZED 中，它定义了实例相对于量化体积的位置。如果 POSITION 或 POSITION_QUANTIZED 均未定义，则不会创建实例。

一个量化体由 offset 和 scale 定义，将量化后的位置映射到局部空间，如下图所示：

![量化体积](https://github.com/CHENJIAMIAN/Blog/assets/20126997/7c1f8a2c-e0ba-4b51-8eb6-7c4ea6ea824c)

图 40 — 用于 POSITION_QUANTIZED 语义的量化说明

offset 存储在全局语义 QUANTIZED_VOLUME_OFFSET 中，scale 存储在全局语义 QUANTIZED_VOLUME_SCALE 中。如果未定义这些全局语义，则无法使用 POSITION_QUANTIZED 。

可以使用以下公式将量化位置映射到局部空间：

POSITION = POSITION_QUANTIZED \* QUANTIZED_VOLUME_SCALE / 65535.0 + QUANTIZED_VOLUME_OFFSET

应在应用任何其他转换之前解压缩压缩的属性。

#### 7.6.4.4.实例缩放

可以使用 SCALE 和 SCALE_NON_UNIFORM 语义将缩放应用于实例。 SCALE 沿所有轴应用统一比例，而 SCALE_NON_UNIFORM 独立地对 x、y 和 z 轴应用缩放。

#### 7.6.4.5.例子

这些示例展示了如何为 Feature 表生成 JSON 和二进制缓冲区。

##### 7.6.4.5.1.仅限职位

在这个最小的示例中，我们将四个实例放置在具有默认方向的单位长度正方形的角上：

```js
var featureTableJSON = {     INSTANCES_LENGTH : 4 ,     POSITION : {         byteOffset : 0 } }; var featureTableBinary = new Buffer ( new Float32Array ([ 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 1.0 , 0.0 , 1.0 ])。缓冲区);



   



   
   
   
   

```

##### 7.6.4.5.2.量化位置和八进制编码法线

在此示例中，四个实例将以\[0.0, 1.0, 0.0]方向向上和\[ 1.0, 0.0, 0.0]方向以八进制编码格式放置，并且它们将放置在量化体积的角上在 x 和 z 方向上的范围从-250.0 到 250.0 个单位：

    var featureTableJSON = {     INSTANCES_LENGTH ：4 ，    QUANTIZED_VOLUME_OFFSET ：[     - 250.0，0.0 ，- 250.0 ]         ，    QUANTIZED_VOLUME_SCALE ：[ 500.0，0.0，500.0 ] ，POSITION_QUANTIZED ：{ byteOffset ：0 }     ，    NORMAL_UP_OCT32P ：{ byteOffset ：24 } ，NORMAL_RIGHT_OCT32P         ：{ _





       


       

            字节偏移量：40 } }；var positionQuantizedBinary = new Buffer ( new Uint16Array ([ 0 , 0 , 0 , 65535 , 0 , 0 , 0 , 0 , 65535 , 65535 , 0 , 65535 ]).缓冲区); var normalUpOct32PBinary = new Buffer ( new Uint16Array ([ 32768 ,
       



       
       
       
       



         65535 , 32768 , 65535 , 32768 , 65535 , 32768 , 65535 ])。缓冲区)；var normalRightOct32PBinary = new Buffer ( new Uint16Array ([ 65535 , 32768 , 65535 , 32768 , 65535 , 32768 , 65535 , 32768 ]). buffer ); var featureTableBinary =缓冲区。连接([
       
       
       



       
       
       
       


     positionQuantizedBinary , normalUpOct32PBinary , normalRightOct32PBinary ]);

### 7.6.5.  批处理表

包含按 batchId 组织的元数据，可用于声明式样式。有关详细信息，请参阅[批处理表参考。](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table)

### 7.6.6. glTF

实例化 3D 模型嵌入了包含模型几何和纹理信息的[glTF 2.0 。](https://github.com/KhronosGroup/glTF/tree/main/specification/2.0)

要实例化的 glTF 资产存储在 Feature Table 和 Batch Table 之后。它可能嵌入其所有几何、纹理和动画，或者它可能引用外部来源以获取部分或全部这些数据。

header.gltfFormat 决定 glTF 字段的格式

- 当 header.gltfFormat 的值为 0 时，glTF 字段为 UTF-8 字符串，其中包含 glTF 或二进制 glTF 模型内容的 URI 。
- 当 header.gltfFormat 的值为 1 时，glTF 字段是包含[二进制 glTF 的](https://www.khronos.org/registry/glTF/specs/2.0/glTF-2.0.html#binary-gltf-layout)二进制 blob 。

当 glTF 字段包含 URI 时，则此 URI 可能指向[相对外部引用 (RFC3986)](https://tools.ietf.org/html/rfc3986#section-4.2)。当 URI 是相对的时，它的基础总是相对于引用的.i3dm 文件。客户端实现需要支持相对外部引用。可选地，客户端实现可以支持其他方案(例如 http\://)。所有 URI 都应有效且可解析。

#### 7.6.6.1.坐标系

默认情况下，glTF 使用右手坐标系，其中*y*轴向上。为了与 3D Tiles 的*z* -up 坐标系保持一致，glTF 应在运行时进行转换。有关详细信息，请参阅[glTF 转换。](https://portal.ogc.org/files/102132#core-gltf-transforms)

当在实例化 3D 模型的 Feature 表中定义[RTC_CENTER](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-rtc_center)[时，瓦片变换](https://portal.ogc.org/files/102132#core-tile-transforms)的计算如下：

1. [glTF 节点层次结构转换](https://portal.ogc.org/files/102132#core-gltf-node-hierarchy)
2. [glTF](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[y](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 到](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[z](https://portal.ogc.org/files/102132#core-y-up-to-z-up)_[-up 变换](https://portal.ogc.org/files/102132#core-y-up-to-z-up)
3. 每个实例的位置和比例，如实例化 3D 模型的 Feature 表中所定义。
4. RTC_CENTER 的变换，用于平移模型顶点
5. [Tile 变换](https://portal.ogc.org/files/102132#core-tile-transforms)

### 7.6.7.  文件扩展名和媒体类型

实例化 3D 模型图块使用.i3dm 扩展名和 application/octet-stream 媒体类型。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其标头中的魔术字段来识别内容的格式。

## 7.7.  点云

警告

点云在 3D Tiles 1.1 中被弃用。请参阅[pnts 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-point-cloud-pnts)。

### 7.7.1.  概述

点*云*图块格式支持高效流式传输大量点云以实现 3D 可视化。每个点都由一个位置和用于定义其外观的可选属性(例如颜色和法线)以及用于定义特定于应用程序的元数据的可选属性定义。

使用 3D Tiles 术语，每个点都是一个*Feature*。

点云图块是小端字节序的二进制 blob。

### 7.7.2.  布局

磁贴由标题部分组成，紧随其后的是正文部分。下图显示了点云布局(破折号表示可选字段)：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/6b03888b-bf08-46bc-90a5-3bace3a01cc8)

图 41 — 点云的数据布局

#### 7.7.2.1.填充

块的 byteLength 应与 8 字节边界对齐。包含的[Feature Table](https://portal.ogc.org/files/102132#tileformats-featuretable-padding)和[Batch Table](https://portal.ogc.org/files/102132#tileformats-batchtable-padding)应符合其各自的填充要求。

### 7.7.3.  标头

28 字节的标头包含以下字段：

表 16 — 点云的标题字段

| 字段名称                     | 数据类型           | 描述                                                                                       |
| :--------------------------- | :----------------- | :----------------------------------------------------------------------------------------- |
| 魔法                         | 4 字节 ANSI 字符串 | "点"。这可用于将内容标识为点云图块。                                                       |
| 版本                         | uint32             | 点云格式的版本。目前是 1。                                                                 |
| 字节长度                     | uint32             | 整个图块的长度，包括标头，以字节为单位。                                                   |
| featureTableJSONByteLength   | uint32             | Feature 表 JSON 部分的长度(以字节为单位)。                                                 |
| featureTableBinaryByteLength | uint32             | Feature 表二进制部分的长度(以字节为单位)。                                                 |
| batchTableJSONByteLength     | uint32             | 批处理表 JSON 部分的长度(以字节为单位)。零表示没有批处理表。                               |
| batchTableBinaryByteLength   | uint32             | 批处理表二进制部分的长度(以字节为单位)。如果 batchTableJSONByteLength 为零，则这也将为零。 |

主体部分紧跟在标题部分之后，由 Feature Table 和 Batch Table 组成。

### 7.7.4. Feature 表

包含定义渲染点的位置和方式的每图块和每点值。[功能表规范](https://portal.ogc.org/files/102132#tileformats-featuretable-feature-table)中提供了更多信息。

[完整的 JSON 模式可以在 pnts.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-pnts-featuretable)中找到  。

#### 7.7.4.1.语义学

##### 7.7.4.1.1.点语义

这些语义映射到定义每个点的 Feature 值数组。这些数组的长度对于所有语义都应该相同，并且等于点的数量。每个点语义的值应是对 Feature 表二进制体的引用；它们不能嵌入到要素表 JSON 标头中。

如果一个语义依赖于另一个语义，则应定义该语义。如果为一个点同时定义了 POSITION 和 POSITION_QUANTIZED ，则将使用精度更高的 POSITION 。如果为一个点定义了 NORMAL 和 NORMAL_OCT16P ，则将使用精度更高的 NORMAL 。

表 17——点云实例的语义

| 语义的             | 数据类型                     | 描述                                                                                               | 必需的                                 |
| :----------------- | :--------------------------- | :------------------------------------------------------------------------------------------------- | :------------------------------------- |
| 位置               | float32\[3]                  | 包含点位置的 x、y 和 z 笛卡尔坐标的 3 分量数字数组。                                               | 是的，除非定义了 POSITION_QUANTIZED 。 |
| POSITION_QUANTIZED | uint16\[3]                   | 包含 x、y 和 z 的 3 分量数字数组，采用量化的笛卡尔坐标表示点的位置。                               | 是的，除非定义了 POSITION 。           |
| RGBA               | uint8\[4]                    | 包含点的 RGBA 颜色的 4 分量值数组。                                                                | 不。                                   |
| 红绿蓝             | uint8\[3]                    | 包含点的 RGB 颜色的 3 分量值数组。                                                                 | 不。                                   |
| RGB565             | uint16                       | 一种有损压缩颜色格式，将 RGB 颜色打包为 16 位，为红色提供 5 位，为绿色提供 6 位，为蓝色提供 5 位。 | 不。                                   |
| 普通的             | float32\[3]                  | 定义点法线的单位向量。                                                                             | 不。                                   |
| 正常\_OCT16P       | uint8\[2]                    | 一个八进制编码的单位向量，具有 16 位精度，用于定义点的法线。                                       | 不。                                   |
| 批号               | uint8、uint16(默认)或 uint32 | 可用于从批处理表中检索元数据的点的 batchId 。                                                      | 不。                                   |

##### 7.7.4.1.2.全局语义

这些语义定义了所有点的全局属性。

表 18——点云的全局语义

| 语义的                  | 数据类型    | 描述                                                      | 必需的                               |
| :---------------------- | :---------- | :-------------------------------------------------------- | :----------------------------------- |
| POINTS_LENGTH           | uint32      | 要渲染的点数。点语义的每个数组值的长度应该等于这个。      | 是的。                               |
| RTC\_中心               | float32\[3] | 当点位置相对于中心定义时，定义中心位置的 3 分量数字数组。 | 不。                                 |
| QUANTIZED_VOLUME_OFFSET | float32\[3] | 定义量化体积偏移量的 3 分量数字数组。                     | 不，除非定义了 POSITION_QUANTIZED 。 |
| QUANTIZED_VOLUME_SCALE  | float32\[3] | 定义量化体积尺度的 3 分量数字数组。                       | 不，除非定义了 POSITION_QUANTIZED 。 |
| 常数\_RGBA              | uint8\[4]   | 一个 4 分量值数组，为图块中的所有点定义常量 RGBA 颜色。   | 不。                                 |
| BATCH_LENGTH            | uint32      | 唯一 BATCH_ID 值的数量。                                  | 否，除非定义了 BATCH_ID 。           |

[使用这些语义的例子可以在下面的例子部分](https://portal.ogc.org/files/102132#tileformats-pointcloud-examples)找到。

#### 7.7.4.2.点位

POSITION 定义在应用任何 tileset 变换之前点的位置。

##### 7.7.4.2.1.坐标参考系统 (CRS)

3D Tiles 局部坐标系使用右手 3 轴(x，y，z)笛卡尔坐标系；也就是说，*x*和*y*的叉积产生*z*。3D Tiles 将*z*轴定义为局部笛卡尔坐标系(另请参阅[坐标参考系](https://portal.ogc.org/files/102132#core-coordinate-reference-system-crs))。

##### 7.7.4.2.2.RTC\_中心

可以相对于中心定义位置以进行高精度渲染，请参阅[Precisions, Precisions](http://help.agi.com/AGIComponents/html/BlogPrecisionsPrecisions.htm)。如果已定义，RTC_CENTER 指定中心位置，所有点位置都被视为相对于此值。

##### 7.7.4.2.3.量化职位

如果未定义 POSITION ，位置可能存储在 POSITION_QUANTIZED 中，它定义了相对于量化体积的点位置。如果既未定义 POSITION 也未定义 POSITION_QUANTIZED，则不需要渲染图块。

量化体积由偏移和比例定义，以将量化位置映射到局部空间中的位置。下图显示了基于 offset 和 scale 的量化体积：

![量化体积](https://github.com/CHENJIAMIAN/Blog/assets/20126997/8911ae70-6658-41e6-92c5-1bdf25433d15)

图 42 — 用于 POSITION_QUANTIZED 语义的量化说明

offset 存储在全局语义 QUANTIZED_VOLUME_OFFSET 中，scale 存储在全局语义 QUANTIZED_VOLUME_SCALE 中。如果未定义这些全局语义，则无法使用 POSITION_QUANTIZED 。

可以使用以下公式将量化位置映射到局部空间：

POSITION = POSITION_QUANTIZED \* QUANTIZED_VOLUME_SCALE / 65535.0 + QUANTIZED_VOLUME_OFFSET

应在应用任何其他转换之前解压缩压缩的属性。

#### 7.7.4.3.点色

如果定义了不止一种颜色语义，则优先顺序为 RGBA、RGB、RGB565，然后是 CONSTANT_RGBA。例如，如果图块的 Feature 表同时包含 RGBA 和 CONSTANT_RGBA 属性，则运行时将使用 RGBA 以每点颜色进行渲染。

如果未定义颜色语义，则运行时可以使用特定于应用程序的默认颜色自由为点着色。

在任何情况下，[3D Tiles Styling](https://portal.ogc.org/files/102132#styling-styling)都可用于在运行时更改最终呈现的颜色和其他视觉属性。

#### 7.7.4.4.点法线

每点法线是一个可选属性，可以通过启用照明、隐藏表面移除和其他渲染技术来帮助提高点的视觉质量。法线将使用 tileset 变换的逆变换进行变换。

##### 7.7.4.4.1.Oct 编码法向量

Oct 编码在\*[A Survey of Efficient Representations of Independent Unit Vectors](http://jcgt.org/published/0003/02/01/)\*中有所描述。Oct 编码值存储在无符号、非标准化范围 ( \[0, 255] ) 中，然后在运行时映射到带符号的标准化范围 ( \[-1.0, 1.0] )。

注意可以在 CesiumJS 的[AttributeCompression](https://github.com/CesiumGS/cesium/blob/main/Source/Core/AttributeCompression.js)模块   中找到对这些单位向量进行编码和解码的实现  。

应在应用任何其他转换之前解压缩压缩的属性。

#### 7.7.4.5.批点

可以使用 BATCH_ID 语义将构成点云不同 Feature 的点一起批处理。例如，构成房屋门的点都将分配相同的 BATCH_ID，而构成窗户的点将分配不同的 BATCH_ID。这对于为声明式样式和特定于应用程序的用例(例如填充 UI 或基于每个对象而不是每个点发出 REST API 请求)的每个对象选择和存储特定于应用程序的元数据很有用。

BATCH_ID 语义可能具有 componentType UNSIGNED_BYTE 、UNSIGNED_SHORT 或 UNSIGNED_INT 。当 componentType 不存在时，使用 UNSIGNED_SHORT 。全局语义 BATCH_LENGTH 定义唯一 batchId 值的数量，类似于[Batched 3D 模型](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)标头中的 batchLength 字段。

#### 7.7.4.6.例子

_本节内容丰富_

这些示例展示了如何为 Feature 表生成 JSON 和二进制缓冲区。

##### 7.7.4.6.1.仅限职位

这个最小的例子在单位长度正方形的角上有四个点：

```js
var featureTableJSON = {     POINTS_LENGTH : 4 ,     POSITION : {         byteOffset : 0 } }; var featureTableBinary = new Buffer ( new Float32Array ([ 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 1.0 , 0.0 , 1.0 ])。缓冲区);



   



   
   
   
   

```

##### 7.7.4.6.2.位置和颜色

以下示例在地球上方有四个点(红色、绿色、蓝色和黄色)。它们的位置是相对于中心定义的：

    var featureTableJSON = {     POINTS_LENGTH : 4 ,     RTC_CENTER : [ 1215013.8 , - 4736316.7 , 4081608.4 ],     POSITION : {         byteOffset : 0 },     RGB : {         byteOffset : 48 } }; var positionBinary = new Buffer ( new Float32Array ([ 0.0 , 0.0 , 0.0 ,




       


       



       
        1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 1.0 , 0.0 , 1.0 ])。缓冲区)；var colorBinary = new Buffer ( new Uint8Array ([ 255 , 0 , 0 , 0 , 255 , 0 , 0 , 0 , 255 , 255 , 255 , 0 , ]).缓冲区
       
       



       
       
       
       
    );

    var featureTableBinary =缓冲区。concat ([ positionBinary , colorBinary ]);

##### 7.7.4.6.3.量化位置和八进制编码法线

在此示例中，四个点的法线在八进制编码格式中指向\[0.0, 1.0, 0.0]，并且它们将放置在 x 和 z 中从-250.0 到 250.0 单位的量化体积的角上方向：

```js
var featureTableJSON = {     POINTS_LENGTH ：4 ，    QUANTIZED_VOLUME_OFFSET ：[ - 250.0，0.0 ，- 250.0     ] ，    QUANTIZED_VOLUME_SCALE ：[ 500.0，0.0，500.0 ] ，POSITION_QUANTIZED ：{     byteOffset ：0 } ，否RMAL_OCT16P : {         byteOffset : 24         } } ; var positionQuantizedBinary =





   


   


 新缓冲区(新Uint16Array ([ 0 , 0 , 0 , 65535 , 0 , 0 , 0 , 0 , 65535 , 65535 , 0 , 65535 ])。缓冲区); var normalOct16PBinary = new Buffer ( new Uint8Array ([ 128 , 255 , 128 , 255 , 128 , 255 , 128
   
   
   
   



   
   
   
    , 255 ]). 缓冲区)；var featureTableBinary =缓冲区。concat ([ positionQuantizedBinary , normalOct16PBinary ]);



```

##### 7.7.4.6.4.批点

在此示例中，前两个点的 batchId 为 0，接下来的两个点的 batchId 为 1。请注意，批处理表只有两个名称：

```js
var featureTableJSON = {     POINTS_LENGTH : 4 ,     BATCH_LENGTH : 2 ,     POSITION : {         byteOffset : 0 },     BATCH_ID : {         byteOffset : 48 ,         componentType : "UNSIGNED_BYTE" } }; var positionBinary = new Buffer ( new Float32Array ([ 0.0 , 0.0 , 0.0 , 1.0




   



   



   
    , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 1.0 , 0.0 , 1.0 ])。缓冲区)；var batchIdBinary = new Buffer ( new Uint8Array ([ 0 , 0 , 1 , 1 ]). buffer ); var featureTableBinary =缓冲区。concat ([ positionBinary , batchIdBinary ]); 变量batchTableJSON
   
   



   
   
   
   




= {    名称: [ 'object1' , 'object2' ] };


```

##### 7.7.4.6.5.每点属性

在此示例中，4 个点中的每一个都将元数据存储在批处理表 JSON 和二进制文件中。

```js
var featureTableJSON = {     POINTS_LENGTH : 4 ,     POSITION : {         byteOffset : 0 } }; var featureTableBinary = new Buffer ( new Float32Array ([ 0.0 , 0.0 , 0.0 , 1.0 , 0.0 , 0.0 , 0.0 , 0.0 , 1.0 , 1.0 , 0.0 , 1.0 ])。缓冲区);



   



   
   
   
   


var batchTableJSON = {    名称：[ 'point1' , 'point2' , 'point3' , 'point4' ] };


```

### 7.7.5.  批处理表

批处理*表*包含特定于应用程序的元数据，可由 batchId 索引，可用于声明式样式和特定于应用程序的用例，例如填充 UI 或发出 REST API 请求。

- 如果定义了 BATCH_ID 语义，则批处理表存储每个 batchId 的元数据，并且批处理表数组的长度将等于 BATCH_LENGTH。
- 如果未定义 BATCH_ID 语义，则批处理表存储每个点的元数据，并且批处理表数组的长度将等于 POINTS_LENGTH。

有关详细信息，请参阅[批处理表参考。](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table)

### 7.7.6.  扩展

以下扩展可应用于点云图块。

- [3DTILES_draco_point_compression](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_draco_point_compression/README.md)

### 7.7.7.  文件扩展名和媒体类型

点云图块使用.pnts 扩展名和 application/octet-stream 媒体类型。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其标头中的魔术字段来识别内容的格式。

### 7.7.8.  实施例

_本节内容丰富_

读取标头的代码可以在 3D Tiles 的 CesiumJS 实现中的[PointCloud3DModelTileContent.js](https://github.com/CesiumGS/cesium/blob/main/Source/Scene/PointCloud3DTileContent.js)中找到。

## 7.8.  合成的

警告

Composite 在 3D Tiles 1.1 中被弃用。请参阅[cmpt 迁移指南](https://portal.ogc.org/files/102132#tileformats-gltf-composite-cmpt)。

### 7.8.1.  概述

Composite tile 格式可以将不同格式的 tile 连接成一个 tile *。*

3D Tiles 和 Composite tile 允许灵活地流式传输异构数据集。例如，建筑物和树木可以存储在两个单独的*批处理 3D 模型*和*实例化 3D 模型*图块中，或者使用*复合*图块将这些图块组合起来。

支持具有瓦片间(同一瓦片集中不同格式的单独瓦片)和瓦片内(同一复合瓦片中的不同瓦片格式)选项的异构数据集允许转换工具在请求数量之间进行权衡，特定类型的最佳细分，以及可见/隐藏层的流式传输方式。

复合图块是小端字节序的二进制 blob。

### 7.8.2.  布局

复合布局(破折号表示可选字段)：

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/da41beb2-04d1-491d-a52f-50880a60b7bc)

图 43 — 复合图块的数据布局

#### 7.8.2.1.填充

块的 byteLength 应与 8 字节边界对齐。复合块中包含的所有块也应与 8 字节边界对齐。

### 7.8.3.  标头

16 字节的标头部分包含以下字段：

表 19——复合块的标题字段

| 字段名称  | 数据类型           | 描述                                                         |
| :-------- | :----------------- | :----------------------------------------------------------- |
| 魔法      | 4 字节 ANSI 字符串 | "cmpt"。这可用于将内容标识为复合图块。                       |
| 版本      | uint32             | 复合格式的版本。目前是 1。                                   |
| 字节长度  | uint32             | 整个复合图块的长度，包括此标头和每个内部图块，以字节为单位。 |
| Tile 长度 | uint32             | Composite 中的图块数。                                       |

### 7.8.4.  内瓦

内部磁贴字段紧跟在标题部分之后紧密存储。以下信息描述了复合瓦片阅读器可能用来查找内部瓦片边界的所有瓦片格式的一般 Feature：

- 每个图块都以一个 4 字节的 ANSI 字符串 magic 开头，可用于确定图块格式以供进一步解析。有关可能格式的列表，请参阅[图块格式规范。](https://portal.ogc.org/files/102132#tileformats-tile-formats)复合图块可以包含复合图块。
- 每个图块的标头都包含一个 uint32 byteLength，它以字节为单位定义内部图块的长度，包括其标头。这可用于遍历内部 Tile。
- 对于任何图块格式的版本 1，所有图块的前 12 个字节是以下字段：

表 20——tile 格式的通用标题字段

| 字段名称 | 数据类型           | 描述                           |
| :------- | :----------------- | :----------------------------- |
| 魔法     | 4 字节 ANSI 字符串 | 指示磁贴格式                   |
| 版本     | uint32             | 1 个                           |
| 字节长度 | uint32             | 整个图块的长度(以字节为单位)。 |

有关详细信息，请参阅每种图块格式的规范。

### 7.8.5.  文件扩展名和媒体类型

复合图块使用.cmpt 扩展名和 application/octet-stream 媒体类型。

显式文件扩展名是可选的。有效的实现可能会忽略它并通过其标头中的魔术字段来识别内容的格式。

### 7.8.6.  实施实例

_本节内容丰富_

- [gltf2glb 工具集中的 Python packcmpt](https://github.com/Geopipe/gltf2glb)工具包含用于将一个或多个*批处理 3D 模型*或*实例化 3D 模型*图块组合到单个复合图块文件中的代码。
- 读取标题的代码可以在 3D Tiles 的 CesiumJS 实现中的[Composite3DTileContent.js](https://github.com/CesiumGS/cesium/blob/main/Source/Scene/Composite3DTileContent.js)中找到 。

# 8、隐式 Tile

## 8.1.  概述

隐式 Tile 定义了 3D Tile 中四叉树和八叉树的简明表示。这种常规模式允许根据瓦片坐标随机访问瓦片，从而实现加速空间查询、新遍历算法和瓦片内容的高效更新，以及其他用例。

隐式切片还可以通过隐式定义的切片方案与现有 GIS 数据格式实现更好的互操作性。一些示例是[TMS](https://wiki.osgeo.org/wiki/Tile_Map_Service_Specification)、[WMTS](https://www.ogc.org/standards/wmts)、[S2](http://s2geometry.io/)和[CDB](https://docs.opengeospatial.org/is/15-113r5/15-113r5.html)。

为了支持稀疏数据集，**可用性**数据决定了存在哪些切片。为了支持海量数据集，可用性被划分为固定大小的**子树**。子树可以存储可用图块和内容的**元数据。**

可以将 implicitTiling 对象添加到 tileset JSON 中的任何 tile。该对象定义了磁贴的细分方式以及内容资源的定位方式。它可以添加到多个图块以创建更复杂的细分方案。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/f45eb369-b67b-44a4-b776-c37eab38a627)

图 44 — 组织成稀疏八叉树的点云。数据来源：天宝

## 8.2.  隐根瓦片

可以将 implicitTiling 对象添加到 tileset JSON 中的任何 tile。这样的瓦片称为**隐式根瓦片**，以区别于瓦片集 JSON 的根瓦片。

```js
{ "root" ：{ "boundingVolume" ：{ "region" ：[- 1.318 , 0.697 , - 1.319 , 0.698 , 0 , 20 ] }, "refine" : "REPLACE" , "geometricError" : 5000 , "content" : { "uri" ："content/{level}/{x}/{y}.glb" }，"implicitTiling" ：{ "subdivisionScheme" ："QUADTREE"，"可用级别" ：
 
   
     
   
   
   
   
     
   
   
     
       21 ，"subtreeLevels" ：7 ，"subtrees" ：{ "uri" ："subtrees/{level}/{x}/{y}.json" } } } }
     
     
       
     
   
 

```

implicitTiling 对象具有以下属性：

表 21——隐式 Tile 对象的属性

| 财产     | 描述                                                                                                  |
| :------- | :---------------------------------------------------------------------------------------------------- |
| 细分方案 | 四叉树或八叉树。见[细分方案](https://portal.ogc.org/files/102132#implicittiling-subdivision-scheme)。 |
| 可用级别 | 树中有多少层可用的图块。                                                                              |
| 子树级别 | 每个子树中有多少层。                                                                                  |
| 子树     | 子树文件的模板 URI。请参阅[子树](https://portal.ogc.org/files/102132#implicittiling-subtrees)。       |

[模板 URI](https://portal.ogc.org/files/102132#implicittiling-template-uris)用于定位子树文件和磁贴内容。对于内容，模板 URI 在 tile 的 content.uri 属性中指定。

以下约束适用于隐式根切片：

- Tile 应省略儿童财产
- 磁贴应省略元数据属性
- content.uri 不应指向外部[tileset](https://portal.ogc.org/files/102132#core-external-tilesets)
- 内容应省略 boundingVolume 属性

## 8.3.  细分方案

**细分方案**是一种递归模式，用于将图块的边界体积划分为占用相同空间的更小的子图块。

**四叉树**仅在 x 和 y 维度上划分空间。它将每个图块分成 4 个较小的图块，其中 x 和 y 维度减半。四叉树 z 的最小值和最大值保持不变。生成的树每个图块有 4 个孩子。

![image](https://github.com/CHENJIAMIAN/Blog/assets/20126997/ca52e774-8f1c-40fb-a508-08a6fa6b5f53)

图 46——八叉树中的细分

对于区域边界体积，x、y 和 z 分别指代 longitude、latitude 和 height。

球体边界体积是不允许的，因为它们不能分为四叉树或八叉树。

有关 S2 边界体积的细分，请参阅[3DTILES_bounding_volume_S2](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md#implicit-subdivision)。

下图说明了 3D Tiles 支持的包围体类型的细分：

表 22——边界框的细分

| 根箱                                                                                                  | 四叉树                                                                                                | 八叉树                                                                                                |
| ----------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/d0e8fb3a-1189-4b48-baff-2789b30791d4) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/a2de7c2b-9a2b-493f-990e-d36684209db8) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/9a9d382e-ac4c-4efd-ab0f-0d868221c861) |

表 23——边界区域的细分

| 根区域                                                                                                | 四叉树                                                                                                | 八叉树                                                                                                |
| ----------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- |
| ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/3806e064-6405-4545-bbd8-65667982dbe5) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/a88dcaca-edb3-430f-bcd1-e79661fa01c0) | ![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/0319452f-be2d-4c69-a7bc-16bca1a5da09) |

### 8.3.1.  细分规则

隐式分块只需要在隐式根分块处定义细分方案、细化策略、边界体积和几何误差。对于后代图块，这些属性是根据以下规则自动计算的：

表 24——隐式分块的细分规则

| 财产                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 细分规则                                   |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------ |
| `细分方案`                                                                                                                                                                                                                                                                                                                                                                                                                                           | 所有后代瓦片的常量                         |
| `提炼`                                                                                                                                                                                                                                                                                                                                                                                                                                               | 所有后代瓦片的常量                         |
| `边界体积`                                                                                                                                                                                                                                                                                                                                                                                                                                           | `根据细分方案`分为四或八部分``             |
| `几何误差`                                                                                                                                                                                                                                                                                                                                                                                                                                           | 每个孩子的`几何误差`是其父`几何误差的一半` |
| 注意   为了在此细分过程中保持数值稳定性，不应通过细分非根瓦片体积来逐步计算实际包围体积。相反，应该直接为给定级别计算精确的边界体积。设根边界体积沿一维*d 的*范围为 _(min d , max d )_ 。对于给定级别，沿该维度的边界体积数为*2 级别*。这个级别的每个边界体积的大小，沿着维度*d*，是*大小 d = (max d  - min d ) / 2 level*。孩子的边界体积的范围可以直接计算为 _(min d + size d_ i, min d + size d *(i + 1))* ，其中*i* *是子元素在维度 d*中的索引。 |                                            |

如果需要，可以使用[tile metadata](https://portal.ogc.org/files/102132#implicittiling-tile-metadata)覆盖计算出的 tile `boundingVolume`和`geometricError`。内容边界体积不是自动计算的，但它们可能由[内容元数据](https://portal.ogc.org/files/102132#implicittiling-content-metadata)提供。Tile 和内容包围体应保持[空间连贯性](https://portal.ogc.org/files/102132#core-bounding-volume-spatial-coherence)。[](https://portal.ogc.org/files/102132#implicittiling-tile-metadata)[](https://portal.ogc.org/files/102132#implicittiling-content-metadata)[](https://portal.ogc.org/files/102132#core-bounding-volume-spatial-coherence)

## [](https://portal.ogc.org/files/102132#toc35)8.4. Tile 坐标

**瓦片坐标**是唯一标识瓦片的整数元组。四叉树的 Tile 坐标是`(level, x, y)`或八叉树的`(level, x, y, z)`。所有图块坐标都是从 0 开始索引的。

``对于隐式根瓦片，`级别为 0。`这个 tile 的子级是 1 级，依此类推。

`x`、`y`和`z`坐标定义图块在关卡中的位置。

对于`框`边界体积：

表 25——边界区域的瓦片坐标

| 协调 | 正方向           |
| ---- | ---------------- |
| `X`  | 沿边界框的`+x轴` |
| `是` | 沿边界框的`+y轴` |
| `z`  | 沿边界框的`+z轴` |

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/c83b7b92-b6d3-4909-8400-432f578591b8)

图 47 — 带有边界框的八叉树节点及其子节点的坐标

对于`区域`边界体积：

表 26——边界区域的瓦片坐标

| 协调 | 正方向             |
| ---- | ------------------ |
| `X`  | 从西向东(增加经度) |
| `是` | 从南到北(纬度增加) |
| `z`  | 从下到上(增加高度) |

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/2b0ac175-85d5-4f15-abfe-2d18e1f9817b)

图 48 — 具有边界区域的八叉树节点及其子节点的坐标

## 8.5.  模板 URI

**模板 URI**是一种 URI 模式，用于通过图块坐标引用图块。

模板 URI 应包括变量`{level}`、`{x}`、`{y}`。八叉树的模板 URI 还应包括`{z}`。当引用特定的图块时，图块的坐标将替换这些变量。

当作为相对路径给出时，模板 URI 是相对于 tileset JSON 文件解析的。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/42060f92-4577-4bf3-8e73-6dc94bfc7a9f)

图 49——用于标识隐式图块内容的模板 URI 示例

## [](https://portal.ogc.org/files/102132#toc37)8.6.  子树

为了支持稀疏数据集，需要额外的信息来指示存在哪些图块或内容。这称为**可用性**。

**子树**是 tileset 树的固定大小部分，用于存储可用性。tileset 被划分为子树以限制每个可用性缓冲区的大小，以实现最佳网络传输和缓存。subtreeLevels 属性定义每个子树中`的`级别数。细分方案决定了每个瓦片的孩子数量。

![子树解剖](https://github.com/CHENJIAMIAN/Blog/assets/20126997/8d262691-8a23-4761-986e-5017e1b0e6f9)

图 50——隐式 Tile 的子树结构

将 tileset 划分为子树后，结果是一棵子树。

![子树的树](https://github.com/CHENJIAMIAN/Blog/assets/20126997/dc5b378a-e7a7-42c8-9d6c-d2f65967e384)

图 51 — 表示隐式图块集的子树树

### [](https://portal.ogc.org/files/102132#8-6-1-%C2%A0-availability)8.6.1.  可用性

每个子树都包含磁贴可用性、内容可用性和子树可用性。

- **瓦片可用性**指示子树中存在哪些瓦片
- **内容可用性**指示哪些磁贴具有关联的内容资源
- **子树可用性**表示可以从此子树访问哪些子树

每种类型的可用性都表示为单独的比特流。每个比特流都是一维数组，其中每个元素代表四叉树或八叉树中的一个节点。1 位表示该元素可用，而 0 位表示该元素不可用。或者，如果比特流中的所有比特都相同，则可以改为使用单个常量值。

为了形成 1D 比特流，图块按以下规则排序：

- [在子树的每个级别中，使用 Morton Z 顺序曲线对](https://en.wikipedia.org/wiki/Z-order_curve)图块进行排序[](https://en.wikipedia.org/wiki/Z-order_curve)
- 每个级别的比特被连接成一个比特流

![可用性订购](https://github.com/CHENJIAMIAN/Blog/assets/20126997/bca7c395-4ca8-48d3-b5de-cce2300f8dd0)

图 52——基于隐式块的坐标计算用于访问可用性比特流的索引

在上图中，彩色单元格代表 1 位，灰色单元格代表 0 位。

按 Morton 顺序存储磁贴具有以下好处：

- 高效索引 - 块的 Morton 索引是通过交织位在恒定时间内计算的。
- 高效遍历——父块或子块的莫顿索引分别通过删除或添加位在恒定时间内计算。
- Locality of reference——连续的图块在 3D 空间中彼此靠近。
- 更好的压缩——参考的局部性导致可用性比特流的更好压缩。

有关使用 Morton 索引和可用性比特流的更多详细信息，请参阅[可用性索引](https://portal.ogc.org/files/102132#implicittiling-availability-indexing)。

#### [](https://portal.ogc.org/files/102132#8-6-1-1-%C2%A0-tile-availability)8.6.1.1.Tile 可用性

瓦片可用性决定子树中存在哪些瓦片。

磁贴可用性具有以下限制：

- 如果非根瓦片的可用性为 1，则其父瓦片的可用性也应为 1。
- 一棵子树应至少有一个可用的图块。

![Tile可用性](https://github.com/CHENJIAMIAN/Blog/assets/20126997/5197ee3b-636f-4be4-8e60-bee622668197)

图 53 — 图块可用性比特流的图示。可用的区块在比特流中用`1`表示。

#### [](https://portal.ogc.org/files/102132#8-6-1-2-%C2%A0-content-availability)8.6.1.2.内容可用性

内容可用性决定了哪些磁贴具有内容资源。`使用content.uri`模板 URI 定位内容资源。如果没有带有内容资源的图块，则应省略`tile.content 。`

内容可用性有以下限制：

- 如果内容可用性为 1，则其对应的图块可用性也应为 1。否则，可以指定图块集中的图块无法访问的内容文件。
- 如果内容可用性为 0 且其对应的磁贴可用性为 1，则该磁贴被视为空磁贴。

![内容可用性](https://github.com/CHENJIAMIAN/Blog/assets/20126997/fdd198f5-6c11-46ce-9635-fe4f34035ad7)

图 54 — 内容可用性比特流的图示。具有关联内容的图块在比特流中用`1表示。`

#### [](https://portal.ogc.org/files/102132#8-6-1-3-%C2%A0-child-subtree-availability)8.6.1.3.子树可用性

子树可用性决定了哪些子树可以从该子树的最深层到达。这将子树链接在一起形成一棵树。

与为子树中的每个级别存储位的图块和内容可用性不同，子树可用性为比子树最深级别更深一级的节点存储位，并表示子子树的根节点。这用于确定在请求图块之前可以访问哪些其他子树。如果所有子树的可用性为 0，则 tileset 不会进一步细分。

![子树可用性](https://github.com/CHENJIAMIAN/Blog/assets/20126997/f4e14397-cf8c-4f16-a43b-db225b978b1e)

图 55 — 子树可用性比特流的图示。作为可用子树根的图块在比特流中由`1表示。`

### [](https://portal.ogc.org/files/102132#8-6-2-%C2%A0-metadata)8.6.2.  元数据

子树可以以多种粒度存储元数据。

- **Tile metadata**  — 子树中可用图块的元数据
- **内容元数据** ——子树中可用内容的元数据
- **子树元数据** ——关于整个子树的元数据

#### [](https://portal.ogc.org/files/102132#8-6-2-1-%C2%A0-tile-metadata)8.6.2.1.磁贴元数据

当图块在图块集中显式列出时，每个图块的元数据也会显式嵌入图块定义中。当 tile 层次结构是*implicit*时，由隐式切片启用，切片不会详尽列出，元数据不能直接嵌入切片定义中。为了支持隐式切片方案中切片的元数据，子树中所有可用切片的属性值都在[属性表](https://portal.ogc.org/files/102132#metadata-referenceimplementation-propertytable-property-table-implementation)中进行编码。二进制表示对于具有许多图块的较大数据集特别有效。

Tile 元数据仅存在于可用的 tiles 中，并根据[Availability Ordering](https://portal.ogc.org/files/102132#implicittiling-availability)由递增的 tile 索引紧密打包。[_每个可用的图块都应有一个值——只有使用二进制表格式_](https://portal.ogc.org/files/102132#metadata-binary-table-format)规范定义的`noData`指示符才能在图块中表示缺失值。[\*\*](https://portal.ogc.org/files/102132#metadata-binary-table-format)

注 1  要确定特定图块的属性值数组的索引，请根据图块可用性排序计算在该索引之前出现的可用图块的数量。如果`i 个`可用图块出现在特定图块之前，则该图块的属性值存储在每个属性值数组的索引`i处。`这些索引可以针对所有可用区块预先计算，作为子树可用性缓冲区的单次传递。

Tile 属性可以具有定义属性值应如何解释的[语义。](https://portal.ogc.org/files/102132#metadata-semantics-3d-metadata-semantic-reference)特别是，`TILE_BOUNDING_BOX`、`TILE_BOUNDING_REGION`、`TILE_BOUNDING_SPHERE`、`TILE_MINIMUM_HEIGHT`和`TILE_MAXIMUM_HEIGHT`语义各自为图块定义了比从隐式 Tile 隐式计算的更具体的边界体积。如果这些语义中的一种以上可用于磁贴，则客户可以根据用例和性能要求选择最合适的选项。

注 2  下图显示了图块高度语义如何用于为隐式图块集定义更紧密的边界区域：整个图块集边界区域的总高度为 320。子图块的边界区域将通过拆分各自父图块在其中心的边界区域。默认情况下，高度将保持不变。通过存储相应区域中内容的*实际高度，并将其作为每个可用图块的*`TILE_MAXIMUM_HEIGHT`提供，可以为每个级别定义最紧密的边界区域。

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/3b731b55-66f6-4eed-8f34-c4f2247926cc)

`图 56 — 使用TILE_MAXIMUM_HEIGHT`语义存储单个图块实际高度的图示

TILE_GEOMETRIC_ERROR 语义允许图块提供覆盖隐式计算的几何误差的几何误差`。`

#### 8.6.2.2.内容元数据

子树还可以存储图块内容的元数据。内容元数据仅针对可用内容而存在，并通过增加的图块索引进行紧密打包。\*[二进制属性值以 3D 元数据规范定义的紧凑二进制表格式](https://portal.ogc.org/files/102132#metadata-binary-table-format)\*进行编码，并存储在[属性表](https://portal.ogc.org/files/102132#metadata-referenceimplementation-propertytable-property-table-implementation)中。如果隐式根瓦片有多个内容，则内容元数据存储在多个属性表中。

内容边界体积不会通过隐式 Tile 自动计算，但可以由具有语义 CONTENT_BOUNDING_BOX、CONTENT_BOUNDING_REGION、CONTENT_BOUNDING_SPHERE、CONTENT_MINIMUM_HEIGHT 和 CONTENT_MAXIMUM_HEIGHT 的属性提供。

如果将图块内容分配给一个[组](https://portal.ogc.org/files/102132#core-tile-content)，则隐式树中的所有内容都将分配给该组。

#### 8.6.2.3.子树元数据

分配给子树的属性提供关于整个子树的元数据。子树元数据根据[JSON 格式](https://portal.ogc.org/files/102132#metadata-json-format)规范以 JSON 编码。

## 8.7.  子树 JSON 格式

_[在 subtree.schema.json](https://portal.ogc.org/files/102132#reference-schema-subtree)中定义。_

子**树文件**是一个 JSON 文件，其中包含单个子树的可用性和元数据信息。子树可以引用包含二进制数据的外部文件。另一种[二进制格式](https://portal.ogc.org/files/102132#implicittiling-subtree-binary-format)允许将 JSON 和二进制数据嵌入到单个二进制文件中。

### 8.7.1.  缓冲区和缓冲区视图

属性[表基于作为](https://portal.ogc.org/files/102132#metadata-referenceimplementation-propertytable-property-table-implementation)*缓冲区*一部分*的缓冲区视图*以二进制形式定义元数据的存储。

缓冲区是一个二进制 blob \*\*。\*\*每个缓冲区都有一个指向包含缓冲区数据的外部文件的 uri 和一个以字节为单位描述缓冲区大小的 byteLength 。相对路径是相对于子树文件的。不允许使用数据 URI。

在[二进制格式](https://portal.ogc.org/files/102132#implicittiling-subtree-binary-format)中，第一个缓冲区可能会引用子树文件的二进制块，在这种情况下，uri 属性应该是未定义的。此缓冲区称为*内部缓冲区*。

**缓冲区视图**是缓冲区的连续子集。缓冲区视图的缓冲区属性是一个整数索引，用于标识缓冲区。缓冲区视图有一个 byteOffset 和一个 byteLength 来描述缓冲区内的字节范围。byteLength 不包括任何填充。可能有多个缓冲区视图引用单个缓冲区。

为了高效的内存访问，缓冲区视图的 byteOffset 应对齐到 8 字节的倍数。

### 8.7.2.  可用性

应始终为子树提供图块可用性 ( tileAvailability ) 和子树可用性 ( childSubtreeAvailability )。

内容可用性 ( contentAvailability ) 是一组内容可用性对象。如果隐式根瓦片只有一个内容，则该数组将只有一个元素；如果 tile 有多个内容，这个数组将有多个元素。如果隐式根瓦片没有 ​​ 内容，则应省略 contentAvailability 。

可用性可以表示为比特流或常量值。比特流是一个整数索引，用于标识包含可用性比特流的缓冲区视图。constant 是一个整数，指示是所有元素都可用 ( 1 ) 还是所有元素都不可用 ( 0 )。availableCount 是一个整数，指示可用性比特流中存在多少个 1 比特。

可用性比特流使用 3D 元数据规范的[布尔部分中描述的格式以二进制形式打包。](https://portal.ogc.org/files/102132#metadata-booleans)

注意   子树的 JSON 描述，其中每个图块都可用，但并非所有图块都有内容，并且并非所有子树都可用：

```js
{ "缓冲区" ：[ { "名称" ："内部缓冲区" ，"byteLength" ：16 }，{ "名称" ："外部缓冲区" ，"uri" ："external.bin" ，"byteLength" ：32 } ] , "bufferViews" : [ { "buffer" : 0 , "byteOffset" : 0 , "byteLength" : 11 }, { "buffer"：1 ，"字节偏移量" ：
 
   
     
     
   
   
     
     
     
   
 
 
   
     
     
     
   
   
     
       0 ，"byteLength" ：32 } ]，"tileAvailability" ：{ "常量" ：1 ，}，"contentAvailability" ：[{ "bitstream" ：0 ，"availableCount" ：60 }]，"childSubtreeAvailability" ：{ "bitstream" "：1 } }
     
   
 
 
   
 
 
   
   
 
 
   
 

```

瓦片可用性可以通过将[tileAvailability.constant](http://tileavailability.constant/)设置为 1 来编码，不需要显式比特流，因为子树中的所有瓦片都可用。

只有一些瓦片有内容，并且 contentAvailability.bufferView 指示存储内容可用性的比特流的位置：索引为 0 的 bufferView 指的是索引为 0 的缓冲区。此缓冲区没有 uri 属性，因此指的是*内部*缓冲区直接存储在子树二进制文件的二进制块中。byteOffset 和 byteLength 表示内容可用性比特流存储在内部缓冲区的字节\[ 0…11)中。

存在一些子树，因此 childSubtreeAvailability.bufferView 引用另一个比特流。索引为 1 的 bufferView 指的是索引为 1 的缓冲区。这个缓冲区有一个 uri 属性，表示第二个比特流存储在一个外部二进制文件中。

### 8.7.3.  元数据

子树可以以多种粒度存储元数据。tileMetadata 是包含可用图块元数据的属性表。contentMetadata 是一组属性表，其中包含可用内容的元数据。如果隐式根瓦片只有一个内容，则该数组将只有一个元素；如果 tile 有多个内容，那么这个数组将有多个元素。如果隐式根瓦片没有 ​​ 内容，则应省略 contentMetadata 。

子树元数据 ( subtreeMetadata ) 根据[JSON 格式](https://portal.ogc.org/files/102132#metadata-json-format)规范以 JSON 编码。

注意   使用图块、内容和子树元数据扩展的子树的相同 JSON 描述。子树 JSON 引用根 tileset 模式中的类 ID。Tile 和内容元数据存储在[属性表](https://portal.ogc.org/files/102132#metadata-referenceimplementation-propertytable-property-table-implementation)中；子树元数据直接用 JSON 编码。

_根 tileset JSON 中的模式_

```js
{ "schema": { "classes": { "tile": { "properties": { "horizo​​nOcclusionPoint": { "semantic": "TILE_HORIZON_OCCLUSION_POINT", "type": "VEC3", "componentType": "FLOAT64", }, "countries": { "description": "countries a tile 相交
 
   
     
       
         
           
           
           
         
         
            "，"类型"："字符串"，"数组"：真} } }，"内容"：{ "属性"：{ "attributionIds"：{ "语义"："ATTRIBUTION_IDS"，"类型"："标量"，"componentType": "UINT16", "array": true }, "minimumHeight":
           
           
         
       
     
     
       
         
           
           
           
           
         
           { "semantic"："CONTENT_MINIMUM_HEIGHT"，"type"："SCALAR"，"componentType"："FLOAT64" }，"maximumHeight"：{ "semantic"："CONTENT_MAXIMUM_HEIGHT"，"type"："SCALAR"，"componentType" : "FLOAT64" }, "triangleCount": { "类型":
           
           
           
         
         
           
           
           
         
         
             "SCALAR"，"componentType"："UINT32" } } }，"子树"：{ "属性"：{ "attributionStrings"：{ "语义"："ATTRIBUTION_STRINGS"，"类型"："STRING"，"数组"：真} } } } } }
           
         
       
     
     
       
         
           
           
           
         
       
     
   
 

```

_子树 JSON_

```js
{ "缓冲区"：[ { "名称"："可用性缓冲区"，"uri"："可用性。bin", "byteLength": 48 }, { "name": "元数据缓冲区", "uri": "元数据。bin", "byteLength": 6512 } ], "bufferViews": [ {
 
   
     
     
     
   
   
     
     
     
   
 
 
     "buffer"：0 ，"byteOffset"：0 ，"byteLength"：11 }，{ "buffer"：0 ，"byteOffset"：16 ，"byteLength"：32 }，{ "buffer"：1 ，"byteOffset"：0 , "byteLength": 2040 }, { "缓冲区": 1 , "
   
   
       byteOffset"：2040 ，"byteLength"：1530 }，{ "buffer"：1 ，"byteOffset"：3576 ，"byteLength"：344 }，{ "buffer"：1 ，"byteOffset"：3920 ，"byteLength"：1024 }, { "缓冲区": 1 , "byteOffset": 4944 , "
   
   
         byteLength"：240 }，{ "buffer"：1 ，"byteOffset"：5184 ，"byteLength"：122 }，{ "buffer"：1 ，"byteOffset"：5312 ，"byteLength"：480 }，{ "buffer" : 1 , "byteOffset": 5792 , "byteLength": 480 }, {
   
   
   
     "buffer"：1 ，"byteOffset"：6272 ，"byteLength"：240 } }]，"propertyTables"：[ { "class"："tile"，"count"：85 ，"properties"：{ "horizo​​nOcclusionPoint"：{ "values"：2 }，"国家"：{ "values"：3
 
 
   
     
     
     
       
         
       
       
           ，"arrayOffsets"：4 ，"stringOffsets"：5 ，"arrayOffsetType"："UINT32"，"stringOffsetType"："UINT32" } } }，{ "class"："content"，"count"：60 ，"properties" : { "attributionIds": { "值": 6 , "
         
         
         
         
       
     
   
   
     
     
     
       
         
          arrayOffsets"：7 ，"arrayOffsetType"："UINT16" }，"minimumHeight"：{ "values"：8 }，"maximumHeight"：{ "values"：9 }，"triangleCount"：{ "values"：10 ，"最小"：520 ，"最大"：31902 } } } ]，"
         
       
       
         
       
       
         
       
       
         
         
         
       
     
   
 
  tileAvailability"：{ "常量"：1 }，"contentAvailability"：[{ "bitstream"：0 ，"availableCount"：60 }]，"childSubtreeAvailability"：{ "bitstream"：1 }，"tileMetadata"：0 ，"contentMetadata": [ 1 ], "subtreeMetadata": { "class": "
   
 
 
   
   
 
 
   
 
 
 
 
     subtree", "properties": { "attributionStrings": [ "Source A", "Source B", "Source C", "Source D" ] } } }
   
     
       
       
       
       
     
   
 

```

### 8.7.4.  多个内容

当隐式根图块具有多个内容时，将为每个内容层提供 contentAvailability 和 contentMetadata 。

注意   具有多个内容的子树的 JSON 描述。在此示例中，所有图块都可用，所有建筑内容都可用，只有一些树内容可用。

_隐根瓦片_

```js
{ "root": { "boundingVolume": { "region": [- 1.318 , 0.697 , - 1.319 , 0.698 , 0 , 20 ] }, "refine": "ADD", "geometricError": 5000 , "contents": [ { "uri": "buildings /{ level }/{ x }/{ y
 
   
     
   
   
   
   
     
         }. glb"，}，{ "uri"："树/{级别}/{ x }/{ y }。glb", } ], "implicitTiling": { "subdivisionScheme": "QUADTREE", "availableLevels": 21 , "subtreeLevels": 7 , "subtrees": { "uri": "subtrees /{ level
     
     
       
     
   
   
     
     
     
     
         }/{ x }/{ y }。JSON" } } } }
     
   
 

```

_子树 JSON_

```js
{ "propertyTables"：[ { "class"："building"，"count"：85 ，"properties"：{ "height"：{ "values"：1 }，"owners"：{ "values"：2 ，"arrayOffsets": 3 , "stringOffsets": 4 } } }, { "类
 
   
     
     
     
       
         
       
       
         
         
         
       
     
   
   
     "："树"，"计数"：52 ，"属性"：{ "高度"：{ "值"：5 }，"物种"：{ "值"：6 } }} } ]，"tileAvailability"：{ "常量"：1 }，"contentAvailability"：[ { "常量"：1 }，{
     
     
       
         
       
       
         
       
     
   
 
 
   
 
 
   
     
   
   
      "bitstream"：0 ，"availableCount" ：52 } }]，"childSubtreeAvailability" ：{ "常量"：1 }，"contentMetadata"：[ 0，1 ] }
     
   
 
 
   
 
 

```

## 8.8.  子树二进制格式

子树二进制格式是 JSON 文件格式的替代格式，它允许将 JSON 和二进制数据嵌入到单个二进制文件中。

二进制子树格式是小端格式，由一个 24 字节的标头和一个可变长度的有效负载组成：

![子树二进制格式](https://github.com/CHENJIAMIAN/Blog/assets/20126997/70916aed-7365-4fc8-826f-11ebe3b247d8)

图 57 — 子树二进制格式的数据布局

标头字段：

表 27——子树文件的头域

| 字节  | 场地           | 类型   | 描述                                                                                         |
| :---- | :------------- | :----- | :------------------------------------------------------------------------------------------- |
| 0-3   | 魔法           | UINT32 | 将此标识为子树文件的幻数。这始终是 0×74627573 ，ASCII 字符串 subt 的四个字节以小端顺序存储。 |
| 4-7   | 版本           | UINT32 | 版本号。对于此版本的规范，始终为 1 。                                                        |
| 8-15  | JSON 字节长度  | UINT64 | 子树 JSON 的长度，包括任何填充。                                                             |
| 16-23 | 二进制字节长度 | UINT64 | 缓冲区的长度(如果缓冲区不存在则为 0)，包括任何填充。                                         |

应填充每个块，使其以 8 字节为边界结束：

- JSON 块应填充尾随空格字符 ( 0×20 )
- 如果存在，则二进制块应填充尾随零(0x00)

# 9、3D 元数据规范

## 9.1.  概述

3D 元数据规范定义了 3D 内容中结构化元数据的标准格式。元数据——表示为实体和属性——可能与部分 3D 内容密切相关，数据表示适用于大型分布式数据集。对于最详细的用例，属性允许顶点级和纹素级关联；还支持更高级别的属性关联。

许多领域都受益于结构化元数据——典型示例包括城市建筑物的历史细节、CAD 模型中组件的名称、纹理表面区域的描述以及点云的分类代码。

该规范定义了多种 3D 格式要使用的核心概念，并且与语言和格式无关。本文档定义了具有目的和术语的概念，但没有强加特定的模式或序列化格式来实现。对于抽象概念定义之外的格式的使用，请参见：

- [3D Tiles Metadata——](https://portal.ogc.org/files/102132#core-metadata)  将元数据分配给 3D Tiles 1.1 中的 tilesets、tiles 和内容
- [3DTILES_metadata](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_metadata)  — 3D Tiles 1.0 的扩展，将元数据分配给图块集、图块和内容
- [EXT_structural_metadata](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata) (glTF 2.0) — 将元数据分配给 glTF 资产中的顶点、纹素和 Feature

该规范没有列举或定义元数据的语义，并假定单独的规范将为它们的特定应用程序或域定义语义。一个例子是[3D 元数据语义参考](https://portal.ogc.org/files/102132#metadata-semantics-3d-metadata-semantic-reference)，它定义了 3D Tiles 和 glTF 的内置语义。外部定义语义的标识符可以存储在 3D 元数据规范中。

## 9.2.  概念

本规范定义了元数据模式和编码元数据的方法。

**模式**包含一组**类**和**枚举**。一个类代表一类相似的实体，并被定义为一组**属性**。每个属性描述特定类型的值。枚举定义了一组表示单个值类型的命名值，并且可以由类属性引用。模式定义不描述实体或属性是如何存储的，并且可以以各种方式以文件格式表示。模式可以在多种资产甚至文件格式中重复使用。

**实体**是类的实例化，填充有符合类定义的\*\*属性值。\*\*实体的每个属性值都应由其类别定义，并且实体不应具有无关的属性值。可能需要一个类的属性，在这种情况下，所有实例化该类的实体都需要包含它们。

注：  实体可以在不同的抽象层次上定义。在大型数据集中，单个顶点或纹素可能代表具有细粒度元数据属性的实体。顶点和纹素可以组织成具有自己关联属性的高阶组(例如网格、场景图或图块集)。

**元数据**，如本规范中所使用的，指的是 3D 内容与实体和属性的任何关联，使得实体代表整体结构中有意义的单元。元数据的其他常见定义，特别是与文件系统或网络相关的定义，而不是 3D 内容，不在本文档的范围内。

属性值以灵活的表示形式存储，以允许紧凑的传输和高效的查找。本规范定义了两种可能的[存储格式](https://portal.ogc.org/files/102132#metadata-storage-formats)。

### 9.2.1.  身份标识

在本规范中，ID(标识符)是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字符串：由大写或小写字母、数字或下划线组成的字符串，以字母或下划线开头。这些字符串应该是人类可读的驼峰式字符串(只要可能)。当受这些限制的 ID 对于人类读者来说不够清晰时，应用程序还应该为支持专用名称的结构提供名称。

## 9.3.  图式

### 9.3.1.  图式

架构定义 3D 内容中使用的元数据的组织和类型，表示为一组类和枚举。类定义由其元数据符合类定义的实体引用。这为数据集中的所有实体提供了一致且机器可读的结构。

下面列出了模式的组件，并且实现可以定义其他组件。

#### 9.3.1.1.ID

ID ( id ) 是架构的唯一[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

#### 9.3.1.2.版本

架构版本 ( version ) 是给定架构修订的特定于应用程序的标识符。Version 应该是一个字符串，并且在语法上应该与[SemVer](https://semver.org/)兼容。

当一个模式有多个版本时，(id, version)对唯一标识一个特定的模式和修订。

注意有效的   语义版本包括像 0.1.2、1.2.3 和 1.2.3-alpha 这样的字符串。

#### 9.3.1.3.名称

名称 ( name ) 为模式提供人类可读的标签，并且不需要是唯一的。名称应为有效的 Unicode 字符串，并应以自然语言书写。

#### 9.3.1.4.描述

描述 ( description ) 提供对模式、其目的或其内容的人类可读解释。通常至少是一个短语，也可能是几个句子或段落。描述应为有效的 Unicode 字符串。

#### 9.3.1.5.枚举

无序的[枚举集](https://portal.ogc.org/files/102132#metadata-enum)。

#### 9.3.1.6.Class

无序的类[集](https://portal.ogc.org/files/102132#metadata-class)。

---

### 9.3.2.  枚举

枚举由一组命名值组成，表示为(字符串，整数)对。每个枚举都由一个唯一的 ID 标识。

注意   一个"物种"枚举，包含三种可能的树种，以及一个"未知"值。

- **ID：** "物种"
- **名称：** "物种"
- **描述：** "研究中确定的常见树种。"
- **值类型：** INT32

示例枚举的名称和值

| 名称   | 价值 |
| :----- | :--- |
| "橡木" | 0    |
| "松树" | 1 个 |
| "枫"   | 2 个 |
| "未知" | -1   |

#### 9.3.2.1.ID

ID ( id ) 是架构中枚举的唯一[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

#### 9.3.2.2.名称

名称 ( name ) 为枚举提供人类可读的标签，并且不需要在模式中是唯一的。名称应为有效的 Unicode 字符串，并应以自然语言书写。

#### 9.3.2.3.描述

说明 ( description ) 为枚举、其用途或其内容提供人类可读的解释。通常至少是一个短语，也可能是几个句子或段落。描述应为有效的 Unicode 字符串。

#### 9.3.2.4.values

枚举由一组命名值组成，表示为(字符串，整数)对。支持以下枚举值类型：INT8、UINT8、INT16、UINT16、INT32、UINT32、INT64 和 UINT64。有关每个的定义，请参阅[组件类型部分。](https://portal.ogc.org/files/102132#metadata-component-type)较小的枚举类型限制了可能的枚举值的范围，并允许更有效的二进制编码。不允许在同一枚举中使用重复的名称或值。

---

### 9.3.3. Class

类表示相似实体的类别，并由类实体共享的一个或多个属性的集合定义。每个类在模式中都有一个唯一的 ID，每个属性在类中都有一个唯一的 ID，用于模式内部和外部的引用。

#### 9.3.3.1.ID

ID ( id ) 是模式中类的唯一[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

#### 9.3.3.2.Name

名称 ( name ) 为类提供人类可读的标签，并且不需要在模式中是唯一的。名称应为有效的 Unicode 字符串，并应以自然语言书写。

#### 9.3.3.3.描述

描述 ( description ) 提供了一个类、它的用途或它的内容的人类可读的解释。通常至少是一个短语，也可能是几个句子或段落。描述应为有效的 Unicode 字符串。

#### 9.3.3.4.Properties

[无序的属性](https://portal.ogc.org/files/102132#metadata-property)集。

---

### 9.3.4.  财产

#### 9.3.4.1.概述

属性描述可能与类的实体相关联的值的类型和结构。实体可以省略属性的值，除非属性是必需的。实体不应包含由其类的属性定义的值以外的值。

注意   以下示例显示了类如何描述元数据类型的基础知识。建筑类描述了数据集中各种建筑物的高度。同样，树类描述了具有高度、种类和叶子颜色的树。

**建筑**

建筑物的属性和类型

| 财产 | 类型 | 组件类型 |
| :--- | :--- | :------- |
| 高度 | 标量 | 浮动 32  |

**树**

树的属性和类型

| 财产 | 类型   | 组件类型 | 枚举类型 |
| :--- | :----- | :------- | :------- |
| 高度 | 标量   | 浮动 32  |          |
| 物种 | 枚举   |          | 物种     |
| 叶色 | string |          |          |

#### 9.3.4.2.ID

ID ( id ) 是类中属性的唯一[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

#### 9.3.4.3.Name

名称 ( name ) 为属性提供人类可读的标签，并且对于类中的属性应该是唯一的。名称应为有效的 Unicode 字符串，并应以自然语言书写。属性名称没有内在含义；为了提供这样的含义，属性还应定义[语义](https://portal.ogc.org/files/102132#metadata-semantic)。

注意   典型的 ID / 名称对，在英文中，将是 localTemperature 和"Local Temperature"。在日语中，这个名字可能表示为"きおん"。因为 ID 仅限于[identifiers](https://portal.ogc.org/files/102132#metadata-identifiers)，所以在许多语言中使用有用的属性名称对于清晰度来说是必不可少的。

#### 9.3.4.4.描述

说明 ( description ) 提供对属性、其用途或其内容的人类可读的解释。通常至少是一个短语，也可能是几个句子或段落。描述应为有效的 Unicode 字符串。为了提供机器可读的语义，属性还应定义[语义](https://portal.ogc.org/files/102132#metadata-semantic)。

#### 9.3.4.5.语义的

属性 ID、名称和描述没有固有含义。为了提供机器可读的含义，可以为属性分配语义标识符字符串 ( semantic )，指示应如何解释属性的内容。[语义标识符可以由 3D 元数据语义参考](https://portal.ogc.org/files/102132#metadata-semantics-3d-metadata-semantic-reference)或外部语义参考定义，并且可以是特定于应用程序的。标识符应大写，并使用下划线作为单词分隔符。

注意   语义定义可能包括以摄氏度为单位的温度(例如 TEMPERATURE_DEGREES_CELSIUS)、以毫秒为单位的时间(例如 TIME_MILLISECONDS)或均方误差(例如 MEAN_SQUARED_ERROR)。这些例子只是说明性的。

#### 9.3.4.6.类型

属性的类型 ( type ) 描述了为每个实体指定的值的结构。

表 28——元数据属性的类型

| 名称   | 类型                                |
| :----- | :---------------------------------- |
| 标量   | 单个数字组件                        |
| VEC2   | 具有两 (2) 个数字分量的固定长度向量 |
| VEC3   | 具有三 (3) 个数字分量的固定长度向量 |
| VEC4   | 具有四 (4) 个数字分量的固定长度向量 |
| MAT2   | 具有数字组件的 2×2 矩阵             |
| MAT3   | 具有数字组件的 3×3 矩阵             |
| MAT4   | 具有数字组件的 4×4 矩阵             |
| string | 字符序列                            |
| 布尔值 | 对或错                              |
| 枚举   | 枚举类型                            |

#### 9.3.4.7.组件类型

标量、向量和矩阵类型由数字组件组成。每个组件都是属性组件类型 ( componentType ) 的一个实例，支持以下组件类型：

表 29——元数据属性的组件类型

| 名称    | 组件类型                                                       |
| :------ | :------------------------------------------------------------- |
| 整数 8  | \[-128, 127]范围内的有符号整数                                 |
| 整数 8  | \[0, 255]范围内的无符号整数                                    |
| INT16   | \[-32768, 32767]范围内的有符号整数                             |
| UINT16  | \[0, 65535]范围内的无符号整数                                  |
| INT32   | \[-2147483648, 2147483647]范围内的有符号整数                   |
| UINT32  | \[0, 4294967295]范围内的无符号整数                             |
| INT64   | \[-9223372036854775808, 9223372036854775807]范围内的有符号整数 |
| UINT64  | \[0, 18446744073709551615]范围内的无符号整数                   |
| 浮动 32 | 可以表示为 32 位 IEEE 浮点数的数字                             |
| FLOAT64 | 可以表示为 64 位 IEEE 浮点数的数字                             |

浮点属性(FLOAT32 和 FLOAT64)不应包括值 NaN、+Infinity 或-Infinity。

注意   创作工具的开发人员应该知道，许多 JSON 实现仅支持可以表示为 IEEE-754 双精度浮点数的数值。当以 JSON 编码时，浮点数应表示为双精度 IEEE-754 浮点数。当这些数字表示具有较低精度(例如单精度浮点数、8 位整数或 16 位整数)的属性值(例如 noData、min 或 max )时，应将这些值四舍五入为 JSON 中的相同精度以避免任何潜在的不匹配。在二进制存储中编码的数字属性值不受 JSON 实现的这些限制的影响。

#### 9.3.4.8.枚举类型

[枚举属性由](https://portal.ogc.org/files/102132#metadata-enums)ENUM 表示。枚举属性还应提供其使用的特定枚举的 ID，称为其枚举类型 ( enumType )。

#### 9.3.4.9.数组

属性可以声明为固定和可变长度数组，由给定类型的元素组成。对于固定长度数组，计数 ( count ) 表示每个数组中元素的数量，并且应大于或等于 2。可变长度数组不定义计数，可以具有任何长度，包括零。

#### 9.3.4.10.归一化值

规范化属性 ( normalized ) 为较大的浮点类型提供了一种紧凑的替代方案。标准化值存储为整数，但在访问时根据以下等式转换为浮点数：

表 30——元件类型的转换

| 组件类型 | int 浮动                                 | 浮点数                               |
| :------- | :--------------------------------------- | :----------------------------------- |
| 整数 8   | f = max(i / 127.0, -1.0)                 | 我 = 圆(f \* 127.0)                  |
| 整数 8   | f = i / 255.0                            | 我 = 圆(f \* 255.0)                  |
| INT16    | f = max(i / 32767.0, -1.0)               | 我 = 圆(f \* 32767.0)                |
| UINT16   | f = i / 65535.0                          | 我 = 轮(f \* 65535.0)                |
| INT32    | f = max(i / 2147483647.0, -1.0)          | 我 = 圆(f \* 2147483647.0)           |
| UINT32   | f = 我 / 4294967295.0                    | 我 = 圆(f \* 4294967295.0)           |
| INT64    | f = max(i / 9223372036854775807.0, -1.0) | 我 = 圆(f \* 9223372036854775807.0)  |
| UINT64   | f = 我 / 18446744073709551615.0          | 我 = 圆(f \* 18446744073709551615.0) |

normalized 仅适用于具有整数分量类型的标量、向量和矩阵类型。

注意   根据实现和选择的整数类型，非规范 ​​ 化后值的精度可能会有所损失。例如，如果实现使用 32 位浮点变量来表示规范化的 32 位整数的值，则浮点数的尾数中只有 23 位，低位将被反规范化截断。客户端实现应在适合正确表示结果时使用更高精度的浮点数。

#### 9.3.4.11.偏移量和比例

属性可以声明偏移量 ( offset ) 和比例 ( scale ) 以应用于属性值。这在将属性值映射到不同范围时很有用。

可以为具有浮点 componentType 或 normalized 设置为 true 的类型定义偏移量和比例。这适用于 SCALAR、VECN 和 MATN 类型，以及这些类型的固定长度数组。offset 和 scale 的结构在[Property Values Structure](https://portal.ogc.org/files/102132#metadata-property-values-structure)部分进行了解释。

以下等式用于将原始属性值转换为客户端使用的实际值：

transformedValue = offset + scale \* normalize(value)

这些操作是按组件应用的，既适用于数组元素，也适用于向量和矩阵组件。

此处描述的转换允许将任意源值范围映射到任意目标值范围，方法是首先计算原始归一化值的浮点值，然后将该浮点范围映射到所需的目标范围。

注意将规范化整数值转换为浮点值   的结果可能是有损的，如[规范化值部分](https://portal.ogc.org/files/102132#metadata-normalized-values)所述。根据属性值的范围、offset 和 scale 的值以及客户端实现中使用的浮点精度，计算可能会导致低有效位从最终结果中被截断。客户端实现应尽可能合理地保持精度。

如果未给出属性的偏移量，则假定相应类型的每个组件的 is 为 0 。如果未给出属性的比例值，则假定相应类型的每个组件为 1 。*定义相应属性的类的实例*可以覆盖偏移和比例因子，以说明实例提供的属性值的实际范围。

#### 9.3.4.12.最小值和最大值

属性可以指定最小 ( min ) 和最大 ( max ) 值。最小值和最大值表示属性有效值范围的组件范围。这两个值都*包含*，这意味着它们分别表示允许的最小值和最大值。

可以为具有数字组件类型的 SCALAR、VECN 和 MATN 类型以及这些类型的固定长度数组定义最小值和最大值。min 和 max 的结构在["属性值结构"](https://portal.ogc.org/files/102132#metadata-property-values-structure)部分进行了解释。

对于 normalized 的属性， min 和 max 的组件类型是浮点类型。它们的值表示最终的转换属性值的范围。这包括归一化和偏移量- 或比例计算，以及不属于类定义本身的其他变换或约束：应用归一化后，归一化的无符号值在 \[0.0, 1.0] 范围内，但\[ min , max ] 可以指定不同的值范围。

对于所有其他属性， min 和 max 的组件类型与属性的 componentType 匹配，并且值是原始属性值的边界。

注意存储 GPS 坐标的属性可能会为经度值定义\[-180, 180]度   的范围，为纬度值定义 \[-90, 90]度的范围。

不允许\[minimum, maximum]范围之外的属性值， noData 值除外。

#### 9.3.4.13.必需属性、无数据值和默认值

当一个类的所有实体都应存在关联的属性值时，属性被认为是必需的(required)。

数组中的单个元素或向量或矩阵中的单个组件不能按要求标记；只有属性本身可以标记为必需。

当属性值不存在时，属性可以选择指定要使用的无数据值(noData 或"标记值")。可以为除 BOOLEAN 之外的任何类型提供 noData 值。对于 ENUM 类型，noData 值应包含枚举值的名称作为字符串，而不是其整数值。noData 值的结构在["属性值结构"](https://portal.ogc.org/files/102132#metadata-property-values-structure)部分进行了说明。

当属性表中只有某些实体缺少属性值时，noData 值特别有用(请参阅二进制表[格式](https://portal.ogc.org/files/102132#metadata-binary-table-format))。否则，如果所有实体都缺少属性值，则可以从表中省略该列，并且不需要提供 noData 值。[以 JSON 格式](https://portal.ogc.org/files/102132#metadata-json-format)编码的实体可能会省略该属性，而不是提供 noData 值。noData 值和省略的属性在功能上是等效的。

可以为缺少的属性值提供默认值 ( default )。对于 ENUM 类型，默认值应包含枚举值的名称作为字符串，而不是其整数值。对于所有其他情况，默认值的结构在["属性值结构"](https://portal.ogc.org/files/102132#metadata-property-values-structure)部分进行了说明。

如果未提供默认值，则遇到缺少属性值时的行为是实现定义的。

注意   在下面的示例中，"树"类定义为 noData，表示要解释为缺失数据的特定枚举值。

树的属性和类型

| 财产 | 组件类型 | 必需的 | 没有数据 |
| :--- | :------- | :----- | :------- |
| 高度 | 浮动 32  | 是的   |          |
| 物种 | 枚举     |        | "未知"   |
| 叶色 | string   | 是的   |          |

#### 9.3.4.14.财产价值结构

作为类定义的一部分出现的属性值是偏移量、比例、最小值、最大值、默认值和无数据值。类定义中这些值的结构取决于属性的类型。对于 SCALAR(非数组)类型，它们是单个值。对于所有其他情况，它们是数组：

- 对于具有固定长度 count 的 SCALAR 数组类型，它们是长度为 count 的数组。
- 对于 VECN 类型，它们是长度为 N 的数组。
- 对于 MATN 类型，它们是长度为 N \* N 的数组。
- 对于具有固定长度 count 的 VECN 数组类型，它们是长度为 count 的数组，其中每个数组元素本身就是一个长度为 N 的数组
- 对于具有固定长度 count 的 MATN 数组类型，它们是长度为 count 的数组，其中每个数组元素本身就是一个长度为 N \* N 的数组。

对于 noData 值和未规范化的数值，这些数组最内层元素的类型对应于 componentType。对于 normalized 的数值，最里面的元素是浮点值。

## 9.4.  存储格式

### 9.4.1.  概述

模式为实体提供模板，但创建实体需要特定的属性值和存储。本节介绍实体元数据的两种存储格式：

- **二进制表格式** ——属性值存储在并行一维数组中，编码为二进制数据
- **JSON 格式** ——属性值存储在键/值字典中，编码为 JSON 对象

这两种格式都适用于通用元数据存储。对于大量元数据，二进制格式可能更可取。

可以在本规范之外定义其他序列化方法。例如，属性值可以存储在纹理通道中或作为 XML 数据从 REST API 检索。

注：  任何引用 3D 元数据的规范都应明确说明支持哪些存储格式，或定义其自己的序列化。例如，[EXT_structural_metadata](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata) glTF 扩展实现了下面描述的二进制表格式，并为每个纹理元数据定义了一个额外的基于图像的格式。

### 9.4.2.  二进制表格式

#### [](https://portal.ogc.org/files/102132#9-4-2-1-%C2%A0-overview)[9.4.2.1.概述

二进制表格式类似于数据库表，其中实体是行，属性是列。每列代表该类的一个属性。每行代表符合该类的单个实体。

![表格格式](https://github.com/CHENJIAMIAN/Blog/assets/20126997/571866a4-fa33-408b-8cf6-0df3274c0d29)

图 58 — 可以存储在表中的元数据的图示

表的行由称为**实体 ID 的**整数索引寻址。实体 ID 始终编号为`0、1、...、N — 1，`其中`N`是表中的行数。

属性值存储在称为**属性数组**的并行数组中，每列一个。每个属性数组存储单个属性的值。每个属性数组的第`i 个`值是实体 ID 为`i`的实体的该属性的值。

二进制编码对于运行时使用是高效的，并且可扩展到大量元数据。因为属性数组包含单一类型的元素，所以比特流可能被紧密打包或可能使用适合特定数据类型的压缩方法。

属性值根据其数据类型以小端格式进行二进制编码。值紧密排列：值之间没有填充。

#### [](https://portal.ogc.org/files/102132#9-4-2-2-%C2%A0-scalars)[9.4.2.2.标量

标量值根据`componentType`进行编码。多个值紧密地打包在同一个缓冲区中。支持以下数据类型：

表 31——标量元数据值的类型

| 名称    | 描述                      |
| ------- | ------------------------- |
| 整数 8  | 8 位二进制补码有符号整数  |
| 整数 8  | 8 位无符号整数            |
| INT16   | 16 位二进制补码有符号整数 |
| UINT16  | 16 位无符号整数           |
| INT32   | 32 位二进制补码有符号整数 |
| UINT32  | 32 位无符号整数           |
| INT64   | 64 位二进制补码有符号整数 |
| UINT64  | 64 位无符号整数           |
| 浮动 32 | 32 位 IEEE 浮点数         |
| FLOAT64 | 64 位 IEEE 浮点数         |

#### [](https://portal.ogc.org/files/102132#9-4-2-3-%C2%A0-vectors)[9.4.2.3.载体

矢量组件基于`componentType`紧密打包和编码。

#### [](https://portal.ogc.org/files/102132#9-4-2-4-%C2%A0-matrices)[9.4.2.4.矩阵

矩阵组件以列优先顺序紧密打包，并根据`componentType`进行编码。

#### [](https://portal.ogc.org/files/102132#9-4-2-5-%C2%A0-booleans)[9.4.2.5.布尔值

布尔值被编码为单个位，即 0 ( `false` ) 或 1 ( `true` )。多个布尔值被紧密地打包在同一个缓冲区中。这些紧密打包的比特缓冲区有时被称为比特流。

`对于具有N`行的表，存储这些布尔值的缓冲区将由`ceil(N / 8)`个字节组成。当`N`不能被 8 整除时，则该缓冲区最后一个字节的未使用位应设置为 0。

注意访问实体 ID `i`  的布尔值的示例。

```js
byteIndex = floor ( i / 8 ) bitIndex = i % 8 bitValue = ( buffer [ byteIndex ] >> bitIndex ) & 1值= bitValue == 1



```

#### [](https://portal.ogc.org/files/102132#9-4-2-6-%C2%A0-strings)[9.4.2.6.字符串

字符串值是 UTF-8 编码的字节序列。多个字符串紧密地打包在同一个缓冲区中。

因为字符串长度可能不同，所以使用**字符串偏移**缓冲区来标识缓冲区中的字符串。如果属性数组中有`N 个`字符串，则字符串偏移缓冲区有`N + 1 个`元素。其中的前`N`​​ 个指向每个字符串的第一个字节，而最后一个指向紧跟在最后一个字符串之后的字节。`第 i 个`字符串中的字节数由`stringOffset[i + 1] — stringOffset[i]`给出。UTF-8 将每个字符编码为 1-4 个字节，因此字符串偏移量不一定代表字符串中的字符数。

**用于偏移的数据类型由字符串偏移类型**定义，可以是`UINT8`、`UINT16`、`UINT32`或`UINT64`。

注意   三个 UTF-8 字符串，在缓冲区中进行二进制编码。

![字符串属性示例](https://github.com/CHENJIAMIAN/Blog/assets/20126997/e1429726-3e79-4972-b48b-481be944cbf2)

图 60 — 存储字符串元数据的缓冲区的数据布局

#### [](https://portal.ogc.org/files/102132#9-4-2-7-%C2%A0-enums)[9.4.2.7.枚举

根据枚举值类型将枚举编码为整数值(请参阅[枚举](https://portal.ogc.org/files/102132#metadata-enums))。[标量](https://portal.ogc.org/files/102132#metadata-scalars)支持的任何整数数据类型都可以用于枚举值。

#### [](https://portal.ogc.org/files/102132#9-4-2-8-%C2%A0-fixed-length-arrays)[9.4.2.8.定长数组

一个固定长度的数组值被编码为一个由`count`个元素组成的紧密排列的数组，其中每个元素都根据`type`进行编码。

#### [](https://portal.ogc.org/files/102132#9-4-2-9-%C2%A0-variable-length-arrays)[9.4.2.9.变长数组

可变长度数组使用额外的**数组偏移**缓冲区。数组偏移缓冲区中的第 i 个值是元素索引——而不是字节偏移——标识第 i` 个``数组 `的开头。数组中的字符串值可能具有不一致的长度，需要数组偏移和**字符串偏移**缓冲区(请参阅：[字符串](https://portal.ogc.org/files/102132#metadata-strings))。

**用于偏移的数据类型由数组偏移类型**定义，可以是`UINT8`、`UINT16`、`UINT32`或`UINT64`。

如果属性数组中有`N 个`数组，则数组偏移缓冲区有`N + 1 个`元素。其中的前`N`​​ 个指向属性数组中数组的第一个元素，或者指向字符串组件类型的字符串偏移缓冲区中的第一个元素。最后一个值指向紧跟在最后一个数组元素之后的一个(不存在的)元素。

对于以下每种情况，数组元素`i`在其二进制存储中的偏移量以实体 ID `id`和元素索引`i`表示。

表 32——字符串和数组的偏移量类型

| 类型         | 胶印型     | 抵消                                |
| ------------ | ---------- | ----------------------------------- |
| `string`     | 字节偏移量 | `stringOffset[arrayOffset[id] + i]` |
| 所有其他类型 | 数组索引   | `arrayOffset[id] + 我`              |

上表中的每个表达式都定义了底层属性数组的索引。` 对于具有FLOAT32组件类型的``SCALAR `元素的属性数组，索引`3`对应于字节偏移量`3 * sizeof(FLOAT32)`。` 对于具有FLOAT32组件类型的``VEC4 `元素的属性数组，索引`3`对应于字节偏移量`3 * 4 * sizeof(FLOAT32) = 48`。`对于BOOLEAN`元素的数组，偏移量`3`将对应于*位*偏移量`3`。

注 1  五个可变长度的 UINT8 组件数组，在缓冲区中进行二进制编码。关联的属性定义为`type = "SCALAR"`、`componentType = "UINT8"`和`array = true`。

![变长数组](https://github.com/CHENJIAMIAN/Blog/assets/20126997/4010d3f2-7297-40ec-a9e0-192b752e4ff6)

图 61 — 存储字符串可变长度数组的缓冲区的数据布局

注 2  两个可变长度的字符串数组，在缓冲区中进行二进制编码。关联的属性定义为`type = "STRING"`和`array = true`(可变长度)。观察数组偏移缓冲区的最后一个元素指向字符串偏移缓冲区的最后一个元素。这是因为最后一个有效的字符串偏移是字符串偏移缓冲区的倒数第二个元素。

![可变长度字符串数组](https://github.com/CHENJIAMIAN/Blog/assets/20126997/ee8ad8c2-14e4-4c6a-ab15-60d536aa604d)

图 62 — 存储字符串可变长度字符串数组的缓冲区的数据布局

### [](https://portal.ogc.org/files/102132#9-4-3-%C2%A0-json-format)9.4.3. JSON 格式

#### 9.4.3.1.概述

JSON 编码对于以人类可读的形式存储少量实体很有用。

每个实体都表示为一个 JSON 对象，其类由字符串 ID 标识。属性值在键/值属性字典中定义，属性 ID 作为其键。属性值被编码为相应的 JSON 类型：数值类型表示为 number，布尔值表示为 boolean，字符串表示为 string ，枚举表示为 string，向量和矩阵表示为 number 数组，数组表示为包含类型的数组。

注意   以下示例演示了固定长度和可变长度数组的用法：

_一个枚举，"basicEnum"，由三个(名称：值)对组成：_

示例枚举的名称和值

| 名称     | 价值 |
| :------- | :--- |
| "枚举 A" | 0    |
| "枚举 B" | 1 个 |
| "枚举 C" | 2 个 |

_一个类，"basicClass"，由十个属性组成。stringArrayProperty 计数未定义，因此是可变长度的。_

示例类的属性

| ID              | 类型   | 组件类型 | 大批   | 数数 | 枚举类型 | 必需的 |
| :-------------- | :----- | :------- | :----- | :--- | :------- | :----- |
| 浮动属性        | 标量   | FLOAT64  | 错误的 |      |          | 是的   |
| 整型属性        | 标量   | INT32    | 错误的 |      |          | 是的   |
| 矢量属性        | VEC2   | 浮动 32  | 错误的 |      |          | 是的   |
| floatArray 属性 | 标量   | 浮动 32  | 真的   | 3 个 |          | 是的   |
| 矢量数组属性    | VEC2   | 浮动 32  | 真的   | 2 个 |          | 是的   |
| 布尔属性        | 布尔值 |          | 错误的 |      |          | 是的   |
| 字符串属性      | string |          | 错误的 |      |          | 是的   |
| 枚举属性        | 枚举   |          | 错误的 |      | 基本枚举 | 是的   |
| 字符串数组属性  | string |          | 真的   |      |          | 是的   |
| 可选属性        | string |          | 错误的 |      |          |        |

_以 JSON 编码的单个实体。请注意，此示例中省略了可选属性。_

```js
{ "实体" ：{ "类" ："basicClass" ，"属性" ：{ "floatProperty" ：1.5 ，"integerProperty" ：- 90 ，"vectorProperty" ：[ 0.0，1.0 ]，"floatArrayProperty" ：[ 1.0，0.5 , - 0.5 ], "vectorArrayProperty" : [[ 0.0 , 1.0 ], [ 1.0 , 2.0 ]],
 
   
   
     
     
     
     
     
      "booleanProperty" ：true ，"stringProperty" ："x123" ，"enumProperty" ："枚举 B" ，"stringArrayProperty" ：[ "abc" ，"12345" ，"おはようございます" ] } } }
     
     
     
   
 

```

#### 9.4.3.2.标量

所有组件类型(INT8、UINT8、INT16、UINT16、INT32、UINT32、INT64、UINT64、FLOAT32 和 FLOAT64)都编码为 JSON 数字。浮点值应表示为 IEEE 浮点数。

注意   对于数字类型，以位为单位的大小是明确的。尽管 JSON 对于所有整数和浮点数只有一种数字类型，但使用 JSON 的应用程序可能会有所区别。例如，C 和 C++ 有几种不同的整数类型，例如 uint8_t、uint32_t。应用程序负责使用属性定义中指定的类型来解释元数据。

#### 9.4.3.3.载体

矢量被编码为 JSON 数字数组。

#### 9.4.3.4.矩阵

矩阵被编码为按列优先顺序排列的 JSON 数字数组。

#### 9.4.3.5.布尔值

布尔值被编码为 JSON 布尔值，true 或 false。

#### 9.4.3.6.字符串

字符串被编码为 JSON 字符串。

#### 9.4.3.7.枚举

使用枚举值的名称而不是整数值将枚举编码为 JSON 字符串。因此，如果指定了枚举值类型，JSON 编码将忽略它。

#### 9.4.3.8.数组

数组被编码为 JSON 数组，其中每个元素都根据 type 进行编码。指定计数时，JSON 数组的长度应与计数匹配。否则，对于可变长度数组，JSON 数组可以是任意长度，包括零长度。

# 10、造型

## 10.1.  概述

3D Tiles 样式提供了 tileset 功能的简洁声明样式。样式定义表达式来评估 Feature 的显示，例如颜色(RGB 和半透明)和显示属性，通常基于存储在磁贴[批处理表](https://portal.ogc.org/files/102132#tileformats-batchtable-batch-table)中的 Feature 属性。

样式可以应用于不包含 Feature 的图块，在这种情况下，图块被视为没有属性的隐式单个 Feature。

虽然可以为 tileset 创建样式并引用 tileset 的属性，但样式独立于 tileset，因此任何样式都可以应用于任何 tileset。

样式是用 JSON 定义的，表达式是用一小部分 JavaScript 编写的，用于样式增强。此外，样式语言提供了一组内置函数来支持常见的数学运算。

以下示例根据建筑物高度分配颜色。

```js
{ "show" : "${Area} > 0" , "color" : { "条件" : [ [ "${Height} < 60" , "color('#13293D')" ], [ "${Height } < 120" , "color('#1B98E0')" ], [ "true" , "color('#E8F1F2', 0.5)" ] ] } }
   
   
       
           
           
           
       
   

```

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/2a407b15-55c4-4047-8b21-4277290d4897)

图 63——根据建筑物的高度用不同颜色渲染建筑物

## 10.2.  概念

### 10.2.1.造型特点

可用于样式 Feature 的视觉属性是 show 属性，其分配的表达式将评估为确定 Feature 是否可见的布尔值，以及 color 属性，其分配的表达式将评估为 Color 对象(RGB 和半透明)确定要素的显示颜色。

以下样式将默认显示和颜色属性分配给每个功能：

```js
{ "显示" ："真"，"颜色" ："颜色('#ffffff ')" }
   
   

```

show 可以是依赖于要素属性的表达式，而不是显示所有要素，例如，以下表达式将仅显示 19341 邮政编码中的要素：

```js
{ "show" : "${ ZipCode } === ' 19341 '" }
   

```

show 也可以用于更复杂的查询；例如，这里使用复合条件和正则表达式来仅显示县以"Chest"开头且建造年份大于或等于 1970 年的要素：

```js
{ "show" : "( regExp ('^ Chest ') .test ( ${ County })) && ( ${ YearBuilt } >= 1970 )" }
   

```

颜色也可以通过依赖于 Feature 属性的表达式来定义。例如，以下表达式将温度高于 90 的 Feature 标记为红色，将其他颜色标记为白色：

```js
{ "颜色" ："(${温度} > 90)？颜色('红色')：颜色('白色')" }
   

```

颜色的 alpha 分量定义了 Feature 的不透明度。例如，以下代码根据要素的属性设置要素的 RGB 颜色分量，并使体积大于 100 的要素透明：

```js
{ "颜色" ："rgba (${ red }，${ green }，${ blue }，(${ volume } > 100 ？0.5 ：1.0))" }
  

```

### 10.2.2.状况

除了包含表达式的字符串外，color 和 show 还可以是定义一系列条件的数组(类似于 if...else 语句)。例如，条件可用于制作具有任何类型的包含/排除间隔的颜色图和颜色渐变。

例如，以下表达式将 ID 属性映射到颜色。条件按顺序评估，因此如果\${id}不是'1'或'2'，"真"条件返回白色。如果不满足任何条件，Feature 的颜色将是未定义的：

```js
{ "颜色" ：{ "条件" ：[ ["${ id } === ' 1 '"，"颜色('# FF0000 ')"]，["${ id } === ' 2 '"，"color ('# 00FF00 ')"], ["true", "color ('# FFFFFF ')"] ] } }
   
       
           
           
           
       
   

```

下一个示例显示如何使用条件使用具有包含下限和不包含上限的间隔来创建色带：

```js
"颜色" ：{ "条件" ：[ ["(${高度} >= 1.0)&& (${高度} < 10.0)"，"颜色('# FF00FF ')"]，["(${高度} >= 10.0 ) && ( ${高度} < 30.0 )", " color ('# FF0000 ')"], ["(
   
           
       
        ${ Height } >= 30.0 ) && ( ${ Height } < 50.0 )", "颜色('# FFFF00 ')"], ["( ${ Height } >= 50.0 ) && ( ${ Height } < 70.0 )", "颜色('# 00FF00 ')"], ["( ${高度} >= 70.0 ) && ( ${
       
            Height } < 100.0 )", " color ('# 00FFFF ')"], ["( ${ Height } >= 100.0 )", " color ('# 0000FF ')"] ] }
       
   

```

由于条件是按顺序评估的，因此可以将上面的内容更简洁地写成如下：

```js
"颜色" ：{ "条件" ：[ ["(${高度} >= 100.0)"，"颜色('# 0000FF ')"]，["(${高度} >= 70.0)"，"颜色( '# 00FFFF ')"], ["( ${ Height } >= 50.0 )", "颜色('# 00FF00 ')"], ["( ${ Height
   
       
       
       
        } >= 30.0 )", " color ('# FFFF00 ')"], ["( ${ Height } >= 10.0 )", " color ('# FF0000 ')"], ["( ${ Height } > = 1.0 )", "颜色('# FF00FF ')"] ] }
       
       
   

```

### 10.2.3.定义变量

常用表达式可以存储在以变量名作为键的定义对象中。如果变量引用已定义表达式的名称，则它会被引用的计算表达式的结果替换：

```js
{ "定义" ：{ "NewHeight" ："钳位((${高度} -  0.5)/ 2.0，1.0，255.0)" ，"HeightColor" ："rgb (${高度} ，${高度} ，${高度})" }, "颜色" : { "条件" :
   
       
       
   
   
          [ ["( ${ NewHeight } >= 100.0 )", "颜色('# 0000FF ') * ${ HeightColor }"], ["( ${ NewHeight } >= 50.0 )", "颜色('# 00FF00 ') ) * ${ HeightColor }"], ["( ${ NewHeight } >= 1.0 )", "color ('# FF0000 ') * ${
           
           
                HeightColor }"] ] }，"显示" ："${ NewHeight } < 200.0" }
       
   
   

```

定义表达式不能引用其他定义；但是，它可能会引用具有相同名称的要素属性。在下面的样式中，高度为 150 的 Feature 变为红色：

    { "定义" ：{ "高度" ："${高度}/2.0 }"，}，"颜色" ：{ "条件" ：[ ["(${高度} > = 100.0)"，"颜色('# 0000FF ')"], ["( ${高度} >= 1.0 )", "颜色('# FF0000 ')"] ]
       
           
       
       
           
               
               
           
        }
    }

### 10.2.4.元属性

可以使用元属性定义 Feature 的非视觉属性。例如，以下将描述元属性设置为包含功能名称的字符串：

```js
{ "meta" ：{ "description" ："'你好，${ featureName }。'" } }
   
       
   

```

元属性表达式可以计算为任何类型。例如：

```js
{ "meta" ：{ "featureColor" ："rgb (${ red }，${ green }，${ blue })"，"featureVolume" ："${ height } * ${ width } * ${ depth }" } }
   
       
       
   

```

## 10.3.  表达式

表达式语言是 JavaScript ( [EMCAScript 5](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf) ) 的一个小子集，加上本机向量和正则表达式类型，以及以只读变量的形式访问 tileset Feature 属性。

注意   CesiumJS 使用[jsep](https://ericsmekens.github.io/jsep/) JavaScript 表达式解析器库将样式表达式解析为[抽象语法树 (AST)](https://en.wikipedia.org/wiki/Abstract_syntax_tree)。

### 10.3.1.语义学

点符号用于按名称访问属性，例如 building.name。

括号表示法 ( \[] ) 也用于访问属性，例如 building\['name']，或数组，例如 temperatures\[1]。

调用函数时使用圆括号 ( () ) 和逗号分隔的参数，例如 ( isNaN(0.0) , color('cyan', 0.5) )。

### 10.3.2.运营商

以下运算符支持与 JavaScript 相同的语义和优先级。

- 一元：+，-，！

  - 不支持：\~

- 二进制：|| , && , === , !== , < , > , <= , >= , + , - , \* , / , % , =~ , !~

  - 不支持：| , ^ , & , << , >>和>>>

- 三元：？:

(和)也支持为清晰度和优先级对表达式进行分组。

逻辑|| &&实现短路；真|| expression 不计算正确的表达式，而 false && 表达式不计算正确的表达式。

同样，真？leftExpression : rightExpression 只执行左边的表达式，false ? leftExpression : rightExpression 只执行右边的表达式。

### 10.3.3.类型

支持以下类型：

- 布尔值
- 无效的
- 不明确的
- 数字
- string
- 大批
- vec2
- vec3
- vec4
- 正则表达式

除 vec2、vec3、vec4 和 RegExp 之外的所有类型都具有与 JavaScript 相同的语法和运行时行为。 vec2、vec3 和 vec4 派生自 GLSL 向量，其行为类似于 JavaScript 对象(请参阅[向量部分](https://portal.ogc.org/files/102132#styling-vector))。颜色派生自[CSS3 Colors 并作为](https://www.w3.org/TR/css3-color/)vec4 实现。RegExp 派生自 JavaScript，在[RegExp 部分](https://portal.ogc.org/files/102132#styling-regexp)中进行了描述。

不同类型的示例表达式包括：

- 真,假
- 无效的
- 不明确的
- 1.0 ,南,无穷大
- 'Cesium' , "Cesium"
- \[0, 1, 2]
- vec2(1.0, 2.0)
- vec3(1.0, 2.0, 3.0)
- vec4(1.0, 2.0, 3.0, 4.0)
- 颜色('#00FFFF')
- regExp('^Chest'))

#### 10.3.3.1.数字

与在 JavaScript 中一样，数字可以是 NaN 或 Infinity。支持以下测试功能：

- isNaN(测试值：数字)：布尔值
- isFinite(测试值：数字)：布尔值

#### 10.3.3.2.string

字符串以 UTF-8 编码。

#### 10.3.3.3.向量

样式语言包括 2、3 和 4 分量浮点向量类型：vec2、vec3 和 vec4。向量构造函数与 GLSL 共享相同的规则：

##### 10.3.3.3.1.vec2

- vec2(xy : Number)  — 用数字初始化每个组件
- vec2(x : Number, y : Number)  — 用两个数字初始化
- vec2(xy : vec2) — 用另一个 vec2  初始化
- vec2(xyz : vec3) — 删除 vec3  的第三个组件
- vec2(xyzw : vec4) — 删除 vec4  的第三和第四部分

##### 10.3.3.3.2.vec3

- vec3(xyz : Number)  — 用数字初始化每个组件
- vec3(x : Number, y : Number, z : Number)  — 用三个数字初始化
- vec3(xyz : vec3) — 用另一个 vec3  初始化
- vec3(xyzw : vec4) — 删除 vec4  的第四个分量
- vec3(xy : vec2, z : Number) — 用 vec2 和数字   初始化
- vec3(x : Number, yz : vec2) — 用 vec2 和数字   初始化

##### 10.3.3.3.3.vec4

- vec4(xyzw : Number)  — 用数字初始化每个组件
- vec4(x : Number, y : Number, z : Number, w : Number)  — 用四个数字初始化
- vec4(xyzw : vec4) — 用另一个 vec4  初始化
- vec4(xy : vec2, z : Number, w : Number) — 用 vec2 和两个数字   初始化
- vec4(x : Number, yz : vec2, w : Number) — 用 vec2 和两个数字   初始化
- vec4(x : Number, y : Number, zw : vec2)  — 用 vec2 和两个数字初始化
- vec4(xyz : vec3, w : Number) — 用 vec3 和数字   初始化
- vec4(x : Number, yzw : vec3) — 用 vec3 和数字   初始化

##### 10.3.3.3.4.矢量用法

可以访问 vec2 组件

- .x , .y
- .r , .g
- \[0] , \[1]

可以访问 vec3 组件

- .x , .y , .z
- .r , .g , .b
- \[0] , \[1] , \[2]

vec4 组件可以访问

- .x , .y , .z , .w
- .r , .g , .b , .a
- \[0] , \[1] , \[2] , \[3]

与 GLSL 不同，样式语言不支持 swizzling。例如，不支持 vec3(1.0).xy 。

向量支持以下一元运算符：-、+。

向量通过执行分量运算来支持以下二元运算符：===、!==、+、-、\*、/和%。例如 vec4(1.0) === vec4(1.0)为真，因为*x*、_y_、*z*和*w*分量相等。对于 vec2、vec3 和 vec4 ，运算符基本上是重载的。

vec2、vec3 和 vec4 有一个 toString 函数，用于显式(和隐式)转换为格式为'(x, y)'、'(x, y, z)'和'(x, y, z, w )'。

- toString() : 字符串

vec2、vec3 和 vec4 不公开任何其他函数或原型对象。

#### 10.3.3.4.颜色

颜色作为 vec4 实现，并使用以下函数之一创建：

- 颜色()
- 颜色(关键字：字符串，\[alpha：数字])
- 颜色(6 位十六进制：字符串，\[alpha：数字])
- 颜色(3 位十六进制：字符串，\[alpha：数字])
- rgb(红色：数字，绿色：数字，蓝色：数字)
- rgba(红色：数字，绿色：数字，蓝色：数字，alpha：数字)
- hsl(色调：数字，饱和度：数字，亮度：数字)
- hsla(色调：数字，饱和度：数字，亮度：数字，alpha：数字)

调用不带参数的 color()与调用 color('#FFFFFF')相同。

由不区分大小写的关键字(例如，'cyan')或十六进制 rgb 定义的颜色作为字符串传递给颜色函数。例如：

- 颜色('青色')
- 颜色('#00FFFF')
- 颜色('#0FF')

这些颜色函数有一个可选的第二个参数，它是一个用于定义不透明度的 alpha 组件，其中 0.0 是完全透明的，1.0 是完全不透明的。例如：

- 颜色('青色'，0.5)

使用十进制 RGB 或 HSL 定义的颜色分别使用 rgb 和 hsl 函数创建，就像在 CSS 中一样(但百分比范围分别从 0.0 到 1.0 表示 0%到 100%)。例如：

- RGB(100, 255, 190)
- hsl(1.0, 0.6, 0.7)

rgb 组件的范围是 0 到 255，包括在内。对于 hsl，色相、饱和度和亮度的范围是 0.0 到 1.0(含)。

用 rgba 或 hsla 定义的颜色有第四个参数，它是定义不透明度的 alpha 分量，其中 0.0 是完全透明的，1.0 是完全不透明的。例如：

- RGBA(100, 255, 190, 0.25)
- hsla(1.0, 0.6, 0.7, 0.75)

颜色等同于 vec4 类型并共享相同的函数、运算符和组件访问器。颜色分量存储在 0.0 到 1.0 的范围内。

例如：

- color('red').x、color('red').r 和 color('red')\[0] 的计算结果均为 1.0。
- color('red').toString()计算结果为(1.0, 0.0, 0.0, 1.0)
- color('red') \* vec4(0.5)等同于 vec4(0.5, 0.0, 0.0, 0.5)

#### 10.3.3.5.正则表达式

正则表达式是使用以下函数创建的，其行为类似于 JavaScript [RegExp](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp)构造函数：

- 正则表达式()
- regExp(模式：字符串，\[标志：字符串])

调用不带参数的 regExp()与调用 regExp('(?:)')相同。

如果指定，标志可以具有以下值的任意组合：

- g  — 全局匹配
- i——  忽略大小写
- m  — 多行
- 你  ——统一码
- y - 粘性

正则表达式支持这些功能：

- test(string : String) : Boolean  — 测试指定字符串是否匹配。
- exec(string : String) : String  — 在指定字符串中执行匹配项搜索。如果搜索成功，它会返回捕获的 String 的第一个实例。如果搜索失败，则返回 null。

例如：

```js
{ "名称" ："1号楼" }
   

```

```js
正则表达式(' a ')。test (' abc ') === true regExp (' a (.)', ' i '). exec (' Abc ') === ' b ' regExp (' Building \s ( \d )'). exec ( ${ Name }) === ' 1 '


```

正则表达式有一个 toString 函数，用于显式(和隐式)转换为'pattern'格式的字符串：

- toString() : 字符串

正则表达式不公开任何其他函数或原型对象。

运算符=~和!~为正则表达式重载。= ~运算符匹配测试函数的行为，并测试指定的字符串是否匹配。如果找到，则返回 true ，如果找不到，则返回 false 。!~运算符与=\~运算符相反。如果未找到匹配项，则返回 true ，如果找到匹配项，则返回 false 。两个运算符都是可交换的。

例如，以下表达式的计算结果均为真：

```js
regExp (' a ') =~ ' abc ' ' abc ' =~ regExp (' a ') regExp (' a ') !~ ' bcd ' ' bcd ' !~ regExp (' a ')




```

### 10.3.4.运营商规则

- 一元运算符+和-仅对数字和向量表达式进行运算。
- 一元运算符！仅对布尔表达式进行操作。
- 二元运算符<、<=、>和>=仅对数字表达式进行运算。
- 二元运算符|| &&仅对布尔表达式进行操作。
- 二元运算符+对以下表达式进行运算：

  - 数字表达式
  - 相同类型的向量表达式
  - [如果至少一个表达式是字符串，则另一个表达式将在字符串转换](https://portal.ogc.org/files/102132#styling-string-conversions)之后转换为字符串，并且该操作返回一个连接的字符串，例如"name"+ 10 计算为"name10"

- 二元运算符-对以下表达式进行运算：

  - 数字表达式
  - 相同类型的向量表达式

- 二元运算符\*对以下表达式进行运算：

  - 数字表达式
  - 相同类型的向量表达式
  - 数字表达式和向量表达式的混合，例如 3 \* vec3(1.0)和 vec2(1.0) \* 3

- 二元运算符/对以下表达式进行运算：

  - 数字表达式
  - 相同类型的向量表达式
  - 向量表达式后跟数字表达式，例如 vec3(1.0) / 3

- 二元运算符%对以下表达式进行运算：

  - 数字表达式
  - 相同类型的向量表达式

- 二元相等运算符===和!==对任何表达式进行运算。如果表达式类型不匹配，则该操作返回 false 。
- 二元 regExp 运算符=~和!~要求一个参数是字符串表达式，另一个参数是 RegExp 表达式。
- 三元运算符？:条件参数应为布尔表达式。

### 10.3.5.类型转换

基本类型之间的显式转换使用 Boolean、Number 和 String 函数处理。

- 布尔值(值：任何)：布尔值
- 数字(值：任意)：数字
- 字符串(值：任何)：字符串

例如：

```js
布尔值( 1 ) === true数字( '1' ) === 1字符串( 1 ) === '1'


```

Boolean 和 Number 遵循 JavaScript 约定。String 遵循[String Conversions](https://portal.ogc.org/files/102132#styling-string-conversions)。

这些本质上是强制转换，而不是构造函数。

样式语言不允许隐式类型转换，除非上面另有说明。像 vec3(1.0) === vec4(1.0)和"5" < 6 这样的表达式是无效的。

### 10.3.6.字符串转换

vec2、vec3、vec4 和 RegExp 表达式使用它们的 toString 方法转换为字符串。所有其他类型都遵循 JavaScript 约定。

- 真  ——  "真"
- 假的  ——  "假的"
- 空  ——  "空"
- 未定义  ——  "未定义"
- 5.0  —  "5"
- NaN  ——  "NaN"
- 无限  ——  "无限"
- "名字"  ——  "名字"
- \[0, 1, 2]  —  "\[0, 1, 2]"
- vec2(1, 2)  —  "(1, 2)"
- vec3(1, 2, 3)  —  "(1, 2, 3)"
- vec4(1, 2, 3, 4)  —  "(1, 2, 3, 4)"
- RegExp('a')  —  "/a/"

### 10.3.7.常量

样式语言支持以下常量：

- [数学.PI](https://portal.ogc.org/files/102132#styling-pi)
- [数学 E](https://portal.ogc.org/files/102132#styling-e)

#### 10.3.7.1.PI

数学常数 PI 表示圆的周长除以直径，大约为 3.14159。

```js
{ "show" : "cos(${Angle} + Math.PI) < 0" }
   

```

#### 10.3.7.2.乙

欧拉常数和自然对数的底，大约为 2.71828。

```js
{ "color" ："color() * pow(Math.E / 2.0, ${Temperature})" }
   

```

### 10.3.8.变量

变量用于检索 tileset 中各个要素的属性值。变量使用 ES 6 ( [ECMAScript 2015](http://www.ecma-international.org/ecma-262/6.0/) ) 模板文字语法来标识，即\${feature.identifier}或\${feature\['identifier']}，其中标识符是区分大小写的属性名称。变量名称以 UTF-8 编码。Feature 是隐式的，在大多数情况下可以省略。如果标识符包含非字母数字字符，例如:、-、#或空格，则应使用\${feature\['identifier']}形式。

变量可以在接受有效表达式的任何地方使用，但在其他变量标识符内除外。例如，不允许以下内容：

    ${ foo [ ${ bar }]}
    ——

如果要素不具有具有指定名称的属性，则该变量的计算结果为 undefined。请注意，如果为属性显式存储了 null ，则该属性也可能为 null 。

变量可以是任何受支持的原生 JavaScript 类型：

- 布尔值
- 无效的
- 不明确的
- 数字
- string
- 大批

例如：

```js
{ "enabled" ：true ，"description" ：null ，"order" ：1 ，"name" ："Feature name" }
   
   
   
   

```

```js
{ enabled } === true ${ description } === null ${ order } === 1 ${ name } === '功能名称'



```

此外，源自存储在[批处理表二进制文件](https://portal.ogc.org/files/102132#tileformats-batchtable-binary-body)中的向量属性的变量被视为向量类型：

表 33 — 矢量类型变量

| 组件类型 | 变量类型 |
| :------- | :------- |
| "VEC2"   | vec2     |
| "VEC3"   | vec3     |
| "VEC4"   | vec4     |

变量可用于构造颜色或向量。例如：

    rgba ( ${ red }, ${ green }, ${ blue }, ${ alpha })
    vec4 ( ${ temperature })

点或括号表示法用于访问要素子属性。例如：

```js
{ "地址" ：{ "街道" ："示例街道"，"城市" ："示例城市" } }
   
       
       
   

```

```js
{地址。街道} === `示例街道` ${地址['街道']} === `示例街道` ${地址. city } === `Example city` ${ address [' city ']} === `Example city`




```

括号表示法仅支持字符串文字。

可以通过显式使用 feature 关键字使用括号表示法访问顶级属性。例如：

```js
{ "地址。街道" ："枫树街"，"地址" ：{ "街道" ："橡树街" } }
   
   
       
   

```

```js
{地址。街道} === `Oak Street` ${ feature . 地址。street } === `Oak Street` ${ feature [' address ']. street } === `Oak Street` ${ feature [' address . 街道']} === `枫树街`



```

要访问名为 feature 的功能，请使用变量\${feature}。这相当于访问\${feature.feature}

```js
{ "Feature" ："建筑" }
   

```

```js
{ feature } === `building` ${ feature . Feature} === `建筑`

```

也可以在用反引号定义的字符串中替换变量，例如：

```js
{ "订单" ：1 ，"名称" ："Feature名称" }
   
   

```

    `名字是${name}，顺序是${order}`

括号表示法用于访问要素子属性或数组。例如：

```js
{ "温度" ：{ "比例" ："华氏度" ，"值" ：[ 70，80，90 ] } } _ _ _
   
       
       
   

```

```js
{温度[' scale ']} === '华氏温度' ${温度. values [ 0 ]} === 70 ${ temperatures [' values '][ 0 ]} === 70 // 与 (temperatures[values])[0] 和 temperatures.values[0] 相同


```

### 10.3.9.内置函数

样式语言支持以下内置函数：

- [腹肌](https://portal.ogc.org/files/102132#styling-abs)
- [开方](https://portal.ogc.org/files/102132#styling-sqrt)
- [余弦](https://portal.ogc.org/files/102132#styling-cos)
- [罪](https://portal.ogc.org/files/102132#styling-sin)
- [棕褐色](https://portal.ogc.org/files/102132#styling-tan)
- [阿科斯](https://portal.ogc.org/files/102132#styling-acos)
- [阿信](https://portal.ogc.org/files/102132#styling-asin)
- [晒黑](https://portal.ogc.org/files/102132#styling-atan)
- [阿坦 2](https://portal.ogc.org/files/102132#styling-atan2)
- [弧度](https://portal.ogc.org/files/102132#styling-radians)
- [学位](https://portal.ogc.org/files/102132#styling-degrees)
- [符号](https://portal.ogc.org/files/102132#styling-sign)
- [地面](https://portal.ogc.org/files/102132#styling-floor)
- [天花板](https://portal.ogc.org/files/102132#styling-ceil)
- [圆形的](https://portal.ogc.org/files/102132#styling-round)
- [exp](https://portal.ogc.org/files/102132#styling-exp)
- [日志](https://portal.ogc.org/files/102132#styling-log)
- [exp2](https://portal.ogc.org/files/102132#styling-exp2)
- [log2](https://portal.ogc.org/files/102132#styling-log2)
- [分形](https://portal.ogc.org/files/102132#styling-fract)
- [战俘](https://portal.ogc.org/files/102132#styling-pow)
- [分钟](https://portal.ogc.org/files/102132#styling-min)
- [最大限度](https://portal.ogc.org/files/102132#styling-max)
- [夹钳](https://portal.ogc.org/files/102132#styling-clamp)
- [混合](https://portal.ogc.org/files/102132#styling-mix)
- [长度](https://portal.ogc.org/files/102132#styling-length)
- [距离](https://portal.ogc.org/files/102132#styling-distance)
- [归一化](https://portal.ogc.org/files/102132#styling-normalize)
- [点](https://portal.ogc.org/files/102132#styling-dot)
- [叉](https://portal.ogc.org/files/102132#styling-cross)

许多内置函数将标量或向量作为参数。对于矢量参数，函数按组件应用并返回结果矢量。

#### 10.3.9.1.腹肌

```js
abs ( x : Number ) : Number abs ( x : vec2 ) : vec2 abs ( x : vec3 ) : vec3 abs ( x : vec4 ) : vec4



```

返回 x 的绝对值。

```js
{ "显示" ："绝对值(${温度})> 20.0" }
   

```

#### 10.3.9.2.开方

```js
sqrt (x ：数字)：数字sqrt (x ：vec2)：vec2 sqrt (x ：vec3)：vec3 sqrt (x ：vec4)：vec4



```

当 x >= 0 时返回 x 的平方根。当 x < 0 时返回 NaN。

```js
{ "颜色" ：{ "条件" ：[ ["${温度} >= 0.5"，"颜色('# 00FFFF ')"]，["${温度} >= 0.0"，"颜色('# FF00FF ')"] ] } }
   
       
           
           
       
   

```

#### 10.3.9.3.余弦

```js
cos (角度：数字)：数字cos (角度：vec2)：vec2 cos (角度：vec3)：vec3 cos (角度：vec4)：vec4



```

以弧度返回角度的余弦值。

```js
{ "显示" ："cos (${角度})> 0.0" }
   

```

#### 10.3.9.4.罪

```js
sin ( angle : Number ) : Number sin ( angle : vec2 ) : vec2 sin ( angle : vec3 ) : vec3 sin ( angle : vec4 ) : vec4



```

以弧度返回角度的正弦值。

```js
{ "显示" ："sin (${ Angle })> 0.0" }
   

```

#### 10.3.9.5.棕褐色

```js
tan (角度：Number)：数字tan (角度：vec2)：vec2 tan (角度：vec3)：vec3 tan (角度：vec4)：vec4



```

以弧度返回角度的正切值。

```js
{ "显示" ："棕褐色(${角度})> 0.0" }
   

```

#### 10.3.9.6.阿科斯

```js
acos ( angle : Number ) : Number acos ( angle : vec2 ) : vec2 acos ( angle : vec3 ) : vec3 acos ( angle : vec4 ) : vec4



```

以弧度返回角度的反余弦值。

```js
{ "显示" ："acos (${角度})> 0.0" }
   

```

#### 10.3.9.7.阿信

```js
asin (角度：数字)：数字asin (角度：vec2)：vec2 asin (角度：vec3)：vec3 asin (角度：vec4)：vec4



```

以弧度返回角度的反正弦值。

```js
{ "显示" ："asin (${ Angle })> 0.0" }
   

```

#### 10.3.9.8.晒黑

```js
atan (角度：数字)：数字atan (角度：vec2)：vec2 atan (角度：vec3)：vec3 atan (角度：vec4)：vec4



```

以弧度返回角度的反正切值。

```js
{ "显示" ："atan (${角度})> 0.0" }
   

```

#### 10.3.9.9.阿坦 2

```js
atan2 (y ：数字，x ：数字)：数字atan2 (y ：vec2 ，x ：vec2)：vec2 atan2 (y ：vec3 ，x ：vec3)：vec3 atan2 (y ：vec4 ，x ：vec4)：vec4



```

返回 y 和 x 的商的反正切值。

```js
{ "显示" ："atan2 (${ GridY }，${ GridX })> 0.0" }
   

```

#### 10.3.9.10.弧度

```js
弧度(角度：数字)：数字弧度(角度：vec2)：vec2弧度(角度：vec3)：vec3弧度(角度：vec4)：vec4



```

将角度从度数转换为弧度。

```js
{ "显示" ："弧度(${角度})> 0.5" }
   

```

#### 10.3.9.11.学位

```js
度(角度：数字)：数字度(角度：vec2)：vec2度(角度：vec3)：vec3度(角度：vec4)：vec4



```

将角度从弧度转换为度数。

```js
{ "显示" ："度数(${角度})> 45.0" }
   

```

#### 10.3.9.12.符号

```js
符号(x ：数字)：数字符号(x ：vec2)：vec2符号(x ：vec3)：vec3符号(x ：vec4)：vec4



```

当 x 为正时返回 1.0，当 x 为零时返回 0.0，当 x 为负时返回 -1.0。

```js
{ "显示" ："符号(${温度})*符号(${速度})=== 1.0" }
   

```

#### 10.3.9.13.地面

```js
floor ( x : Number ) : Number floor ( x : vec2 ) : vec2 floor ( x : vec3 ) : vec3 floor ( x : vec4 ) : vec4



```

返回小于或等于 x 的最接近的整数。

```js
{ "显示" ："楼层(${位置})=== 0" }
   

```

#### 10.3.9.14.天花板

```js
ceil (x ：Number)：数字ceil (x ：vec2)：vec2 ceil (x ：vec3)：vec3 ceil (x ：vec4)：vec4



```

返回大于或等于 x 的最接近的整数。

```js
{ "显示" ："天花板(${位置})=== 1" }
   

```

#### 10.3.9.15.圆形的

```js
回合(x ：数字)：数字回合(x ：vec2)：vec2回合(x ：vec3)：vec3回合(x ：vec4)：vec4



```

返回最接近 x 的整数。小数为 0.5 的数字将按实现定义的方向舍入。

```js
{ "显示" ："轮(${位置})=== 1" }
   

```

#### 10.3.9.16.exp

```js
exp (x ：数字)：数字exp (x ：vec2)：vec2 exp (x ：vec3)：vec3 exp (x ：vec4)：vec4



```

返回 e 的 x 次方，其中 e 是欧拉常数，大约为 2.71828。

```js
{ "显示" ："exp (${密度})> 1.0" }
   

```

#### 10.3.9.17.日志

```js
日志(x ：数字)：数字日志(x ：vec2)：vec2日志(x ：vec3)：vec3日志(x ：vec4)：vec4



```

返回 x 的自然对数(以 e 为底)。

```js
{ "显示" ："日志(${密度})> 1.0" }
   

```

#### 10.3.9.18.exp2

```js
exp2 ( x : Number ) : Number exp2 ( x : vec2 ) : vec2 exp2 ( x : vec3 ) : vec3 exp2 ( x : vec4 ) : vec4



```

返回 2 的 x 次方。

```js
{ "显示" ："exp2 (${密度})> 1.0" }
   

```

#### 10.3.9.19.log2

```js
log2 ( x : Number ) : Number log2 ( x : vec2 ) : vec2 log2 ( x : vec3 ) : vec3 log2 ( x : vec4 ) : vec4



```

返回 x 的以 2 为底的对数。

```js
{ "显示" ："log2 (${密度})> 1.0" }
   

```

#### 10.3.9.20.分形

```js
fract (x ：Number)：Number fract (x ：vec2)：vec2 fract (x ：vec3)：vec3 fract (x ：vec4)：vec4



```

返回 x 的小数部分。相当于 x — floor(x)。

```js
{ "颜色" ："颜色()*分形(${密度})" }
   

```

#### 10.3.9.21.战俘

```js
pow (底数：Number ，指数：Number)：数字pow (底数：vec2 ，指数：vec2)：vec2 pow (底数：vec3 ，指数：vec3)：vec3 pow (底数：vec4 ，指数：vec4)：vec4



```

返回 base 的 exponent 次方。

```js
{ "show" : "pow ( ${ Density }, ${ Temperature }) > 1.0" }
   

```

#### 10.3.9.22.分钟

```js
min ( x : Number , y : Number ) : Number min ( x : vec2 , y : vec2 ) : vec2 min ( x : vec3 , y : vec3 ) : vec3 min ( x : vec4 , y : vec4 ) : vec4



```

```js
min (x ：Number ，y ：Number)：Number min (x ：vec2 ，y ：Number)：vec2 min (x ：vec3 ，y ：Number)：vec3 min (x ：vec4 ，y ：Number)：vec4



```

返回 x 和 y 中较小的一个。

```js
{ "show" : "min ( ${ Width }, ${ Height }) > 10.0" }
   

```

#### 10.3.9.23.最大限度

```js
max (x ：Number ，y ：Number)：Number max (x ：vec2 ，y ：vec2)：vec2 max (x ：vec3 ，y ：vec3)：vec3 max (x ：vec4 ，y ：vec4)：vec4



```

```js
max (x ：Number ，y ：Number)：Number max (x ：vec2 ，y ：Number)：vec2 max (x ：vec3 ，y ：Number)：vec3 max (x ：vec4 ，y ：Number)：vec4



```

返回 x 和 y 中的较大者。

```js
{ "显示" ："最大(${宽度}，${高度})> 10.0" }
   

```

#### 10.3.9.24.夹钳

    clamp (x ：Number ，  min ：Number ，max ：Number)：Number clamp (x ：vec2 ，  min ：vec2 ，max ：vec2)：vec2 clamp (x ：vec3 ，  min ：vec3 ，max ：vec3)：vec3 clamp (x : vec4 ,


      最小值：vec4 ，最大值：vec4)：vec4



    clamp (x ：Number ，  min ：Number ，max ：Number)：Number clamp (x ：vec2 ，  min ：Number ，max ：Number)：vec2 clamp (x ：vec3 ，  min ：Number ，max ：Number)：vec3 clamp (x : vec4


    ,   min :数字, max :数字) : vec4

限制 x 位于 min 和 max 之间。

```js
{ "颜色" ："颜色()*钳位(${温度}，0.1，0.2)" }
   

```

#### 10.3.9.25.混合

    混合(x ：数字，  y ：数字，a ：数字)：数字混合(x ：vec2 ，  y ：vec2 ，a ：vec2)：vec2混合(x ：vec3 ，  y ：vec3 ，a ：vec3)：vec3混合(x : vec4 ,   y


    : vec4 ,一个: vec4 ) : vec4



    mix ( x : Number ,   y : Number , a : Number ) : Number mix ( x : vec2 ,   y : vec2 , a : Number ) : vec2 mix ( x : vec3 ,   y : vec3 , a : Number ) : vec3 mix ( x : vec4 ,   y


    : vec4 , a :数字) : vec4

计算 x 和 y 的线性插值。

```js
{ "显示" ："混合(20.0 ，${角度}，0.5)> 25.0" }
   

```

#### 10.3.9.26.长度

```js
长度(x ：数字)：数字长度(x ：vec2)：vec2长度(x ：vec3)：vec3长度(x ：vec4)：vec4



```

计算向量 x 的长度，即分量平方和的平方根。如果 x 是数字，则 length 返回 x。

```js
{ "显示" ："长度(${尺寸})> 10.0" }
   

```

#### 10.3.9.27.距离

```js
距离(x ：数字，y ：数字)：数字距离(x ：vec2 ，y ：vec2)：vec2距离(x ：vec3 ，y ：vec3)：vec3距离(x ：vec4 ，y ：vec4)：vec4



```

计算两点 x 和 y 之间的距离，即 length(x — y)。

```js
{ "显示" ："距离(${ BottomRight }，${ UpperLeft })> 50.0" }
   

```

#### 10.3.9.28.归一化

```js
标准化(x ：数字)：数字标准化(x ：vec2)：vec2标准化(x ：vec3)：vec3标准化(x ：vec4)：vec4



```

返回与 x 平行的长度为 1.0 的向量。当 x 是数字时，normalize 返回 1.0。

```js
{ "显示" ："归一化(${ RightVector }，${ UpVector })> 0.5" }
   

```

#### 10.3.9.29.点

```js
点(x ：数字，y ：数字)：数字点(x ：vec2 ，y ：vec2)：vec2点(x ：vec3 ，y ：vec3)：vec3点(x ：vec4 ，y ：vec4)：vec4



```

计算 x 和 y 的点积。

```js
{ "显示" ："点(${ RightVector }，${ UpVector })> 0.5" }
   

```

#### 10.3.9.30.叉

    交叉(x ：vec3 ，y ：vec3)：vec3

计算 x 和 y 的叉积。此函数仅接受 vec3 参数。

```js
{ "颜色" ："vec4 (交叉(${ RightVector }，${ UpVector })，1.0)" }
   

```

### 10.3.10.笔记

不支持评论。

## 10.4.  点云

点[云](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)是可以像其他要素一样设置样式的点的集合。除了评估点的颜色和显示属性外，点云样式还可以评估 pointSize 或每个点的大小(以像素为单位)。默认的 pointSize 是 1.0。

```js
{ "颜色" ："颜色('红色')"，"pointSize" ："${温度} * 0.5" }
   
   

```

实现可能会将评估的 pointSize 限制在系统支持的点大小范围内。例如，WebGL 渲染器可能会查询 ALIASED_POINT_SIZE_RANGE 以获取使用 POINTS 渲染时的系统限制。应支持 1.0 的 pointSize 。

点云样式还可以引用[要素表](https://portal.ogc.org/files/102132#tileformats-pointcloud-feature-table)中的语义，包括位置、颜色和法线，以允许对源数据进行更灵活的样式设置。

- \${POSITION}是一个 vec3，存储应用 RTC_CENTER 和 Tile 变换之前点的 xyz 笛卡尔坐标。当位置被量化时，\${POSITION}指的是应用 QUANTIZED_VOLUME_SCALE 之后但应用 QUANTIZED_VOLUME_OFFSET 之前的位置。
- \${POSITION_ABSOLUTE}是一个 vec3 ，存储应用 RTC_CENTER 和 Tile 变换后点的 xyz 笛卡尔坐标。当位置被量化时，\${POSITION_ABSOLUTE}指的是应用 QUANTIZED_VOLUME_SCALE、QUANTIZED_VOLUME_OFFSET 和 Tile 变换后的位置。
- \${COLOR}评估为 Color 存储点的 rgba 颜色。当 Feature 表的颜色语义为 RGB 或 RGB565 时，\${COLOR}.alpha 为 1.0。如果未定义颜色语义，则\${COLOR}计算为特定于应用程序的默认颜色。
- \${NORMAL}是一个 vec3，存储应用 Tile 变换之前点的笛卡尔坐标法线。当法线是 oct 编码时，\${NORMAL}指的是解码后的法线。如果 Feature 表中没有定义正常语义，则\${NORMAL} 的计算结果为 undefined。

例如：

```js
{ "color" ："${ COLOR } * color (' red ') '"，    "show"："${POSITION}.x > 0.5"，    "pointSize"："${NORMAL}.x > 0 ? 2 : 1" }
   



```

注意   点云样式引擎可能经常使用着色器 (GLSL) 实现，但是表达式语言的某些功能在纯 GLSL 实现中是不可能的。其中一些功能包括：

- isNaN 和 isFinite 的评估(GLSL 2.0+分别支持这些函数的 isnan 和 isinf)_ 类型 null 和 undefined<br/>_ 字符串，包括访问对象属性 ( color()\['r'] ) 和批处理表值<br/>_ 常用表达<br/>_ 长度不是 2、3 或 4 的数组
- 不匹配的类型比较(例如 1.0 === false)
- 数组索引越界

## 10.5.文件扩展名和媒体类型

Tileset 样式使用.json 扩展名和 application/json 媒体类型。

# **附件 A**(规范性)**属性参考**

========

## A.1.  资产

关于整个 tileset 的元数据。

表 A.1——资产属性

|                  | 类型                                                                 | 描述                                                                       | 必需的 |
| :--------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------- | :----- |
| **版本**         | string                                                               | 3D Tile 版本。该版本定义了 tileset JSON 的 JSON 模式和基本的 tile 格式集。 | ✓ 是   |
| **tileset 版本** | string                                                               | 此 tileset 的特定应用程序版本，例如，用于更新现有 tileset 时。             | 不     |
| **extensions**   | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                               | 不     |
| **extras**       | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                     | 不     |

- **允许附加属性。**
- **JSON 架构**：[asset.schema.json](https://portal.ogc.org/files/102132#reference-schema-asset)

### A.1.1.  资产版本

3D Tile 版本。该版本定义了 tileset JSON 的 JSON 模式和基本的 tile 格式集。

- **类型**：字符串
- **必须**：✓ 是

### A.1.2. asset.tileset 版本

此 tileset 的特定应用程序版本，例如，用于更新现有 tileset 时。

- **类型**：字符串
- **必须**：否

### A.1.3.  资产.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.1.4. asset.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A2.可用性

描述一组元素可用性的对象。

表 A.2——可用性属性

|                | 类型                                                                 | 描述                                                                                                                                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **比特流**     | 整数                                                                 | 指示每个元素是否可用的缓冲区视图的索引。比特流符合 3D 元数据规范中描述的布尔数组编码。如果一个元素可用，则其位为 1，如果不可用，则其位为 0。 | 不     |
| **可用计数**   | 整数                                                                 | 一个数字，指示可用性比特流中存在多少个 1 比特。                                                                                              | 不     |
| **持续的**     | 整数                                                                 | 指示是所有元素都可用 (1) 还是全部不可用 (0) 的整数。                                                                                         | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                       | 不     |

- **允许附加属性。**
- **JSON 架构**：[availability.schema.json](https://portal.ogc.org/files/102132#reference-schema-availability)

### A.2.1.  可用性.bitstream

指示每个元素是否可用的缓冲区视图的索引。比特流符合 3D 元数据规范中描述的布尔数组编码。如果一个元素可用，则其位为 1，如果不可用，则其位为 0。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.2.2.  可用性.availableCount

一个数字，指示可用性比特流中存在多少个 1 比特。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.2.3.  [可用性.常数](http://availability.constant/)

指示是所有元素都可用 (1) 还是全部不可用 (0) 的整数。

- **类型**：整数
- **必须**：否
- **允许值**：

  - 0 不可用
  - 1 个可用

### A.2.4.可用性.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.2.5.可用性.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.3.  批处理的 3D 模型 Feature 表

一组批处理 3D 模型语义，其中包含有关图块中要素的附加信息。

表 A.3 —批处理 3D 模型 Feature 表属性

|                  | 类型                                                                                                                                                 | 描述                                                                                                                    | 必需的 |
| :--------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------- | :----- |
| **BATCH_LENGTH** | [featureTable-定义-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)              | 定义所有要素的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。                        | ✓ 是   |
| **RTC\_中心**    | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **extensions**   | [extension](https://portal.ogc.org/files/102132#reference-extension)                                                                                 | 具有扩展特定对象的字典对象。                                                                                            | 不     |
| **extras**       | [extras](https://portal.ogc.org/files/102132#reference-extras)                                                                                       | 特定于应用程序的数据。                                                                                                  | 不     |

- **允许附加属性。**
- **JSON 架构**：[b3dm.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-b3dm-featuretable)

### A.3.1. b3dm.featureTable.BATCH_LENGTH

定义所有要素的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)
- **必须**：✓ 是

### A.3.2. b3dm.featureTable.RTC_CENTER

一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.3.3. b3dm.featureTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.3.4. b3dm.featureTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.4.  批处理表

一组属性，为图块中的要素定义特定于应用程序的元数据。

表 A.4 —批处理表属性

|                | 类型                                                                 | 描述                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------- | :----- |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。       | 不     |

- **允许附加属性。**
- **附加属性的类型**：[batchTable-definitions-property](https://portal.ogc.org/files/102132#reference-batchtable-definitions-property)
- **JSON 架构**：[batchTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-batchtable)

### A.4.1. batchTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.4.2. batchTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

### A.4.3.  **批处理表定义**

#### A.4.3.1.batchTable-定义-binaryBodyReference

如果未在 JSON 中直接定义，则定义对存储属性值的批处理表的二进制主体部分的引用的对象。

- **类型**：[根属性](https://portal.ogc.org/files/102132#reference-rootproperty)

表 A.5 — BinaryBodyReference 属性

|                | 类型                                                                 | 描述                             | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------- | :----- |
| **字节偏移量** | 整数                                                                 | 缓冲区中的偏移量(以字节为单位)。 | ✓ 是   |
| **组件类型**   | string                                                               | 属性中组件的数据类型。           | ✓ 是   |
| **类型**       | string                                                               | 指定属性是标量还是向量。         | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。     | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。           | 不     |

- **允许附加属性。**

#### A.4.3.2.batchTable-定义-binaryBodyReference.byteOffset

缓冲区中的偏移量(以字节为单位)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

#### A.4.3.3.  [batchTable-定义-binaryBodyReference.componentType](http://batchtable-definitions-binarybodyreference.componenttype/)

属性中组件的数据类型。

- **类型**：字符串
- **必须**：✓ 是
- **允许值**：

  - "字节"
  - "UNSIGNED_BYTE"
  - "短的"
  - "UNSIGNED_SHORT"
  - "情报"
  - "UNSIGNED_INT"
  - "漂浮"
  - "双倍的"

#### A.4.3.4.batchTable-definitions-binaryBodyReference.type

指定属性是标量还是向量。

- **类型**：字符串
- **必须**：✓ 是
- **允许值**：

  - "标量"
  - "VEC2"
  - "VEC3"
  - "VEC4"

#### A.4.3.5.batchTable-definitions-binaryBodyReference.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

#### A.4.3.6. batchTable-definitions-binaryBodyReference.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

#### A.4.3.7.batchTable-定义-属性

一个用户定义的属性，用于指定磁贴中每个功能的特定于应用程序的元数据。值可以直接在 JSON 中定义为数组，也可以使用 BinaryBodyReference 对象引用二进制主体中的部分。

- \*\*类型： \*\*[batchTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-batchtable-definitions-binarybodyreference)之一，数组
- **允许附加属性。**

## A.5.  边界体积

包围图块或其内容的边界体积。至少需要一个边界体积属性。边界体积包括 box、region 或 sphere。

表 A.6 —边界体积属性

|                | 类型                                                                 | 描述                                                                                                                                                                                                                                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **盒子**       | 数量  \[12]                                                          | 定义定向边界框的 12 个数字的数组。前三个元素定义框中心的 x、y 和 z 值。接下来的三个元素(索引为 3、4 和 5)定义了 x 轴方向和半长。接下来的三个元素(索引 6、7 和 8)定义了 y 轴方向和半长。最后三个元素(索引 9、10 和 11)定义了 z 轴方向和半长。 | 不     |
| **Region**     | 编号  \[6]                                                           | 定义 EPSG:4979 中边界地理区域的六个数字的数组，坐标顺序为 \[west, south, east, north, minimum height, maximum height]。经度和纬度以弧度为单位，高度以高于(或低于)WGS84 椭球的米为单位。                                                      | 不     |
| **Sphere**     | 编号  \[4]                                                           | 定义边界球体的四个数字的数组。前三个元素定义球体中心的 x、y 和 z 值。最后一个元素(索引为 3)定义了以米为单位的半径。                                                                                                                          | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                                                                                                                       | 不     |

- **允许附加属性。**
- **JSON 架构**：[boundingVolume.schema.json](https://portal.ogc.org/files/102132#reference-schema-boundingvolume)

### A.5.1.  包围盒.box

定义定向边界框的 12 个数字的数组。前三个元素定义框中心的 x、y 和 z 值。接下来的三个元素(索引为 3、4 和 5)定义了 x 轴方向和半长。接下来的三个元素(索引 6、7 和 8)定义了 y 轴方向和半长。最后三个元素(索引 9、10 和 11)定义了 z 轴方向和半长。

- **类型**：数字  \[12]
- **必须**：否

### A.5.2.边界体积.region

定义 EPSG:4979 中边界地理区域的六个数字的数组，坐标顺序为 \[west, south, east, north, minimum height, maximum height]。经度和纬度以弧度为单位，高度以高于(或低于)WGS84 椭球的米为单位。

- **类型**：数字  \[6]
- **必须**：否

### A.5.3. boundingVolume.sphere

定义边界球体的四个数字的数组。前三个元素定义球体中心的 x、y 和 z 值。最后一个元素(索引为 3)定义了以米为单位的半径。

- **类型**：数字  \[4]
- **必须**：否

### A.5.4.boundingVolume.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.5.5.boundingVolume.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.6.  缓冲

缓冲区是一个二进制 blob。它要么是子树文件的二进制块，要么是 URI 引用的外部缓冲区。

表 A.7 —缓冲区属性

|                | 类型                                                                 | 描述                                                                                                                                                                                                       | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **uri**        | string                                                               | 外部架构文件的 URI(或 IRI)。相对路径是相对于包含缓冲区 JSON 的文件的。uri 在使用 JSON 子树格式时是必需的，而在使用二进制子树格式时则不需要——当省略时，缓冲区指的是子树文件的二进制块。不允许使用数据 URI。 | 不     |
| **字节长度**   | 整数                                                                 | 缓冲区的长度(以字节为单位)。                                                                                                                                                                               | ✓ 是   |
| **name**       | string                                                               | 缓冲区的名称。                                                                                                                                                                                             | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                                                                               | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                                                                                     | 不     |

- **允许附加属性。**
- **JSON 架构**：[buffer.schema.json](https://portal.ogc.org/files/102132#reference-schema-buffer)

### A.6.1.  缓冲区.uri

外部架构文件的 URI(或 IRI)。相对路径是相对于包含缓冲区 JSON 的文件的。uri 在使用 JSON 子树格式时是必需的，而在使用二进制子树格式时则不需要——当省略时，缓冲区指的是子树文件的二进制块。不允许使用数据 URI。

- **类型**：字符串
- **必须**：否
- **格式**: iri-reference

### A.6.2.  缓冲区.byteLength

缓冲区的长度(以字节为单位)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 1

### A.6.3.  缓冲区名称

缓冲区的名称。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.6.4.缓冲.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.6.5.缓冲区.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.7.  缓冲区视图

缓冲区的连续子集

表 A.8 —缓冲区视图属性

|                | 类型                                                                 | 描述                             | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------- | :----- |
| **缓冲**       | 整数                                                                 | 缓冲区的索引。                   | ✓ 是   |
| **字节偏移量** | 整数                                                                 | 缓冲区中的偏移量(以字节为单位)。 | ✓ 是   |
| **字节长度**   | 整数                                                                 | 缓冲区视图的总字节长度。         | ✓ 是   |
| **name**       | string                                                               | 缓冲区视图的名称。               | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。     | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。           | 不     |

- **允许附加属性。**
- **JSON 架构**：[bufferView.schema.json](https://portal.ogc.org/files/102132#reference-schema-bufferview)

### A.7.1.  缓冲视图.buffer

缓冲区的索引。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

### A.7.2. bufferView\.byteOffset

缓冲区中的偏移量(以字节为单位)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

### A.7.3. bufferView.字节长度

缓冲区视图的总字节长度。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 1

### A.7.4.  缓冲区视图名称

缓冲区视图的名称。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.7.5. bufferView.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.7.6. bufferView\.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.8. Class

包含一组属性的类。

表 A.9 —类属性

|                 | 类型                                                                 | 描述                                                                                                                                            | 必需的 |
| :-------------- | :------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **name**        | string                                                               | 类的名称，例如用于显示 Object。                                                                                                                 | 不     |
| **description** | string                                                               | 类的描述。                                                                                                                                      | 不     |
| **properties**  | Object                                                               | 一个字典，其中每个键都是一个属性 ID，每个值都是一个定义属性的对象。属性 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。 | 不     |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                    | 不     |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                          | 不     |

- **允许附加属性。**
- **JSON 架构**：[class.schema.json](https://portal.ogc.org/files/102132#reference-schema-class)

### A.8.1. Class 名称

类的名称，例如用于显示 Object。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.8.2.  [类.描述](http://class.description/)

类的描述。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.8.3.  类.属性

一个字典，其中每个键都是一个属性 ID，每个值都是一个定义属性的对象。属性 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[class.property](https://portal.ogc.org/files/102132#reference-class-property)

### A.8.4.  类.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.8.5.  类.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.9.  类属性

元数据类的单个属性。

表 A.10 —类属性属性

|                 | 类型                                                                                                         | 描述                                                                                                                                                                                                                            | 必需的          |
| :-------------- | :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------------- |
| **name**        | string                                                                                                       | 属性的名称，例如用于显示 Object。                                                                                                                                                                                               | 不              |
| **description** | string                                                                                                       | 属性的描述。                                                                                                                                                                                                                    | 不              |
| **类型**        | string                                                                                                       | 元素类型。                                                                                                                                                                                                                      | ✓ 是            |
| **组件类型**    | string                                                                                                       | 元素组件的数据类型。仅适用于 SCALAR、VECN 和 MATN 类型。                                                                                                                                                                        | 不              |
| **枚举类型**    | string                                                                                                       | 枚举字典中声明的枚举 ID 。当类型为 ENUM 时是必需的。                                                                                                                                                                            | 不              |
| **大批**        | 布尔值                                                                                                       | 属性是否为数组。定义计数时，该属性是一个固定长度的数组。否则该属性是可变长度数组。                                                                                                                                              | 否，默认：false |
| **数数**        | 整数                                                                                                         | 数组元素的数量。只能在 array 为 true 时定义。                                                                                                                                                                                   | 不              |
| **归一化**      | 布尔值                                                                                                       | 指定是否规范化整数值。仅适用于具有整数组件类型的 SCALAR、VECN 和 MATN 类型。对于无符号整数组件类型，值在\[0.0, 1.0]之间进行归一化。对于有符号整数组件类型，值在\[-1.0, 1.0]之间标准化。对于所有其他组件类型，此属性应为 false。 | 否，默认：false |
| **抵消**        | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 应用于属性值的偏移量。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时，才适用于 SCALAR、VECN 和 MATN 类型。                                                                                                                  | 不              |
| **规模**        | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 应用于属性值的比例。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时，才适用于 SCALAR、VECN 和 MATN 类型。                                                                                                                    | 不              |
| **最大限度**    | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 属性的最大允许值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。                                                                                                 | 不              |
| **分钟**        | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 属性的最小允许值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。                                                                                         | 不              |
| **必需的**      | 布尔值                                                                                                       | 如果需要，该属性应存在于符合该类的每个实体中。如果不需要，单个实体可以包含 noData 值，或者可以省略整个属性。因此，noData 对必需的属性没有影响。客户端实现可以使用所需的属性来进行性能优化。                                     | 否，默认：false |
| **没有数据**    | [定义-定义-noDataValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-nodatavalue)   | noData 值代表缺失数据(也称为标记值)，无论它出现在哪里。BOOLEAN 属性不能指定 noData 值。这是作为普通属性值给出的，没有来自 normalized、offset 和 scale 属性的转换。如果 required 为真，则不应定义。                              | 不              |
| **默认**        | [定义-定义-anyValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-anyvalue)         | 遇到 noData 值或省略的属性时使用的默认值。该值以其最终形式给出，并考虑了 normalized、offset 和 scale 属性的影响。如果 required 为真，则不应定义。                                                                               | 不              |
| **语义的**      | string                                                                                                       | 描述应如何解释此属性的标识符。该语义不能被类中的其他属性使用。                                                                                                                                                                  | 不              |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension)                                         | 具有扩展特定对象的字典对象。                                                                                                                                                                                                    | 不              |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)                                               | 特定于应用程序的数据。                                                                                                                                                                                                          | 不              |

- **允许附加属性。**
- **JSON 架构**：[class.property.schema.json](https://portal.ogc.org/files/102132#reference-schema-class-property)

### A.9.1.  类.属性.名称

属性的名称，例如用于显示 Object。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.9.2.  [类.属性.描述](http://class.property.description/)

属性的描述。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.9.3.  类.属性.类型

元素类型。

- **类型**：字符串
- **必须**：✓ 是
- **允许值**：

  - "标量"
  - "VEC2"
  - "VEC3"
  - "VEC4"
  - "MAT2"
  - "MAT3"
  - "MAT4"
  - "string"
  - "布尔值"
  - "枚举"

### A.9.4.  [类.property.componentType](http://class.property.componenttype/)

元素组件的数据类型。仅适用于 SCALAR、VECN 和 MATN 类型。

- **类型**：字符串
- **必须**：否
- **允许值**：

  - "INT8"
  - "UINT8"
  - "INT16"
  - "UINT16"
  - "INT32"
  - "UINT32"
  - "INT64"
  - "UINT64"
  - "FLOAT32"
  - "浮动 64"

### A.9.5.  类.property.enumType

枚举字典中声明的枚举 ID 。当类型为 ENUM 时是必需的。

- **类型**：字符串
- **必须**：否

### A.9.6.  类.属性.array

属性是否为数组。定义计数时，该属性是一个固定长度的数组。否则该属性是可变长度数组。

- **类型**：布尔值
- **必需**：否，默认值：false

### A.9.7.  [类.property.count](http://class.property.count/)

数组元素的数量。只能在 array 为 true 时定义。

- **类型**：整数
- **必须**：否
- **最小值**：>= 2

### A.9.8.  [类.property.normalized](http://class.property.normalized/)

指定是否规范化整数值。仅适用于具有整数组件类型的 SCALAR、VECN 和 MATN 类型。对于无符号整数组件类型，值在\[0.0, 1.0]之间进行归一化。对于有符号整数组件类型，值在\[-1.0, 1.0]之间标准化。对于所有其他组件类型，此属性应为 false。

- **类型**：布尔值
- **必需**：否，默认值：false

### A.9.9.  类.property.offset

应用于属性值的偏移量。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时，才适用于 SCALAR、VECN 和 MATN 类型。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.9.10.  类.属性.规模

应用于属性值的比例。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时，才适用于 SCALAR、VECN 和 MATN 类型。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.9.11.类.property.max

属性的最大允许值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.9.12.类.property.min

属性的最小允许值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.9.13.  类.property.required

如果需要，该属性应存在于符合该类的每个实体中。如果不需要，单个实体可以包含 noData 值，或者可以省略整个属性。因此，noData 对必需的属性没有影响。客户端实现可以使用所需的属性来进行性能优化。

- **类型**：布尔值
- **必需**：否，默认值：false

### A.9.14.  [类.property.noData](http://class.property.nodata/)

noData 值代表缺失数据(也称为标记值)，无论它出现在哪里。BOOLEAN 属性不能指定 noData 值。这是作为普通属性值给出的，没有来自 normalized、offset 和 scale 属性的转换。如果 required 为真，则不应定义。

- **类型**：[定义-定义-noDataValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-nodatavalue)
- **必须**：否

### A.9.15.  [类.property.default](http://class.property.default/)

遇到 noData 值或省略的属性时使用的默认值。该值以其最终形式给出，并考虑了 normalized、offset 和 scale 属性的影响。如果 required 为真，则不应定义。

- **类型**：[定义-定义-anyValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-anyvalue)
- **必须**：否

### A.9.16.  [类.属性.语义](http://class.property.semantic/)

描述应如何解释此属性的标识符。该语义不能被类中的其他属性使用。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.9.17.  类.属性.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.9.18.类.property.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.10.  内容

有关磁贴内容的元数据和指向内容的链接。

表 A.11 —内容属性

|                    | 类型                                                                       | 描述                                                                                                                                                                                                         | 必需的 |
| :----------------- | :------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **boundingVolume** | [边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)   | 一个可选的边界体积，它紧紧地包围着图块内容。tile.boundingVolume 提供空间连贯性，而[tile.content.boundingVolume](http://tile.content.boundingvolume/)实现紧密的视锥体剔除。省略时，使用 tile.boundingVolume。 | 不     |
| **uri**            | string                                                                     | 指向磁贴内容的 uri。当 uri 是相对的时，它是相对于引用的 tileset JSON 文件的。                                                                                                                                | ✓ 是   |
| **metadata**       | [元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity) | 与此内容关联的元数据。                                                                                                                                                                                       | 不     |
| **group**          | 整数                                                                       | 此内容所属的组。该值是为包含 tileset 定义的组数组的索引。                                                                                                                                                    | 不     |
| **extensions**     | [extension](https://portal.ogc.org/files/102132#reference-extension)       | 具有扩展特定对象的字典对象。                                                                                                                                                                                 | 不     |
| **extras**         | [extras](https://portal.ogc.org/files/102132#reference-extras)             | 特定于应用程序的数据。                                                                                                                                                                                       | 不     |

- **允许附加属性。**
- **JSON 架构**：[content.schema.json](https://portal.ogc.org/files/102132#reference-schema-content)

### A.10.1. content.boundingVolume

一个可选的边界体积，它紧紧地包围着图块内容。tile.boundingVolume 提供空间连贯性，而[tile.content.boundingVolume](http://tile.content.boundingvolume/)实现紧密的视锥体剔除。省略时，使用 tile.boundingVolume。

- **类型**：[边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)
- **必须**：否
- **最小属性数**：1

### A.10.2.  内容.uri

指向磁贴内容的 uri。当 uri 是相对的时，它是相对于引用的 tileset JSON 文件的。

- **类型**：字符串
- **必须**：✓ 是

### A.10.3.  内容.元数据

与此内容关联的元数据。

- **类型**：[元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)
- **必须**：否

### A.10.4.  内容组

此内容所属的组。该值是为包含 tileset 定义的组数组的索引。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.10.5.内容.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.10.6.  内容.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.11.  定义

模式文件中使用的通用定义。

- **允许附加属性。**
- **JSON 模式**：[definitions.schema.json](https://portal.ogc.org/files/102132#reference-schema-definitions)

### A.11.1.  **定义定义**

#### A.11.1.1.定义-定义-numericArray1D

数值数组

- **类型**：数字  \[1-\*]
- **最少项目**：1
- **允许附加属性。**

#### A.11.1.2.定义-定义-numericArray2D

数值数组的数组

- **类型**：[定义-定义-numericArray1D](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericarray1d) \[1-\*]
- **最少项目**：1
- **允许附加属性。**

#### A.11.1.3.定义-定义-booleanArray1D

布尔值数组

- **类型**：布尔值  \[1-\*]
- **最少项目**：1
- **允许附加属性。**

#### A.11.1.4.定义-定义-stringArray1D

字符串值数组

- **类型**：字符串  \[1-\*]
- **最少项目**：1
- **允许附加属性。**

#### A.11.1.5.定义-定义-numericValue

对于 SCALAR，这是一个数字。对于 VECN，这是一个包含 N 个数字的数组。对于 MATN，这是一个 N² 数字数组。对于固定长度数组，这是给定类型的计数元素数组。

- \*\*类型： \*\*number、[definitions-definitions-numericArray1D](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericarray1d)、[definitions-definitions-numericArray2D](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericarray2d)之一
- **允许附加属性。**

#### A.11.1.6.定义-定义-noDataValue

对于 SCALAR，这是一个数字。对于 STRING，这是一个字符串。对于 ENUM，这是一个字符串，它应该是一个有效的枚举名称，而不是一个整数值。对于 VECN，这是一个包含 N 个数字的数组。对于 MATN，这是一个 N² 数字数组。对于固定长度数组，这是给定类型的计数元素数组。

- \*\*类型： \*\*[definitions-definitions-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)、string、[definitions-definitions-stringArray1D](https://portal.ogc.org/files/102132#reference-definitions-definitions-stringarray1d)之一
- **允许附加属性。**

#### A.11.1.7.定义-定义-anyValue

对于 SCALAR，这是一个数字。对于 STRING，这是一个字符串。对于 ENUM，这是一个字符串，它应该是一个有效的枚举名称，而不是一个整数值。对于 BOOLEAN，这是一个布尔值。对于 VECN，这是一个包含 N 个数字的数组。对于 MATN，这是一个 N² 数字数组。对于固定长度数组，这是给定类型的计数元素数组。对于可变长度数组，这是给定类型的任意长度的数组。

- \*\*类型： \*\*[definitions-definitions-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)、string、[definitions-definitions-stringArray1D](https://portal.ogc.org/files/102132#reference-definitions-definitions-stringarray1d)、boolean、[definitions-definitions-booleanArray1D](https://portal.ogc.org/files/102132#reference-definitions-definitions-booleanarray1d)之一
- **允许附加属性。**

## A.12.  枚举

定义枚举值的对象。

表 A.12 —枚举属性

|                 | 类型                                                                       | 描述                                         | 必需的             |
| :-------------- | :------------------------------------------------------------------------- | :------------------------------------------- | :----------------- |
| **name**        | string                                                                     | 枚举的名称，例如用于显示 Object。            | 不                 |
| **description** | string                                                                     | 枚举的描述。                                 | 不                 |
| **值类型**      | string                                                                     | 整数枚举值的类型。                           | 否，默认值：UINT16 |
| **values**      | [枚举值](https://portal.ogc.org/files/102132#reference-enum-value) \[1-\*] | 枚举值数组。不允许重复的名称或重复的整数值。 | ✓ 是               |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension)       | 具有扩展特定对象的字典对象。                 | 不                 |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)             | 特定于应用程序的数据。                       | 不                 |

- **允许附加属性。**
- **JSON 架构**：[enum.schema.json](https://portal.ogc.org/files/102132#reference-schema-enum)

### A.12.1.枚举名称

枚举的名称，例如用于显示 Object。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.12.2.  [枚举.描述](http://enum.description/)

枚举的描述。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.12.3.枚举值类型

整数枚举值的类型。

- **类型**：字符串
- **必需**：否，默认值：UINT16
- **允许值**：

  - "INT8"
  - "UINT8"
  - "INT16"
  - "UINT16"
  - "INT32"
  - "UINT32"
  - "INT64"
  - "UINT64"

### A.12.4.枚举值

枚举值数组。不允许重复的名称或重复的整数值。

- **类型**：[枚举值](https://portal.ogc.org/files/102132#reference-enum-value) \[1-\*]
- **必须**：✓ 是

### A.12.5.枚举.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.12.6.枚举.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.13.  枚举值

一个枚举值。

表 A.13 —枚举值属性

|                 | 类型                                                                 | 描述                         | 必需的 |
| :-------------- | :------------------------------------------------------------------- | :--------------------------- | :----- |
| **name**        | string                                                               | 枚举值的名称。               | ✓ 是   |
| **description** | string                                                               | 枚举值的描述 ​​。            | 不     |
| **价值**        | 整数                                                                 | 整数枚举值。                 | ✓ 是   |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。 | 不     |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。       | 不     |

- **允许附加属性。**
- **JSON 架构**：[enum.value.schema.json](https://portal.ogc.org/files/102132#reference-schema-enum-value)

### A.13.1.枚举值名称

枚举值的名称。

- **类型**：字符串
- **必须**：✓ 是
- **最小长度**：>= 1

### A.13.2.  [枚举值描述](http://enum.value.description/)

枚举值的描述 ​​。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.13.3.  枚举值

整数枚举值。

- **类型**：整数
- **必须**：✓ 是

### A.13.4.  枚举值扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.13.5.enum.value.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.14. Extension

具有扩展特定对象的字典对象。

- **允许附加属性。**
- **附加属性的类型**：对象
- **JSON 架构**：[extension.schema.json](https://portal.ogc.org/files/102132#reference-schema-extension)

## A.15.  附加功能

特定于应用程序的数据。

- **允许附加属性。**
- **JSON 架构**：[extras.schema.json](https://portal.ogc.org/files/102132#reference-schema-extras)

## A.16. Feature 表

一组语义，包含每个图块和每个 Feature 值，定义图块中 Feature 的位置和外观属性。

表 A.14 —Feature 表属性

|                | 类型                                                                 | 描述                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------- | :----- |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。       | 不     |

- **允许附加属性。**
- **附加属性的类型**：[featureTable-definitions-property](https://portal.ogc.org/files/102132#reference-featuretable-definitions-property)
- **JSON 架构**：[featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-featuretable)

### A.16.1. featureTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.16.2.featureTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

### A.16.3.  **Feature 表定义**

#### A.16.3.1.featureTable-定义-binaryBodyOffset

如果未在 JSON 中直接定义，则将偏移量定义到要素表的二进制主体的一部分中，属性值将存储在该部分中。

- **类型**：[根属性](https://portal.ogc.org/files/102132#reference-rootproperty)

表 A.15 — BinaryBodyOffset 属性

|                | 类型                                                                 | 描述                             | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------- | :----- |
| **字节偏移量** | 整数                                                                 | 缓冲区中的偏移量(以字节为单位)。 | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。     | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。           | 不     |

- **允许附加属性。**

#### A.16.3.2.featureTable-定义-binaryBodyOffset.byteOffset

缓冲区中的偏移量(以字节为单位)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

#### A.16.3.3.featureTable-definitions-binaryBodyOffset.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

#### A.16.3.4.featureTable-definitions-binaryBodyOffset.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

#### A.16.3.5.featureTable-definitions-binaryBodyReference

如果未在 JSON 中直接定义，则定义对存储属性值的 Feature 表的二进制主体部分的引用的对象。

- **类型**：[featureTable-definitions-binaryBodyOffset](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyoffset)

表 A.16 — BinaryBodyReference 属性

|                | 类型                                                                 | 描述                                                                                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------- | :----- |
| **组件类型**   | string                                                               | 属性中组件的数据类型。仅当语义允许覆盖隐式组件类型时才定义它。这些案例在每个图块格式中指定。 | 不     |
| **字节偏移量** | 整数                                                                 | 缓冲区中的偏移量(以字节为单位)。                                                             | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                       | 不     |

- **允许附加属性。**

#### A.16.3.6.  [featureTable-定义-binaryBodyReference.componentType](http://featuretable-definitions-binarybodyreference.componenttype/)

属性中组件的数据类型。仅当语义允许覆盖隐式组件类型时才定义它。这些案例在每个图块格式中指定。

- **类型**：字符串
- **必须**：否
- **允许值**：

  - "字节"
  - "UNSIGNED_BYTE"
  - "短的"
  - "UNSIGNED_SHORT"
  - "情报"
  - "UNSIGNED_INT"
  - "漂浮"
  - "双倍的"

#### A.16.3.7.featureTable-定义-binaryBodyReference.byteOffset

缓冲区中的偏移量(以字节为单位)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

#### A.16.3.8.featureTable-definitions-binaryBodyReference.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

#### A.16.3.9.featureTable-definitions-binaryBodyReference.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

#### A.16.3.10.Feature 表定义属性

一种用户定义的属性，用于指定磁贴中特定于应用程序的元数据。值可以使用 BinaryBodyReference 对象引用二进制主体中的部分。也可以直接在 JSON 中定义全局值。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)、[featureTable-definitions-globalPropertyBoolean](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyboolean)、[featureTable-definitions-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)、[featureTable-definitions-globalPropertyNumber](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertynumber)、[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)、[featureTable-definitions-globalPropertyCartesian4 之一](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian4)
- **允许附加属性。**

#### A.16.3.11.featureTable-定义-globalPropertyBoolean

为所有功能定义全局布尔属性值的对象。

- **类型**：布尔值
- **允许附加属性。**

#### A.16.3.12.featureTable-定义-globalPropertyInteger

为所有功能定义全局整数属性值的对象。

- \*\*类型： \*\*[featureTable-definitions-binaryBodyOffset](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyoffset)之一，整数
- **允许附加属性。**

#### A.16.3.13.featureTable-定义-globalPropertyNumber

为所有 Feature 定义全局数字属性值的对象。

- \*\*类型： \*\*[featureTable-definitions-binaryBodyOffset](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyoffset)之一，数字
- **允许附加属性。**

#### A.16.3.14.featureTable-definitions-globalPropertyCartesian3

为所有 Feature 定义全局 3 分量数字属性值的对象。

- \*\*类型： \*\*[featureTable-definitions-binaryBodyOffset](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyoffset)之一，数字  \[3]
- **允许附加属性。**

#### A.16.3.15.featureTable-definitions-globalPropertyCartesian4

为所有 Feature 定义全局 4 分量数字属性值的对象。

- \*\*类型： \*\*[featureTable-definitions-binaryBodyOffset](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyoffset)之一，数字  \[4]
- **允许附加属性。**

## A.17.  组元数据

包含有关组的元数据的对象。

表 A.17 —组元数据属性

|                | 类型                                                                 | 描述                                                                                                                                                                                                                                                                                                                                                      | 必需的 |
| :------------- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **class**      | string                                                               | 属性值符合的类。该值应是在元数据模式的类字典中声明的类 ID。                                                                                                                                                                                                                                                                                               | ✓ 是   |
| **properties** | Object                                                               | 一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都包含属性值。值的类型应与属性定义匹配：对于 BOOLEAN 使用 true 或 false。对于 STRING，使用 JSON 字符串。对于数字类型，使用 JSON 数字。对于 ENUM 使用有效的枚举名称，而不是整数值。对于 ARRAY、VECN 和 MATN 类型，使用包含与 componentType 匹配的值的 JSON 数组。必需的属性应包含在该词典中。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                                                                                                                              | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                                                                                                                                                                                                                                    | 不     |

- **允许附加属性。**
- **JSON 架构**：[group.schema.json](https://portal.ogc.org/files/102132#reference-schema-group)

### A.17.1.  组.类

属性值符合的类。该值应是在元数据模式的类字典中声明的类 ID。

- **类型**：字符串
- **必须**：✓ 是

### A.17.2.  组.properties

一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都包含属性值。值的类型应与属性定义匹配：对于 BOOLEAN 使用 true 或 false。对于 STRING，使用 JSON 字符串。对于数字类型，使用 JSON 数字。对于 ENUM 使用有效的枚举名称，而不是整数值。对于 ARRAY、VECN 和 MATN 类型，使用包含与 componentType 匹配的值的 JSON 数组。必需的属性应包含在该词典中。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[definitions-definitions-anyValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-anyvalue)

### A.17.3.  群组扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.17.4. group.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.18.  实例化 3D 模型 Feature 表

一组实例化 3D 模型语义，其中包含定义图块中实例化模型的位置和外观属性的值。

表 A.18 —实例化 3D 模型 Feature 表属性

|                             | 类型                                                                                                                                                 | 描述                                                                                                                    | 必需的 |
| :-------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------- | :----- |
| **位置**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **POSITION_QUANTIZED**      | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **NORMAL_UP**               | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **正常\_右**                | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **NORMAL_UP_OCT32P**        | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **NORMAL_RIGHT_OCT32P**     | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **规模**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **SCALE_NON_UNIFORM**       | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **批号**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。      | 不     |
| **INSTANCES_LENGTH**        | [featureTable-定义-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)              | 定义所有要素的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。                        | ✓ 是   |
| **RTC\_中心**               | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **QUANTIZED_VOLUME_OFFSET** | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **QUANTIZED_VOLUME_SCALE**  | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **EAST_NORTH_UP**           | [featureTable-定义-globalPropertyBoolean](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyboolean)              | 为所有功能定义布尔属性的 GlobalPropertyBoolean 对象。3D Tiles 规范中描述了有关此属性的详细信息。                        | 不     |
| **extensions**              | [extension](https://portal.ogc.org/files/102132#reference-extension)                                                                                 | 具有扩展特定对象的字典对象。                                                                                            | 不     |
| **extras**                  | [extras](https://portal.ogc.org/files/102132#reference-extras)                                                                                       | 特定于应用程序的数据。                                                                                                  | 不     |

- **允许附加属性。**
- **JSON 架构**：[i3dm.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-i3dm-featuretable)

### A.18.1.i3dm.featureTable.POSITION

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.2.i3dm.featureTable.POSITION_QUANTIZED

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.3.  [i3dm.featureTable.NORMAL_UP](http://i3dm.featuretable.normal_up/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.4.  [i3dm.featureTable.NORMAL_RIGHT](http://i3dm.featuretable.normal_right/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.5.  [i3dm.featureTable.NORMAL_UP_OCT32P](http://i3dm.featuretable.normal_up_oct32p/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.6.  [i3dm.featureTable.NORMAL_RIGHT_OCT32P](http://i3dm.featuretable.normal_right_oct32p/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.7.i3dm.featureTable.SCALE

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.8.i3dm.featureTable.SCALE_NON_UNIFORM

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.9. i3dm.featureTable.BATCH_ID

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.18.10.  [i3dm.featureTable.INSTANCES_LENGTH](http://i3dm.featuretable.instances_length/)

定义所有要素的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)
- **必须**：✓ 是

### A.18.11. i3dm.featureTable.RTC_CENTER

一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.18.12. i3dm.featureTable.QUANTIZED_VOLUME_OFFSET

一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.18.13. i3dm.featureTable.QUANTIZED_VOLUME_SCALE

一个 GlobalPropertyCartesian3 对象，为所有 Feature 定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.18.14. i3dm.featureTable.EAST_NORTH_UP

为所有功能定义布尔属性的 GlobalPropertyBoolean 对象。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyBoolean](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyboolean)
- **必须**：否

### A.18.15.i3dm.featureTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.18.16. i3dm.featureTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.19.  元数据实体

一个对象，包含对元数据模式中的类的引用，以及符合该类属性的属性值。

表 A.19 —元数据实体属性

|                | 类型                                                                 | 描述                                                                                                                                                                                                                                                                                                                                                      | 必需的 |
| :------------- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **class**      | string                                                               | 属性值符合的类。该值应是在元数据模式的类字典中声明的类 ID。                                                                                                                                                                                                                                                                                               | ✓ 是   |
| **properties** | Object                                                               | 一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都包含属性值。值的类型应与属性定义匹配：对于 BOOLEAN 使用 true 或 false。对于 STRING，使用 JSON 字符串。对于数字类型，使用 JSON 数字。对于 ENUM 使用有效的枚举名称，而不是整数值。对于 ARRAY、VECN 和 MATN 类型，使用包含与 componentType 匹配的值的 JSON 数组。必需的属性应包含在该词典中。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                                                                                                                              | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                                                                                                                                                                                                                                    | 不     |

- **允许附加属性。**
- **JSON 架构**：[metadataEntity.schema.json](https://portal.ogc.org/files/102132#reference-schema-metadataentity)

### A.19.1.  元数据实体类

属性值符合的类。该值应是在元数据模式的类字典中声明的类 ID。

- **类型**：字符串
- **必须**：✓ 是

### A.19.2.  元数据实体.properties

一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都包含属性值。值的类型应与属性定义匹配：对于 BOOLEAN 使用 true 或 false。对于 STRING，使用 JSON 字符串。对于数字类型，使用 JSON 数字。对于 ENUM 使用有效的枚举名称，而不是整数值。对于 ARRAY、VECN 和 MATN 类型，使用包含与 componentType 匹配的值的 JSON 数组。必需的属性应包含在该词典中。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[definitions-definitions-anyValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-anyvalue)

### A.19.3.  元数据实体.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.19.4. metadataEntity.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.20.  点云 Feature 表

一组点云语义，其中包含定义图块中点的位置和外观属性的值。

表 A.20 —点云 Feature 表属性

|                             | 类型                                                                                                                                                 | 描述                                                                                                               | 必需的 |
| :-------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------- | :----- |
| **位置**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **POSITION_QUANTIZED**      | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **RGBA**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **红绿蓝**                  | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **RGB565**                  | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **普通的**                  | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **正常\_OCT16P**            | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **批号**                    | [featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)           | 一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。 | 不     |
| **POINTS_LENGTH**           | [featureTable-定义-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)              | 定义所有点的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。                     | ✓ 是   |
| **RTC\_中心**               | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。   | 不     |
| **QUANTIZED_VOLUME_OFFSET** | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。   | 不     |
| **QUANTIZED_VOLUME_SCALE**  | [featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3) | 一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。   | 不     |
| **常数\_RGBA**              | [featureTable-definitions-globalPropertyCartesian4](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian4) | 一个 GlobalPropertyCartesian4 对象，为所有点定义一个 4 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。   | 不     |
| **BATCH_LENGTH**            | [featureTable-定义-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)              | 定义所有点的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。                     | 不     |
| **extensions**              | [extension](https://portal.ogc.org/files/102132#reference-extension)                                                                                 | 具有扩展特定对象的字典对象。                                                                                       | 不     |
| **extras**                  | [extras](https://portal.ogc.org/files/102132#reference-extras)                                                                                       | 特定于应用程序的数据。                                                                                             | 不     |

- **允许附加属性。**
- **JSON 架构**：[pnts.featureTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-pnts-featuretable)

### A.20.1.pnts.featureTable.POSITION

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.2.pnts.featureTable.POSITION_QUANTIZED

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.3. pnts.featureTable.RGBA

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.4.pnts.featureTable.RGB

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.5.pnts.featureTable.RGB565

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.6.  [pnts.featureTable.NORMAL](http://pnts.featuretable.normal/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.7.  [pnts.featureTable.NORMAL_OCT16P](http://pnts.featuretable.normal_oct16p/)

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.8.pnts.featureTable.BATCH_ID

一个 BinaryBodyReference 对象，定义对存储属性值的二进制主体部分的引用。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-binaryBodyReference](https://portal.ogc.org/files/102132#reference-featuretable-definitions-binarybodyreference)
- **必须**：否

### A.20.9.pnts.featureTable.POINTS_LENGTH

定义所有点的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)
- **必须**：✓ 是

### A.20.10.pnts.featureTable.RTC_CENTER

一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.20.11. pnts.featureTable.QUANTIZED_VOLUME_OFFSET

一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.20.12. pnts.featureTable.QUANTIZED_VOLUME_SCALE

一个 GlobalPropertyCartesian3 对象，为所有点定义一个 3 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian3](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian3)
- **必须**：否

### A.20.13.  [pnts.featureTable.CONSTANT_RGBA](http://pnts.featuretable.constant_rgba/)

一个 GlobalPropertyCartesian4 对象，为所有点定义一个 4 分量数字属性。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyCartesian4](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertycartesian4)
- **必须**：否

### A.20.14. pnts.featureTable.BATCH_LENGTH

定义所有点的整数属性的 GlobalPropertyInteger 对象。3D Tiles 规范中描述了有关此属性的详细信息。

- **类型**：[featureTable-definitions-globalPropertyInteger](https://portal.ogc.org/files/102132#reference-featuretable-definitions-globalpropertyinteger)
- **必须**：否

### A.20.15.pnts.featureTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.20.16. pnts.featureTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.21. properties

关于每个 Feature 属性的元数据的字典对象。

表 A.21 -属性属性

|                | 类型                                                                 | 描述                               | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------------- | :----- |
| **最大限度**   | 数字                                                                 | 瓦片集中所有要素的此属性的最大值。 | ✓ 是   |
| **最低限度**   | 数字                                                                 | 瓦片集中所有要素的此属性的最小值。 | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。       | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。             | 不     |

- **允许附加属性。**
- **JSON 架构**：[properties.schema.json](https://portal.ogc.org/files/102132#reference-schema-properties)

### A.21.1.属性.maximum

瓦片集中所有要素的此属性的最大值。

- **类型**：数字
- **必须**：✓ 是

### A.21.2.属性.minimum

瓦片集中所有要素的此属性的最小值。

- **类型**：数字
- **必须**：✓ 是

### A.21.3.属性.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.21.4.属性.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.22.  属性表

符合类的属性，组织为存储在二进制列数组中的属性值。

表 A.22 —属性表属性

|                | 类型                                                                 | 描述                                                                                                                        | 必需的 |
| :------------- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------- | :----- |
| **name**       | string                                                               | 属性表的名称，例如用于显示 Object。                                                                                         | 不     |
| **class**      | string                                                               | 属性值符合的类。该值应是类字典中声明的类 ID。                                                                               | ✓ 是   |
| **数数**       | 整数                                                                 | 每个属性数组中的元素数。                                                                                                    | ✓ 是   |
| **properties** | Object                                                               | 一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都是一个描述属性值存储位置的对象。必需的属性应包含在该词典中。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                      | 不     |

- **允许附加属性。**
- **JSON 架构**：[propertyTable.schema.json](https://portal.ogc.org/files/102132#reference-schema-propertytable)

### A.22.1.属性表.name

属性表的名称，例如用于显示 Object。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.22.2.属性表.class

属性值符合的类。该值应是类字典中声明的类 ID。

- **类型**：字符串
- **必须**：✓ 是

### A.22.3.  [属性表.count](http://propertytable.count/)

每个属性数组中的元素数。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 1

### A.22.4.属性表.properties

一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值都是一个描述属性值存储位置的对象。必需的属性应包含在该词典中。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[propertyTable.property](https://portal.ogc.org/files/102132#reference-propertytable-property)

### A.22.5.propertyTable.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.22.6.propertyTable.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.23.  属性表属性

二进制属性值数组。这表示属性表的一列，并包含每个元数据实体的某个属性的一个值。

表 A.23 —属性表属性

|                      | 类型                                                                                                         | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 必需的             |
| :------------------- | :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :----------------- |
| **values**           | 整数                                                                                                         | 包含属性值的缓冲区视图的索引。属性值的数据类型由属性定义决定：当类型为 BOOLEAN 时，值被打包到比特流中。当类型为 STRING 时，值存储为字节序列并解码为 UTF-8 字符串。当类型为 SCALAR、VECN 或 MATN 时，值存储为提供的 componentType 并且缓冲区视图 byteOffset 应与 componentType 大小的倍数对齐。当类型为 ENUM 时，值存储为枚举的 valueType 和缓冲区视图 byteOffset 应与 valueType 大小的倍数对齐。数组中的每个枚举值都应与枚举定义中允许的值之一相匹配。arrayOffsets 是可变长度数组所必需的，stringOffsets 是字符串所必需的(对于可变长度字符串数组，两者都是必需的)。 | ✓ 是               |
| **数组偏移量**       | 整数                                                                                                         | 包含可变长度数组偏移量的缓冲区视图的索引。偏移量的数量等于属性表计数加一。偏移量表示每个数组的起始位置，最后一个偏移量表示最后一个数组之后的位置。使用后续偏移量和当前偏移量之间的差值计算数组长度。如果类型为 STRING，则偏移量索引到字符串偏移量数组(存储在 stringOffsets 中)，否则它们索引到属性数组(存储在 values 中)。这些偏移量的数据类型由 arrayOffsetType 确定。缓冲区视图 byteOffset 应对齐到 arrayOffsetType 大小。                                                                                                                                        | 不                 |
| **字符串偏移量**     | 整数                                                                                                         | 包含字符串偏移量的缓冲区视图的索引。偏移量的数量等于字符串元素的数量加一。偏移量表示属性数组(存储在 values 中)中每个字符串的字节偏移量，最后一个偏移量表示最后一个字符串之后的字节偏移量。使用后续偏移量和当前偏移量之间的差异计算字符串字节长度。这些偏移量的数据类型由 stringOffsetType 确定。缓冲区视图 byteOffset 应与 stringOffsetType 大小的倍数对齐。                                                                                                                                                                                                        | 不                 |
| **arrayOffset 类型** | string                                                                                                       | arrayOffsets 中值的类型。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 否，默认值：UINT32 |
| **字符串偏移类型**   | string                                                                                                       | stringOffsets 中值的类型。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 否，默认值：UINT32 |
| **抵消**             | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 应用于属性值的偏移量。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时适用。如果两者都已定义，则覆盖类属性的偏移量。                                                                                                                                                                                                                                                                                                                                                                                                                                              | 不                 |
| **规模**             | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 应用于属性值的比例。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时适用。如果两者都已定义，则覆盖类属性的比例。                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 不                 |
| **最大限度**         | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 属性值中存在的最大值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。                                                                                                                                                                                                                                                                                                                                                                                                                                 | 不                 |
| **分钟**             | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | 属性值中存在的最小值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。                                                                                                                                                                                                                                                                                                                                                                                                                         | 不                 |
| **extensions**       | [extension](https://portal.ogc.org/files/102132#reference-extension)                                         | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 不                 |
| **extras**           | [extras](https://portal.ogc.org/files/102132#reference-extras)                                               | 特定于应用程序的数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 不                 |

- **允许附加属性。**
- **JSON 架构**：[propertyTable.property.schema.json](https://portal.ogc.org/files/102132#reference-schema-propertytable-property)

### A.23.1.属性表.属性.值

包含属性值的缓冲区视图的索引。属性值的数据类型由属性定义决定：当类型为 BOOLEAN 时，值被打包到比特流中。当类型为 STRING 时，值存储为字节序列并解码为 UTF-8 字符串。当类型为 SCALAR、VECN 或 MATN 时，值存储为提供的 componentType 并且缓冲区视图 byteOffset 应与 componentType 大小的倍数对齐。当类型为 ENUM 时，值存储为枚举的 valueType 和缓冲区视图 byteOffset 应与 valueType 大小的倍数对齐。数组中的每个枚举值都应与枚举定义中允许的值之一相匹配。arrayOffsets 是可变长度数组所必需的，stringOffsets 是字符串所必需的(对于可变长度字符串数组，两者都是必需的)。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 0

### A.23.2.propertyTable.property.arrayOffsets

包含可变长度数组偏移量的缓冲区视图的索引。偏移量的数量等于属性表计数加一。偏移量表示每个数组的起始位置，最后一个偏移量表示最后一个数组之后的位置。使用后续偏移量和当前偏移量之间的差值计算数组长度。如果类型为 STRING，则偏移量索引到字符串偏移量数组(存储在 stringOffsets 中)，否则它们索引到属性数组(存储在 values 中)。这些偏移量的数据类型由 arrayOffsetType 确定。缓冲区视图 byteOffset 应对齐到 arrayOffsetType 大小。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.23.3.propertyTable.property.stringOffsets

包含字符串偏移量的缓冲区视图的索引。偏移量的数量等于字符串元素的数量加一。偏移量表示属性数组(存储在 values 中)中每个字符串的字节偏移量，最后一个偏移量表示最后一个字符串之后的字节偏移量。使用后续偏移量和当前偏移量之间的差异计算字符串字节长度。这些偏移量的数据类型由 stringOffsetType 确定。缓冲区视图 byteOffset 应与 stringOffsetType 大小的倍数对齐。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.23.4.propertyTable.property.arrayOffsetType

arrayOffsets 中值的类型。

- **类型**：字符串
- **必需**：否，默认值：UINT32
- **允许值**：

  - "UINT8"
  - "UINT16"
  - "UINT32"
  - "UINT64"

### A.23.5.propertyTable.property.stringOffsetType

stringOffsets 中值的类型。

- **类型**：字符串
- **必需**：否，默认值：UINT32
- **允许值**：

  - "UINT8"
  - "UINT16"
  - "UINT32"
  - "UINT64"

### A.23.6.propertyTable.property.offset

应用于属性值的偏移量。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时适用。如果两者都已定义，则覆盖类属性的偏移量。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.23.7.propertyTable.property.scale

应用于属性值的比例。仅当组件类型为 FLOAT32 或 FLOAT64 或属性已规范化时适用。如果两者都已定义，则覆盖类属性的比例。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.23.8.属性表.property.max

属性值中存在的最大值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.23.9.属性表.property.min

属性值中存在的最小值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.23.10.propertyTable.property.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.23.11.propertyTable.property.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.24.  根属性

存储扩展和额外内容的基础。

表 A.24 —根属性

|                | 类型                                                                 | 描述                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------- | :----- |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。       | 不     |

- **允许附加属性。**
- **JSON 架构**：[rootProperty.schema.json](https://portal.ogc.org/files/102132#reference-schema-rootproperty)

### A.24.1.rootProperty.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.24.2.rootProperty.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.25.  图式

定义类和枚举的对象。

表 A.25 —模式属性

|                 | 类型                                                                 | 描述                                                                                                                                              | 必需的 |
| :-------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :----- |
| **ID**          | string                                                               | 架构的唯一标识符。架构 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。                                                    | ✓ 是   |
| **name**        | string                                                               | 模式的名称，例如用于显示 Object。                                                                                                                 | 不     |
| **description** | string                                                               | 模式的描述。                                                                                                                                      | 不     |
| **版本**        | string                                                               | 特定于应用程序的模式版本。                                                                                                                        | 不     |
| **类**          | Object                                                               | 一个字典，其中每个键都是一个类 ID，每个值都是一个定义类的对象。类 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。         | 不     |
| **枚举**        | Object                                                               | 一个字典，其中每个键都是一个枚举 ID，每个值都是一个定义枚举值的对象。枚举 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。 | 不     |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                      | 不     |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                            | 不     |

- **允许附加属性。**
- **JSON 模式**：[schema.schema.json](https://portal.ogc.org/files/102132#reference-schema-schema)

### A.25.1.模式.id

架构的唯一标识符。架构 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。

- **类型**：字符串
- **必须**：✓ 是
- **模式**：^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$

### A.25.2.架构名称

模式的名称，例如用于显示 Object。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.25.3.  [架构.描述](http://schema.description/)

模式的描述。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.25.4.模式.version

特定于应用程序的模式版本。

- **类型**：字符串
- **必须**：否
- **最小长度**：>= 1

### A.25.5.模式.类

一个字典，其中每个键都是一个类 ID，每个值都是一个定义类的对象。类 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[类](https://portal.ogc.org/files/102132#reference-class)

### A.25.6.架构.枚举

一个字典，其中每个键都是一个枚举 ID，每个值都是一个定义枚举值的对象。枚举 ID 应是与正则表达式^\[a-zA-Z\_]\[a-zA-Z0-9\_]\*\$匹配的字母数字标识符。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[枚举](https://portal.ogc.org/files/102132#reference-enum)

### A.25.7.架构.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.25.8.模式.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.26.  统计数据

有关实体的统计信息。

表 A.26 -统计属性

|                | 类型                                                                 | 描述                                                                                            | 必需的 |
| :------------- | :------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------- | :----- |
| **类**         | Object                                                               | 字典，其中每个键对应于类字典中的类 ID，每个值是一个对象，其中包含有关符合该类的实体的统计信息。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                    | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                          | 不     |

- **允许附加属性。**
- **JSON 架构**：[statistics.schema.json](https://portal.ogc.org/files/102132#reference-schema-statistics)

### A.26.1.统计类

字典，其中每个键对应于类字典中的类 ID，每个值是一个对象，其中包含有关符合该类的实体的统计信息。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[statistics.class](https://portal.ogc.org/files/102132#reference-statistics-class)

### A.26.2.统计.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.26.3.统计.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.27. Class 统计

有关符合类的实体的统计信息。

表 A.27 —类统计属性

|                | 类型                                                                 | 描述                                                                                          | 必需的 |
| :------------- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------- | :----- |
| **数数**       | 整数                                                                 | 符合类别的实体数。                                                                            | 不     |
| **properties** | Object                                                               | 一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值是一个包含属性值统计信息的对象。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                  | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                        | 不     |

- **允许附加属性。**
- **JSON 架构**：[statistics.class.schema.json](https://portal.ogc.org/files/102132#reference-schema-statistics-class)

### A.27.1.  [统计.class.count](http://statistics.class.count/)

符合类别的实体数。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.27.2.统计.class.properties

一个字典，其中每个键对应于类的属性字典中的一个属性 ID，每个值是一个包含属性值统计信息的对象。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：[statistics.class.property](https://portal.ogc.org/files/102132#reference-statistics-class-property)

### A.27.3.统计.class.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.27.4.statistics.class.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.28.  财产统计

有关属性值的统计信息。

表 A.28 —属性统计属性

|                | 类型                                                                                                         | 描述                                                                                                                                              | 必需的 |
| :------------- | :----------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------ | :----- |
| **分钟**       | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的最小属性值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。 | 不     |
| **最大限度**   | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的最大属性值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。         | 不     |
| **意思是**     | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的属性值的算术平均值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的平均值。 | 不     |
| **中位数**     | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的属性值的中值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的中值。         | 不     |
| **标准差**     | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的属性值的标准偏差。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的标准差。   | 不     |
| **方差**       | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的属性值的方差。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的方差。         | 不     |
| **和**         | [定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue) | tileset 中出现的属性值的总和。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的总和。         | 不     |
| **事件**       | Object                                                                                                       | 一个字典，其中每个键对应一个枚举名称，每个值是该枚举的出现次数。仅当类型为 ENUM 时适用。对于固定长度的数组，这是一个按组件出现的数组。            | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension)                                         | 具有扩展特定对象的字典对象。                                                                                                                      | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)                                               | 特定于应用程序的数据。                                                                                                                            | 不     |

- **允许附加属性。**
- **JSON 架构**：[statistics.class.property.schema.json](https://portal.ogc.org/files/102132#reference-schema-statistics-class-property)

### A.28.1.statistics.class.property.min

tileset 中出现的最小属性值。仅适用于 SCALAR、VECN 和 MATN 类型。在应用基于 normalized、offset 和 scale 属性的转换之后，这是所有属性值中的最小值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.2.统计.class.property.max

tileset 中出现的最大属性值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的最大值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.3.统计.class.property.mean

tileset 中出现的属性值的算术平均值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的平均值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.4.statistics.class.property.median

tileset 中出现的属性值的中值。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的中值。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.5.statistics.class.property.standardDeviation

tileset 中出现的属性值的标准偏差。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的标准差。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.6.统计.class.property.variance

tileset 中出现的属性值的方差。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的方差。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.7.统计.class.property.sum

tileset 中出现的属性值的总和。仅适用于 SCALAR、VECN 和 MATN 类型。这是应用基于 normalized、offset 和 scale 属性的转换后所有属性值的总和。

- **类型**：[定义-定义-numericValue](https://portal.ogc.org/files/102132#reference-definitions-definitions-numericvalue)
- **必须**：否

### A.28.8.statistics.class.property.occurrences

一个字典，其中每个键对应一个枚举名称，每个值是该枚举的出现次数。仅当类型为 ENUM 时适用。对于固定长度的数组，这是一个按组件出现的数组。

- **类型**：对象
- **必须**：否
- **最小属性数**：1
- **允许附加属性。**
- **每个属性的类型**：整数

### A.28.9.统计.class.property.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.28.10.statistics.class.property.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.29.  风格

3D Tile 风格。

表 A.29 —样式属性

|                | 类型                                                                                                                                                | 描述                                                                                                                                   | 必需的                     |
| :------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------- | :------------------------- |
| **定义**       | Object                                                                                                                                              | 映射到可在整个样式中引用的变量名称键的表达式字符串的字典对象。如果一个表达式引用了一个已定义的变量，它将被替换为相应表达式的计算结果。 | 不                         |
| **展示**       | [style.booleanExpression](https://portal.ogc.org/files/102132#reference-style-booleanexpression) , [style.conditions](http://style.conditions/)之一 | 一个布尔表达式或条件属性，用于确定是否应显示某个功能。                                                                                 | 否，默认值：true           |
| **颜色**       | [style.colorExpression](http://style.colorexpression/) , [style.conditions](http://style.conditions/)之一                                           | 颜色表达式或条件属性，用于确定与要素的固有颜色混合的颜色。                                                                             | 否，默认：color('#FFFFFF') |
| **元**         | [样式.meta](https://portal.ogc.org/files/102132#reference-style-meta)                                                                               | 确定要素的非视觉属性值的元对象。                                                                                                       | 不                         |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension)                                                                                | 具有扩展特定对象的字典对象。                                                                                                           | 不                         |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)                                                                                      | 特定于应用程序的数据。                                                                                                                 | 不                         |

- **允许附加属性。**
- **JSON 架构**：[style.schema.json](https://portal.ogc.org/files/102132#reference-schema-style)

### A.29.1.  [风格.定义](http://style.defines/)

映射到可在整个样式中引用的变量名称键的表达式字符串的字典对象。如果一个表达式引用了一个已定义的变量，它将被替换为相应表达式的计算结果。

- **类型**：对象
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：[style.expression](https://portal.ogc.org/files/102132#reference-style-expression)

### A.29.2.样式.show

一个布尔表达式或条件属性，用于确定是否应显示某个功能。

- **类型**：其中一种[style.booleanExpression](https://portal.ogc.org/files/102132#reference-style-booleanexpression) , [style.conditions](http://style.conditions/)
- **必需**：否，默认值：true

### A.29.3.  [样式.颜色](http://style.color/)

颜色表达式或条件属性，用于确定与要素的固有颜色混合的颜色。

- **类型**：其中一种[style.colorExpression](http://style.colorexpression/)，[style.conditions](http://style.conditions/)
- **必需**：否，默认值：color('#FFFFFF')

### A.29.4.样式.meta

确定要素的非视觉属性值的元对象。

- **类型**：[style.meta](https://portal.ogc.org/files/102132#reference-style-meta)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：[style.expression](https://portal.ogc.org/files/102132#reference-style-expression)

### A.29.5.样式.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.29.6.  样式.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.30.  布尔表达式

具有计算结果为布尔值的 3D Tiles 样式表达式的布尔值或字符串。详细信息在 3D Tiles Styling 规范中进行了描述。

- **允许附加属性。**
- **JSON 架构**：[style.booleanExpression.schema.json](https://portal.ogc.org/files/102132#reference-schema-style-booleanexpression)

## A.31.  色彩表达

计算结果为 Color 的 3D Tiles 样式表达式。详细信息在 3D Tiles Styling 规范中进行了描述。

- **允许附加属性。**
- **JSON 模式**：[style.colorExpression.schema.json](http://style.colorexpression.schema.json/)

## A.32.  状况

按顺序计算的一系列条件，例如一系列 if...else 语句，这些语句导致表达式被计算。

表 A.30——条件属性

|                | 类型                                                                 | 描述                                                                                                                                                                                                                        | 必需的 |
| :------------- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **状况**       | [样式.条件.条件](http://style.conditions.condition/) \[]             | 按顺序评估的一系列布尔条件。对于第一个计算结果为 true 的，计算并返回其值"结果"(也是一个表达式)。结果表达式都应是同一类型。如果没有条件计算为真，则结果为 undefined。当条件为 undefined、null 或空对象时，结果为 undefined。 | 不     |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                                                                                                                                | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                                                                                                                                      | 不     |

- **允许附加属性。**
- **JSON 模式**：[style.conditions.schema.json](http://style.conditions.schema.json/)

### A.32.1.  [样式.条件.条件](http://style.conditions.conditions/)

按顺序评估的一系列布尔条件。对于第一个计算结果为 true 的，计算并返回其值"结果"(也是一个表达式)。结果表达式都应是同一类型。如果没有条件计算为真，则结果为 undefined。当条件为 undefined、null 或空对象时，结果为 undefined。

- **类型**: [style.conditions.condition](http://style.conditions.condition/) \[]
- **必须**：否

### A.32.2.  [样式.条件.扩展](http://style.conditions.extensions/)

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.32.3.  [style.conditions.extras](http://style.conditions.extras/)

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.33.  健康)状况

作为条件为真的结果评估的表达式。两个表达式的数组。如果对第一个表达式求值且结果为 true，则对第二个表达式求值并作为条件结果返回。

- **允许附加属性。**
- **JSON 模式**：[style.conditions.condition.schema.json](http://style.conditions.condition.schema.json/)

## A.34.  表达

有效的 3D Tiles 样式表达式。详细信息在 3D Tiles Styling 规范中进行了描述。

- **允许附加属性。**
- **JSON 模式**：[style.expression.schema.json](https://portal.ogc.org/files/102132#reference-schema-style-expression)

## A.35.元

一系列属性名称和用于计算该属性值的表达式。

表 A.31——元属性

|                | 类型                                                                 | 描述                         | 必需的 |
| :------------- | :------------------------------------------------------------------- | :--------------------------- | :----- |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。 | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。       | 不     |

- **允许附加属性。**
- **附加属性的类型**：[style.expression](https://portal.ogc.org/files/102132#reference-style-expression)
- **JSON 架构**：[style.meta.schema.json](https://portal.ogc.org/files/102132#reference-schema-style-meta)

### A.35.1.样式.元.扩展

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.35.2.style.meta.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.36.  子树

描述子树中图块和内容的可用性以及子树的可用性的对象。还可以存储可用图块和内容的元数据。

表 A.32 —子树属性

|                 | 类型                                                                           | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 必需的 |
| :-------------- | :----------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **缓冲器**      | [缓冲区](https://portal.ogc.org/files/102132#reference-buffer) \[1-\*]         | 缓冲区数组。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 不     |
| **缓冲区视图**  | [缓冲区视图](https://portal.ogc.org/files/102132#reference-bufferview) \[1-\*] | 缓冲区视图数组。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 不     |
| **属性表**      | [属性表](https://portal.ogc.org/files/102132#reference-propertytable) \[1-\*]  | 一组属性表。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 不     |
| **Tile 可用性** | [可用性](https://portal.ogc.org/files/102132#reference-availability)           | 子树中磁贴的可用性。可用性比特流是一个一维布尔数组，其中图块按其在子树中的级别和该级别内的 Morton 索引排序。瓦片的可用性由一位确定，1 表示该空间索引处存在瓦片，0 表示不存在。数组中的元素数是(N^subtreeLevels — 1)/(N — 1)，其中 N 是 4 用于细分方案 QUADTREE 和 8 用于 OCTREE。可用性可以存储在缓冲区视图中或作为适用于所有图块的常量值。如果非根瓦片的可用性为 1，则其父瓦片的可用性也应为 1。tileAvailability.constant [:](http://tileavailability.constant/) 0 是不允许的，因为子树应至少有一个瓦片。 | ✓ 是   |
| **内容可用性**  | [可用性](https://portal.ogc.org/files/102132#reference-availability) \[1-\*]   | 一组内容可用性对象。如果图块只有一个内容，则此数组将有一个元素；如果 tile 有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——这个数组将有多个元素。                                                                                                                                                                                                                                                                                                                                          | 不     |
| **子树可用性**  | [可用性](https://portal.ogc.org/files/102132#reference-availability)           | 子树的可用性。可用性比特流是一个一维布尔数组，其中子树按其在子树底行正下方的树级别中的 Morton 索引排序。子树的可用性由一位决定，1 表示该空间索引处存在子树，0 表示不存在。数组中的元素数量是 N^subtreeLevels，其中 N 是 4 对于细分方案 QUADTREE 和 8 对于 OCTREE。可用性可以存储在缓冲区视图中或作为适用于所有子树的常量值。如果所有子树的可用性为 0，则 tileset 不会进一步细分。                                                                                                                          | ✓ 是   |
| **图块元数据**  | 整数                                                                           | 包含图块元数据的属性表的索引。瓦片元数据仅存在于可用瓦片中，并通过增加瓦片索引来紧密打包。为了访问单个图块元数据，实现可以创建从图块索引到图块元数据索引的映射。                                                                                                                                                                                                                                                                                                                                           | 不     |
| **内容元数据**  | 整数  \[1-\*]                                                                  | 包含内容元数据的属性表的索引数组。如果图块只有一个内容，则此数组将有一个元素；如果 tile 有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——这个数组将有多个元素。内容元数据仅存在于可用内容中，并通过增加 tile 索引进行紧密打包。为了访问单独的内容元数据，实现可以创建从图块索引到内容元数据索引的映射。                                                                                                                                                                                    | 不     |
| **子树元数据**  | [元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)     | 以 JSON 编码的子树元数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 不     |
| **extensions**  | [extension](https://portal.ogc.org/files/102132#reference-extension)           | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 不     |
| **extras**      | [extras](https://portal.ogc.org/files/102132#reference-extras)                 | 特定于应用程序的数据。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 不     |

- **允许附加属性。**
- **JSON 架构**：[subtree.schema.json](https://portal.ogc.org/files/102132#reference-schema-subtree)

### A.36.1.子树缓冲区

缓冲区数组。

- **类型**：[缓冲区](https://portal.ogc.org/files/102132#reference-buffer) \[1-\*]
- **必须**：否

### A.36.2.子树.bufferViews

缓冲区视图数组。

- **类型**：[缓冲视图](https://portal.ogc.org/files/102132#reference-bufferview) \[1-\*]
- **必须**：否

### A.36.3.子树.propertyTables

一组属性表。

- **类型**：[属性表](https://portal.ogc.org/files/102132#reference-propertytable) \[1-\*]
- **必须**：否

### A.36.4.subtree.tileAvailability

子树中磁贴的可用性。可用性比特流是一个一维布尔数组，其中图块按其在子树中的级别和该级别内的 Morton 索引排序。瓦片的可用性由一位确定，1 表示该空间索引处存在瓦片，0 表示不存在。数组中的元素数是(N^subtreeLevels — 1)/(N — 1)，其中 N 是 4 用于细分方案 QUADTREE 和 8 用于 OCTREE。可用性可以存储在缓冲区视图中或作为适用于所有图块的常量值。如果非根瓦片的可用性为 1，则其父瓦片的可用性也应为 1。tileAvailability.constant [:](http://tileavailability.constant/) 0 是不允许的，因为子树应至少有一个瓦片。

- **类型**：[可用性](https://portal.ogc.org/files/102132#reference-availability)
- **必须**：✓ 是

### A.36.5.  [subtree.contentAvailability](http://subtree.contentavailability/)

一组内容可用性对象。如果图块只有一个内容，则此数组将有一个元素；如果 tile 有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——这个数组将有多个元素。

- **类型**：[可用性](https://portal.ogc.org/files/102132#reference-availability) \[1-\*]
- **必须**：否

### A.36.6.  [subtree.childSubtreeAvailability](http://subtree.childsubtreeavailability/)

子树的可用性。可用性比特流是一个一维布尔数组，其中子树按其在子树底行正下方的树级别中的 Morton 索引排序。子树的可用性由一位决定，1 表示该空间索引处存在子树，0 表示不存在。数组中的元素数量是 N^subtreeLevels，其中 N 是 4 对于细分方案 QUADTREE 和 8 对于 OCTREE。可用性可以存储在缓冲区视图中或作为适用于所有子树的常量值。如果所有子树的可用性为 0，则 tileset 不会进一步细分。

- **类型**：[可用性](https://portal.ogc.org/files/102132#reference-availability)
- **必须**：✓ 是

### A.36.7.subtree.tileMetadata

包含图块元数据的属性表的索引。瓦片元数据仅存在于可用瓦片中，并通过增加瓦片索引来紧密打包。为了访问单个图块元数据，实现可以创建从图块索引到图块元数据索引的映射。

- **类型**：整数
- **必须**：否
- **最小值**：>= 0

### A.36.8.  [子树.contentMetadata](http://subtree.contentmetadata/)

包含内容元数据的属性表的索引数组。如果图块只有一个内容，则此数组将有一个元素；如果 tile 有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——这个数组将有多个元素。内容元数据仅存在于可用内容中，并通过增加 tile 索引进行紧密打包。为了访问单独的内容元数据，实现可以创建从图块索引到内容元数据索引的映射。

- **类型**：整数  \[1-\*]

  - 数组中的每个元素都应大于或等于 0。

- **必须**：否

### A.36.9.subtree.subtreeMetadata

以 JSON 编码的子树元数据。

- **类型**：[元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)
- **必须**：否

### A.36.10.子树.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.36.11.子树.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.37.  子树

描述子树文件位置的对象。

表 A.33 —子树属性

|                | 类型                                                                  | 描述                                                                                                                                                                                                        | 必需的 |
| :------------- | :-------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----- |
| **uri**        | [模板 Uri](https://portal.ogc.org/files/102132#reference-templateuri) | 指向子树文件的模板 URI。子树是树的固定深度(由 subtreeLevels 定义)部分，以限制内存使用。每个文件的 URI 被替换为子树根的全局级别、x 和 y。对于细分方案 OCTREE，还应给出 z。相对路径是相对于 tileset JSON 的。 | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension)  | 具有扩展特定对象的字典对象。                                                                                                                                                                                | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)        | 特定于应用程序的数据。                                                                                                                                                                                      | 不     |

- **允许附加属性。**
- **JSON 架构**：[subtrees.schema.json](https://portal.ogc.org/files/102132#reference-schema-subtrees)

### A.37.1.子树.uri

指向子树文件的模板 URI。子树是树的固定深度(由 subtreeLevels 定义)部分，以限制内存使用。每个文件的 URI 被替换为子树根的全局级别、x 和 y。对于细分方案 OCTREE，还应给出 z。相对路径是相对于 tileset JSON 的。

- **类型**：[templateUri](https://portal.ogc.org/files/102132#reference-templateuri)
- **必须**：✓ 是

### A.37.2.子树.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.37.3.子树.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.38.  模板 URI

一个带有嵌入式表达式的 URI，用于描述与隐式瓦片集中的隐式瓦片关联的资源。允许的表达式是{level}、{x}、{y}和{z}。{level}代入节点的层级，{x}代入层级内节点的 x 索引，{y}代入层内节点的 y 索引。{z}只能在细分方案为 OCTREE 时给出，并替换为级别内节点的 z 索引。

- **允许附加属性。**
- **JSON 架构**：[templateUri.schema.json](https://portal.ogc.org/files/102132#reference-schema-templateuri)

## A.39.  瓦

3D Tiles 瓦片集中的瓦片。

表 A.34 —拼贴属性

|                         | 类型                                                                                     | 描述                                                                                                                                                                                                                                                                                                                                                                          | 必需的                                       |
| :---------------------- | :--------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------- |
| **boundingVolume**      | [边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)                 | 包围图块的边界体积。                                                                                                                                                                                                                                                                                                                                                          | ✓ 是                                         |
| **viewerRequestVolume** | [边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)                 | 可选的边界体积，它定义了在请求图块内容之前以及根据几何错误优化图块之前查看者应位于其中的体积。                                                                                                                                                                                                                                                                                | 不                                           |
| **几何误差**            | 数字                                                                                     | 如果渲染此图块而其子项未呈现，则会引入以米为单位的错误。在运行时，几何误差用于计算屏幕空间误差 (SSE)，即以像素为单位测量的误差。                                                                                                                                                                                                                                              | ✓ 是                                         |
| **提炼**                | string                                                                                   | 指定在遍历 tileset 进行渲染时是否使用附加或替换细化。这个属性对于 tileset 的根 tile 是必需的；它对于所有其他图块都是可选的。默认是从父 tile 继承。                                                                                                                                                                                                                            | 不                                           |
| **转换**                | 编号  \[16]                                                                              | 一个浮点 4×4 仿射变换矩阵，以列优先顺序存储，将图块的内容——即它的 Feature 以及 content.boundingVolume、boundingVolume 和 viewerRequestVolume——从图块的局部坐标系转换到父瓦片的坐标系，或者，在根瓦片的情况下，从瓦片的局部坐标系到瓦片集的坐标系。当体积是在 EPSG:4979 坐标中定义的区域时，变换不适用于任何体积属性。transform 通过矩阵中的最大缩放因子缩放 geometricError 。 | 否，默认：\[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1] |
| **内容**                | [内容](https://portal.ogc.org/files/102132#reference-content)                            | 有关磁贴内容的元数据和指向内容的链接。当省略时，瓦片仅用于剔除。当它被定义时，内容将是未定义的。                                                                                                                                                                                                                                                                              | 不                                           |
| **内容**                | [内容](https://portal.ogc.org/files/102132#reference-content) \[1-\*]                    | 内容数组。当它被定义时，内容将是未定义的。                                                                                                                                                                                                                                                                                                                                    | 不                                           |
| **metadata**            | [元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)               | 与此磁贴关联的元数据实体。                                                                                                                                                                                                                                                                                                                                                    | 不                                           |
| **隐式 Tile**           | [tile.implicitTiling](https://portal.ogc.org/files/102132#reference-tile-implicittiling) | 描述此图块的隐式细分的对象。                                                                                                                                                                                                                                                                                                                                                  | 不                                           |
| **孩子们**              | [Tile](https://portal.ogc.org/files/102132#reference-tile) \[1-\*]                       | 定义子图块的对象数组。每个子图块内容都被其父图块的边界体积完全包围，并且通常具有小于其父图块的几何误差的几何误差。对于叶瓦片，此数组的长度为零，并且可能未定义子级。                                                                                                                                                                                                          | 不                                           |
| **extensions**          | [extension](https://portal.ogc.org/files/102132#reference-extension)                     | 具有扩展特定对象的字典对象。                                                                                                                                                                                                                                                                                                                                                  | 不                                           |
| **extras**              | [extras](https://portal.ogc.org/files/102132#reference-extras)                           | 特定于应用程序的数据。                                                                                                                                                                                                                                                                                                                                                        | 不                                           |

- **允许附加属性。**
- **JSON 架构**：[tile.schema.json](https://portal.ogc.org/files/102132#reference-schema-tile)

### A.39.1.tile.boundingVolume

包围图块的边界体积。

- **类型**：[边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)
- **必须**：✓ 是
- **最小属性数**：1

### A.39.2.tile.viewerRequestVolume

可选的边界体积，它定义了在请求图块内容之前以及根据几何错误优化图块之前查看者应位于其中的体积。

- **类型**：[边界体积](https://portal.ogc.org/files/102132#reference-boundingvolume)
- **必须**：否
- **最小属性数**：1

### A.39.3.tile.geometricError

如果渲染此图块而其子项未呈现，则会引入以米为单位的错误。在运行时，几何误差用于计算屏幕空间误差 (SSE)，即以像素为单位测量的误差。

- **类型**：数字
- **必须**：✓ 是
- **最小值**：>= 0

### A.39.4.tile.refine

指定在遍历 tileset 进行渲染时是否使用附加或替换细化。这个属性对于 tileset 的根 tile 是必需的；它对于所有其他图块都是可选的。默认是从父 tile 继承。

- **类型**：字符串
- **必须**：否
- **允许值**：

  - "添加"
  - "代替"

### A.39.5.tile.transform

一个浮点 4×4 仿射变换矩阵，以列优先顺序存储，将图块的内容——即它的 Feature 以及 content.boundingVolume、boundingVolume 和 viewerRequestVolume——从图块的局部坐标系转换到父瓦片的坐标系，或者，在根瓦片的情况下，从瓦片的局部坐标系到瓦片集的坐标系。当体积是在 EPSG:4979 坐标中定义的区域时，变换不适用于任何体积属性。transform 通过矩阵中的最大缩放因子缩放 geometricError 。

- **类型**：数字  \[16]
- **必填**：否，默认：\[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]

### A.39.6.  [图块内容](http://tile.content/)

有关磁贴内容的元数据和指向内容的链接。当省略时，瓦片仅用于剔除。当它被定义时，内容将是未定义的。

- **类型**：[内容](https://portal.ogc.org/files/102132#reference-content)
- **必须**：否

### A.39.7.  [tile.contents](http://tile.contents/)

内容数组。当它被定义时，内容将是未定义的。

- **类型**：[内容](https://portal.ogc.org/files/102132#reference-content) \[1-\*]
- **必须**：否

### A.39.8.图块元数据

与此磁贴关联的元数据实体。

- **类型**：[元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)
- **必须**：否

### A.39.9.tile.implicitTiling

描述此图块的隐式细分的对象。

- **类型**：[tile.implicitTiling](https://portal.ogc.org/files/102132#reference-tile-implicittiling)
- **必须**：否

### A.39.10.  [tile.children](http://tile.children/)

定义子图块的对象数组。每个子图块内容都被其父图块的边界体积完全包围，并且通常具有小于其父图块的几何误差的几何误差。对于叶瓦片，此数组的长度为零，并且可能未定义子级。

- **类型**：[Tile](https://portal.ogc.org/files/102132#reference-tile) \[1-\*]

  - 数组中的每个元素都应是唯一的。

- **必须**：否

### A.39.11.tile.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.39.12.tile.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.40.  隐式 Tile

该对象允许对图块进行隐式细分。磁贴和内容可用性以及元数据存储在外部引用的子树中。

表 A.35——隐式 Tile 属性

|                | 类型                                                                 | 描述                                                                                                           | 必需的 |
| :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------- | :----- |
| **细分方案**   | string                                                               | 描述 tileset 中使用的细分方案的字符串。                                                                        | ✓ 是   |
| **子树级别**   | 整数                                                                 | 每个子树中不同级别的数量。例如，subtreeLevels = 2 的四叉树将具有包含 5 个节点(一个根节点和 4 个子节点)的子树。 | ✓ 是   |
| **可用级别**   | 整数                                                                 | 树中可用图块的层数。                                                                                           | ✓ 是   |
| **子树**       | [子树](https://portal.ogc.org/files/102132#reference-subtrees)       | 描述子树文件位置的对象。                                                                                       | ✓ 是   |
| **extensions** | [extension](https://portal.ogc.org/files/102132#reference-extension) | 具有扩展特定对象的字典对象。                                                                                   | 不     |
| **extras**     | [extras](https://portal.ogc.org/files/102132#reference-extras)       | 特定于应用程序的数据。                                                                                         | 不     |

- **允许附加属性。**
- **JSON 架构**：[tile.implicitTiling.schema.json](https://portal.ogc.org/files/102132#reference-schema-tile-implicittiling)

### A.40.1.tile.implicitTiling.subdivisionScheme

描述 tileset 中使用的细分方案的字符串。

- **类型**：字符串
- **必须**：✓ 是
- **允许值**：

  - "四叉树"
  - "八叉树"

### A.40.2.tile.implicitTiling.subtreeLevels

每个子树中不同级别的数量。例如，subtreeLevels = 2 的四叉树将具有包含 5 个节点(一个根节点和 4 个子节点)的子树。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 1

### A.40.3.tile.implicitTiling.availableLevels

树中可用图块的层数。

- **类型**：整数
- **必须**：✓ 是
- **最小值**：>= 1

### A.40.4.tile.implicitTiling.subtrees

描述子树文件位置的对象。

- **类型**：[子树](https://portal.ogc.org/files/102132#reference-subtrees)
- **必须**：✓ 是

### A.40.5.tile.implicitTiling.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.40.6.tile.implicitTiling.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

## A.41.  瓦片集

一个 3D Tiles Tile 集。

表 A.36 — Tileset 属性

|                     | 类型                                                                       | 描述                                                                                                                     | 必需的 |
| :------------------ | :------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :----- |
| **资产**            | [资产](https://portal.ogc.org/files/102132#reference-asset)                | 关于整个 tileset 的元数据。                                                                                              | ✓ 是   |
| **properties**      | Object                                                                     | 关于每个 Feature 属性的元数据的字典对象。                                                                                | 不     |
| **图式**            | [图式](https://portal.ogc.org/files/102132#reference-schema)               | 定义元数据类和枚举结构的对象。当它被定义时，schemaUri 应该是未定义的。                                                   | 不     |
| **架构 Uri**        | string                                                                     | 外部架构文件的 URI(或 IRI)。当它被定义时，模式应该是未定义的。                                                           | 不     |
| **统计数据**        | [统计数据](https://portal.ogc.org/files/102132#reference-statistics)       | 包含有关元数据实体的统计信息的对象。                                                                                     | 不     |
| **group**           | [组](https://portal.ogc.org/files/102132#reference-group) \[1-\*]          | 图块内容可能属于的一组数组。该数组的每个元素都是一个描述组的元数据实体。图块内容组属性是此数组的索引。                   | 不     |
| **metadata**        | [元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity) | 与此 tileset 关联的元数据实体。                                                                                          | 不     |
| **几何误差**        | 数字                                                                       | 如果未渲染此 tileset，则会引入以米为单位的错误。在运行时，几何误差用于计算屏幕空间误差 (SSE)，即以像素为单位测量的误差。 | ✓ 是   |
| **根**              | [瓦](https://portal.ogc.org/files/102132#reference-tile)                   | 根瓦片。                                                                                                                 | ✓ 是   |
| **扩展使用**        | 字符串  \[1-\*]                                                            | 此 tileset 中某处使用的 3D Tiles 扩展的名称。                                                                            | 不     |
| **extensions 必填** | 字符串  \[1-\*]                                                            | 正确加载此 tileset 所需的 3D Tiles 扩展的名称。                                                                          | 不     |
| **extensions**      | [extension](https://portal.ogc.org/files/102132#reference-extension)       | 具有扩展特定对象的字典对象。                                                                                             | 不     |
| **extras**          | [extras](https://portal.ogc.org/files/102132#reference-extras)             | 特定于应用程序的数据。                                                                                                   | 不     |

- **允许附加属性。**
- **JSON 架构**：[tileset.schema.json](https://portal.ogc.org/files/102132#reference-schema-tileset)

### A.41.1.tileset.asset

关于整个 tileset 的元数据。

- **类型**：[资产](https://portal.ogc.org/files/102132#reference-asset)
- **必须**：✓ 是

### A.41.2.tileset.properties

关于每个 Feature 属性的元数据的字典对象。

- **类型**：对象
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：[属性](https://portal.ogc.org/files/102132#reference-properties)

### A.41.3.tileset.schema

定义元数据类和枚举结构的对象。当它被定义时，schemaUri 应该是未定义的。

- **类型**：[架构](https://portal.ogc.org/files/102132#reference-schema)
- **必须**：否

### A.41.4.tileset.schemaUri

外部架构文件的 URI(或 IRI)。当它被定义时，模式应该是未定义的。

- **类型**：字符串
- **必须**：否
- **格式**: iri-reference

### A.41.5.tileset.statistics

包含有关元数据实体的统计信息的对象。

- **类型**：[统计](https://portal.ogc.org/files/102132#reference-statistics)
- **必须**：否

### A.41.6.tileset.groups

图块内容可能属于的一组数组。该数组的每个元素都是一个描述组的元数据实体。图块内容组属性是此数组的索引。

- **类型**：[组](https://portal.ogc.org/files/102132#reference-group) \[1-\*]
- **必须**：否

### A.41.7.tileset.metadata

与此 tileset 关联的元数据实体。

- **类型**：[元数据实体](https://portal.ogc.org/files/102132#reference-metadataentity)
- **必须**：否

### A.41.8.tileset.geometricError

如果未渲染此 tileset，则会引入以米为单位的错误。在运行时，几何误差用于计算屏幕空间误差 (SSE)，即以像素为单位测量的误差。

- **类型**：数字
- **必须**：✓ 是
- **最小值**：>= 0

### A.41.9.tileset.root

根瓦片。

- **类型**:[Tile](https://portal.ogc.org/files/102132#reference-tile)
- **必须**：✓ 是

### A.41.10.tileset.extensionsUsed

此 tileset 中某处使用的 3D Tiles 扩展的名称。

- **类型**：字符串  \[1-\*]

  - 数组中的每个元素都应是唯一的。

- **必须**：否

### A.41.11.tileset.extensionsRequired

正确加载此 tileset 所需的 3D Tiles 扩展的名称。

- **类型**：字符串  \[1-\*]

  - 数组中的每个元素都应是唯一的。

- **必须**：否

### A.41.12.tileset.extensions

具有扩展特定对象的字典对象。

- **类型**：[扩展](https://portal.ogc.org/files/102132#reference-extension)
- **必须**：否
- **允许附加属性。**
- **每个属性的类型**：对象

### A.41.13.tileset.extras

特定于应用程序的数据。

- **类型**：[extras](https://portal.ogc.org/files/102132#reference-extras)
- **必须**：否

# **附件 B**(资料性)**JSON SCHEMA 参考**

==================

## B.1.  资产的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："asset.schema.json" ，"title" ："资产" ，"$ref " : "rootProperty.schema.json" , "description" : "关于整个 tileset 的元数据。" , "properties" : { "version" : { "type" : "string" , "description" : "3D Tiles 版本。
   
   
   
   
   
   
       
           
           
       
        : { "type" : "string" , "description" : "此 tileset 的应用程序特定版本，例如，用于更新现有 tileset 时。" } }，"必需" ：[ "版本" ] }
           
           
       
   
   
       
   

```

## B.2.  可用性的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："availability.schema.json" ，"title" ："可用性" ，"$ref " : "rootProperty.schema.json" , "description" : "描述一组元素可用性的对象。" , "属性" ：{ "比特流" ：{ "描述" ：
   
   
   
   
   
   
       
             "指示每个元素是否可用的缓冲区视图的索引。比特流符合 3D 元数据规范中描述的布尔数组编码。如果元素可用，则其位为 1，如果不可用，其位为 0" , "type" : "integer" , "minimum" : 0 }, "availableCount" : { "description" : "一个数字，表示可用性比特流中存在多少个 1 比特。" , "type" : "integer" , "minimum" : 0 }, "constant" :
           
           
       
       
           
           
           
       
       
             "表示所有元素可用 (1) 还是全部不可用 (0) 的整数。" ，"anyOf" ：[ { "常量" ：0 ，"描述" ："不可用" ，"类型" ："整数" }，{ "常量" ：1 ，"描述" ："可用" ，"类型" ："整数" }, { "类型" : "整数" } ] } }, "
           
               
                   
                   
                   
               
               
                   
                   
                   
               
               
                   
               
           
       
   
   
       
           
                "比特流" ] }，{ "必需" ：[ "常量" ] }} ] }
           
       
       
           
               
           
       
   

```

## B.3.  批量 3D 模型 Feature 表的 JSON 模式

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "b3dm.featureTable.schema.json" , "title" : "批处理 3D 模型FeatureTable" , "$ref" : "featureTable.schema.json" , "description" : "一组批处理 3D 模型语义，其中包含有关图块中要素的附加信息。" ，"弃用" ：真，"属性" ：{ "BATCH_LENGTH" ：{ "
   
   
   
   
   
   
   
       
             , "description" : "一个 `GlobalPropertyInteger` 对象，为所有Feature定义一个整数属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" }, "RTC_CENTER" : { "$ref" : "featureTable.schema.json#/definitions/globalPropertyCartesian3" , "description" : "一个 `GlobalPropertyCartesian3` 对象，为所有Feature定义一个 3 分量数字属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" } }, "必需" ：[ "BATCH_LENGTH" ] }
           
       
       
           
           
       
   
   
       
   

```

## B.4.  批处理表的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："batchTable.schema.json" ，"title" ："批处理表" ，"$ ref" : "rootProperty.schema.json" , "description" : "一组属性，为磁贴中的功能定义特定于应用程序的元数据。" , "已弃用" : true , "additionalProperties" : { "$ref" : "#/definitions/property" }, "
   
   
   
   
   
   
   
       
   
   
         { "title" : "BinaryBodyReference" , "$ref" : "rootProperty.schema.json" , "description" : "定义对存储属性值的批处理表的二进制主体部分的引用的对象没有直接在 JSON 中定义。" , "properties" : { "byteOffset" : { "type" : "integer" , "description" : "以字节为单位的缓冲区偏移量。, "最低" : 0 }, "
           
           
           
           
               
                   
                   
                   
               
               
                     "属性中组件的数据类型。" ，"anyOf" ：[ { "const" ："BYTE" }，{ "const" ："UNSIGNED_BYTE" }，{ "const" ："SHORT" }，{ "const" ："UNSIGNED_SHORT" }，{ "const" ："INT" }，{ "常量" ："UNSIGNED_INT" }，{ "常量" ："FLOAT" }，{ "
                   
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                             "string" } ] }, "type" : { "description" : "指定属性是标量还是向量。" ，"anyOf" ：[ { "const" ："SCALAR" }，{ "const" ："VEC2" }，{ "const" ："VEC3" }，{ "const" ："VEC4" }，{ "类型" ："字符串" } ] } }，"必需"
                       
                   
               
               
                   
                   
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                   
               
           
           
               
                , "type" ] }, "property" : { "title" : "Property" , "description" : "一个用户定义的属性，它在图块中指定每个功能特定于应用程序的元数据。值可以直接在JSON 作为数组，或者可以使用 `BinaryBodyReference` 对象引用二进制主体中的部分。" , "oneOf" : [ { "$ref" : "#/definitions/binaryBodyReference" }, { "type" : "array" } ] } } }
               
           
       
       
           
           
           
               
                   
               
               
                   
               
           
       
   

```

## B.5.  边界体积的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："boundingVolume.schema.json" ，"title" ："包围卷" ，"$ ref" : "rootProperty.schema.json" , "description" : "包围图块或其内容的包围体。至少需要一个包围体属性。包围体包括 `box`、`region` 或 `sphere `。，"minProperties" ：1 ，"属性" ：{ "框" ：
   
   
   
   
   
   
   
       
           
            "description" : "一个包含 12 个数字的数组，用于定义定向边界框。前三个元素定义框中心的 x、y 和 z 值。接下来的三个元素(索引为 3、4 和 5 )定义x轴方向和半长。接下来的三个元素(索引6、7和8)定义y轴方向和半长。最后三个元素(索引9、10和11)定义z轴向和半长。" ，"项目" ：{ "类型" ："数字" }，"minItems" ：12 ，"maxItems" ：12 }，"区域" ：{ "
           
               
           
           
           
       
       
           
            "description" : "一个包含六个数字的数组，定义了 EPSG:4979 中的边界地理区域，坐标顺序为 [west, south, east, north, minimum height, maximum height]。经度和纬度以弧度为单位，高度为在 WGS84 椭球上方(或下方)以米为单位。" , "items" : { "type" : "number" }, "minItems" : 6 , "maxItems" : 6 }, "sphere" : { "type" : "array" , "description" :
           
               
           
           
           
       
       
           
             "定义边界球体的四个数字数组。前三个元素定义球体中心的 x、y 和 z 值。最后一个元素(索引为 3)定义以米为单位的半径。" , "items" : { "type" : "number" }, "minItems" : 4 , "maxItems" : 4 } } }
           
               
           
           
           
       
   

```

## B.6.  缓冲区的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："buffer.schema.json" ，"title" ："Buffer" ，"$ref " : "rootProperty.schema.json" , "description" : "缓冲区是二进制 blob。它可以是子树文件的二进制块，也可以是 URI 引用的外部缓冲区。" ，"属性" ：{ "uri" ：{ "类型" ："字符串" ，"描述"
   
   
   
   
   
   
       
           
             "外部模式文件的 URI(或 IRI)。相对路径是相对于包含缓冲区 JSON 的文件的。使用 JSON 子树格式时需要 `uri`，而使用二进制子树格式时则不需要 - 当省略缓冲区时指的是子树文件的二进制块。不允许使用数据 URI。" , "format" : "iri-reference" }, "byteLength" : { "type" : "integer" , "minimum" : 1 , "description" : "缓冲区的长度，以字节为单位。" }, "名称" ：{ "类型"
           
       
       
           
           
           
       
       
           
            : 1 , "description" : "缓冲区的名称。" } }，"必需" ：[ "byteLength" ] }
           
       
   
   
       
   

```

## B.7.  缓冲区视图的 JSON 模式

```js
："缓冲区的索引。" }，"字节偏移量" ：
   
   
   
   
   
   
       
           
           
           
       
         { "type" : "integer" , "minimum" : 0 , "description" : "缓冲区中的偏移量(以字节为单位)。" }, "byteLength" : { "type" : "integer" , "minimum" : 1 , "description" : "缓冲区视图的总字节长度。" }, "名称" ：{ "类型" ："字符串" ，"最小长度" ：1 ，"
           
           
           
       
       
           
           
           
       
       
           
           
           
       
   
    "必需" ：[ "缓冲区" ，"byteOffset" ，"byteLength" ] }
       
       
       
   

```

## B.8.  类的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："class.schema.json" ，"title" ："Class" ，"$ref " : "rootProperty.schema.json" , "description" : "包含一组属性的类。" ，"属性" ：{ "名称" ：{ "类型" ："字符串" ，"最小长度" ：1 ，"描述" ："类的名称，例如用于显示Object。" }, "描述"
   
   
   
   
   
   
       
           
           
           
       
        : { "type" : "string" , "minLength" : 1 , "description" : "类的描述。" }, "properties" : { "type" : "object" , "description" : "一个字典，其中每个键是一个属性 ID，每个值是一个定义属性的对象。属性 ID 应是与正则表达式匹配的字母数字标识符`^[a-zA-Z_][a-zA-Z0-9_]*$`。" , "minProperties" : 1 , "additionalProperties" :
           
           
           
       
       
           
           
           
           
                 "class.property.schema.json" } } } }
           
       
   

```

## B.9.  类属性的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："class.property.schema.json" ，"title" ："类属性" ，"$ref" : "rootProperty.schema.json" , "description" : "元数据类的单个属性。" ，"属性" ：{ "名称" ：{ "类型" ："字符串" ，"最小长度" ：1 ，"
   
   
   
   
   
   
       
           
           
           
       
        "description" : { "type" : "string" , "minLength" : 1 , "description" : "属性的描述。" }, "type" : { "description" : "元素类型。" ，"anyOf" ：[ { "const" ："SCALAR" }，{ "const" ："VEC2" }，{ "const" ："VEC3" }，{ "
           
           
           
       
       
           
           
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                     "MAT2" }，{ "const" ："MAT3" }，{ "const" ："MAT4" }，{ "const" ："STRING" }，{ "const" ："BOOLEAN" }，{ "const" ："ENUM" }, { "type" : "string" } ] }, "componentType" : { "description" : "元素组件的数据类型。仅适用于`SCALAR`、`VECN`、和 `MATN` 类型。" , "anyOf" : [ {
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
           
       
       
           
           
               
                    "常量" ："INT8" }，{ "常量" ："UINT8" }，{ "常量" ："INT16" }，{ "常量" ："UINT16" }，{ "常量" ："INT32" }，{ "常量" ："UINT32" }，{ "常量" ："INT64" }，{ "常量" ："UINT64" }，{ "常量" ："FLOAT32" }，{ "常量" ："FLOAT64" }，{ "类型"
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                    : "string" } ] }, "enumType" : { "type" : "string" , "description" : "在 `enums` 字典中声明的枚举 ID。当 `type` 为 `ENUM` 时需要。" }, "array" : { "type" : "boolean" , "default" : false , "description" : "属性是否为数组。定义`count`时，属性为定长数组。否则属性是一个可变长度数组。" }, "计数"
               
           
       
       
           
           
       
       
           
           
           
       
       
             , "minimum" : 2 , "description" : "数组元素的数量。只能在 array 为 true 时定义。" }, "normalized" : { "type" : "boolean" , "description" : "指定整数值是否被归一化。仅适用于具有整数组件类型的`SCALAR`、`VECN`和`MATN`类型。对于无符号整数组件类型，值在 [0.0, 1.0] 之间归一化。对于有符号整数组件类型，值在 [-1.0, 1.0] 之间归一化。对于所有其他组件类型，此属性应为 false。，"默认" ：
           
           
       
       
           
           
           
       
        : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "应用于属性值的偏移量。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型组件类型为 `FLOAT32` 或 `FLOAT64`，或者当属性为 `normalized` 时。" }, "scale" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "适用于属性值的比例。仅适用于 `SCALAR`、`VECN` 和当组件类型为 `FLOAT32` 或 `FLOAT64` 或属性为 `normalized` 时，`MATN` 类型。},
           
           
       
       
           
           
       
       
            "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "属性的最大允许值。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值的最大值，在应用基于 `normalized`、`offset` 和 `scale` 属性的转换之后。" }, "min" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" :
           
       
       
           
             "属性的最小允许值。仅适用于 ‘SCALAR’、‘VECN’ 和 ‘MATN’ 类型。这是所有属性值中的最小值，在基于 ‘normalized’、‘offset’ 和 ‘已应用 scale` 属性。" }, "required" : { "type" : "boolean" , "description" : "如果需要，该属性应出现在符合该类的每个实体中。如果不需要，单个实体可以包含 `noData` 值，或者整个属性可能会被省略。因此，`noData` 对必需的属性没有影响。客户端实现可能会使用必需的属性来进行性能优化。" , "默认"
       
       
           
           
           
       
        "noData" : { "$ref" : "definitions.schema.json#/definitions/noDataValue" , "description" : "`noData` 值表示缺失数据——也称为哨兵值——无论它出现在哪里。`BOOLEAN ` 属性不能指定 `noData` 值。这是作为普通属性值给出的，没有来自 `normalized`、`offset` 和 `scale` 属性的转换。如果 `required` 为真，则不应定义。}, "默认" : { "$ref" : "definitions.schema.json#/definitions/anyValue" , "描述" :
           
           
       
       
           
             "在遇到 ‘noData’ 值或省略的属性时使用的默认值。该值以其最终形式给出，并考虑了 ‘normalized’、‘offset’ 和 ‘scale’ 属性的影响。不应是如果 `required` 为真则定义。" }, "semantic" : { "type" : "string" , "minLength" : 1 , "description" : "描述该属性应如何解释的标识符。语义不能被类中的其他属性使用。" } }, "必填" : [ "类型" ] }
       
       
           
           
           
       
   
   
       
   

```

## B.10.  内容的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："content.schema.json" ，"title" ："内容" ，"$ref " : "rootProperty.schema.json" , "description" : "关于磁贴内容的元数据和内容链接。" , "properties" : { "boundingVolume" : { "description" : "一个可选的边界体积，它紧紧地包围着 tile 内容。tile.
   
   
   
   
   
   
       
             启用紧密视锥体剔除。省略时，使用 tile.boundingVolume。" , "$ref" : "boundingVolume.schema.json" }, "uri" : { "type" : "string" , "description" : "指向Tile内容。当uri 是相对的时，它是相对于引用的tileset JSON文件。" }, "
           
       
       
           
           
       
       
           
           
       
       
             , "minimum" : 0 , "description" : "此内容所属的组。该值是为包含 tileset 定义的 `groups` 数组的索引。" } }, "必填项" ：[ "uri" ] }
           
           
       
   
   
       
   

```

## B.11.  用于定义的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："definitions.schema.json" ，"title" ："定义" ，"描述" ："模式文件中使用的通用定义。" ，"定义" ：{ "numericArray1D" ：{ "标题" ："数字一维数组" ，"类型" ："数组" ，"项目" ：{ "类型" ：
   
   
   
   
   
       
           
           
           
               
           
           
            "description" : "数值数组" }, "numericArray2D" : { "title" : "Numeric 2D Array" , "type" : "array" , "items" : { "$ref" : "#/definitions /numericArray1D" }, "minItems" : 1 , "description" : "数值数组的数组" }, "booleanArray1D" : { "title" : "布尔一维数组" ,"类型" ："数组" ，"项目" ：{
       
       
           
           
           
               
           
           
           
       
       
           
           
           
                "type" ："boolean" }，"minItems" ：1 ，"description" ："布尔值数组" }，"stringArray1D" ：{ "title" ："String 1D Array" ，"type" ："array" , "items" : { "type" : "string" }, "minItems" : 1 , "description" : "字符串值数组" }, "numericValue"：{ "标题" ："数值" ，"一个"
           
           
           
       
       
           
           
           
               
           
           
           
       
       
           
            : [ { "type" : "number" }, { "$ref" : "#/definitions/numericArray1D" }, { "$ref" : "#/definitions/numericArray2D" } ], "description" : "For ` SCALAR` 这是一个数字。对于 `VECN`，这是一个包含 `N` 个数字的数组。对于 `MATN`，这是一个包含 `N²` 个数字的数组。对于固定长度的数组，这是一个包含 `count` 个元素的数组给定的`类型`。" }, "noDataValue" : { "title" : "无数据值" , "oneOf" :
               
                   
               
               
                   
               
               
                   
               
           
           
       
       
           
           
               
                     "#/definitions/numericValue" }, { "type" : "string" }, { "$ref" : "#/definitions/stringArray1D" } ], "description" : "对于 `SCALAR`，这是一个数字。对于`STRING` 这是一个字符串。对于 `ENUM`，这是一个字符串，它应该是一个有效的枚举 `name`，而不是整数值。对于 `VECN`，这是一个包含 `N` 个数字的数组。对于 `MATN`，这是一个包含"N²"个数字的数组。对于固定长度的数组，这是一个包含给定"类型"的"count"个元素的数组。}, "anyValue" : { "title" : "任何值" , "oneOf"
               
               
                   
               
               
                   
               
           
           
       
       
           
           
               
                    : "#/definitions/numericValue" }, { "type" : "string" }, { "$ref" : "#/definitions/stringArray1D" }, { "type" : "boolean" }, { "$ref" : "#/definitions/booleanArray1D" } ], "描述" :
               
              
                   
               
               
                   
               
               
                   
               
               
                   
               
           
             "对于‘SCALAR’，这是一个数字。对于‘STRING’，这是一个字符串。对于‘ENUM’，这是一个字符串，它应该是一个有效的枚举‘name’，而不是整数值。对于‘BOOLEAN’，这是一个布尔值.对于"VECN"，这是一个包含"N"个数的数组。对于"MATN"，这是一个包含"N²"个数的数组。对于固定长度数组，这是一个包含给定"类型"的"count"个元素的数组。对于可变长度数组，这是给定"类型"的任意长度的数组。" } } }
       
   

```

## B.12.  枚举的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："enum.schema.json" ，"title" ："Enum" ，"$ref " : "rootProperty.schema.json" , "description" : "定义枚举值的对象。" ，"属性" ：{ "名称" ：{ "类型" ："字符串" ，"最小长度" ：1 ，"描述" ："枚举的名称，例如用于显示Object。" }, "描述"
   
   
   
   
   
   
       
           
           
           
       
        : { "type" : "string" , "minLength" : 1 , "description" : "枚举的描述。" }, "valueType" : { "default" : "UINT16" , "description" : "整数枚举值的类型。" , "anyOf" : [ { "const" : "INT8" }, { "const" : "UINT8" }, { "const" :
           
           
           
       
       
           
           
           
               
                   
               
               
                   
               
               
                   
               
               
                   
                }, { "const" : "INT32" }, { "const" : "UINT32" }, { "const" : "INT64" }, { "const" : "UINT64" }, { "type" : "string" } ] }, "values" : { "type" : "array" , "description" : "枚举值数组。不允许重复名称或重复整数值。" , "物品"
               
                   
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
           
       
       
           
           
           
               
            }, "minItems" : 1 } }, "required" : [ "values" ] }
           
       
   
   
       
   

```

## B.13.  枚举值的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："enum.value.schema.json" ，"title" ："枚举值" ，"$ref" : "rootProperty.schema.json" , "description" : "一个枚举值。" ，"属性" ：{ "名称" ：{ "类型" ："字符串" ，"最小长度" ：1 ，"描述" ："枚举值的名称。" }，"描述" ：{
   
   
   
   
   
   
       
           
           
           
       
       
            "type" ："string" ，"minLength" ：1 ，"description" ："枚举值的描述​​。" }, "value" : { "type" : "integer" , "description" : "整数枚举值。" } }, "必填项" : [ "名称" , "值" ] }
           
           
       
       
           
           
       
   
   
       
       
   

```

## B.14.  扩展的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："extension.schema.json" ，"title" ："Extension" ，"type" ："对象" ，"描述" ："具有扩展特定对象的字典对象。" , "additionalProperties" : { "type" : "object" } }
   
   
   
   
   
   
       
   

```

## B.15.  额外的 JSON 模式

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "extras.schema.json" , "title" : "Extras" , "description" ："特定于应用程序的数据。" }
   
   
   
   

```

## B.16. Feature 表的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："featureTable.schema.json" ，"title" ："Feature表" ，"$ ref" : "rootProperty.schema.json" , "description" : "一组语义，包含每个图块和每个Feature值，定义图块中Feature的位置和外观属性。" ，"弃用" ：真，"additionalProperties" ：{ "$ref" ："
   
   
   
   
   
   
   
       
   
   
        "binaryBodyOffset" : { "title" : "BinaryBodyOffset" , "$ref" : "rootProperty.schema.json" , "description" : "一个对象，将偏移量定义为Feature表的二进制主体的一部分，其中属性如果没有直接在 JSON 中定义，值将被存储。" , "properties" : { "byteOffset" : { "type" : "integer" , "description" : "以字节为单位的缓冲区偏移量。，"最小"
           
           
           
           
               
                   
                   
                   
               
           
             [ "byteOffset" ] }, "binaryBodyReference" : { "title" : "BinaryBodyReference" , "$ref" : "#/definitions/binaryBodyOffset" , "description" : "定义对二进制主体部分的引用的对象如果未在 JSON 中直接定义，则存储属性值的功能表的名称。" , "属性" ：{ "组件类型" ：{ "描述" ：
               
           
       
       
           
           
           
           
               
                     "属性中组件的数据类型。仅当语义允许覆盖隐式组件类型时才定义。这些情况在每个图块格式中指定。" ，"anyOf" ：[ { "const" ："BYTE" }，{ "const" ："UNSIGNED_BYTE" }，{ "const" ："SHORT" }，{ "const" ："UNSIGNED_SHORT" }，{ "const" : "INT" }, { "const" : "UNSIGNED_INT"
                   
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                       
                           
                       
                        { "const" : "DOUBLE" }, { "type" : "string" } ] } } }, "property" : { "title" : "Property" , "description" : "指定应用程序的用户定义属性- 磁贴中的特定元数据。值可以使用"BinaryBodyReference"对象引用二进制主体中的部分。全局值也可以直接在 JSON 中定义。" , "oneOf" : [ { "$ref" : "#/definitions/binaryBodyReference"
                           
                       
                       
                           
                       
                   
               
           
       
       
           
           
           
               
                   
               
               
                     "#/definitions/globalPropertyBoolean" }, { "$ref" : "#/definitions/globalPropertyInteger" }, { "$ref" : "#/definitions/globalPropertyNumber" }, { "$ref" : "#/definitions/ globalPropertyCartesian3" }, { "$ref" : "#/definitions/globalPropertyCartesian4" } ] }, "globalPropertyBoolean" : { "title" : "GlobalPropertyBoolean" , "description" : "为所有Feature定义全局布尔属性值的对象。" , "type"
               
               
                   
               
               
                   
               
               
                   
               
               
                   
               
           
       
       
           
           
            : "boolean" }, "globalPropertyInteger" : { "title" : "GlobalPropertyInteger" , "description" : "为所有Feature定义全局整数属性值的对象。" , "oneOf" : [ { "$ref" : "#/definitions/binaryBodyOffset" }, { "type" : "integer" , "minimum" : 0 } ] }, "globalPropertyNumber" : { "title" :
       
       
           
           
           
               
                   
               
               
                   
                   
               
           
       
       
           
             "为所有功能定义全局数字属性值的对象。" , "oneOf" : [ { "$ref" : "#/definitions/binaryBodyOffset" }, { "type" : "number" , "minimum" : 0 } ] }, "globalPropertyCartesian3" : { "title" : "GlobalPropertyCartesian3 " , "description" : "一个为所有Feature定义全局 3 分量数字属性值的对象。" ，"一个" ：
           
               
                   
               
               
                   
                   
               
           
       
       
           
           
           
               
                     "#/definitions/binaryBodyOffset" }, { "type" : "array" , "items" : { "type" : "number" }, "minItems" : 3 , "maxItems" : 3 } ] }, "globalPropertyCartesian4" : { "title" : "GlobalPropertyCartesian4" , "description" : "为所有Feature定义全局 4 分量数字属性值的对象。" ，"一个" ：
               
               
                   
                   
                       
                   
                   
                   
               
           
       
       
           
           
           
               
                     "#/definitions/binaryBodyOffset" }, { "type" : "array" , "items" : { "type" : "number" }, "minItems" : 4 , "maxItems" : 4 } ] } } }
               
               
                   
                   
                       
                   
                   
                   
               
           
       
   

```

## B.17.  组元数据的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："group.schema.json" ，"title" ："组元数据" ，"$ ref" : "metadataEntity.schema.json" , "description" : "包含有关组的元数据的对象。" }
   
   
   
   
   

```

## B.18.  实例化 3D 模型 Feature 表的 JSON 架构

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "i3dm.featureTable.schema.json" , "title" : "实例化 3D 模型FeatureTable" , "$ref" : "featureTable.schema.json" , "description" : "一组实例化 3D 模型语义，包含定义图块中实例化模型的位置和外观属性的值。" ，"弃用" ：真，"属性" ：{ "位置" ：
   
   
   
   
   
   
   
       
             "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "POSITION_QUANTIZED" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "
           
       
       
           
           
       
       
            "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "NORMAL_RIGHT" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.
           
       
       
           
           
       
        : { "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "NORMAL_RIGHT_OCT32P" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.
           
           
       
       
           
           
       
        "SCALE" : { "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "SCALE_NON_UNIFORM" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$参考" :
           
           
       
       
           
             "featureTable.schema.json#/definitions/binaryBodyReference" }, "BATCH_ID" : { "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "INSTANCES_LENGTH" : { "description" : "一个 `GlobalPropertyInteger` 对象定义所有Feature的整数属性。有关此属性的详细信息在3D Tiles 规范。" ,
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyInteger" }, "RTC_CENTER" : { "description" : "一个 `GlobalPropertyCartesian3` 对象定义了所有Feature的 3 分量数字属性。有关此属性的详细信息在 3D Tiles 中进行了描述规格。" , "$ref" : "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "QUANTIZED_VOLUME_OFFSET" : { "description" : "一个 `GlobalPropertyCartesian3` 对象定义了所有Feature的 3 分量数字属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" ,
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "QUANTIZED_VOLUME_SCALE" : { "description" : "一个 `GlobalPropertyCartesian3` 对象定义了所有Feature的 3 分量数字属性。有关此属性的详细信息在 3D Tiles 中有描述规格。" , "$ref" : "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "EAST_NORTH_UP" : { "description" : "一个 `GlobalPropertyBoolean` 对象定义了所有Feature的布尔属性。有关此属性的详细信息在3D Tiles 规范。" ,
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyBoolean" } }, "oneOf" : [ { "required" : [ "POSITION" ] }, { "required" : [ "POSITION_QUANTIZED" ] } ], "dependencies" : { "POSITION_QUANTIZED" ：[ "QUANTIZED_VOLUME_OFFSET" ，"QUANTIZED_VOLUME_SCALE" ]，"NORMAL_UP" ：[ "NORMAL_RIGHT" ]，"NORMAL_RIGHT" ：[ "NORMAL_UP" ], "NORMAL_UP_OCT32P"
       
   
   
       
           
               
           
       
       
           
               
           
       
   
   
       
           
           
       
       
           
       
       
           
       
        ：[ "NORMAL_RIGHT_OCT32P" ]，"NORMAL_RIGHT_OCT32P" ：[ "NORMAL_UP_OCT32P" ] }，"必需" ：[ "INSTANCES_LENGTH" ] }
           
       
       
           
       
   
   
       
   

```

## B.19.  元数据实体的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："metadataEntity.schema.json" ，"title" ："元数据实体" ，"$ ref" : "rootProperty.schema.json" , "description" : "一个对象，包含对元数据模式中的类的引用，以及符合该类属性的属性值。" ，"属性" ：{ "类" ：{ "类型" ："字符串" ，
   
   
   
   
   
   
       
           
             "属性值符合的类。该值应是在元数据模式的"类"字典中声明的类 ID。" }, "属性" : { "类型" : "对象" , "描述" :
       
       
           
             "一个字典，其中每个键对应于类‘properties’字典中的一个属性 ID，每个值都包含属性值。值的类型应与属性定义匹配：对于 ‘BOOLEAN’，使用 ‘true’ 或 ‘false’ `。对于 `STRING` 使用 JSON 字符串。对于数字类型使用 JSON 数字。对于 `ENUM` 使用有效的枚举 `name`，而不是整数值。对于 `ARRAY`、`VECN` 和 `MATN` 类型使用包含与"componentType"匹配的值的 JSON 数组。必需的属性应包含在此字典中。" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "definitions.schema.json#/definitions/anyValue" } } },
           
           
               
           
       
   
     [ "类" ] }
       
   

```

## B.20.  点云 Feature 表的 JSON 模式

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "pnts.featureTable.schema.json" , "title" : "点云Feature表" , "$ref" : "featureTable.schema.json" , "description" : "一组点云语义，包含定义图块中点的位置和外观属性的值。" ，"弃用" ：真，"属性" ：{ "位置" ：
   
   
   
   
   
   
   
       
             "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "POSITION_QUANTIZED" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "
           
       
       
           
           
       
       
            "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "RGB" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference"
           
       
       
           
           
       
         { "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "NORMAL" : { "description" : "一个 `BinaryBodyReference` 对象定义了对二进制主体部分的引用，其中属性值是存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.
           
           
       
       
           
           
       
        "NORMAL_OCT16P" : { "description" : "一个 `BinaryBodyReference` 对象定义了对存储属性值的二进制主体部分的引用。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/binaryBodyReference" }, "BATCH_ID" : { "description" : "一个 `BinaryBodyReference` 对象，定义对二进制主体部分的引用，其中属性值为存储。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$参考" :
           
           
       
       
           
             "featureTable.schema.json#/definitions/binaryBodyReference" }, "POINTS_LENGTH" : { "description" : "一个 `GlobalPropertyInteger` 对象定义了所有点的整数属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$ref" : "featureTable.schema.json#/definitions/globalPropertyInteger" }, "RTC_CENTER" : { "description" : "一个 `GlobalPropertyCartesian3` 对象，为所有点定义一个 3 分量数字属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。" , "$参考"
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "QUANTIZED_VOLUME_OFFSET" : { "description" : "一个 `GlobalPropertyCartesian3` 对象定义了所有点的 3 分量数字属性。有关此属性的详细信息在 3D Tiles 中有描述规格。" , "$ref" : "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "QUANTIZED_VOLUME_SCALE" : { "description" : "一个 `GlobalPropertyCartesian3` 对象，为所有点定义一个 3 分量数字属性。有关此属性的详细信息在 3D Tiles 规范中进行了描述。"
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyCartesian3" }, "CONSTANT_RGBA" : { "description" : "一个 `GlobalPropertyCartesian4` 对象定义了所有点的 4 分量数字属性。有关此属性的详细信息在 3D Tiles 中有描述规格。" , "$ref" : "featureTable.schema.json#/definitions/globalPropertyCartesian4" }, "BATCH_LENGTH" : { "description" : "一个 `GlobalPropertyInteger` 对象定义所有点的整数属性。有关此属性的详细信息在3D Tiles 规范。" , "
       
       
           
           
       
       
           
             "featureTable.schema.json#/definitions/globalPropertyInteger" } }，"anyOf" ：[ { "required" ：[ "POSITION" ] }，{ "required" ：[ "POSITION_QUANTIZED" ] } ]，"dependencies" ：{ "POSITION_QUANTIZED" ：[ "QUANTIZED_VOLUME_OFFSET" ，"QUANTIZED_VOLUME_SCALE" ]，"BATCH_ID" ：[ "BATCH_LENGTH" ] }，"必需" ：[ "POINTS_LENGTH" ] }
       
   
   
       
           
               
           
       
       
           
               
           
       
   
   
       
           
           
       
       
           
       
   
   
       
   

```

## B.21.  属性的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："properties.schema.json" ，"title" ："属性" ，"$ref " : "rootProperty.schema.json" , "description" : "关于每个Feature属性的元数据字典对象。" ，"属性" ：{ "最大" ：{ "类型" ："数字" ，"描述" ："
   
   
   
   
   
   
       
           
           
       
         { "type" : "number" , "description" : "tileset 中所有Feature的这个属性的最小值。" } }, "必需" : [ "最大" , "最小" ] }
           
           
       
   
   
       
       
   

```

## B.22.  属性表的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："propertyTable.schema.json" ，"title" ："属性表" ，"$ ref" : "rootProperty.schema.json" , "description" : "符合类的属性，组织为存储在二进制柱状数组中的属性值。" ，"属性" ：{ "名称" ：{ "类型" ："字符串" ，"最小长度" ：
   
   
   
   
   
   
       
           
           
             "属性表的名称，例如用于显示Object。" }, "class" : { "type" : "string" , "description" : "属性值符合的类。该值应为在 `classes` 字典中声明的类 ID。" }, "count" : { "type" : "integer" , "minimum" : 1 , "description" : "每个属性数组中的元素数。" }, "属性" ：{ "类型" ：
       
       
           
           
       
       
           
           
           
       
       
           
             "一个字典，其中每个键对应于类‘properties’字典中的一个属性 ID，每个值都是一个描述属性值存储位置的对象。必需的属性应包含在该字典中。" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "propertyTable.property.schema.json" } } }, "required" : [ "class" , "count" ] }
           
           
               
           
       
   
   
       
       
   

```

## B.23.  属性表属性的 JSON 模式

```js
    { "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："propertyTable.property.schema.json" ，"title" ："属性表属性" , "$ref" : "rootProperty.schema.json" , "description" : "一组二进制属性值。这代表属性表的一列，并包含每个元数据实体的某个属性的一个值。" ，"属性" ：{ "值" ：{ "类型" ：
       
       
       
       
       
       
           
               
                 , "描述" :
                 "包含属性值的缓冲区视图的索引。属性值的数据类型由属性定义决定：当 type 是 BOOLEAN 时，值被打包到比特流中。当 type 是 STRING 时，值被存储作为字节序列并解码为 UTF-8 字符串。当"type"为"SCALAR"、"VECN"或"MATN"时，值将存储为提供的"componentType"，缓冲区视图"byteOffset"应与`componentType` 大小的倍数。当 `type` 为 `ENUM` 时，值存储为枚举的 `valueType` 并且缓冲区视图 `byteOffset` 应与 `valueType` 大小的倍数对齐。每个枚举值在数组应匹配枚举定义中允许的值之一。可变长度数组需要 arrayOffsets，字符串需要 stringOffsets(对于字符串的可变长度数组，两者都是必需的)。"
            }, "arrayOffsets" : { "type" : "integer" , "minimum" : 0 , "description" :
           
               
               
                 "缓冲区视图的索引，包含可变长度数组的偏移量。偏移量的数量等于属性表`count`加一。偏移量表示每个数组的起始位置，最后一个偏移量表示数组之后的位置最后一个数组。数组长度是使用后续偏移量和当前偏移量之间的差值计算的。如果"type"为"STRING"，则偏移量索引到字符串偏移量数组(存储在"stringOffsets"中)，否则它们索引到属性中数组(存储在"值"中)。这些偏移量的数据类型由"arrayOffsetType"确定。缓冲区视图"byteOffset"应与"arrayOffsetType"大小的倍数对齐。}, "stringOffsets" : { "类型" : "
           
           
               
                "minimum" : 0 , "description" : "包含字符串偏移量的缓冲区视图的索引。偏移量的数量等于字符串元素的数量加一。偏移量表示属性数组中每个字符串的字节偏移量(存储在`values`中)，最后一个偏移量表示最后一个字符串之后的字节偏移量。字符串字节长度是使用后续偏移量与当前偏移量之间的差来计算的。这些偏移量的数据类型由`stringOffsetType确定`。缓冲区视图 `byteOffset` 应与 `stringOffsetType` 大小的倍数对齐。" }, "arrayOffsetType" : { "说明" : "
               
           
           
                 ，"默认" ："UINT32" ，"anyOf" ：[ { "常量" ："UINT8" }，{ "常量" ："UINT16" }，{ "常量" ："UINT32" }，{ "常量" ："UINT64" }, { "type" : "string" } ] }, "stringOffsetType" : { "description" : "`stringOffsets` 中值的类型。" ,
               
               
                   
                       
                   
                   
                       
                   
                   
                       
                   
                   
                       
                   
                   
                       
                   
               
           
           
               
               
                 [ { "常量" ："UINT8" }，{ "常量" ："UINT16" }，{ "常量" ："UINT32" }，{ "常量" ："UINT64" }，{ "类型" ："字符串" } ] }, "offset" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" :
                   
                       
                   
                   
                       
                   
                   
                       
                   
                   
                       
                   
                   
                       
                   
               
           
           
               
                 "应用于属性值的偏移量。仅当组件类型为"FLOAT32"或"FLOAT64"，或者属性为"规范化"时才适用。如果两者均已定义，则覆盖类属性的"偏移量"。}, "scale" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "应用于属性值的比例。仅适用于组件类型为 `FLOAT32` 或 ` FLOAT64，或者当属性被"规范化"时。如果两者都被定义，则覆盖类属性的"比例"。}, "max" : { "$ref" : "definitions.schema.
           
           
               
               
           
           
               
                : "属性值中存在的最大值。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值的最大值，在基于 `normalized`、`offset` 的转换之后，并且应用了 `scale` 属性。" }, "min" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "属性值中存在的最小值。仅适用于 `SCALAR`、`VECN` 和`MATN` 类型。在应用基于 `normalized`、`offset` 和 `scale` 属性的转换后，这是所有属性值中的最小值。" } }，"必填" ：
           
           
               
               
           
       
       
           
       
    }
```

## B.24.  根属性的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："rootProperty.schema.json" ，"title" ："根属性" ，"类型" : "object" , "description" : "存储扩展和额外内容的基础。, "properties" : { "extensions" : { "$ref" : "extension.schema.json" }, "extras" : { "$ref" :
   
   
   
   
   
   
       
           
       
       
           
       
   

```

## B.25.  模式的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："schema.schema.json" ，"title" ："Schema" ，"$ref " : "rootProperty.schema.json" , "description" : "定义类和枚举的对象。" ，"属性" ：{ "id" ：{ "类型" ："字符串" ，"模式" ："^ [a-zA-Z_] [a-zA-Z0-9_] * $" ，"
   
   
   
   
   
   
       
           
           
             "架构的唯一标识符。架构 ID 应是与正则表达式 `^[a-zA-Z_][a-zA-Z0-9_]*$` 匹配的字母数字标识符。" }, "name" : { "type" : "string" , "minLength" : 1 , "description" : "模式的名称，例如用于显示Object。" }, "description" : { "type" : "string" , "minLength" : 1 , "description" : "模式的描述。" }, "
       
       
           
           
           
       
       
           
           
           
       
       
             "string" ，"minLength" ：1 ，"description" ："特定于应用程序的模式版本。" }, "classes" : { "type" : "object" , "description" : "字典，其中每个键是一个类 ID，每个值是一个定义类的对象。类 ID 应是与正则表达式匹配的字母数字标识符`^[a-zA-Z_][a-zA-Z0-9_]*$`。" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "
           
           
       
       
           
           
           
           
               
           
       
         { "type" : "object" , "description" : "一个字典，其中每个键都是一个枚举 ID，每个值都是一个定义枚举值的对象。枚举 ID 应该是与正则表达式 `^[ 匹配的字母数字标识符a-zA-Z_][a-zA-Z0-9_]*$`。" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "enum.schema.json" } } }, "required" : [ "id" ] }
           
           
           
           
               
           
       
   
   
       
   

```

## B.26.  用于统计的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："statistics.schema.json" ，"title" ："统计" ，"$ref " : "rootProperty.schema.json" , "description" : "关于实体的统计信息。" ，"属性" ：{ "类" ：{ "类型" ："对象" ，"描述" ：
   
   
   
   
   
   
       
           
             "一个字典，其中每个键对应于 ‘classes’ 字典中的一个类 ID，每个值都是一个对象，其中包含有关符合该类的实体的统计信息。" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "statistics.class.schema.json" } } } }
           
           
               
           
       
   

```

## B.27.  用于类统计的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："statistics.class.schema.json" ，"title" ："类统计" ，"$ref" : "rootProperty.schema.json" , "description" : "关于符合类的实体的统计信息。" ，"属性" ：{ "计数" ：{ "类型" ："整数" ，"描述" ："
   
   
   
   
   
   
       
           
           
           
        }, "properties" : { "type" : "object" , "description" : "一个字典，其中每个键对应于类'`properties`字典中的一个属性ID，每个值是一个包含属性值统计信息的对象" , "minProperties" : 1 , "additionalProperties" : { "$ref" : "statistics.class.property.schema.json" } } } }
       
           
           
           
           
               
           
       
   

```

## B.28.  属性统计的 JSON 模式

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "statistics.class.property.schema.json" , "title" : "属性统计" , "$ref" : "rootProperty.schema.json" , "description" : "关于属性值的统计数据。" ，"属性" ：{ "分钟" ：{ "$ref" ："definitions.schema.json#/definitions/numericValue" ，"描述" ：
   
   
   
   
   
   
       
           
             "tileset 中出现的最小属性值。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值中的最小值，在基于 `normalized`、`offset`、并且应用了 `scale` 属性。" }, "max" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "tileset 中出现的最大属性值。仅适用于`SCALAR`, `VECN`,和 `MATN` 类型。这是所有属性值的最大值，在应用基于 `normalized`、`offset` 和 `scale` 属性的转换之后。}，"平均" ：
       
       
           
           
       
       
             "definitions.schema.json#/definitions/numericValue" , "description" : "tileset 中出现的属性值的算术平均值。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是平均值所有属性值，在应用基于 `normalized`、`offset` 和 `scale` 属性的转换之后。" }，"中位数" ：{ "$ref" ："definitions.schema.json#/definitions/numericValue" ，"描述" ：
           
       
       
           
             "tileset 中出现的属性值的中值。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值的中值，在基于 `normalized`、`offset` 的转换之后，并且应用了 `scale` 属性。" }, "standardDeviation" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "tileset中出现的属性值的标准差。仅适用于`SCALAR`, `VECN `, 和 `MATN` 类型。这是所有属性值的标准偏差，在应用基于 `normalized`、`offset` 和 `scale` 属性的转换之后。}, "
       
       
           
           
       
       
            "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" : "tileset 中出现的属性值的变化。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值的方差，在应用基于"规范化"、"偏移量"和"缩放"属性的转换之后。" }, "sum" : { "$ref" : "definitions.schema.json#/definitions/numericValue" , "description" :
           
       
       
           
             "tileset 中出现的属性值的总和。仅适用于 `SCALAR`、`VECN` 和 `MATN` 类型。这是所有属性值的总和，在基于 `normalized`、`offset` 的转换之后，并且应用了 `scale` 属性。" }, "occurrences" : { "type" : "object" , "description" : "一个字典，其中每个键对应一个枚举`name`，每个值是该枚举的出现次数。仅适用于`type ` 是 `ENUM`。对于固定长度的数组，这是一个按组件出现的数组。" , "minProperties" : 1 , "additionalProperties"
       
       
           
           
           
           
                ：[ { "类型" ："整数" }，{ "类型" ："数组" ，"项目" ：{ "类型" ："整数" }，"minItems" ：1 } ] } } } } }
                   
                       
                   
                   
                       
                       
                           
                       
                       
                   
               
           
       
   

```

## B.29.  样式的 JSON 模式

```js
    { "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.schema.json" ，"title" ："Style" ，"$ref " : "rootProperty.schema.json" , "description" : "3D Tiles 样式。" , "properties" : { "defines" : { "type" : "object" , "additionalProperties" : { "$ref" : "style.
       
       
       
       
       
       
           
               
               
                   
               
                 "映射到可在整个样式中引用的变量名称键的 `expression` 字符串的字典对象。如果表达式引用已定义的变量，它将替换为相应表达式的评估结果。" }, "show" : { "oneOf" : [ { "$ref" : "style.booleanExpression.schema.json" }, { "$ref" : "style.conditions.schema.json" } ], "description" : "一个 `boolean expression` 或 `conditions` 属性，决定是否应该显示一个Feature。" ，"默认" ：
           
           
               
                   
                       
                   
                   
                       
                   
               
               
               
           
            : { "oneOf" : [ { "$ref" : "style.colorExpression.schema.json" }, { "$ref" : "style.conditions.schema.json" } ], "description" : "A `color expression` 或 `conditions` 属性，用于确定与Feature的固有颜色混合的颜色。" , "default" : "color('#FFFFFF')" }, "meta" : { "$ref" : "style.meta.schema.json" , "description" : "
               
                   
                       
                   
                   
                       
                   
               
               
               
           
           
               
               
           
        }
    }
```

## B.30.  布尔表达式的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.booleanExpression.schema.json" ，"title" ："布尔表达式" ，"type" : [ "boolean" , "string" ], "description" : "具有 3D Tiles 样式表达式的布尔值或字符串，其计算结果为布尔值。详细信息在 3D Tiles Styling 规范中进行了描述。" }
   
   
   
   
       
       
   
   

```

## B.31.  用于颜色表达的 JSON 模式

```js
{ "$schema" : " https://json-schema.org/draft/2020-12/schema" , "$id" : "style.colorExpression.schema.json" , "title" : "颜色表达" , "type" : "string" , "description" : "3D Tiles style `expression` 计算结果为 Color。详细信息在 3D Tiles Styling 规范中描述。" }
   
   
   
   
   

```

## B.32.  条件的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.conditions.schema.json"，"title" ："条件" ，"$ref" : "rootProperty.schema.json" , "description" : "按顺序评估的一系列条件，如一系列 if...else 语句，导致表达式被评估。" , "属性" ：{ "条件" ：{ "类型" ："数组" ，
   
   
   
   
   
   
       
           
             "按顺序评估的一系列布尔条件。对于第一个评估为真的条件，评估并返回其值"结果"(也是一个表达式)。结果表达式应全部为同一类型。如果没有condition 的计算结果为 true，结果为 undefined。当 conditions 为 undefined、null 或空对象时，结果为 undefined。" , "items" : { "$ref" : "style.conditions.condition.schema.json" } } } }
           
               
           
       
   

```

## B.33.  条件的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.conditions.condition.schema.json"，"title" ："条件" , "type" : "array" , "description" : "一个 `expression` 被评估为条件为真的结果。两个表达式的数组。如果第一个表达式被评估并且结果为 `true`，那么第二个表达式被评估并作为条件的结果返回。" , "项目" : { "$ref" :
   
   
   
   
   
   
       
   
    ：2 ，"最大项目" ：2 }
   

```

## B.34.  表达式的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.expression.schema.json" ，"title" ："表达式" ，"type" : "string" , "description" : "有效的 3D Tiles 样式表达式。详细信息在 3D Tiles Styling 规范中描述。" }
   
   
   
   
   

```

## B.35.元数据的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："style.meta.schema.json" ，"title" ："元" ，"$ref" : "rootProperty.schema.json" , "description" : "一系列属性名称和用于评估该属性值的 `expression`。" , "additionalProperties" : { "$ref" : "style.expression.schema.json" } }
   
   
   
   
   
   
       
   

```

## B.36.  子树的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："subtree.schema.json" ，"title" ："子树" ，"$ref " : "rootProperty.schema.json" , "description" : "描述子树中图块和内容的可用性以及子树的可用性的对象。还可以存储可用图块和内容的元数据。" ，"属性" ：{ "缓冲区" ：{ "类型" ："
   
   
   
   
   
   
       
           
           
                : "buffer.schema.json" }, "minItems" : 1 , "description" : "一个缓冲区数组。" }, "bufferViews" : { "type" : "array" , "items" : { "$ref" : "bufferView.schema.json" }, "minItems" : 1 , "description" : "缓冲区视图数组" }, "propertyTables" : { "类型" : "数组"
           
           
           
       
       
           
           
               
           
           
           
       
       
           
           
                 "propertyTable.schema.json" }, "minItems" : 1 , "description" : "一组属性表。" }, "tileAvailability" : { "$ref" : "availability.schema.json" , "description" :
           
           
           
       
       
           
             "子树中瓦片的可用性。可用性比特流是一个一维布尔数组，其中瓦片按其在子树中的级别和该级别中的莫顿索引排序。瓦片的可用性由一位确定，1 表示瓦片存在于该空间索引，0 表示它没有。数组中的元素数为 `(N^subtreeLevels - 1)/(N - 1)`，其中对于细分方案 `QUADTREE`，N 为 4，对于 `OCTREE`，N 为 8 . 可用性可以存储在缓冲区视图中或作为适用于所有图块的常量值。如果非根图块的可用性为 1，则其父图块的可用性也应为 1。`tileAvailability.constant: 0` 是不允许的，因为子树应该至少有一张牌。" }，"内容可用性" ：
       
       
            : "array" , "items" : { "$ref" : "availability.schema.json" }, "minItems" : 1 , "description" : "内容可用性对象数组。如果磁贴只有一个内容数组将有一个元素；如果 tile 有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——这个数组将有多个元素。" }, "childSubtreeAvailability" : { "$ref" : "availability.schema.json" , "description" :
           
               
           
           
           
       
       
           
             "子树的可用性。可用性比特流是一个一维布尔数组，其中子树按其在子树底行正下方的树级别中的 Morton 索引排序。子树的可用性由一位确定，1表示该空间索引处存在子树，0 表示不存在。数组中的元素数为"N^subtreeLevels"，其中对于细分方案"QUADTREE"，N 为 4，对于"OCTREE"，N 为 8。可存储可用性在缓冲区视图中或作为适用于所有子树的常量值。如果所有子树的可用性为 0，则 tileset 不会进一步细分。" }，"tileMetadata" ：{ "类型" ："整数" ，"
       
       
           
             0 , "description" : "包含图块元数据的属性表的索引。图块元数据仅存在于可用图块中，并通过增加图块索引来紧密打包。要访问单个图块元数据，实现可以创建从图块索引到图块元数据索引的映射" }, "contentMetadata" : { "type" : "array" , "items" : { "type" : "integer" , "minimum" : 0 }, "minItems" : 1 , "description" :
           
       
       
           
           
               
               
           
           
             "包含内容元数据的属性表的索引数组。如果图块具有单个内容，则该数组将具有一个元素；如果图块具有多个内容——如 3DTILES_multiple_contents 和 3D Tiles 1.1 所支持——该数组将具有多个元素。内容元数据仅存在于可用内容中，并通过增加 tile 索引紧密打包。要访问单个内容元数据，实现可能会创建从 tile 索引到内容元数据索引的映射。}, "subtreeMetadata" : { "$ref" : "metadataEntity.schema.json" , "description" : "以 JSON 编码的子树元数据。" } }, "必需"
       
       
           
           
       
   
   
        "tileAvailability" ，"childSubtreeAvailability" ] }
       
   

```

## B.37.  子树的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："subtrees.schema.json" ，"title" ："子树" ，"$ref " : "rootProperty.schema.json" , "description" : "一个描述子树文件位置的对象。" ，"属性" ：{ "uri" ：{ "$ref" ："templateUri.schema.json" ，"描述" ：
   
   
   
   
   
   
       
           
             "指向子树文件的模板 URI。子树是树的固定深度(由 subtreeLevels 定义)部分，以限制内存使用。每个文件的 URI 替换为子树根的全局级别 x，和y。对于细分方案'OCTREE'，还应给出z。相对路径是相对于tileset JSON。" } }, "必填项" ：[ "uri" ] }
       
   
   
       
   

```

## B.38.  模板 URI 的 JSON 架构

    { "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："templateUri.schema.json" ，"title" ："模板 URI" ，"类型" ："字符串" ，"描述" ：
       
       
       
       
         "带有嵌入式表达式的 URI，用于描述与隐式瓦片集中的隐式瓦片关联的资源。允许的表达式为 `{level}`、`{x}`、`{y}` 和 `{z}`。 `{level}` 替换为节点的级别，`{x}` 替换为该级别内节点的 x 索引，而 `{y}` 替换为该级别内节点的 y 索引. `{z}` 只能在细分方案为 `OCTREE` 时给出，并替换为该级别内节点的 z 索引。
    }

## B.39. Tile 的 JSON 架构

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："tile.schema.json" ，"title" ："Tile" ，"$ref " : "rootProperty.schema.json" , "description" : "3D Tiles 瓦片集中的瓦片。" , "properties" : { "boundingVolume" : { "description" : "包围图块的边界体积。" , "$ref" : "边界体积。
   
   
   
   
   
   
       
           
           
       
       
            "description" : "可选的边界体积，它定义了在请求图块的内容之前以及在基于几何错误对图块进行细化之前，查看者应位于其中的体积。" , "$ref" : "boundingVolume.schema.json" }, "geometricError" : { "type" : "number" , "description" : "错误，以米为单位，如果这个瓦片被渲染而它的孩子没有被引入. 在运行时，几何误差用于计算屏幕空间误差 (SSE)，即以像素为单位测量的误差。" ，"最小" ：
           
       
       
           
           
           
       
       
            "description" : "指定在遍历瓦片集进行渲染时是否使用附加或替换细化。此属性对于瓦片集的根瓦片是必需的；它对于所有其他瓦片是可选的。默认是从父瓦片继承。 ", "anyOf" : [ { "const" : "ADD" }, { "const" : "REPLACE" }, { "type" : "string" } ] }, "transform" : { "type" : "array" , "
           
               
                   
               
               
                   
               
               
                   
               
           
       
       
           
             "一个浮点 4x4 仿射变换矩阵，以列优先顺序存储，将图块的内容——即它的Feature以及 content.boundingVolume、boundingVolume 和 viewerRequestVolume——从图块的本地坐标系转换到父级瓦片的坐标系，或者，在根瓦片的情况下，从瓦片的局部坐标系到瓦片集的坐标系。当体积是在 EPSG:4979 坐标中定义的区域时，"转换"不适用于任何体积属性。 `transform` 通过矩阵的最大缩放因子缩放 `geometricError`。" , "items" : { "type" : "number" }, "minItems" : 16 ,
           
               
           
           
             16 ，"默认" ：[ 1.0，0.0，0.0，0.0，0.0，1.0，0.0，0.0，0.0，0.0，0.0，0.0，1.0，0.0，0.0，0.0，0.0，0.0，0.0，1.0 ] } ，"content" ：{ "description" ：{ "description" ：_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ "关于图块内容的元数据和内容链接。省略时，图块仅用于剔除。定义后，‘内容’将未定义。"
           
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
               
           
       
       
             , "$ref" : "content.schema.json" }, "contents" : { "type" : "array" , "description" : "内容数组。定义后，`content` 应为未定义" ，"项目" ：{ "$ref" ："content.schema.json" }，"minItems" ：1 }，"元数据" ：{ "$ref" ："metadataEntity.schema.json" ，"描述" ："
           
       
       
           
           
           
               
           
           
       
       
           
           
       
        : { "$ref" : "tile.implicitTiling.schema.json" , "description" : "一个描述该图块隐式细分的对象。" }, "children" : { "type" : "array" , "description" : "定义子图块的对象数组。每个子图块的内容完全被其父图块的包围体包围，并且通常具有较少的几何误差比其父图块的几何错误。对于叶图块，此数组的长度为零，并且可能未定义子项。" ，"项目" ：
           
           
       
       
           
           
           
               
           
            "uniqueItems" ：true ，"minItems" ：1 } }，"required" ：[ "boundingVolume" ，"geometricError" ]，"not" ：{ "required" ：[ "content" ，"contents" ] } }
           
       
   
   
       
       
   
   
       
           
           
       
   

```

## B.40.用于隐式 Tile 的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："tile.implicitTiling.schema.json" ，"title" ："隐式Tile" ，"$ref" : "rootProperty.schema.json" , "description" : "此对象允许对图块进行隐式细分。图块和内容可用性以及元数据存储在外部引用的子树中。" , "properties" : { "subdivisionScheme" : { "description" :
   
   
   
   
   
   
       
             , "anyOf" : [ { "const" : "QUADTREE" }, { "const" : "OCTREE" }, { "type" : "string" } ] }, "subtreeLevels" : { "type" : "integer" , "description" : "每个子树中不同级别的数量。例如，`subtreeLevels = 2` 的四叉树将有包含 5 个节点的子树(一个根节点和 4 个子节点)。" , "最少" : 1 }, "
           
               
                   
               
               
                   
               
               
                   
               
           
       
       
           
           
           
       
       
             "整数" ，"描述" ："树中可用图块的级别数。" , "minimum" : 1 }, "subtrees" : { "$ref" : "subtrees.schema.json" , "description" : "描述子树文件位置的对象。" } }, "required" : [ "subdivisionScheme" , "subtreeLevels" , "availableLevels" , "subtrees" ] }
           
           
       
       
           
           
       
   
   
       
       
       
       
   

```

## B.41. Tileset 的 JSON 模式

```js
{ "$schema" ："https://json-schema.org/draft/2020-12/schema"，"$id" ："tileset.schema.json" ，"title" ："Tileset" ，"$ref " : "rootProperty.schema.json" , "description" : "一个 3D Tiles tileset." , "properties" : { "asset" : { "description" : "关于整个 tileset 的元数据。" , "$ref" : "asset.schema.json" },
   
   
   
   
   
   
       
           
           
       
       
             , "description" : "关于每个Feature属性的元数据字典对象。" , "additionalProperties" : { "$ref" : "properties.schema.json" }, "deprecated" : true }, "schema" : { "$ref" : "schema.schema.json" , "description" : "定义元数据类和枚举结构的对象。定义后，`schemaUri` 应该是未定义的。" }, "schemaUri" : { "类型" :
           
           
               
           
           
       
       
           
           
       
       
           
             "外部模式文件的 URI(或 IRI)。定义后，‘模式’将未定义。" , "format" : "iri-reference" }, "statistics" : { "$ref" : "statistics.schema.json" , "description" : "包含元数据实体统计信息的对象。" }, "groups" : { "type" : "array" , "description" : "Tile内容可能属于的一组数组。此数组的每个元素都是描述该组的元数据实体。
           
       
       
           
           
       
       
           
           
            "项目" ：{ "$ref" ："group.schema.json" }，"minItems" ：1 }，"元数据" ：{ "$ref" ："metadataEntity.schema.json" ，"描述" ："A与此 tileset 关联的元数据实体。" }, "geometricError" : { "type" : "number" , "description" : "错误，以米为单位，如果这个 tileset 没有被渲染。在运行时，
               
           
           
       
       
           
           
       
       
           
           
            : 0 }, "root" : { "description" : "根瓦片。" , "$ref" : "tile.schema.json" }, "extensionsUsed" : { "type" : "array" , "description" : "在此 tileset 中某处使用的 3D Tiles 扩展的名称。" , "items" : { "type" : "string" }, "uniqueItems" : true , "minItems" : 1 },
       
       
           
           
       
       
           
           
           
               
           
           
           
       
       
             "array" ，"description" ："正确加载此 tileset 所需的 3D Tiles 扩展名称。" , "items" : { "type" : "string" }, "uniqueItems" : true , "minItems" : 1 } }, "required" : [ "asset" , "geometricError" , "root" ], "not" ：{ "必需" ：[ "模式" ，"
           
           
               
           
           
           
       
   
   
       
       
       
   
   
       
           
           
       
   

```

# **附件 C** (资料性) **从旧版图块格式迁移**

本节介绍如何将旧版图块格式转换为等效的 glTF 内容。

## C.1.  批处理 3D 模型 (b3dm)

[批处理 3D 模型](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-batched-3d-model)是二进制 glTF 的包装器，在其 Feature 表和批处理表中包含附加信息。批处理的 3D 模型内容可以通过以下更改转换为 glTF 内容：

- RTC_CENTER 可以添加到 glTF 资产[`的`](https://portal.ogc.org/files/102132#tileformats-batched3dmodel-coordinate-system)根节点的翻译组件。
- 可以使用[`EXT_mesh_features`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features)和[`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)表示批次 ID 和批次表。

![b3dm](https://github.com/CHENJIAMIAN/Blog/assets/20126997/7669df5d-f96e-4a0e-ae82-6282d19a59f2)

图 C.1 — 3D Tiles 1.0 中的批处理 3D 模型，以及 3D Tiles 1.1 中的相应表示

## C.2.  实例化 3D 模型 (i3dm)

[实例化 3D 模型](https://portal.ogc.org/files/102132#tileformats-instanced3dmodel-instanced-3d-model)实例化 glTF 资产(嵌入式或外部)并提供每个实例的转换和批次 ID。

- RTC_CENTER 可以添加到 glTF 资产`的`根节点的翻译组件。
- glTF 可以利用带有[EXT_mesh_gpu_instancing](https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Vendor/EXT_mesh_gpu_instancing/README.md)扩展的 GPU 实例化。
- [`批次 ID 和批次表可以使用EXT_instance_features`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features)和[`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)表示。
- `不直接支持EAST_NORTH_UP`，但可以使用每个实例的旋转来表示。

![i3dm](https://github.com/CHENJIAMIAN/Blog/assets/20126997/95a2d0aa-ad29-4297-b5c9-e7c9c3dad749)

图 C.2 — 3D Tiles 1.0 中的实例化 3D 模型，以及 3D Tiles 1.1 中的相应表示

## C.3.  点云 (pnts)

[点云可以表示为使用原始模式](https://portal.ogc.org/files/102132#tileformats-pointcloud-point-cloud)`0` ( `POINTS` )的 glTF 。

- RTC_CENTER 可以添加到 glTF 资产`的`根节点的翻译组件。
- `POSITION`、`COLOR`和`NORMAL 等`要素表属性可以存储为 glTF 属性。
- [`EXT_meshopt_compression`](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Vendor/EXT_meshopt_compression)和[`KHR_mesh_quantization`](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_mesh_quantization)可用于点云压缩。glTF 不直接支持[`3DTILES_draco_point_compression ，因为`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_draco_point_compression/)[`KHR_draco_mesh_compression`](https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_draco_mesh_compression)仅支持三角形网格。
- 可以使用[`EXT_mesh_features`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features)和[`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)表示批次 ID 和批次表。
- `CONSTANT_RGBA`在 glTF 中不直接支持，但可以通过材质或逐点颜色来实现。

![积分](https://github.com/CHENJIAMIAN/Blog/assets/20126997/11ca3680-0747-45a3-b943-029c14fea29a)

图 C.3 — 3D Tiles 1.0 中的点云，以及 3D Tiles 1.1 中的相应表示

## C.4.  复合 (cmpt)

[Composite](https://portal.ogc.org/files/102132#tileformats-composite-composite)的所有内部内容都可以组合成相同的 glTF 作为单独的节点、网格或基元，由 tileset 作者自行决定。或者，一个图块可以有[多个内容](https://portal.ogc.org/files/102132#core-tile-content)。

# **附件 D** (资料性) **可用性索引**

## D.1.  从瓦片坐标转换为莫顿指数

[Morton 指数](https://en.wikipedia.org/wiki/Z-order_curve)是通过交错图块的`(x, y)`或`(x, y, z)`坐标的位来计算的。具体来说：

```js
quadtreeMortonIndex = interleaveBits(x, y);
octreeMortonIndex = interleaveBits(x, y, z);
```

例如：

```js
// 四叉树
交错位( 0b11 , 0b00 ) = 0b0101交错位( 0b1010 , 0b0011 ) = 0b01001110交错位( 0b0110 , 0b0101 ) = 0b00110110 // 八叉树交错位( 0b001 , 0b0 10 , 0b100 ) = 0b100010001 interleaveBits ( 0b111 , 0b000 , 0b111 ) = 0b101101101






```

![莫顿秩序](https://github.com/CHENJIAMIAN/Blog/assets/20126997/c99e0a04-faa6-44c9-93db-9fa51e51b8e8)

图 D.1——基于四叉树三层瓦片坐标计算 Morton 指数的示例

## D.2.  可用性比特流长度

表 D.1——可用性比特流长度

| 可用性类型  | 长度(位)                        | 描述                                                                |
| ----------- | ------------------------------- | ------------------------------------------------------------------- |
| Tile 可用性 | `(N^subtreeLevels - 1)/(N - 1)` | 子树中的节点总数                                                    |
| 内容可用性  | `(N^subtreeLevels - 1)/(N - 1)` | 由于每个 tile 最多有一个内容，因此这与 tile availability 的长度相同 |
| 子树可用性  | `N^subtreeLevels`               | 比子树最深一层更深一层的节点数                                      |

其中`N`对于四叉树为 4，对于八叉树为 8。

这些长度以比特流中的比特数表示。要计算比特流的字节长度，使用以下公式：

```js
lengthBytes = ceil(lengthBits / 8);
```

## D.3.  访问可用性位

对于图块可用性和内容可用性，Morton 索引仅确定子树的单个级别内的排序。由于可用性比特流为子树的每个级别存储比特，因此应计算级别偏移量。

给定一个 tile 相对于子树根的`(level, mortonIndex)`，相应位的索引可以用以下公式计算：

表 D.2——可用性补偿

| 数量                    | 公式                        | 描述                                                   |
| ----------------------- | --------------------------- | ------------------------------------------------------ |
| `levelOffset`           | `(N^level - 1) / (N - 1)`   | `这是第 1、2`层、...(第 - 1 层)的节点数``              |
| `tileAvailabilityIndex` | `levelOffset + mortonIndex` | 缓冲区视图中的索引是图块级别的偏移量加上图块的莫顿索引 |

其中`N`对于四叉树为 4，对于八叉树为 8。

由于子树可用性存储单个级别的位，因此不需要 levelOffset，即`childSubtreeAvailabilityIndex = mortonIndex`，其中`mortonIndex`是所需子树相对于当前子树根的 Morton 索引。

## D.4.  全局和局部图块坐标

使用图块坐标时，重要的是要考虑坐标相对于哪个图块。隐式 Tile 中使用了两种主要类型：

- **全局坐标** ——相对于隐式根瓦片的坐标。
- **局部坐标** ——相对于特定子树的根的坐标。

全局坐标用于定位整个隐式瓦片集中的任何瓦片。例如，模板 URI 使用全局坐标来定位内容文件和子树。同时，本地坐标用于在单个子树文件中定位数据。

在二进制中，瓦片的全局莫顿索引是从隐式根瓦片到瓦片的完整路径。这是从隐式根瓦片到子树根瓦片的路径的串联，后跟从子树根瓦片到瓦片的路径。这可以用以下等式表示：

```js
Tile。globalMortonIndex = concatBits ( subtreeRoot.globalMortonIndex , tile.localMortonIndex ) _ _ _ _
```

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/34696603-3f6c-4e0c-bb96-ccda61ffb1fe)

图 D.2——说明如何根据包含子树的根的全局莫顿索引和该子树中的图块的局部莫顿索引来计算图块的全局莫顿索引

类似地，瓦片的全局级别是从隐式根瓦片到瓦片的路径长度。这是子树根瓦片的全局级别和瓦片相对于子树根瓦片的本地级别的总和：

```js
Tile。全局级别=子树根。全球水平+Tile。本地级别
```

![download](https://github.com/CHENJIAMIAN/Blog/assets/20126997/938673f3-8e7f-4ebb-b2a4-7d9f4876f06e)

图 D.3 — 说明如何从包含子树的根的全局级别和该子树中的图块的局部级别计算图块的全局级别

`(x, y, z)`坐标遵循与 Morton 指数相同的模式。唯一的区别是位的连接是按组件进行的。那是：

```js
Tile。globalX = concatBits ( subtreeRoot.globalX , tile.localX )瓦片。_ _ _ _ globalY = concatBits ( subtreeRoot . globalY , tile . localY ) // 只有八叉树tile . globalZ = concatBits ( subtreeRoot.globalZ , tile.localZ ) _ _ _ _
```

![全局到局部 XY 坐标](https://github.com/CHENJIAMIAN/Blog/assets/20126997/cafc3851-a9db-4128-ad7c-d6db7ee544fa)

图 D.4——从包含子树的全局坐标和该子树中的局部坐标计算全局图块坐标的图示。

## D.5.  查找父子磁贴

也可以通过对 Morton 索引的按位运算来计算父或子图块的坐标。以下公式适用于局部坐标和全局坐标。

```js
儿童Tile。级别=父图块。级别+ 1 childTile 。mortonIndex = concatBits ( parentTile.mortonIndex , childIndex ) childTile 。_ _ x = concatBits ( parentTile.x , childX ) childTile 。_ _ y = concatBits ( parentTile.y , childY ) //仅八叉树childTile .





z = concatBits ( parentTile.z , childZ ) _ _
```

在哪里：

- ` childIndex是``[0, N) `范围内的整数，它是子瓦片相对于父瓦片的索引。
- `childX`、`childY`和`childZ`是单个位，表示子级在每个方向上位于父级边界体积的哪一半。

![父子坐标](https://github.com/CHENJIAMIAN/Blog/assets/20126997/82148992-c715-44c9-bb87-e0a138975782)

图 D.5——父子块坐标计算的图示

# **附件 E** (资料性) **3D 元数据参考实现**

[本文档定义了 3D 元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)中定义的概念的参考实现。3D 元数据规范本身以与语言和格式无关的方式为 3D 内容中的结构化元数据定义了标准格式。此处描述的参考实现是这些概念的实现：

- Schema 是[3D 元数据模式](https://portal.ogc.org/files/102132#metadata-schemas)的基于 JSON 的表示，描述了元[数据](https://portal.ogc.org/files/102132#metadata-referenceimplementation-schema-schema-implementation)的结构和类型[](https://portal.ogc.org/files/102132#metadata-schemas)
- PropertyTable[是](https://portal.ogc.org/files/102132#metadata-referenceimplementation-propertytable-property-table-implementation)[Binary Table Format](https://portal.ogc.org/files/102132#metadata-binary-table-format)的一种形式。它是一种基于 JSON 的描述，描述了如何以二进制形式紧凑地存储大量元数据。

这些序列化格式用作 3D 元数据规范的不同实现的通用基础：

- [3D Tiles Metadata——](https://portal.ogc.org/files/102132#core-metadata)  将元数据分配给 3D Tiles 1.1 中的 tilesets、tiles 和内容
- [`3DTILES_metadata`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_metadata)  — 3D Tiles 1.0 的扩展，将元数据分配给图块集、图块和内容
- [`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata) (glTF 2.0) — 将元数据分配给 glTF 资产中的顶点、纹素和 Feature

## E.1.  属性表实现

3D[元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)将模式定义为元数据结构的描述，以及元数据的不同存储格式。存储元数据的一种形式是[二进制表格式](https://portal.ogc.org/files/102132#metadata-binary-table-format)，其中数据以表的二进制表示形式存储。这样一个表的每一列代表一个类的属性。每行代表符合该类的单个实体。下面是对这种二进制表格式的描述，简称**属性表**。它在以下实现中用作定义元数据存储的基础：

- [3D Tiles Metadata Implicit Tilesets](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)  - 将元数据分配给 3D Tiles tileset 中的 tilesets、tiles、groups 和内容。为隐式图块层次结构的子树定义属性表，并存储与此类子树的节点相关联的元数据。
- [`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)  — 将元数据分配给 glTF 资产中的顶点、纹素和 Feature。属性表在顶级扩展对象中定义。属性值存储在标准 glTF 缓冲区视图中。

[此实现的完整 JSON 模式定义可以在规范的 PropertyTable 目录](https://github.com/CesiumGS/3d-tiles/tree/draft-1.1/specification/schema/PropertyTable/)中找到。

### [](https://portal.ogc.org/files/102132#e-1-1-%C2%A0-property-tables)E.1.1.  属性表

_[`在propertyTable.schema.json`](https://portal.ogc.org/files/102132#reference-schema-propertytable)中定义。_

属性表应指定以下元素：

- 它的类(`class)，指的是一个`[Schema](https://portal.ogc.org/files/102132#metadata-referenceimplementation-schema-schema)中的类 ID 。
- `属性 ( properties` )的字典，其中每个条目描述相应类属性的数据的二进制存储。
- 属性表中元素(行)数的计数 ( `count )。`

属性表可能只为其类的属性的一个子集提供值数组，但模式中标记为`required: true的类属性不应被省略。`

注意   tree_survey_2021-09-29 属性表，实现了[架构](https://portal.ogc.org/files/102132#metadata-referenceimplementation-schema-schema)示例中定义的` 树``类 `。该表包含 10 棵树的观察结果。有关类属性的详细信息将在后面的示例中给出。[](https://portal.ogc.org/files/102132#metadata-referenceimplementation-schema-schema)

```js
"模式" ：{ ... }，"propertyTables" ：[{ "名称" ："tree_survey_2021-09-29" ，"类" ："树" ，"计数" ：10 ，"属性" ：{ "物种" : { ... }, "age" : { ... }, "height" : { ... }, // "diameter" 不是必需的，已从该表中省略。} }]

 
 
 
 
   
   
   
   
 
```

### [](https://portal.ogc.org/files/102132#e-1-2-%C2%A0-property-table-properties)E.1.2.  属性表属性

_[`在propertyTable.schema.json`](https://portal.ogc.org/files/102132#reference-schema-propertytable)中定义。_

属性表中的每个属性定义代表该表的一列。[此列数据以二进制形式存储，使用 3D 元数据规范的二进制表格式](https://portal.ogc.org/files/102132#metadata-binary-table-format)部分中定义的编码。实际数据存储在二进制缓冲区中，属性指的是该缓冲区的一部分，称为*缓冲区视图*。

- 在[3D Tiles Metadata](https://portal.ogc.org/files/102132#core-metadata)实现中，缓冲区视图被定义为[隐式 tilesets 中子树](https://portal.ogc.org/files/102132#implicittiling-buffers-and-buffer-views)的一部分。
- 在 3D Tiles 1.0 的[`3DTILES_metadata`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_metadata)扩展中，缓冲区视图被定义为[`3DTILES_implicit_tiling`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_implicit_tiling#buffers-and-buffer-views)[扩展](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_implicit_tiling#buffers-and-buffer-views)[中子树``](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_implicit_tiling#buffers-and-buffer-views)的一部分。
- 在[`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)中，缓冲区视图是标准的 glTF 缓冲区视图。

每个属性条目的确切结构取决于[属性类型](https://portal.ogc.org/files/102132#metadata-property)：

- 每个属性定义都应定义存储实际值原始数据的`值。`
- 具有`STRING`组件类型的属性应定义 stringOffsets `，`如[Strings](https://portal.ogc.org/files/102132#metadata-strings)中所定义。
- 可变长度数组的属性应定义 arrayOffsets `，如`[Arrays](https://portal.ogc.org/files/102132#metadata-arrays)中所定义。

对于可变长度的字符串数组，stringOffsets`和`arrayOffsets`都是`必需的。

注 1  前面示例中的属性表，包含有关属性值二进制存储的详细信息

```js
{ "propertyTables" ：[{ "name" ："tree_survey_2021-09-29" ，"class" ："tree" ，"count" ：10 ，"properties" ：{ "species" ：{ "values" ：2 ，"stringOffsets" : 3 }, "age" : { "values" : 1 }, "height" : { "values" : 0 }, // "diameter" 不是必需的，已从该表中省略。 } } ]
 
   
   
   
   
     
       
       
     
     
       
     
     
       
     
     
   
 
}
```

每个缓冲区视图`byteOffset`应与相应属性的[`componentType`](https://portal.ogc.org/files/102132#metadata-component-type)大小的倍数对齐。

注 2  创作工具可以选择将所有缓冲区视图对齐到 8 字节边界以保持一致性，但客户端实现应该仅依赖于包含 64 位组件类型的缓冲区视图的 8 字节对齐。

对于`arrayOffsets`和`stringOffsets`缓冲区视图，该属性还可以定义`arrayOffsetType`和`stringOffsetType`，它们分别描述数组和字符串偏移量的存储类型。允许的类型是`UINT8`、`UINT16`、`UINT32`和`UINT64`。默认值为`UINT32`。

属性可以覆盖类中属性定义的[`最小值`和`最大值`](https://portal.ogc.org/files/102132#metadata-minimum-and-maximum-values)以及[`偏移量`和`比例`](https://portal.ogc.org/files/102132#metadata-offset-and-scale)[，以说明存储在属性表中的实际值范围。](https://portal.ogc.org/files/102132#metadata-minimum-and-maximum-values)

## E.2.  模式实施

3D[元数据规范将](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)[模式](https://portal.ogc.org/files/102132#metadata-schemas)定义为元数据结构的描述，由具有不同属性的类和枚举类型组成。以下是此类模式及其元素的基于 JSON 的表示形式的描述。它在以下实现中用作定义元数据结构的基础：

- [3D Tiles Metadata Implicit Tilesets](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)  - 将元数据分配给 3D Tiles tileset 中的 tilesets、tiles、groups 和内容。为隐式图块层次结构的子树定义属性表，并存储与此类子树的节点相关联的元数据。
- [`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata)  — 将元数据分配给 glTF 资产中的顶点、纹素和 Feature。属性表在顶级扩展对象中定义。属性值存储在标准 glTF 缓冲区视图中。

[可以在规范的 Schema 目录](https://github.com/CesiumGS/3d-tiles/tree/draft-1.1/specification/schema/Schema/)中找到此实现的完整 JSON 架构定义。

### [](https://portal.ogc.org/files/102132#e-2-1-%C2%A0-schema)E.2.1.  图式

_[`在schema.schema.json`](https://portal.ogc.org/files/102132#reference-schema-schema)中定义。_

模式定义了一组类和枚举。类充当实体的模板。它们提供属性列表和这些属性的类型信息。枚举定义枚举属性的允许值。

注意   具有`树`类和定义不同树种的`speciesEnum枚举的模式。`后面的例子更详细地展示了这些结构。

```js
{ "架构" ：{ "类" ：{ "树" ：{ ... }，"枚举" ：{ "物种枚举" ：{ ... } } } }
 
   
     
   
     
   
 
```

#### [](https://portal.ogc.org/files/102132#e-2-1-1-%C2%A0-class)E.2.1.1.Class

_[`在class.schema.json`](https://portal.ogc.org/files/102132#reference-schema-class)中定义。_

类是元数据实体的模板。类提供属性定义列表。每个实体都应与一个类关联，实体的属性应符合类的属性定义。属性符合类的实体被认为是该类的实例。

类被定义为`schema.classes`字典中的条目，由类 ID 索引。类 ID 应是 3D 元数据规范中定义的[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

注意   一个"树"类，它可能描述了在公园里进行的树木测量表。属性定义在这里略写，下一节介绍。

```js
{ "模式" ：{ "类" ：{ "树" ：{ "名称" ："树" ，"描述" ："多年生木本植物。" ，"属性" ：{ "物种" ：{ ... }，"年龄" ：{ ... }，"身高" ：{ ... }，"直径" ：{ ... }} } }} } }
 
   
     
       
       
       
         
         
         
         
       
     
   
 
```

#### [](https://portal.ogc.org/files/102132#e-2-1-2-%C2%A0-class-property)E.2.1.2.类属性

_[`在class.property.schema.json`](https://portal.ogc.org/files/102132#reference-schema-class-property)中定义。_

类属性是在类中抽象定义的。该类使用符合这些属性的特定值进行实例化。类属性支持多种数据类型。有关受支持类型的详细信息，请参阅[3D 元数据规范](https://portal.ogc.org/files/102132#metadata-property)。

类属性定义为`class.properties`字典中的条目，由属性 ID 索引。属性 ID 应是 3D 元数据规范中定义的[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

注意   一个"树"类，它可能描述了在公园里进行的树木测量表。属性包括每棵树的种类、年龄、高度和直径。

```js
{ "模式" ：{ "类" ：{ "树" ：{ "名称" ："树" ，"描述" ："多年生木本植物。" , "properties" : { "species" : { "description" : "树的类型。" , "type" : "ENUM" , "enumType" : "speciesEnum" , "required" : true }, "age"
 
   
     
       
       
       
         
           
           
           
           
         
         
           
            "type" ："SCALAR" ，"componentType" ："UINT8" ，"required" ：true }，"height" ：{ "description" ："从地面测量的树高，以米为单位。" , "type" : "SCALAR" , "componentType" : "FLOAT32" }, "diameter" : { "description" : "树干底部的直径，以米为单位。" ，"类型" ："标量"
           
           
         
         
           
           
           
         
         
           
           
           
         
       
     
    } } }
 
```

#### [](https://portal.ogc.org/files/102132#e-2-1-3-%C2%A0-enum)E.2.1.3.枚举

_[`在enum.schema.json`](https://portal.ogc.org/files/102132#reference-schema-enum)中定义。_

一组分类类型，定义为`(名称，值)`对。枚举属性使用枚举作为它们的类型。

枚举被定义为`schema.enums`字典中的条目，由枚举 ID 索引。枚举 ID 应是 3D 元数据规范中定义的[标识符。](https://portal.ogc.org/files/102132#metadata-identifiers)

注意   定义树木类型的"物种"枚举。"未指定"枚举值是可选的，但当作为属性的`noData`值提供时(请参阅： [3D 元数据 - 无数据值](https://portal.ogc.org/files/102132#metadata-required-properties-no-data-values-and-default-values))可能有助于识别缺失数据。

```js
{ "schema" ：{ "enums" ：{ "speciesEnum" ：{ "name" ："Species" ，"description" ："树种的示例枚举。" , "values" : [ { "name" : "Unspecified" , "value" : 0 }, { "name" : "Oak" , "value" : 1 }, { "name" : "Pine" ,
 
   
     
       
       
       
         
         
         
          ："枫树" ，"价值" ：3 } ] } } } }
       
     
   
 
```

#### [](https://portal.ogc.org/files/102132#e-2-1-4-%C2%A0-enum-value)E.2.1.4.枚举值

_[`在enum.value.schema.json`](https://portal.ogc.org/files/102132#reference-schema-enum-value)中定义。_

成对的`(名称，值)`条目表示枚举属性的可能值。

枚举值定义为`enum.values`数组中的条目。不允许重复的名称或重复的整数值。

# **附件 F** (资料性) **3D 元数据语义参考**

## F.1.  概述

本文档提供了 3D Tiles 和 glTF 中元数据属性使用的含义("语义")的通用定义。Tileset 作者可以单独定义他们自己的应用程序或特定领域的语义。

语义描述了应该如何解释属性。例如，在解析数据集时遇到`ID`或`NAME`语义的应用程序可能会将这些值分别用作唯一标识符或人类可读标签。

每个语义都是根据它的含义和它可能采用的数据类型来定义的。[数据类型规范包括 3D 元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)定义的"类型" 。适用时，它们还可能包括"组件类型"、"数组"和"计数"。

有关语义的使用，请参见：

- [3D Tiles Metadata——](https://portal.ogc.org/files/102132#core-metadata)  将元数据分配给 3D Tiles 1.1 中的 tilesets、tiles 和内容
- [`3DTILES_metadata`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_metadata)  — 3D Tiles 1.0 的扩展，将元数据分配给图块集、图块和内容
- [`EXT_structural_metadata`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_structural_metadata) (glTF 2.0) — 将元数据分配给 glTF 资产中的顶点、纹素和 Feature

## F.2.  一般的

### [](https://portal.ogc.org/files/102132#f-2-1-%C2%A0-overview)F.2.1.  概述

在本节中，术语"实体"指的是可能与属性值(如[3D 元数据规范](https://portal.ogc.org/files/102132#metadata-3d-metadata-specification)中定义)相关联的任何概念对象。实体的示例包括 3D Tiles 中的图块集、图块和图块内容，或 glTF 2.0 资产中的顶点和纹素组。其他类型的实体可以由其他规范或应用程序定义。

### [](https://portal.ogc.org/files/102132#f-2-2-%C2%A0-general-semantics)F.2.2.  一般语义

表 F.1——通用元数据语义

| 语义的                | 类型                                                                                     | 描述                                                                                                                                                                                                                                                                                                                                      |
| --------------------- | ---------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `ID`                  | \* 类型：`STRING`                                                                        | 实体的唯一标识符。                                                                                                                                                                                                                                                                                                                        |
| `name`                | \* 类型：`STRING`                                                                        | 实体的名称。名称应该是人类可读的，并且不必是唯一的。                                                                                                                                                                                                                                                                                      |
| `描述`                | \* 类型：`STRING`                                                                        | 实体的描述。通常至少是一个短语，也可能是几个句子或段落。                                                                                                                                                                                                                                                                                  |
| `ATTRIBUTION_IDS`     | _ 类型：`标量` <br/>_ 组件类型：`UINT8`、`UINT16`、`UINT32`或`UINT64` <br/>\* 数组：`真` | 索引到属性字符串全局列表中的属性 ID 列表。这种语义可以分配给任何粒度级别的元数据，包括瓦片 <br/>、组、子树、瓦片、内容、Feature、顶点和纹素粒度。属性字符串的全局列表位于具有属性语义`ATTRIBUTION_STRINGS 的`tileset 或子树中。以下优先顺序用于定位属性字符串：首先是包含子树(如果适用)，然后是包含外部瓦片集(如果适用)，最后是根瓦片集。 |
| `ATTRIBUTION_STRINGS` | _ 类型：`STRING` <br/>_ 数组：`真`                                                       | 属性字符串列表。每个字符串都包含有关数据提供者或版权文本的信息。文本可能包含嵌入式标记语言，例如 HTML。这种语义可以分配给任何粒度的元数据(任何可以编码`STRING属性值的地方)。`当与`ATTRIBUTION_IDS`结合使用时，它被分配给子树和 tilesets。                                                                                                 |

## F.3. 3D Tile

### [](https://portal.ogc.org/files/102132#f-3-1-%C2%A0-overview)F.3.1.  概述

3D Tiles 的语义根据 3D Tiles 规范定义的 tileset、子树、tile 或 tile 内容进行分配。当与其他类型的实体相关联时，这些语义可能具有无效或未定义的含义。

所有直线距离的单位都是米，所有角度的单位都是弧度。

### [](https://portal.ogc.org/files/102132#f-3-2-%C2%A0-tileset)F.3.2.  瓦片集

#### [](https://portal.ogc.org/files/102132#f-3-2-1-%C2%A0-overview)F.3.2.1.概述

`TILESET_*`语义为与 tileset 关联的属性提供含义。

#### [](https://portal.ogc.org/files/102132#f-3-2-2-%C2%A0-tileset-semantics)F.3.2.2.瓦片集语义

表 F.2——Tileset 元数据语义

| 语义的                         | 类型                               | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ------------------------------ | ---------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `TILESET_FEATURE_ID_LABELS`    | _ 类型：`STRING` <br/>_ 数组：`真` | [`使用EXT_mesh_features`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_mesh_features)和[`EXT_instance_features`](https://github.com/CesiumGS/glTF/tree/3d-tiles-next/extensions/2.0/Vendor/EXT_instance_features)扩展合并 glTF 内容中的所有 Feature ID 标签。                                                                                                                                                                                                                                                                        |
| `TILESET_CRS_GEOCENTRIC`       | \* 类型：`STRING`                  | tileset 的地心坐标参考系统 (CRS)。值包括但不限于：- `"EPSG:4978"`  ——WGS 84 <br/>_ `"EPSG:7656"`  — WGS 84 (G730) <br/>_ `"EPSG:7658"`  — WGS 84 (G873) <br/>_ `"EPSG:7660"`  — WGS 84 (G1150) <br/>_ `"EPSG:7662"`  — WGS 84 (G1674) <br/>_ `"EPSG:7664"`  — WGS 84 (G1762) <br/>_ `"EPSG:9753"`  — WGS 84 (G2139) <br/>\* `"UNKNOWN"`  — CRS 未知`假定区域`包围体使用与此处指定的地心坐标参考系相同的参考椭球体。有关 3D Tiles 中坐标参考系统的更多详细信息，请参阅[坐标参考系统 (CRS)](https://portal.ogc.org/files/102132#core-coordinate-reference-system-crs)。 |
| `TILESET_CRS_COORDINATE_EPOCH` | \* 类型：`STRING`                  | 参考动态 CRS(例如 WGS 84)的坐标的坐标纪元。坐标包括应用变换后的 glTF 顶点位置——请参阅[glTF 变换](https://portal.ogc.org/files/102132#core-gltf-transforms)。表示为十进制年份(例如`"2019.81"`)。有关更多详细信息，请参阅[坐标纪元和坐标元数据的 WKT 表示。](http://docs.opengeospatial.org/is/18-010r7/18-010r7.html#128)                                                                                                                                                                                                                                              |

### [](https://portal.ogc.org/files/102132#f-3-3-%C2%A0-tile)F.3.3.  瓦

#### [](https://portal.ogc.org/files/102132#f-3-3-1-%C2%A0-overview)F.3.3.1.概述

`TILE_*`语义为与特定图块关联的属性提供含义，并且应优先于父对象上的等效元数据，以及从[隐式 Tile](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)中的细分方案派生的值。

如果缺少属性值，要么是因为省略了属性，要么是属性表包含`noData`值，则会使用原始图块属性，例如在 tileset JSON 中明确定义的属性或从[隐式 Tile](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)中的细分方案隐式计算的属性。

特别是，`TILE_BOUNDING_BOX`、`TILE_BOUNDING_REGION`和`TILE_BOUNDING_SPHERE`语义各自为图块定义了比从[隐式 Tile 隐式](https://portal.ogc.org/files/102132#implicittiling-implicit-tiling)计算的更具体的边界体积。如果这些语义中的一种以上可用于磁贴，则客户可以根据用例和性能要求选择最合适的选项。

#### [](https://portal.ogc.org/files/102132#f-3-3-2-%C2%A0-tile-semantics)F.3.3.2.Tile 语义

表 F.3——图块元数据语义

| 语义的                          | 类型                                                                                     | 描述                                                                                                                                                                                                                                                                                                                              |
| ------------------------------- | ---------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `TILE_BOUNDING_BOX`             | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64` <br/>_ 数组：`真` <br/>_ 数量：`12` | tile 的边界体积，表示为[box](https://portal.ogc.org/files/102132#core-box)。相当于`tile.boundingVolume.box`。                                                                                                                                                                                                                     |
| `TILE_BOUNDING_REGION`          | _ 类型：`标量` <br/>_ 组件类型：`FLOAT64` <br/>_ 数组：`真` <br/>_ 数量：`6`             | tile 的边界体积，表示为[region](https://portal.ogc.org/files/102132#core-region)。相当于`tile.boundingVolume.region`。                                                                                                                                                                                                            |
| `TILE_BOUNDING_SPHERE`          | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64` <br/>_ 数组：`真` <br/>_ 数量：`4`  | tile 的边界体积，表示为[sphere](https://portal.ogc.org/files/102132#core-sphere)。相当于`tile.boundingVolume.sphere`。                                                                                                                                                                                                            |
| `TILE_BOUNDING_S2_CELL`         | _ 类型：`标量` <br/>_ 组件类型：`UINT64`                                                 | 图块的边界体积，使用 64 位表示而不是十六进制表示表示为[S2 单元 ID 。](https://github.com/ <br/>\*siumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md#cell-ids)仅适用于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/ <br/>DTILES_bounding_volume_S2/README.md)。 |
| `TILE_MINIMUM_HEIGHT`           | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                     | WGS84 椭球体上方(或下方)的最小高度。相当于`TILE_BOUNDING_REGION`和`tile.boundingVolume. <br/>*gion`的最小高度组件。也相当于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md)的最小高度组 <br/>。                                                     |
| `TILE_MAXIMUM_HEIGHT`           | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                     | WGS84 椭球体上方(或下方)的最大高度。相当于`TILE_BOUNDING_REGION`和`tile.boundingVolume. <br/>*gion`的最大高度组件。也相当于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md)的最大高度分 <br/>。                                                     |
| `TILE_HORIZON_OCCLUSION_POINT`1 | _ 类型：`VEC3` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                     | Tile 的地平线遮挡点以椭圆体比例的固定框架表示。如果此点在地平线以下，则整个图块都在地平线以下。有关详细信息，请参阅[地平线剔除。](https://cesium.com/blog/2013/04/25/horizon-culling/)                                                                                                                                            |
| `TILE_GEOMETRIC_ERROR`          | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                     | Tile 的几何误差。相当于`tile. <br/>*ometricError`。 <br/>                                                                                                                                                                                                                                                                         |
| `TILE_REFINE`                   | _ 类型：`标量` <br/>_ 组件类型：`UINT8`                                                  | 磁贴优化类型。有效值为`0` ( `"ADD"` ) 和`1` ( `"REPLACE"` )。相当于`tile. <br/>*fine`。 <br/>                                                                                                                                                                                                                                     |
| `TILE_TRANSFORM`                | _ 类型：`MAT4` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                     | Tile 变换。相当于`tile.transform`。                                                                                                                                                                                                                                                                                               |

1 `TILE_HORIZON_OCCLUSION_POINT`应说明图块及其后代中的所有内容，而`CONTENT_HORIZON_OCCLUSION_POINT`应仅说明图块中的内容。当两个值相等时，只应指定`TILE_HORIZON_OCCLUSION_POINT 。`

### [](https://portal.ogc.org/files/102132#f-3-4-%C2%A0-content)F.3.4.  内容

#### [](https://portal.ogc.org/files/102132#f-3-4-1-%C2%A0-overview)F.3.4.1.概述

`CONTENT_*`语义为与图块内容关联的属性提供含义，并且可能比包含图块的属性更具体到该内容。

`CONTENT_BOUNDING_BOX`、`CONTENT_BOUNDING_REGION`和`CONTENT_BOUNDING_SPHERE`语义分别为图块内容定 ​​ 义比图块边界体积更具体的边界体积。如果这些语义中有多个可用于相同的内容，则客户端可以根据用例和性能要求选择最合适的选项。

#### [](https://portal.ogc.org/files/102132#f-3-4-2-%C2%A0-content-semantics)F.3.4.2.内容语义

表 F.4——内容元数据语义

| 语义的                             | 类型                                                                                    | 描述                                                                                                                                                                                                                                                                                                                               |
| ---------------------------------- | --------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `CONTENT_BOUNDING_BOX`             | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`<br/>_ 数组：`真` <br/>_ 数量：`12` | tile 内容的边界体积，表示为[box](https://portal.ogc.org/files/102132#core-box)。相当于`tile.content.boundingVolume.box`。                                                                                                                                                                                                          |
| `CONTENT_BOUNDING_REGION`          | _ 类型：`标量` <br/>_ 组件类型：`FLOAT64` <br/>_ 数组：`真` <br/>_ 数量：`6`            | tile 内容的边界体积，表示为[region](https://portal.ogc.org/files/102132#core-region)。相当于`tile.content.boundingVolume.region`。                                                                                                                                                                                                 |
| `CONTENT_BOUNDING_SPHERE`          | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64` <br/>_ 数组：`真` <br/>_ 数量：`4` | tile 内容的边界体积，表示为[sphere](https://portal.ogc.org/files/102132#core-sphere)。相当于`tile.content.boundingVolume.sphere`。                                                                                                                                                                                                 |
| `CONTENT_BOUNDING_S2_CELL`         | _ 类型：`标量` <br/>_ 组件类型：`UINT64`                                                | 图块内容的边界体积，使用 64 位表示而不是十六进制表示表示为[S2 单元 ID 。](https://github.com/<br/>esiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md#cell-ids)仅适用于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/<br/>DTILES_bounding_volume_S2/README.md)。 |
| `CONTENT_MINIMUM_HEIGHT`           | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                    | WGS84 椭球上方(或下方)的图块内容的最小高度。相当于`CONTENT_BOUNDING_REGION`和`tile.content.<br/>oundingVolume.region`的最小高度组件。也相当于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md)的最小高度组<br/>。                                     |
| `CONTENT_MAXIMUM_HEIGHT`           | _ 类型：`标量` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                    | WGS84 椭球上方(或下方)的图块内容的最大高度。相当于`CONTENT_BOUNDING_REGION`和`tile.content.<br/>oundingVolume.region`的最大高度组件。也相当于[`3DTILES_bounding_volume_S2`](https://github.com/CesiumGS/3d-tiles/tree/main/extensions/3DTILES_bounding_volume_S2/README.md)的最大高度分<br/>。                                     |
| `CONTENT_HORIZON_OCCLUSION_POINT`1 | _ 类型：`VEC3` <br/>_ 组件类型：`FLOAT32`或`FLOAT64`                                    | 以椭圆体比例固定框架表示的图块内容的水平遮挡点。如果这个点在地平线以下，则整个内容都在地平线以下。有关详细信息，请参阅[地平线剔除。](https://cesium.com/blog/2013/04/25/horizon-culling/)                                                                                                                                          |
| `内容_URI`                         | \* 类型：`STRING`                                                                       | 内容 uri。覆盖隐式磁贴生成的内容 uri。相当于`tile.content.uri`。                                                                                                                                                                                                                                                                   |
| `CONTENT_GROUP_ID`                 | _ 类型：`标量` <br/>_ 组件类型：`UINT8`、`UINT16`、`UINT32`或`UINT64`                   | 内容组 ID。相当于`tile.content.group`。                                                                                                                                                                                                                                                                                            |

1 `TILE_HORIZON_OCCLUSION_POINT`应说明图块及其后代中的所有内容，而`CONTENT_HORIZON_OCCLUSION_POINT`应仅说明图块中的内容。当两个值相等时，只应指定`TILE_HORIZON_OCCLUSION_POINT 。`

# **附件 G** (资料性) **贡献者**

编辑：

- 帕特里克·科齐，[@pjcozzi](https://twitter.com/pjcozzi)，<patrick@cesium.com>
- 肖恩·利利，[@](https://twitter.com/lilleyse) lilleyse ，<sean@cesium.com>

致谢：

- 加比盖茨，[@gabbygetz](https://twitter.com/gabbygetz)
- 马特·阿马托，[@matt_amato](https://twitter.com/matt_amato)
- 埃里克·安德森，[@e-andersson](https://github.com/e-andersson)
- 丹·巴格内尔，[@bagnell](https://github.com/bagnell)
- 雷宾利
- 詹尼斯博林，[@jbo023](https://github.com/jbo023)
- 约翰博格
- 迪伦·布朗，[@Dylan-Brown](http://www.github.com/Dylan-Brown)
- Sarah Chow，[cesium.com/team/SarahChow](https://cesium.com/team/SarahChow/)
- 保罗·康奈利
- 沃尔克库尔斯
- 埃里克·达尔斯特罗姆，[@erikdahlstrom](https://github.com/erikdahlstrom)
- 汤姆菲利，[@CesiumFili](https://twitter.com/CesiumFili)
- 丽萨·菲尼，[@LeesaFini](http://www.github.com/LeesaFini)
- 彼得·加利亚尔迪，[@ptrgags](https://github.com/ptrgags)
- 拉尔夫古特贝尔
- 弗雷德里克·胡比
- 马可·哈特，[@javagl](https://github.com/javagl)
- 丹尼尔克鲁普卡，[@krupkad](https://github.com/krupkad)
- 伊恩·利利，[@IanLilleyT](https://github.com/IanLilleyT)
- 唐麦柯迪，[@donmccurdy](https://github.com/donmccurdy)
- Christopher Mitchell，博士，[@KermMartian](https://github.com/KermMartian)
- 谢赞穆罕默德，[@shehzan10](https://github.com/shehzan10)
- 克劳斯内格尔
- 让-菲利普庞斯
- 卡尔·里德
- 凯文·林 (Kevin Ring)，[www.kotachrome.com/kevin](http://www.kotachrome.com/kevin/)
- 斯科特·西蒙斯
- Sam Suhag，[@sanjeetsuhag](https://github.com/sanjeetsuhag)
- Rob Taglang，[@lasalvavida](https://github.com/lasalvavida)
- 斯坦蒂尔曼
- 皮耶罗·托法宁，[@pierotofy](https://github.com/pierotofy)
- Bao Tran，[@baothientran](https://github.com/baothientran)
- 塞缪尔巴尔加斯，[@samulus](https://github.com/samulus)
- 帕诺·沃杜里斯
- 戴夫韦斯洛

# **附件 H** (资料性) **修订历史**

| 日期       | 发布  | 编辑      | 主要条款已修改 | 描述                                                                                 |
| ---------- | ----- | --------- | -------------- | ------------------------------------------------------------------------------------ |
| 2022-07-26 | 1.1.0 | 肖恩·里利 | 全部           | 这是本文件的第一个规范版本。                                                         |
| 2022-08-17 | 1.1.0 | 肖恩·里利 |                | 添加了关于矩阵的弧度选择、边界框表示和列主序的解释性说明。修复了格式问题和拼写错误。 |
| 2022-08-18 | 1.1.0 | 肖恩·里利 |                | 生成的文档的 HTML 版本。                                                             |
